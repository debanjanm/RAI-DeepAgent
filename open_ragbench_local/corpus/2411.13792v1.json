{"title": "Multiscale Markowitz", "sections": [{"section_id": 0, "text": "#### Abstract\n\nTraditional Markowitz portfolio optimization constrains daily portfolio variance to a target value, optimising returns, Sharpe or variance within this constraint. However, this approach overlooks the relationship between variance at different time scales, typically described by $\\sigma(\\Delta t) \\propto(\\Delta t)^{H}$ where $H$ is the Hurst exponent, most of the time assumed to be $\\frac{1}{2}$. This paper introduces a multifrequency optimization framework that allows investors to specify target portfolio variance across a range of frequencies, characterized by a target Hurst exponent $H_{\\text {target }}$, or optimize the portfolio at multiple time scales. By incorporating this scaling behavior, we enable a more nuanced and comprehensive risk management strategy that aligns with investor preferences at various time scales. This approach effectively manages portfolio risk across multiple frequencies and adapts to different market conditions, providing a robust tool for dynamic asset allocation. This overcomes some of the traditional limitations of Markowitz, when it comes to dealing with crashes, regime changes, volatility clustering or multifractality in markets. We illustrate this concept with a toy example and discuss the practical implementation for assets with varying scaling behaviors.", "tables": {}, "images": {}}, {"section_id": 1, "text": "## 1 Introduction\n\nIn the classical Markowitz portfolio optimization framework, the daily variance is typically constrained to a predefined maximum value, such that $\\sum_{i} \\sigma_{i}^{2}<\\sigma_{\\text {target }}^{2}$. The objective is then to maximize returns while adhering to this variance constraint. This approach assumes a fixed variance at a single time scale, usually on a daily basis.\n\nHowever, it is well understood that the variance of asset returns across different time scales is, to a large extent, related by a scaling law of the form:\n\n$$\n\\sigma(\\Delta t) \\propto(\\Delta t)^{H}\n$$\n\nwhere $H=0.5$ for Brownian motion [1]. Despite this, the target portfolio variance is typically defined at only one frequency (commonly daily), without consideration for how variance behaves across other time scales. In practice, it would be reasonable to expect that investors might have target portfolio variances across a range of frequencies, from the fast trade adjustment frequency to long-term portfolio objectives. The most general form of this would be an arbitrary function of scale, $\\sigma_{\\text {target }}^{2}(\\Delta t)$, which need not be continuous or differentiable. This function allows investors to specify their risk preferences over a spectrum of relevant time scales, for example, from one day to one month or more [6].\n\nFor simplicity, however, we can assume self-similarity in the variance structure and instead fix the target scaling behavior, characterized by a target Hurst exponent $H_{\\text {target }}$. This gives us the relationship:\n\n$$\n\\sigma_{\\text {target }}^{2}(\\Delta t) \\propto(\\Delta t)^{H_{\\text {target }}}\n$$\n\nThis approach allows for flexibility in portfolio optimization based on different investor risk preferences across time scales [8]. For example, an investor who is more risk-averse to lower frequency volatility (e.g., weekly returns) than higher frequency volatility (e.g., daily returns) might prefer a target Hurst exponent $H_{\\text {target }}<H_{\\text {market }}$. This situation could arise if a fund seeks to limit drawdowns at lower frequencies, where volatility is naturally higher. Conversely, if an investor is willing to tolerate more variance at lower frequencies, the target Hurst exponent might be set such that $H_{\\text {target }}>H_{\\text {market }}[2]$.\n\nIn this article, we first justify the need for a multifrequency approach to time series analysis through observed stylized facts, such as varying volatility, fat tails and autocorrelation. Then we study a toy example based on multifractality and show how optimal weights in this context depend on the various parameters.\n\nFinally, we evidence on US sector index tracking ETFs the superiority of multifrequency optimization over traditional Markowitz based on daily variances and covariances.", "tables": {}, "images": {}}, {"section_id": 2, "text": "# 1.1 Why Multiscale Optimization? \n\nWe might question why there is a need at all to do multiscale portfolio optimization. Isn't the single scale case enough?\n\nIn reality, two facts occur in stock and stock index prices. On the one hand, non-trivial self-similarity with varying critical exponents has been observed in pricing time series since the time of Mandelbrot (who noticed it for cotton prices). At lower frequencies (weekly and below), momentum appears, i.e. a Hurst exponent above $\\frac{1}{2}$ while fat tails fade away. On the contrary, intraday returns display fatter tails but negative autocorrelation, i.e. a Hurst exponent below $\\frac{1}{2}$.\n\nOn the other hand, periods of high and low volatility operate like an acceleration and slowdown of the time clock. Using a fixed time clock for the return series boils down to using some kind of random time sampling with respect to the market \"volatility time\". We will se that, in fact, volatility is a hidden market variable. In other words, short of considering it as a hidden variable, prices series are not Markovian, despite the Efficient Market Hypothesis, which one to needs to enter into high frequency trading to invalidate it.\n\nThe logic of all this is that investors at marginally different time horizons behave in a similar way. Dynamic phase transitions are also characterised by self similar fixed points (markets show these near crashes and regime shifts). Motivated by this, there are certain cases where Markowitz breaks, particularly when the volatility spikes. Exposures that are calibrated on a low volatility period turn out be way to large for the newly appearing high volatility. We will show that this can be addressed by the multiscale optimization.", "tables": {}, "images": {}}, {"section_id": 3, "text": "### 1.2 Stylised Facts\n\nThe following are typical stylised facts observed in the stock market and in financial markets in general:\n\n- Volatility Clusters Market volatility varies through time in a irregular and time-asymmetric manner. Volatility may suddenly surge following an event or a news that triggers its instability. Then it will take time to progressively decrease.\n- Rough volatility: This causes the volatility of some assets to increase disproportionately at longer scales, causing over-allocation to them [2]. Globally, volatility remains in a limited range, implying a negative autocorrelation of its variations at various time scales.\n- Non-Ellipticity Asset returns exhibit varying fat-tailed distributions subject to the tail concentration effect: under extreme conditions, the number of effective variables driving the market shrinks down to just a few of them. The Hurst exponent also varies, due to market impact eg. illiquids, corporate bonds, PE/VC funds, emerging markets etc. We know that Markowitz generally overallocates to illiquids $[12-14]$.\n- Crashes and Bubbles: During times of crashes, often Markowitz worsens drawdowns as opposed to an equally weighted portfolio [9]. This is because the volatility begins to scale non-trivially with scale. We expect that we see power laws during bubbles as well, with imaginary critical exponents.\n- Stochastic Volatility: This introduces uncertainty on the volatility of the different assets, resulting in instabilities and estimation errors, in addition to non-generizability out of sample [4].\n- Regime Changes: It is unable to handle stochastic regime changes such as shocks induced by changes in interest rates, unemployment numbers, and global macroeconomic and political factors $[7]$.\n\nA lot of these are instances when the volatility becomes increasingly rough, with Hursts substantially different from half, or when tails become disproportionately fat [2]. In the case of market crashes, in fact, that is what really happens. Bubbles too are characterized by Hursts, but those which are imaginary, corresponding to dynamics governed by the Log Periodic Power Law (LPPL). Markowitz is based on the condition of ellipticity, where all stocks have the same Hurst exponents. Therefore, optimal weights at one time scale generalize across scales.", "tables": {}, "images": {}}, {"section_id": 4, "text": "# 2 Motivations\n### 2.1 Fractional Diffusion PDE\n\nWe are motivated by the fact that pricing time series has been shown to exhibit self-similarity in various studies, starting with the time of Mandelbrot [12]. Also self-similar dynamics is at the endpoints of renormalization group flows. We start with the most general non-interacting PDE we can write down describing fractional diffusion in both space and time:\n$\\frac{\\partial^{\\beta} P(x, t)}{\\partial t^{\\beta}}=-K_{\\alpha}(-\\Delta)^{\\alpha} P(x, t)$\nWhere\n\n- $P(x, t)$ is the probability density function\n- $\\frac{\\partial^{\\beta}}{\\partial t^{\\beta}}$ is fractional Caputo derivative (with $0<\\beta<=1$ )\n- $(-\\Delta)^{\\alpha}$ is the fractional Laplacian (Riesz derivative) of order $\\alpha$ (with $0<\\alpha<=2$ )\n- $K_{\\alpha}$ is a generalised diffusion coefficient.\n\nHere we see that there are qualitatively three types of cases:\n\n- Brownian motion $(\\beta=1, \\alpha=2)$ : This case equates to the usual Markowitz case. Here $|x| \\propto t^{0.5}$\n- Fat Tails $(\\beta=1,1<=\\alpha<2)$ : This corresponds to no time dependence but fat tails with a power law $|x| \\propto t^{1 / \\alpha}$\n- Gaussian distribution with time dependence $(0<\\beta<2, \\alpha=2)$ : Here we have the benefit of no fat tails but time dependence causes anomalous scaling $|x| \\propto t^{\\beta}$\n- Time dependence and Fat Tails $(0<\\beta<2,1<=\\alpha<=2)$ : This is the most general base with time dependence and fat tails. Here we have that $|x| \\propto t^{\\beta / \\alpha}$\n\nNote that in most studies, the Hurst is considered to be solely due to time dependence, and $H:=\\beta / 2$. However, this obfuscates the fact that anomalous scaling can be due to both time depedence and fat tails. Hence thereafter in this study, when we refer to the Hurst, we refer to the standardised Hurst defined as\n$H:=\\beta / \\alpha$\nThis recognises that anomalous scaling can be due to both fat tails and time dependence. In a similar vein, in the presence of nonlinearities we can in principle have multifractality due to both the effect of the probability distribution $\\left(\\beta_{n} \\neq n \\beta\\right)$ and the interactions $\\left(\\alpha_{n} \\neq \\alpha / n\\right)$. Analogously, we have a standardised generalized Hurst:\n$H_{n}:=\\beta_{n} / \\alpha_{n}$\nThe direct observable here is the scaling law $|x|^{\\alpha} \\propto t^{H_{n}}$, while it is more subtle to address the contributions of the iid distribution and dependence structure to it, and will not be addressed.\n\nThe discerning reader might be concerned here about the inconsistency of the Markowitz paradigm with the presence of fat tails, since the covariance matrix does not in principle converge under the presence of fat tails. The solution to that is straightforward: one can replace the covariance matrix with the $L^{1}$-modified covariance matrix and solve the optimisation problem:\n$\\min _{w} w_{i} \\Sigma_{i j}^{L^{1}} w_{j}$\nWhere the $L^{1}$-modified covariance matrix is written as:\n$\\Sigma_{i j}^{L^{1}}=\\rho_{i j}\\left|R_{i}-\\bar{R}_{i}\\right|\\left|R_{j}-\\bar{R}_{j}\\right|$\nWhere $\\rho_{i j}$ are just the cross-asset correlations and $\\left|R_{i}-\\bar{R}_{i}\\right|$ and $\\left|R_{j}-\\bar{R}_{j}\\right|$ are absolute deviations from the robust central estimate (median). This will in principle have better convergence properties in the presence of tails, but should not make a substantial difference to the allocations.", "tables": {}, "images": {}}, {"section_id": 5, "text": "## 3 Implementation\n\nIn practice, it would work in the following manner. The returns are invariant under rescaling, so the return maximization condition will remain as is across a range of scales. As we progressively move to\n\nhigher and higher frequencies, we will measure the variance of each asset across a range of frequencies, $\\sigma_{i}^{2}(\\Delta t)$, and then for each frequency we get:\n\n$$\n\\sigma_{\\text {portfolio }}(\\Delta t)^{2}=\\sum_{i} w_{i} w_{j} \\Sigma_{i j}(\\Delta t)\n$$\n\nWe have a few options on how to implement this:\n\n1. For each frequency, we impose maximal return under the constraint $\\sigma_{\\text {portfolio }}(\\Delta t)<\\sigma_{\\text {target }}(\\Delta t)$ where $\\sigma_{\\text {target }}^{2}(\\Delta t) \\propto \\sigma_{\\text {target }}^{2}(\\Delta 1)|\\Delta t|^{H_{\\text {target }}}$. This approach ensures that risk, in the form of variance, is effectively managed across a range of frequencies [5].\n2. Construct a minimum variance or maximal Sharpe portfolios with the variance estimated by taking an average across scales or by averaging weights after multiscale optimization [10]. The alternative is to compute weights across various scales $w_{i}(\\Lambda)$ and then average them out $\\tilde{w}=\\left\\langle w_{i}(\\Lambda)\\right\\rangle_{\\Lambda}$ before renormalization.\n3. Construct a minimum variance or maximal Sharpe portfolio where variance is a multiscale estimate of variance, involving the average over scales $\\Sigma_{i j}=\\left\\langle\\Sigma_{i j}(\\Delta t) /(\\Delta t)\\right\\rangle_{\\Delta t}$.\n\nWe consider only the last case since the first does not sufficiently constrain the portfolio. We use the minimum variance optimisation, the advantage of which is that it directly measures the efficacy of the variance estimator without dependence on the mean estimator [10].Let us see how multi-frequency optimization constrains our weights at a range of scales, beginning with special cases.", "tables": {}, "images": {}}, {"section_id": 6, "text": "# 4 Special Cases\n### 4.1 Elliptical Case\n\nConsider a simplified scenario where all assets exhibit the same standardised Hurst exponent, $H$, so $|x|=|t|^{H}$. Here, although we have anomalous scaling, the optimization problem can be solved at any given frequency, and the resulting solution will be applicable across all frequencies. This is due to the fact that when the scale is varied through a scaling transformation, the portfolio variance is modified by a factor of $\\left(\\Delta t_{1} / \\Delta t_{2}\\right)^{H}[1]$, thus rescaling our optimisation function by a constant.\n\nHowever, in practice, assets often exhibit diverse scaling behaviors with frequency and are typically not self-similar. In such cases, it is necessary to compute the optimization independently at each frequency to account for these differences [6].", "tables": {}, "images": {}}, {"section_id": 7, "text": "### 4.2 General Case\n\nIn a more generalized scenario, the variances and covariances of different assets, denoted as $\\sigma_{i}(\\Delta t)$ and $\\rho_{i}(\\Delta t)$, respectively, can vary arbitrarily with scale and are derived from empirical data. Similarly, the target variance $\\sigma_{\\text {target }}(\\Delta t)$ can be expressed as an arbitrary function of $\\Delta t$. Under these circumstances, the optimization problem is formulated as follows:\n\n- Minimize the portfolio variance: $\\sum_{i} w_{i} \\Sigma_{i j}^{M S} w_{j}$\n- Here $\\Sigma_{i j}^{M S}=<\\Sigma_{i j}(\\Delta t) / \\Delta t>$\n- Ensure portfolio weights across scales sum to one: $\\sum_{i} w_{i}(\\Lambda)=1$\n- Maintain non-negative weights: $w_{i}(\\Lambda) \\geq 0 \\forall i, \\Lambda$\n\nThis general case highlights the complexity of portfolio optimization when dealing with assets that exhibit non-uniform scaling behavior across different time scales.", "tables": {}, "images": {}}, {"section_id": 8, "text": "# 5 Effect of Multifractality\n### 5.1 Introduction to Multifractality\n\nMultifractality in financial time series reflects the idea that different parts of the data may exhibit different scaling behaviors. Unlike a monofractal process, which is characterized by a single Hurst exponent $H$, a multifractal process is described by a spectrum of exponents $H(q)$, where $q$ is a moment order. This spectrum captures the complex, heterogeneous nature of financial markets, where the roughness of returns can vary depending on the time scale and the statistical moment being considered.\n\nIn a multifractal framework, the variance scaling law is generalized to:\n\n$$\n<\\sigma^{q}(\\Delta t)>\\propto(\\Delta t)^{H(q)}\n$$\n\nwhere $H(q)$ is the multifractal scaling function, which depends on the moment $q$. For example, $H(1)$ corresponds to the traditional Hurst exponent used in variance scaling. Multifractality corresponds to $H(q) \\neq q H(1)$", "tables": {}, "images": {}}, {"section_id": 9, "text": "### 5.2 Multifractal Portfolio Variance\n\nTo incorporate multifractality into portfolio optimization, the variance of each asset $i$ at a given time scale $\\Delta t$ is modeled using the multifractal formalism:\n\n$$\n\\sigma_{i}^{q}(\\Delta t) \\propto(\\Delta t)^{H_{i}(q)}\n$$\n\nwhere $H_{i}(q)$ is the multifractal scaling exponent for asset $i$ at moment $q$. For Markowitz, we will be interested in $q=2$ where multifractality implies that $H(2) \\neq 2 H(1)$. Similarly the covariance between stocks $i$ and $j$ scales as:\n\n$$\n\\Sigma_{i j}(\\Delta t)=\\rho_{i j}(\\Delta t) \\sigma_{i}(\\Delta t) \\sigma_{j}(\\Delta t)=(\\Delta t)^{H_{i j}(2)}\n$$\n\nWhere multifractality ensures $H_{i j}(2) \\neq\\left(H_{i}(1)+H_{j}(1)\\right) / 2$. In fact from the above expression, if we assume a the scaling exponent for the correlation:\n\n$$\n\\rho_{i j} \\propto(\\Delta t)^{H_{i j}^{\\rho}}\n$$\n\nWe find that:\n\n$$\nH_{i j}^{\\rho}=H_{i j}(2)-\\left(H_{i}(1)+H_{j}(1)\\right)\n$$\n\nThis is well known to be non-zero and positive as a result of the Epps effect [15], where correlation between any two pairs of stocks is expected to increase with increasing length scale. Empirically from studies of the Epps effect, we find that $H_{i j}^{\\rho} \\approx 0.3$, which implies that the variation of cross correlation with scale decreases as one moves to lower and lower frequencies. The portfolio variance at time scale $\\Delta t$ then becomes:\n\n$$\n\\sigma_{\\text {portfolio }}^{2}(\\Delta t)=\\sum_{i=1}^{N} w_{i}^{2} \\sigma_{i}^{2}(\\Delta t)+2 \\sum_{i=1}^{N} \\sum_{j=i+1}^{N} w_{i} w_{j} \\rho_{i j}(\\Delta t) \\sigma_{i}(\\Delta t) \\sigma_{j}(\\Delta t)\n$$\n\nThis expression now accounts for multifractality by incorporating the $q$-dependent scaling behavior of the assets, in terms of both the variance and covariance.", "tables": {}, "images": {}}, {"section_id": 10, "text": "### 5.3 Multifractal Optimization Problem\n\nThe optimization problem in a multifractal setting aims to minimize the portfolio variance across both time scales and moments. The optimization problem can be formulated as:\n\n$$\n\\text { Minimize } \\sum_{k=1}^{K} \\sigma_{\\text {portfolio }}^{2}\\left(\\Delta t_{k}, q\\right)\n$$\n\nHere:\n\n$$\n\\sigma_{\\text {portfolio }}^{2}(\\Delta t, q)=\\sum_{i} w_{i}^{2} \\sigma_{i}^{2}(\\Delta t)+2 \\sum_{i j} w_{i} w_{j} \\rho_{i j}(\\Delta t) \\sigma_{i}(\\Delta t) \\sigma_{j}(\\Delta t)\n$$\n\nWe here will expand the variances and covariances with the correct scaling properties. This is subject to:\n\n$$\n\\begin{gathered}\n\\sum_{i=1}^{N} w_{i} \\mu_{i} \\geq \\mu_{\\text {target }} \\\\\n\\sum_{i=1}^{N} w_{i}=1 \\\\\nw_{i} \\geq 0, \\quad \\forall i\n\\end{gathered}\n$$\n\nHere, the optimization takes into account not only the scaling behavior across different time scales $\\Delta t_{k}$ but also the varying roughness of the time series as captured by the multifractal spectrum $H_{i}(q)$. This leads to a more complex, yet more accurate, description of portfolio risk that better reflects the true nature of financial markets.", "tables": {}, "images": {}}, {"section_id": 11, "text": "# 5.4 Estimation of Multifractal Parameters \n\nTo implement the multifractal optimization framework, it is necessary to estimate the multifractal scaling exponents $H_{i}(q)$ for each asset. This can be done using methods such as the multifractal detrended fluctuation analysis (MF-DFA) or the wavelet transform modulus maxima (WTMM) method. These techniques allow for the extraction of the multifractal spectrum from historical return data.\n\nThe estimated multifractal spectrum can then be used to calculate the portfolio variance at different time scales and moments, which serves as the input for the optimization problem.", "tables": {}, "images": {}}, {"section_id": 12, "text": "## 6 Sensitivity Analysis\n\nWe can compute the sensitivity of the weights to the Hursts, multifractal Hursts etc. First let us evaluate the dependence on volatility.\n\nTo find the optimal weights $\\mathbf{w}$ that minimize $\\sigma_{p}^{2}$ subject to the constraint $\\mathbf{w}^{\\top} \\mathbf{1}=1$, we employ the method of Lagrange multipliers. The Lagrangian $\\mathcal{L}$ is given by:\n\n$$\n\\mathcal{L}(\\mathbf{w}, \\lambda)=\\mathbf{w}^{\\top} \\Sigma \\mathbf{w}-\\lambda\\left(\\mathbf{w}^{\\top} \\mathbf{1}-1\\right)\n$$\n\nwhere $\\lambda$ is the Lagrange multiplier associated with the budget constraint. We implement first order conditions. Take the derivative of $\\mathcal{L}$ with respect to $\\mathbf{w}$ and set it to zero:\n\n$$\n\\frac{\\partial \\mathcal{L}}{\\partial \\mathbf{w}}=2 \\Sigma \\mathbf{w}-\\lambda \\mathbf{1}=0\n$$\n\nSolving for $\\mathbf{w}$ :\n\n$$\n2 \\Sigma \\mathbf{w}=\\lambda \\mathbf{1} \\quad \\Rightarrow \\quad \\mathbf{w}=\\frac{\\lambda}{2} \\Sigma^{-1} \\mathbf{1}\n$$\n\nUsing the budget constraint $\\mathbf{w}^{\\top} \\mathbf{1}=1$ :\n\n$$\n\\mathbf{w}^{\\top} \\mathbf{1}=\\left(\\frac{\\lambda}{2} \\Sigma^{-1} \\mathbf{1}\\right)^{\\top} \\mathbf{1}=\\frac{\\lambda}{2} \\mathbf{1}^{\\top} \\Sigma^{-1} \\mathbf{1}=1\n$$\n\nLet $S=\\mathbf{1}^{\\top} \\Sigma^{-1} \\mathbf{1}$, a scalar. Then:\n\n$$\n\\frac{\\lambda}{2} S=1 \\quad \\Rightarrow \\quad \\lambda=\\frac{2}{S}\n$$\n\nSubstituting back into the expression for $\\mathbf{w}$ :\n\n$$\n\\mathbf{w}=\\frac{1}{S} \\Sigma^{-1} \\mathbf{1}\n$$\n\nThus, the optimal weights are:\n\n$$\n\\mathbf{w}=\\frac{\\Sigma^{-1} \\mathbf{1}}{\\mathbf{1}^{\\top} \\Sigma^{-1} \\mathbf{1}}\n$$", "tables": {}, "images": {}}, {"section_id": 13, "text": "# 6.1 Effect of Variance \n\nTo demonstrate that increasing the variance $\\sigma_{k}^{2}$ of a specific asset $k$ leads to a decrease in its optimal weight $w_{k}$, while keeping all other parameters constant.\n\nWe want to now express the weight of asset $k$. From the optimal weights expression:\n\n$$\nw_{k}=\\frac{\\left(\\Sigma^{-1} \\mathbf{1}\\right)_{k}}{S}=\\frac{s_{k}}{S}\n$$\n\nwhere $s_{k}=\\left(\\Sigma^{-1} \\mathbf{1}\\right)_{k}$ and $S=\\mathbf{1}^{\\top} \\Sigma^{-1} \\mathbf{1}$.\nNow we want to analyze the effect of increasing $\\sigma_{k}^{2}$. We aim to compute the derivative $\\frac{\\partial w_{k}}{\\partial \\sigma_{k}^{2}}$ and show that it is negative.\n\n$$\n\\frac{\\partial w_{k}}{\\partial \\sigma_{k}^{2}}=\\frac{\\partial}{\\partial \\sigma_{k}^{2}}\\left(\\frac{s_{k}}{S}\\right)=\\frac{\\frac{\\partial s_{k}}{\\partial \\sigma_{k}^{2}} S-s_{k} \\frac{\\partial S}{\\partial \\sigma_{k}^{2}}}{S^{2}}\n$$\n\nComputing $\\frac{\\partial s_{k}}{\\partial \\sigma_{k}^{2}}$ and $\\frac{\\partial S}{\\partial \\sigma_{k}^{2}}$\nSince $\\mathbf{s}=\\Sigma^{-1} \\mathbf{1}$, we have:\n\n$$\n\\frac{\\partial \\mathbf{s}}{\\partial \\sigma_{k}^{2}}=-\\Sigma^{-1}\\left(\\frac{\\partial \\Sigma}{\\partial \\sigma_{k}^{2}}\\right) \\Sigma^{-1} \\mathbf{1}\n$$\n\nGiven that $\\Sigma$ only depends on $\\sigma_{k}^{2}$ through the $(k, k)$-element:\n\n$$\n\\frac{\\partial \\Sigma}{\\partial \\sigma_{k}^{2}}=\\mathbf{e}_{k} \\mathbf{e}_{k}^{\\top}\n$$\n\nwhere $\\mathbf{e}_{k}$ is the $k$-th standard basis vector. Thus:\n\n$$\n\\frac{\\partial \\mathbf{s}}{\\partial \\sigma_{k}^{2}}=-\\Sigma^{-1} \\mathbf{e}_{k} \\mathbf{e}_{k}^{\\top} \\Sigma^{-1} \\mathbf{1}\n$$\n\nSpecifically, the derivative of $s_{k}$ is:\n\n$$\n\\frac{\\partial s_{k}}{\\partial \\sigma_{k}^{2}}=-\\left(\\Sigma^{-1}\\right)_{k k} s_{k}\n$$\n\nSimilarly, the derivative of $S$ is:\n\n$$\n\\frac{\\partial S}{\\partial \\sigma_{k}^{2}}=-s_{k}^{2}\n$$\n\nLets get the final expression for the derivative. Substituting back:\n\n$$\n\\frac{\\partial w_{k}}{\\partial \\sigma_{k}^{2}}=\\frac{-\\left(\\Sigma^{-1}\\right)_{k k} s_{k} S+s_{k}^{3}}{S^{2}}=\\frac{s_{k}\\left(-\\left(\\Sigma^{-1}\\right)_{k k} S+s_{k}^{2}\\right)}{S^{2}}\n$$\n\nGiven that $\\Sigma^{-1}$ is positive definite, $\\left(\\Sigma^{-1}\\right)_{k k}>0$, and $S>s_{k}^{2}$, it follows that:\n\n$$\n\\frac{\\partial w_{k}}{\\partial \\sigma_{k}^{2}}<0\n$$\n\nWe know that $\\frac{\\partial \\sigma}{\\partial H_{i}}=|\\Delta t|^{H_{i}} \\ln (\\Delta t)$\nIt follows that\n\n$$\n\\frac{\\partial w_{k}}{\\partial H_{k}}<0\n$$", "tables": {}, "images": {}}, {"section_id": 14, "text": "# 6.2 Effect of Correlation and Multifractality \n\nNext, we consider the effect of increasing the correlation between two assets, say $i$ and $j$, on their combined weight $w_{i}+w_{j}$. The covariance between assets $i$ and $j$ is given by:\n\n$$\n\\sigma_{i j}=\\rho_{i j} \\sigma_{i} \\sigma_{j}\n$$\n\nwhere $\\rho_{i j}$ is the correlation between assets $i$ and $j$. Increasing $\\rho_{i j}$ increases the covariance $\\sigma_{i j}$.\nThe weights $w_{i}$ and $w_{j}$ depend on the inverse of the covariance matrix $\\Sigma^{-1}$. To compute the effect of increasing $\\rho_{i j}$, we differentiate the weights $w_{i}$ and $w_{j}$ with respect to $\\rho_{i j}$ :\n\n$$\n\\begin{aligned}\n& \\frac{\\partial\\left(w_{i}\\right)}{\\partial \\rho_{i j}}=\\frac{\\partial\\left(s_{i}\\right)}{\\partial \\rho_{i j}} \\cdot \\frac{1}{S}-\\left(s_{i}\\right) \\cdot \\frac{\\partial S}{\\partial \\rho_{i j}} \\cdot \\frac{1}{S^{2}} \\\\\n& \\frac{\\partial\\left(w_{j}\\right)}{\\partial \\rho_{i j}}=\\frac{\\partial\\left(s_{j}\\right)}{\\partial \\rho_{i j}} \\cdot \\frac{1}{S}-\\left(s_{j}\\right) \\cdot \\frac{\\partial S}{\\partial \\rho_{i j}} \\cdot \\frac{1}{S^{2}}\n\\end{aligned}\n$$\n\nwhere $s_{i}=\\left(\\Sigma^{-1} \\mathbf{1}\\right)_{i}$ and $s_{j}=\\left(\\Sigma^{-1} \\mathbf{1}\\right)_{j}$. The derivative $\\frac{\\partial \\Sigma}{\\partial w_{i j}}$ has nonzero entries only at positions $(i, j)$ and $(j, i)$. Here we can have that $w_{i}$ and $w_{j}$ might increase or decrease. However, if we do an optimisation over the combined asset $w_{i}+w_{j}$ we can conclude that the combined weight of the synthetic asset decreases with an increase in correlation. This is because in this modified picture, all you are doing is changing the variance of the two assets:\n$<l r_{\\text {synthetic }, i j}^{2}>=<\\left(l r_{i}+l r_{j}\\right)^{2}>=<\\left(l r_{i}\\right)^{2}>+<\\left(l r_{j}\\right)^{2}>+<l r_{i} l r_{j}>$\nSo all the other variances and covariances are the same, except that of the synthetic combination of $i$ and $j$. Thus if we freeze $w_{i j}$, we get from the previous result:\n\n$$\n\\frac{\\partial w_{i j}}{\\partial \\rho_{i j}}<=0\n$$\n\nThus:\n\n$$\n\\frac{\\partial w_{i j}}{\\partial H_{i j}}=\\frac{\\partial w_{i j}}{\\partial \\rho_{i j}} \\frac{\\partial \\rho_{i j}}{\\partial H_{i j}}=\\frac{\\partial w_{i j}}{\\partial \\rho_{i j}} *|\\Delta t|^{H_{i j}} \\ln (\\Delta t)<0\n$$\n\nHere note that although empirically $H_{i j}>0$ which causes a positive multifractality, one could have had $H_{i j}<0$ as well in principle. In that case the correlations would decay with scale, and hence the weight of the synthetic asset would increase with an increase in the multifractal parameter $H_{i j}$.", "tables": {}, "images": {}}, {"section_id": 15, "text": "### 6.3 Summary\n\nTo summarize our results we get as expected:\n\n- If you increase volatility of a stock, its portfolio weight goes down\n- If you increase Hurst $(\\beta / 2)$ of a stock, $H_{i}$ goes up, its portfolio weight goes down\n- If you increase the fat tailedness of a stock $(1 / \\alpha), H_{i}$ goes up, its portfolio weight goes down\n- If you increase correlation between two stocks, their combined weight goes down.\n- If you introduce positive multifractality in two stocks' correlation (increased Epps effect), $H_{i j}$ goes up, their combined weight goes down; and vice versa.", "tables": {}, "images": {}}, {"section_id": 16, "text": "## 7 Out of Sample Performance\n\nTo rigorously assess the efficacy of the proposed multiscale optimization methods, we conducted an out-of-sample evaluation in two scenarios: the minimum variance portfolio and the maximal Sharpe portfolio, with the mean estimated using a simple moving average. The portfolio weights correspond to allocations across the 11 sectors of the S\\&P 500. The following choices were used for the backtest:\n\n- We utilized five years of data, spanning from 2019 to 2024, a period that notably includes significant market events such as the March 2020 COVID-19 crash and the 2022 market correction.\n\nTable 1: Backtest Results for Various Portfolio Optimization Methods (Sector Rotation)\n\n![table_0](table_0)\n\nTable 2: Backtest Results for Various Portfolio Optimization Methods (Factor Rotation)\n\n![table_1](table_1)\n\n- The SPDR sector ETFs were used in lieu of allocation to the 11 sectors of the $S \\& P 500$, making it a long-only sector rotation strategy. We also considered a factor rotation strategy taking 9 factors (quality, growth, value, low volatility etc) where each factor was represented by ETFs.\n- A lookback of six months was chosen (125 days), which is common in such studies.\n- Minimum variance portfolios with overlapping vs non-overlapping averages were considered at lower frequencies\n- At each scale, the covariance matrix was evaluated on the same period, but lower frequency covariances were averaged over all posible non-overlapping sets to increase robustness. We compute covariance matrix at a range of scales $\\Sigma_{i j}^{M S}=<\\Sigma_{i j}(\\Delta t) / \\Delta t>_{\\Delta t}$\n- Transaction costs were assumed to be negligible for the purpose of this study.\n\nOur findings indicate that the multiscale optimization method results in portfolios with higher Sharpe ratios and Sortino ratios, as well as lower kurtosis and drawdowns. This enhanced performance is attributable to the multiscale method's ability to account for the effects of non-ellipticity and fat tails, phenomena that are often inadequately captured by traditional minimum variance portfolios $[3,10]$.", "tables": {"table_0": "| Method | Sharpe Ratio | Sortino Ratio | Max Drawdown (\\%) |\n| :-- | :--: | :--: | :--: |\n| Equally Weighted | 0.45 | 0.53 | -39.9 |\n| Traditional Markowitz | 0.35 | 0.41 | -33.1 |\n| Multiscale Markowitz | 0.53 | 0.62 | -31.5 |\n| Multiscale Markowitz (Overlapping) | 0.49 | 0.58 | -30.3 |", "table_1": "| Method | Sharpe Ratio | Sortino Ratio | Max Drawdown (\\%) |\n| :-- | :--: | :--: | :--: |\n| Equally Weighted | 0.42 | 0.52 | -39.1 |\n| Traditional Markowitz | 0.43 | 0.49 | -36.9 |\n| Multiscale Markowitz | 0.53 | 0.61 | -36.3 |\n| Multiscale Markowitz (Overlapping) | 0.57 | 0.66 | -34.9 |"}, "images": {}}, {"section_id": 17, "text": "# References \n\n[1] Benoit B. Mandelbrot and John W. Van Ness, \"Fractional Brownian motions, fractional noises and applications,\" SIAM Review, vol. 10, no. 4, pp. 422-437, 1968.\n[2] Jim Gatheral, Thibault Jaisson, and Mathieu Rosenbaum, \"Volatility is rough,\" Quantitative Finance, vol. 18, no. 6, pp. 933-949, 2018.\n[3] Laurent E. Calvet and Adlai J. Fisher, \"Multifractality in asset returns: Theory and evidence,\" Review of Economics and Statistics, vol. 84, no. 3, pp. 381-406, 2002.\n[4] Steven L. Heston, \"A closed-form solution for options with stochastic volatility with applications to bond and currency options,\" The Review of Financial Studies, vol. 6, no. 2, pp. 327-343, 1993.\n[5] Gregory Berman and Lawrence Hochberg, \"Multiscale modeling of financial time series and portfolio optimization,\" Journal of Investment Strategies, vol. 1, no. 2, pp. 45-67, 2008.\n[6] Jean-Fran\u00e7ois Muzy, J\u00e9r\u00f4me Delour, and Emmanuel Bacry, \"Modelling fluctuations of financial time series: from cascade process to stochastic volatility model,\" The European Physical Journal B-Condensed Matter and Complex Systems, vol. 17, no. 3, pp. 537-548, 2000.\n[7] Andrew Ang and Allan Timmermann, \"Regime Changes and Financial Markets,\" Annual Review of Financial Economics, vol. 4, no. 1, pp. 313-337, 2012.\n[8] Edgar E. Peters, Fractal Market Analysis: Applying Chaos Theory to Investment and Economics, John Wiley \\& Sons, 1994.\n\n[9] Rama Cont and Jean-Philippe Bouchaud, \"Herd behavior and aggregate fluctuations in financial markets,\" Macroeconomic Dynamics, vol. 4, no. 2, pp. 170-196, 2000.\n[10] Robert J. Bianchi, Michael E. Drew, and Jesse H. Fan, \"Multiscale Hedge Fund Performance Persistence: Evidence from Wavelet Analysis,\" Journal of Financial Econometrics, vol. 13, no. 1, pp. $50-78,2015$.\n[11] H. E. Hurst, \"Long-term storage capacity of reservoirs,\" Transactions of the American Society of Civil Engineers, vol. 116, no. 1, pp. 770-799, 1951.\n[12] Benoit Mandelbrot, \"The variation of certain speculative prices,\" The Journal of Business, vol. 36, no. 4, pp. 394-419, 1963.\n[13] Rama Cont, \"Empirical properties of asset returns: stylized facts and statistical issues,\" Quantitative Finance, vol. 1, no. 2, pp. 223-236, 2001.\n[14] Yakov Amihud and Haim Mendelson, \"Asset pricing and the bid-ask spread,\" Journal of Financial Economics, vol. 17, no. 2, pp. 223-249, 1986.\n[15] Thomas W. Epps, \"Comovements in stock prices in the very short run,\" Journal of the American Statistical Association, vol. 74, no. 366a, pp. 291-298, 1979.\n\nThis figure \"epps1.png\" is available in \"png\" format from:\nhttp://arxiv.org/ps/2411.13792v1", "tables": {}, "images": {}}], "id": "2411.13792v1", "authors": ["Revant Nayar", "Raphael Douady"], "categories": ["nlin.CD", "q-fin.MF"], "abstract": "Traditional Markowitz portfolio optimization constrains daily portfolio\nvariance to a target value, optimising returns, Sharpe or variance within this\nconstraint. However, this approach overlooks the relationship between variance\nat different time scales, typically described by $\\sigma(\\Delta t) \\propto\n(\\Delta t)^{H}$ where $H$ is the Hurst exponent, most of the time assumed to be\n\\(\\frac{1}{2}\\). This paper introduces a multifrequency optimization framework\nthat allows investors to specify target portfolio variance across a range of\nfrequencies, characterized by a target Hurst exponent $H_{target}$, or optimize\nthe portfolio at multiple time scales. By incorporating this scaling behavior,\nwe enable a more nuanced and comprehensive risk management strategy that aligns\nwith investor preferences at various time scales. This approach effectively\nmanages portfolio risk across multiple frequencies and adapts to different\nmarket conditions, providing a robust tool for dynamic asset allocation. This\novercomes some of the traditional limitations of Markowitz, when it comes to\ndealing with crashes, regime changes, volatility clustering or multifractality\nin markets. We illustrate this concept with a toy example and discuss the\npractical implementation for assets with varying scaling behaviors.", "updated": "2024-11-21T02:37:54Z", "published": "2024-11-21T02:37:54Z"}