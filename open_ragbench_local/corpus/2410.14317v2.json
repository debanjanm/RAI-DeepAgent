{
  "title": "Identification of a Rank-dependent Peer Effect Model",
  "sections": [
    {
      "section_id": 0,
      "text": "#### Abstract\n\nWe develop a model that captures peer effect heterogeneity by modeling the endogenous spillover to be linear in ordered peer outcomes. Unlike the canonical linear-in-means model, our approach accounts for the distribution of peer outcomes as well as the size of peer groups. Under a minimal condition, our model admits a unique equilibrium and is therefore tractable and identified. Simulations show our estimator has good finite sample performance. Finally, we apply our model to educational data from Norway, finding that higher-performing friends disproportionately drive GPA spillovers. Our framework provides new insights into the structure of peer effects beyond aggregate measures.",
      "tables": {},
      "images": {}
    },
    {
      "section_id": 1,
      "text": "## 1 Introduction\n\nEconomic agents are often connected. These connections raise important questions about how linked units influence one another through spillovers, known as peer effects. It has been well established in many empirical settings that peer effects are heterogeneous (Sacerdote, 2011; Masten, 2018; Bramoull\u00e9, Djebbari and Fortin, 2020). Despite this, the canonical models of peer effects assume homogeneous effects from peers (Manski, 1993; Bramoull\u00e9, Djebbari and Fortin, 2009). This paper develops an econometric framework that allows for flexible and heterogeneous patterns of peer effects. Specifically, we will focus on heterogeneous effects based on the ranking of each peer's outcome among the peer group: a rank-dependent peer effect model. As such, the effect of each peer\n\n[^0]\n[^0]:    *Erasmus University Rotterdam and Tindbergen Institute. email: herstad@ese.eur.nl\n    ${ }^{\\dagger}$ School of Social Sciences, University of Surrey. email: m.shin@surrey.ac.uk\n\nof an individual is endogenously determined by the distribution of the outcomes of that individual's peers.\n\nThis framework provides empirical researchers with a new tool to uncover patterns in peer influence, particularly in settings where relative standing plays a crucial role, such as education, workplace productivity, and social interactions. For instance, when students in a school interact, the skills of your highest-performing friend may be the key determinant of how well you perform in school. On the other hand, in a manufacturing setting where workers operate on a conveyor-beltstyle assembly line, the performance of the slowest worker might be the key factor determining the spillover effect. This motivates a model of peer effects that allows for differently ranked peers to have different effects on an individual's outcome.\n\nThe current literature on peer effects has primarily focused on estimating a scalar spillover parameter. The canonical model for peer effects has, following the seminal works of Manski (1993) and Bramoull\u00e9, Djebbari and Fortin (2009), been the linear-in-means (LIM) peer effect model. This model is defined as: for $i=1, \\cdots, n$,\n\n$$\nY_{i}=\\beta \\bar{Y}_{i}+x_{i}^{\\top} \\gamma+\\varepsilon_{i}\n$$\n\nFor example, consider spillovers in exam scores. Then $Y_{i}$ is the exam score for student $i, \\bar{Y}_{i}$ is the mean of student $i$ 's peers' exam scores and $x_{i}$ is the vector of student-level covariates for student $i$. $x_{i}$ could also include contextual effects: e.g., the mean of student $i$ 's peers' covariates. In the LIM model, the total peer effect is the product of $\\bar{Y}_{i}$ and a scalar peer effect parameter $\\beta$.\n\nHowever, the LIM model has several caveats, limiting the patterns of spillover it can analyse. For example, the LIM model assumes that inputs from different peers are perfectly substitutable. As such, there is no compositional effect from having perfectly homogeneous peers compared to having heterogeneous peers, as long as the mean is equal. This means that the LIM model assumes that the higher moments such as standard deviation of peer outcomes does not matter.\n\nThe limitations of the LIM model are also well established in the empirical literature (Sacerdote, 2011). To overcome them, empirical papers have investigated heterogenous patterns of peer effects by interacting average peer outcomes with exogenous variables, or by estimating non-linear functions of the average outcome of peers (Foster, 2006; Han and Li, 2009; Guryan, Kroft and Notowidigdo,\n\n2009). More recently, there has been extensions to the LIM model by allowing for more general aggregators than the mean (Boucher et al., 2024). However, this analysis is still limited to looking at the effect of peer outcomes through a single aggregated measure. We further expand the scope of peer effects by developing a generalized econometric model that flexibly estimates heterogeneous spillovers from peers under an exchangeability assumption ${ }^{1}$. Specifically, we will let the inputs from peers affect an individual's outcome differently depending on the peer's relative position in the individual's peer group.\n\nIn our generalized model, the peer effect is a linear function of 'ordered' peer outcomes. That is, for $i=1, \\ldots, n$,\n\n$$\nY_{i}=\\sum_{k=1}^{d_{i}} \\tilde{Y}_{i, k} \\beta_{k, d_{i}}+x_{i}^{\\top} \\gamma+\\varepsilon_{i}\n$$\n\n$d_{i}$ is the number of peers for individual $i$ and $\\tilde{Y}_{i, k}$ is the outcome of the $k$-th lowest performing peer of individual $i ; \\tilde{Y}_{i, k}$ takes the $k$-th lowest value from the set\n\n$$\n\\left\\{Y_{j}: \\text { individual } j \\text { is a peer of individual } i .\\right\\}\n$$\n\nThis model identifies the general peer effect under an assumption that peers are exchangeable and that the peer effect is linear in ordered peer outcomes. Note that this does not impose linear separability of peer outcomes. To see this, consider two connected individuals, $A$ and $B$. The impact of $A$ 's outcome on $B$ 's outcome depends on the outcomes of all the individuals that individual $B$ is connected to. This means that both the magnitude and sign of the peer effect coefficient from individual $A$ to $B$ is endogenous to all the peers of $B$, as their outcomes decide the ranking of $A$ in $B$ 's peer group. In contrast, the canonical LIM model assumes this peer effect coefficient only depends on how many peers individual $B$ has.\n\nThe generality of this model allows us to capture many economically relevant features of peer effects. Firstly, as the model does not impose perfect substitution, it can analyse whether there are complementarities or substitutability in peer effects. Secondly, as the spillover from a peer can\n\n[^0]\n[^0]:    ${ }^{1}$ In this context, exchangeability means that the spillover an individual experiences does not depend on the identity of their peers. This is implicitly assumed in existing models of peer effects, but needs to be made explicit in our model due to it's flexible nature.\n\ndepend on the size of the peer group, the model can detect if individuals with more connections are systemically different from other individuals. For example, consider a simple model where individuals are affected differently by their relatively higher- and lower-performing peers:\n\n$$\nY_{i}=\\beta_{\\text {low }} \\sum_{k=1}^{\\left\\lceil d_{i} / 2\\right\\rceil} \\tilde{Y}_{i, k}+\\beta_{\\text {high }} \\sum_{k=\\left\\lceil d_{i} / 2\\right\\rceil+1}^{d_{i}} \\tilde{Y}_{i, k}+x_{i}^{\\top} \\gamma+\\varepsilon_{i}\n$$\n\nThis model is a simplification of the rank-dependent peer effect model, with $\\beta_{1, d}=\\ldots=\\beta_{\\lceil d / 2\\rceil, d}=$ $\\beta_{\\text {low }}$ and $\\beta_{\\lceil d / 2\\rceil+1, d}=\\ldots=\\beta_{d, d}=\\beta_{\\text {high }}$ for each $d$. When $\\beta_{\\text {low }}=\\beta_{\\text {high }}$, all peer outcomes are perfectly substitutable with each other, as in the LIM model. When $\\beta_{\\text {low }} \\neq \\beta_{\\text {high }}$, a sufficiently large change will move a peer from the lower-performing half to higher-performing half. This will change that peer's coefficient, and therefore also change their relative rate of substitution with the other peers.\n\nSimilarly, as the models' coefficients depend on $d_{i}$, it allows for returns to scale in the number of connections. As an illustrative example, consider a model where the median of peer outcomes is the sole determining factor in the peer effect, this becomes:\n\n$$\nY_{i}=\\beta_{d_{i}} \\tilde{Y}_{i,\\left\\lceil d_{i} / 2\\right\\rceil}+x_{i}^{\\top} \\gamma+\\varepsilon_{i}\n$$\n\nIf $\\beta_{d}<\\beta_{d^{\\prime}}$ when $d<d^{\\prime}$, we would conclude that peer effects exhibit returns to scale in the number of connections.\n\nMore generally, the rank-dependent peer effect model can be motivated as a general regression of an individual's outcome on the distribution of their peers' outcomes. As will be further discussed in Section 2, ordered peer outcomes have one-to-one relationship with the (empirical) distribution of peer outcomes. As such, our model allows for a wide variety of heterogeneous patterns in the peer effects in terms of the distribution of peer outcomes. The primary contribution of this paper is the introduction and identification of the rank-dependent peer effect model, as shown in Equation (2). Following the literature on peer effects, our identification result uses the conditional distribution of the outcomes given the network connections and the individual characteristics, with the network assumed to be exogenous. The steps of the identification argument are as follows. First, we show that the rank-dependent peer effect model admits a unique equilibrium when the magnitude of\n\nthe total peer effect is bounded by one. Then, using the unique equilibrium result, we derive a reduced-form representation of the model. Given the reduced-form representation, we construct moment conditions to identify the peer effect coefficients $\\left\\{\\beta_{k, d}\\right\\}_{k, d}$ and $\\gamma$. This step relies on an instrument relevance condition closely related to the equivalent condition of the LIM model.\n\nIn implementation, we use Two-stage Least-squares (TSLS) to estimate the parameters. We show, through simulation exercises, how the finite-sample performance of the TSLS estimator depends on the complexity of the model, the sample size and the strength of our instruments. We also show how ex-ante knowledge about the structure of peer effects can aid in estimation in settings where the fully saturated model is challenging to estimate. We then show how our estimator can be applied to empirical settings by estimating spillovers in learning between students at two Norwegian middle schools. Our estimates show that the homogeneous estimates of the LIM model does not capture the heterogeneity of peer effects we find in the data. Instead, the highestGPA peers are the driving factor in GPA spillovers. This supports the empirical relevance of the rank-dependent peer effect model in real world settings.\n\nThe paper most closely related to ours is Boucher et al. (2024). They let peer outcomes be aggregated to a scalar summary measure by a broad class of aggregators, which determines the peer effect. This class of aggregators nests the mean used in the LIM model. Unlike our model, this aggregator depends on a single parameter, and does not allow for returns to centrality. In two extreme cases of their model, Boucher et al. (2024) construct the peer effect to be linear in the minimum peer outcome or the maximum peer outcome alone, both of which are allowed in our model as well. Similarly, Tao and Lee (2014) shows how to identify a model in which only the highest outcome friend matters for the peer effect. This is a special case of our model with $\\beta_{d, d}=\\beta_{\\max }$ for all d , and zero otherwise.\n\nThe empirical study of peer effects has been a large literature in economics (Bramoull\u00e9, Djebbari and Fortin, 2020), with a seminal contribution by Sacerdote (2001). Some of the papers in this literature are close in spirit to our model, showcasing an interest in exploring these kinds of heterogeneities in the empirical literature. Existing work has, for example, let the peer effect be the mean of nonlinear functions of peer outcomes, such as the proportion of peers above a cutoff (Kang, 2007; Guryan, Kroft and Notowidigdo, 2009), through quantile regressions (Kang, 2007), or looked at heterogeneity by interacting the peer effect with exogenous variables (Foster, 2006; Han and Li,\n\n2009; Alne, Herstad and Myhre, 2025; Tincani, 2024). To the best of our knowledge, however, there is no previous work allowing for peer effects to depend on the distribution of peer outcomes, or a theoretical discussion of these methods.\n\nThe rest of this paper is structured as follows. Section 2 discusses the model and its implications. Section 3 formally identifies the parameters of the rank-dependent peer effect model. Section 4 discusses finite-sample performances of a TSLS estimator in the rank-dependent peer effect model, using simulations. Finally, Section 5 applies our methodology to educational peer effects in Norwegian schools.",
      "tables": {},
      "images": {}
    },
    {
      "section_id": 2,
      "text": "# 2 Model \n\nIn our setting, a researcher observes individual-level outcomes and individual-level control covariates $\\left\\{Y_{i}, x_{i}\\right\\}_{i=1}^{n}$ and the network adjacency matrix $\\left\\{A_{i, j}\\right\\}_{1 \\leq i, j \\leq n}$. We let $A_{i, j}=1$ indicate that individual $i$ is linked to individual $j$, and $A_{i, j}=0$ otherwise. We assume there are no self-loops in the network, so $A_{i, i}=0$, and links may be directed, i.e., $A_{i, j}$ and $A_{j, i}$ are allowed to be different.\n\nConsider a general model of nonparametric peer effects:\n\n$$\nY_{i}=h\\left(\\left\\{A_{i, j} Y_{j}\\right\\}_{j=1}^{n}\\right)+x_{i}^{\\top} \\gamma+\\varepsilon_{i}\n$$\n\nWe call $h(\\cdot)$ the peer effect function, or simply the peer effect, which takes a $n \\times 1$ vector and produces a scalar peer effect.\n\nAssumption 1 (Exchangeability).\n\n$$\nh\\left(\\left\\{A_{i, j} Y_{j}\\right\\}_{j=1}^{n}\\right)=h\\left(\\left\\{A_{i, \\pi(j)} Y_{\\pi(j)}\\right\\}_{j=1}^{n}\\right)\n$$\n\nfor any permutation $\\pi$ on $\\{1, \\ldots, n\\} \\backslash\\{i\\}$\n\nLemma 1. Under Assumption 1, there exists some function $\\tilde{h}$ such that\n\n$$\nh\\left(\\left\\{A_{i, j} Y_{j}\\right\\}_{j=1}^{n}\\right)=\\tilde{h}\\left(\\left\\{\\tilde{Y}_{i, k}\\right\\}_{k=1}^{d_{i}}, d_{i}\\right)\n$$\n\nFurthermore, if $\\tilde{h}(\\cdot)$ is linear then\n\n$$\nh\\left(\\left\\{A_{i, j} Y_{j}\\right\\}_{j=1}^{n}\\right)=\\sum_{k=1}^{d_{i}} \\tilde{Y}_{i, k} \\beta_{k, d_{i}}\n$$\n\nProof. For any realized values of $\\left\\{A_{i, j}, Y_{j}\\right\\}_{j \\neq i}$ such that student $i$ has $d$ peers and their ordered peer outcomes are $\\left\\{\\tilde{y}_{i, k}\\right\\}_{k=1}^{d}$, Assumption 1 assumes that the peer effect function $h$ has the same value. By constructing $\\tilde{h}$ to be a function that maps the number of peers and the ordered peer outcomes to the evaluated $h$, Lemma 1 holds.\n\nAssumption 1 assumes that the peer effect function $h$ is invariant to a permutation on its inputs. Then, we can construct a (derived) peer effect function $\\tilde{h}$ that takes the ordered peer outcomes and the number of peers as its inputs, with which the nonlinear peer effect model (4) holds. By additionally assuming linearity on $\\tilde{h}$, i.e.\n\n$$\n\\tilde{h}\\left(\\left\\{\\tilde{Y}_{i, k}\\right\\}_{k=1}^{d_{i}}, d_{i}\\right)=\\sum_{k=1}^{d_{i}} \\beta_{k, d} \\tilde{Y}_{i, k}\n$$\n\nwe obtain the rank-dependent peer effect model of our paper. In this sense, the key motivation for the rank-dependent peer effect model is Assumption 1 where we assume that the names of individuals do not matter.\n\nWe define the rank-dependent peer effect model as:\n\n$$\nY_{i}=\\sum_{k=1}^{d_{i}} \\tilde{Y}_{i, k} \\beta_{k, d_{i}}+x_{i}^{\\top} \\gamma+\\varepsilon_{i}\n$$\n\nfor $i=1, \\ldots, n$, where\n\n$$\n\\begin{aligned}\nd_{i} & =\\sum_{j=1}^{n} A_{i, j}=\\text { number of peers for individual } i \\\\\n\\tilde{Y}_{i, k} & =\\text { outcome of the } k \\text {-th lowest performing peer of individual } i \\\\\n& =k \\text {-th ordered statistic from }\\left\\{Y_{j}: A_{i, j}=1\\right\\}\n\\end{aligned}\n$$\n\nNote that $\\tilde{Y}_{i, 1} \\leq \\ldots \\leq \\tilde{Y}_{i, d_{i}}$ for any $i$ and $\\tilde{Y}_{i, k}=Y_{j}$ for some $j \\neq i$. The individual-level control covariates $x_{i}$ may include functions of the network adjacency matrix $\\left\\{A_{i, j}\\right\\}_{1 \\leq i, j \\leq n}$ and the peer\n\ncharacteristics. For example, given some individual-specific characteristics $\\left\\{w_{i}\\right\\}_{i=1}^{n}$, the control covariate $x_{i}$ could be functions of $\\left\\{w_{i}\\right\\}_{i=1}^{n}$ and $\\left\\{A_{i, j}\\right\\}_{1 \\leq i, j \\leq n}$, allowing for contextual effects:\n\n$$\nY_{i}=\\sum_{k=1}^{d_{i}} \\tilde{Y}_{i, k} \\beta_{k, d_{i}}+\\left(\\begin{array}{ll}\nw_{i} & \\frac{1}{d_{i}} \\sum_{j \\neq i} A_{i, j} w_{j}\n\\end{array}\\right)^{\\top} \\gamma+\\varepsilon_{i}=: \\sum_{k=1}^{d_{i}} \\tilde{Y}_{i, k} \\beta_{k, d_{i}}+x_{i} \\gamma+\\varepsilon_{i}\n$$\n\nThe rank-dependent peer effect model (5) assumes that the outcomes of individual $i$ 's peers affect individual $i$ in a way that the coefficient on a peer outcome depends on the peer's rank among individual $i$ 's peer group. $\\beta_{k, d}$ is the coefficient for the $k$-th lowest performing peer's outcome, when the given individual has $d$ peers in total. Note that the model allows a individual to affect different peers differently. Suppose that individual 1 is friends with both individual 2 and 3. If individual 1 is the lowest-performing peer of individual 2 while being the highest-performing peer of individual 3 , the effect of individual 1's outcome will be $\\beta_{1, d_{2}}$ for individual 2 and $\\beta_{d_{3}, d_{3}}$ for individual 3 .\n\nThe model nests both the linear-in-means (LIM) model and the linear-in-sums (LIS) model. By letting $\\beta_{k, d}=\\beta / d$, the peer effect term in (5) becomes the LIM peer effect:\n\n$$\n\\sum_{k=1}^{d_{i}} \\tilde{Y}_{i, k} \\beta_{k, d_{i}}=\\frac{1}{d_{i}} \\sum_{k=1}^{d_{i}} \\tilde{Y}_{i, k} \\beta=\\beta \\bar{Y}_{i}\n$$\n\nwith $\\bar{Y}_{i}=\\frac{1}{d_{i}} \\sum_{k=1}^{d_{i}} \\tilde{Y}_{i, k}=\\frac{\\sum_{j=1}^{n} A_{i, j} Y_{j}}{\\sum_{j=1}^{n} A_{i, j}}$. By letting $\\beta_{k, d}=\\beta$, the peer effect term becomes the LIS peer effect:\n\n$$\n\\sum_{k=1}^{d_{i}} \\tilde{Y}_{i, k} \\beta_{k, d_{i}}=\\sum_{k=1}^{d_{i}} \\tilde{Y}_{i, k} \\beta=\\beta \\sum_{j=1}^{n} A_{i, j} Y_{j}\n$$\n\nThough widely used, the LIM model and the LIS model have a caveat that using only a mean or a sum may ignore important information contained in the second or higher moments of the peer outcomes. ${ }^{2}$\n\nThe flexibility of our peer effect model (5) allows us to address key questions in the peer effect literature. First, because the coefficients are rank-dependent, our model enables the analysis of complementarity versus substitutability, as has been discussed in Kang (2007) amongst others. For instance, when $\\beta_{1, d} \\neq 0$ and $\\beta_{k, d}=0$ for every $k \\geq 2$ and $d$, the peer effect reflects perfect\n\n[^0]\n[^0]:    ${ }^{2}$ A notable exception is where the peer effect occurs through a binary variable, as in (Gazze, Persico and Spirovska, 2024)\n\ncomplementarity, meaning that only the lowest-performing peer influences the outcome. On the other hand, when $\\beta_{k, d}=\\beta_{k^{\\prime}, d}$ for all $k, k^{\\prime}$, the peer effect exhibits global perfect substitutability, where each peer contributes equally. It is important to note that the linear structure of our model imposes local perfect substitutability. Specifically, all peer outcomes are perfectly substitutable with a constant marginal rate of substitution for small changes in $\\tilde{Y}_{i, k}$ such that $\\tilde{Y}_{i, k-1} \\leq \\tilde{Y}_{i, k}+\\Delta \\leq \\tilde{Y}_{i, k+1}$. However, when the change in $\\tilde{Y}_{i, k}$ is large enough to alter its rank, the slope of the isoquant curve adjusts accordingly.\n\nSecondly, because the coefficients also depend on $d_{i}$, the size of the peer group, our peer effect model enables the exploration of returns to centrality. For simplicity, assume $Y_{j}=y$ for every $j$ in the peer group of individual $i$. In the LIM model, there is zero return to centrality, meaning that the peer effect remains unchanged when an additional peer is added. The LIS model imposes a constant return to centrality. In contrast, our model we can document the return to centrality in a flexible manner, by plotting $d \\mapsto \\sum_{k=1}^{d} \\beta_{k, d} y$. These two features of peer effect heterogeneity are directly related to several empirically important questions: does a student benefit from a highperforming peer or get negatively influenced by a low-performing one? how substitutable are peer outcomes? does the number of friends impact the spillover effect?\n\nWhile the rank-dependent peer effect model (5) allows for nonlinearity in the peer effect, allowing for the peer effect of one peer to depend on the outcomes of all peers, it still admits a unique equilibrium under a natural extension of the assumption used in LIM models (Bramoull\u00e9, Djebbari and Fortin, 2009).\n\nAssumption 2. (Bounded Peer Effect) There exists some $\\bar{d}$ such that $\\max _{i} d_{i} \\leq \\bar{d}$. For each $d=1, \\ldots, \\bar{d}$\n\n$$\n\\sum_{k=1}^{d}\\left|\\beta_{k, d}\\right|<1\n$$\n\nAssumption 2 assumes that the sum of the absolute values of peer effect coefficients for each individual is less than 1 . Proposition 1 states our unique equilibrium result.\n\nProposition 1. Let Assumption 2 hold. Then, for any realization of $\\left\\{x_{i}, A_{i, j}, \\epsilon_{i}\\right\\}_{1 \\leq i, j \\leq n}$, the peer effect model (5) admits a unique equilibrium.\n\nProof. See Appendix B. 1\n\nSince the peer effect model admits a unique equilibrium, there exists a well-defined function from $\\left\\{\\varepsilon_{i}\\right\\}_{i=1}^{n}$ to $\\left\\{Y_{i}\\right\\}_{i=1}^{n}$ given $\\left\\{x_{i}, A_{i, j}\\right\\}_{1 \\leq i, j \\leq n}$.\n\nThe unique equilibrium result from Proposition 1 allows us to introduce a key ingredient in the identification of the peer effect parameters: the conditional distribution of $\\left\\{Y_{i}\\right\\}_{i=1}^{n}$ given $\\left\\{x_{i}, A_{i, j}\\right\\}_{1 \\leq i, j \\leq n}$. Without a unique equilibrium result as in Proposition 1, we would have to assume an equilibrium selection mechanism to derive a conditional distribution of $\\left\\{Y_{i}\\right\\}_{i=1}^{n}$ given $\\left\\{x_{i}, A_{i, j}\\right\\}_{1 \\leq i, j \\leq n}$ from a conditional distribution of $\\left\\{\\varepsilon_{i}\\right\\}_{i=1}^{n}$ given $\\left\\{x_{i}, A_{i, j}\\right\\}_{1 \\leq i, j \\leq n} .^{3}$ However, thanks to Proposition 1, we can assume Assumption 2 and additional conditions on the distribution of $\\left\\{\\varepsilon_{i}\\right\\}_{i=1}^{n}$, to construct moment conditions with $\\left\\{Y_{i}\\right\\}_{i=1}^{n}$.",
      "tables": {},
      "images": {}
    },
    {
      "section_id": 3,
      "text": "# 3 Identification \n\nTo simplify notation, we use $\\mathbf{E}_{n}$ to denote the conditional expectation of a random variable given the exogenous variables throughout the paper. That is for any random variable $W$,\n\n$$\n\\mathbf{E}_{n}[W]:=\\mathbf{E}\\left[W \\mid\\left\\{x_{i}, A_{i, j}\\right\\}_{1 \\leq i, j \\leq n}\\right]\n$$\n\nWe will follow the literature by assuming that the error term $\\varepsilon_{i}$ is exogenous to all individual characteristics and the network.\n\nAssumption 3. (Exogenous Network and Covariates) For each $i=1, \\ldots, n$\n\n$$\n\\mathbf{E}_{n}\\left[\\varepsilon_{i}\\right]=\\mathbf{E}\\left[\\varepsilon_{i} \\mid\\left\\{x_{i}, A_{i, j}\\right\\}_{1 \\leq i, j \\leq n}\\right]=0\n$$\n\nAssumption 3 rules out endogenous network formation and treats the network structure as fixed, meaning it does not depend on the randomness in $\\left\\{\\varepsilon_{i}\\right\\}_{i=1}^{n}$. While there has been advances in analysing peer effect models with endogenous network formation (Goldsmith-Pinkham and Imbens,\n\n[^0]\n[^0]:    ${ }^{3}$ Identification does not necessarily require a unique equilibrium, see for example De Paula (2013) for examples from the literature on games with multiple equilibria. For example, an alternative identification strategy in our setting based on this literature would be to limit our attention to sets of $\\left\\{y_{i}\\right\\}_{i=1}^{n}$ that can only be an outcome of a single realization of $\\left\\{\\epsilon_{i}\\right\\}_{i=1}^{n}$. Or, we may focus on extreme values of $\\left\\{x_{i}\\right\\}_{i=1}^{n}$ and discuss identification for samples with extreme values only. Though these approaches have been valuable in the contexts discussed in De Paula (2013), they are not straightforward to implement in our setting. If there were multiple equilibria in the rank-dependent peer effect model, there would be $n$ !, a massive number, different orderings to consider to find values of $\\left\\{y_{i}\\right\\}_{i=1}^{n}$ consistent with $\\left\\{\\epsilon_{i}\\right\\}_{i=1}^{n}$.\n\n2013; Hsieh and Lee, 2016; Johnsson and Moon, 2021; Jochmans, 2023), we instead focus on endogeneity in peer effects conditional on the network. ${ }^{4}$\n\nAssumption 3 allows us to construct a reduced-form representation of $\\mathbf{E}_{n}\\left[Y_{i}\\right]$, though unlike the LIM model this reduced form is not linear in $\\left\\{x_{i}\\right\\}_{i=1}^{n}$. Instead, the rank-dependence creates a nonlinear reduced-form representation as shown in Corollary 1. To discuss the coefficients in the corollary, let us introduce the following notations: $\\pi$ denotes an ordering on $\\{1, \\ldots, n\\}$ in terms of $\\left\\{y_{i}\\right\\}_{i=1}^{n}$ and $\\mathbb{B}(\\pi)$ denotes a $n \\times n$ peer effect coefficient matrix such that its $i$-th row $j$-th column component corresponds to the peer effect coefficient for individual $j$ 's outcome on individual $i$ 's outcome, given the ordering $\\pi$. For any realization of $\\left\\{\\epsilon_{i}\\right\\}_{i=1}^{n}$, Proposition 1 gives us a unique equilibrium $\\left\\{y_{i}\\right\\}_{i=1}^{n}$ and thus a unique $\\pi$ such that\n\n$$\n\\left(\\begin{array}{c}\ny_{1} \\\\\n\\vdots \\\\\ny_{n}\n\\end{array}\\right)=\\mathbb{B}(\\pi)\\left(\\begin{array}{c}\ny_{1} \\\\\n\\vdots \\\\\ny_{n}\n\\end{array}\\right)+\\left(\\begin{array}{c}\nx_{1}^{\\top} \\gamma+\\epsilon_{1} \\\\\n\\vdots \\\\\nx_{n}^{\\top} \\gamma+\\epsilon_{n}\n\\end{array}\\right)\n$$\n\nCorollary 1 takes expectations over the set of every possible ordering, $\\Pi$, and gives us a reduced-form representation of $\\mathbf{E}_{n}\\left[Y_{i}\\right]$.\n\nCorollary 1. Let Assumptions 2 and 3 hold. Then, the peer effects model (5) admits a reducedform relationship with residual terms $\\eta_{i}$ :\n\n$$\n\\mathbf{E}_{n}\\left[Y_{i}\\right]=\\sum_{j=1}^{n} \\theta_{i, j} x_{j}^{\\top} \\gamma+\\eta_{i}\n$$\n\nwhere\n\n$$\n\\begin{aligned}\n\\theta_{i, j} & =\\sum_{\\pi \\in \\Pi} \\theta_{i, j}(\\pi) \\operatorname{Pr}_{n}\\{\\pi\\} \\\\\n\\eta_{i} & =\\sum_{\\pi \\in \\Pi} \\sum_{j=1}^{n} \\theta_{i, j}(\\pi) \\mathbf{E}_{n}\\left[\\varepsilon_{j} \\mid \\pi\\right] \\cdot \\operatorname{Pr}_{n}\\{\\pi\\}\n\\end{aligned}\n$$\n\n[^0]\n[^0]:    ${ }^{4}$ To see this, note that we can view our model as a second step of a two-stage process where firstly, the network is formed and secondly, the peer effect is determined based on the connections established in the first step. Models of endogenous network formation address endogeneity in the first step, whereas our model addresses endogeneity in the second step by allowing peer effect coefficients to depend on $\\left\\{\\varepsilon_{i}\\right\\}_{i=1}^{n}$.\n\nand $\\left(\\theta_{i, 1}(\\pi), \\ldots, \\theta_{i, n}(\\pi)\\right)$ is the $i$-th row of the $n \\times n$ matrix $\\left(I_{n}-\\mathbb{B}(\\pi)\\right)^{-1}$. Moreover, there also exists a reduced-form relationship between the ordered peer outcome $\\tilde{Y}_{i, k}$ and $\\left\\{x_{j}\\right\\}_{j=1}^{n}$, with residual terms $\\left\\{\\tilde{\\eta}_{j, k}\\right\\}_{j=1}^{n}$ :\n\n$$\n\\mathbf{E}_{n}\\left[\\tilde{Y}_{i, k}\\right]=\\sum_{j=1}^{n} \\tilde{\\theta}_{i, k, j} x_{j}{ }^{\\top} \\gamma+\\tilde{\\eta}_{i, k}\n$$\n\nwhere\n\n$$\n\\begin{aligned}\n\\tilde{\\theta}_{i, k, j} & =\\sum_{\\pi \\in \\Pi} \\tilde{\\theta}_{i, k, j}(\\pi) \\operatorname{Pr}_{n}\\{\\pi\\} \\\\\n\\tilde{\\eta}_{i, k} & =\\sum_{\\pi \\in \\Pi} \\sum_{j=1}^{n} \\tilde{\\theta}_{i, k, j}(\\pi) \\mathbf{E}_{n}\\left[\\varepsilon_{j} \\mid \\pi\\right] \\cdot \\operatorname{Pr}_{n}\\{\\pi\\}\n\\end{aligned}\n$$\n\nand $\\left(\\tilde{\\theta}_{i, k, 1}(\\pi), \\ldots, \\tilde{\\theta}_{i, k, n}(\\pi)\\right)$ is one row of the $n \\times n$ matrix $\\left(I_{n}-\\mathbb{B}(\\pi)\\right)^{-1}$, which corresponds to the $k$-th lowest performing peer of individual $i$.",
      "tables": {},
      "images": {}
    },
    {
      "section_id": 4,
      "text": "# Proof. See Appendix B. 2 \n\nNote that the residual terms $\\eta_{i}$ and $\\tilde{\\eta}_{i, k}$ may not be linear in $\\left\\{x_{i}\\right\\}_{i=1}^{n}$.\nTo compare the reduced form from Corollary 1 with more familiar models, such as the LIM model in (1) and the LIS model, observe that for these models, Assumptions 2 and 3 directly yield a reduced-form representation of $\\left\\{Y_{i}\\right\\}_{i=1}^{n}$ :\n\n$$\n\\left(\\begin{array}{c}\n\\mathbf{E}_{n}\\left[Y_{1}\\right] \\\\\n\\vdots \\\\\n\\mathbf{E}_{n}\\left[Y_{n}\\right]\n\\end{array}\\right)=\\left(I_{n}-\\mathbb{B}\\right)^{-1}\\left(\\begin{array}{c}\nx_{1}{ }^{\\top} \\gamma \\\\\n\\vdots \\\\\nx_{n}{ }^{\\top} \\gamma\n\\end{array}\\right)\n$$\n\nwhere the $n \\times n$ matrix $\\mathbb{B}$ is $\\beta G:=\\beta \\cdot\\left(A_{i, j} / d_{i}\\right)_{i, j}$ in the LIM model and $\\beta A:=\\beta \\cdot\\left(A_{i, j}\\right)_{i, j}$ in the LIS model. Importantly, this equation is linear in $\\left\\{x_{i}\\right\\}_{i=1}^{n}$.\n\nHowever, this linearity does not hold in our model. Instead, the rank-dependent peer effect coefficients introduce nonlinearities in the conditional expectations due to the connection between ordering and $\\left\\{x_{i}\\right\\}_{i=1}^{n}$. Consider a simple case with three individuals where individual 1 is connected to both individuals 2 and 3 , but individuals 2 and 3 are not connected to each other. From\n\nAssumption 3, we have:\n\n$$\n\\begin{aligned}\n\\mathbf{E}_{n}\\left[Y_{1}\\right]= & \\beta_{12} \\mathbf{E}_{n}\\left[Y_{2} \\mathbf{1}\\left\\{Y_{2} \\leq Y_{3}\\right\\}+Y_{3} \\mathbf{1}\\left\\{Y_{2}>Y_{3}\\right\\}\\right] \\\\\n& +\\beta_{22} \\mathbf{E}_{n}\\left[Y_{3} \\mathbf{1}\\left\\{Y_{2} \\leq Y_{3}\\right\\}+Y_{2} \\mathbf{1}\\left\\{Y_{2}>Y_{3}\\right\\}\\right]+x_{1}^{\\top} \\gamma\n\\end{aligned}\n$$\n\nSubstituting $Y_{2}$ and $Y_{3}$ using their reduced forms, we get:\n\n$$\n\\begin{aligned}\n\\tilde{\\beta} \\mathbf{E}_{n}\\left[Y_{1} \\mid\\left\\{x_{i}, A_{i, j}\\right\\}_{1 \\leq i, j \\leq n}\\right]= & \\beta_{12} \\mathbf{E}_{n}\\left[\\varepsilon_{2} \\mathbf{1}\\left\\{Y_{2} \\leq Y_{3}\\right\\}+\\varepsilon_{3} \\mathbf{1}\\left\\{Y_{2}>Y_{3}\\right\\}\\right] \\\\\n& +\\beta_{22} \\mathbf{E}_{n}\\left[\\varepsilon_{3} \\mathbf{1}\\left\\{Y_{2} \\leq Y_{3}\\right\\}+\\varepsilon_{2} \\mathbf{1}\\left\\{Y_{2}>Y_{3}\\right\\}\\right]+\\sum_{i=1}^{3} x_{i}^{\\top} \\tilde{\\gamma}_{i}\n\\end{aligned}\n$$\n\nfor some $\\tilde{\\beta}, \\tilde{\\gamma}_{1}, \\tilde{\\gamma}_{2}$, and $\\tilde{\\gamma}_{3}$. Without further assumptions on the distribution of $\\left\\{\\varepsilon_{i}\\right\\}_{i=1}^{n}$, the conditional expectations involve terms like $\\mathbf{E}_{n}\\left[\\varepsilon_{2} \\mathbf{1}\\left\\{Y_{2} \\leq Y_{3}\\right\\}\\right]$, which may not be zero or linear in $x_{i}$. An exception occurs when $\\beta_{12}=\\beta_{22}$, in which case the conditional expectations cancel out, resulting in a form similar to the LIM or LIS model.\n\nThese complications affect the relevance conditions we use to construct valid moment conditions. In the standard LIM and LIS models, the relevance condition on a set of instruments $\\left\\{z_{i}\\right\\}_{i=1}^{n}$ for identifying $\\beta$ is given by ensuring that the matrix\n\n$$\n\\left(\\begin{array}{lll}\nz_{1} & \\ldots & z_{n}\n\\end{array}\\right)\\left(\\mathbb{B}\\left(I_{n}-\\mathbb{B}\\right)^{-1}\\left(\\begin{array}{c}\nx_{1}^{\\top} \\gamma \\\\\n\\vdots \\\\\nx_{n}^{\\top} \\gamma\n\\end{array}\\right)\\left(\\begin{array}{c}\nx_{1}^{\\top} \\\\\n\\vdots \\\\\nx_{n}^{\\top}\n\\end{array}\\right)\\right)\n$$\n\nhas full rank. Bramoull\u00e9, Djebbari and Fortin (2009) discusses a similar condition in the LIM model when instruments are based on the mean covariates of peers or peers of peers.\n\nOur conditions are different and will instead relate to the reduced forms presented in Corollary 1. These conditions are given in Assumption 4.",
      "tables": {},
      "images": {}
    },
    {
      "section_id": 5,
      "text": "# Assumption 4. \n\na. (EXOGENEITY) $\\left\\{z_{i, 1}, \\ldots, z_{i, d}\\right\\}_{i=1}^{n}$ are known, predetermined functions of $\\left\\{x_{i}, A_{i, j}\\right\\}_{1 \\leq i, j \\leq n}$.\n\nb. (Relevance) The construction of the instrument $z_{i}$ and the reduced-form representation of\n\n$$\n\\mathbf{E}_{n}\\left[\\tilde{Y}_{i, k}\\right]=\\sum_{j=1}^{n} \\tilde{\\theta}_{i, k, j} x_{j}^{\\top} \\gamma+\\tilde{\\eta}_{i, k}\n$$\n\nfrom Corollary 1 satisfy that\n\n$$\n\\sum_{i=1}^{n}\\binom{z_{i, d}}{x_{i}}\\left(\\begin{array}{c}\n\\sum_{j=1}^{n} \\tilde{\\theta}_{i, 1, j} x_{j}^{\\top} \\gamma+\\tilde{\\eta}_{i, 1} \\\\\n\\vdots \\\\\n\\sum_{j=1}^{n} \\tilde{\\theta}_{i, d_{i}, j} x_{j}^{\\top} \\gamma+\\tilde{\\eta}_{i, d_{i}} \\\\\nx_{i}\n\\end{array}\\right)^{\\top} \\mathbf{1}\\left\\{d_{i}=d\\right\\}\n$$\n\nhas full rank, for each $d=1, \\ldots, \\bar{d}$.\n\nPart a. of Assumption 4, together with Assumption 3, provides the standard instrument exogeneity assumption commonly found in the literature. This includes, for example, instruments based on the average covariates of peers and peers-of-peers, as introduced by Bramoull\u00e9, Djebbari and Fortin (2009) for estimating the effects of peers' average outcomes. Given the increased number of endogenous variables in our model compared to the LIM model, a larger set of instruments is required. Beyond the instruments discussed in Bramoull\u00e9, Djebbari and Fortin (2009), we also consider alternatives such as ordered peer covariates or higher moments of peer covariates. In the following discussion, we do not commit to a specific set of instruments, we focus on outlining the necessary conditions that any valid instruments must satisfy for identification.\n\nAssumption 4-b. establishes a rank condition analogous to those found in Bramoull\u00e9, Djebbari and Fortin (2009). The matrix in Assumption 4-b. decomposes into two components:\n\n$$\n\\sum_{i: d_{i}=d}\\binom{z_{i, d}}{x_{i}}\\left(\\begin{array}{c}\n\\sum_{j=1}^{n} \\tilde{\\theta}_{i, 1, j} x_{j}^{\\top} \\gamma \\\\\n\\vdots \\\\\n\\sum_{j=1}^{n} \\tilde{\\theta}_{i, d, j} x_{j}^{\\top} \\gamma \\\\\nx_{i}\n\\end{array}\\right)^{\\top} \\quad \\text { and } \\quad \\sum_{i: d_{i}=d}\\binom{z_{i, d}}{x_{i}}\\left(\\begin{array}{c}\n\\tilde{\\eta}_{i, 1} \\\\\n\\vdots \\\\\n\\tilde{\\eta}_{i, d} \\\\\n\\mathbf{0}_{l}\n\\end{array}\\right)^{\\top}\n$$\n\nConstructing instruments $\\left\\{z_{i, d}\\right\\}_{i=1}^{n}$ such that the first matrix is full rank is straightforward as long as there is sufficient non-transitivity in the network and variation in the covariates $\\left\\{x_{i}\\right\\}_{i=1}^{n}$.\n\nSpecifically, we need the columns of $\\mathbb{X}=\\left(x_{1}, \\ldots, x_{n}\\right)^{\\top}$ and\n\n$$\n\\left(\\begin{array}{c}\n\\vdots \\\\\n\\sum_{j=1}^{n} \\tilde{\\theta}_{i, 1, j} x_{j}^{\\top} \\gamma \\\\\n\\vdots\n\\end{array}\\right) \\quad \\cdots \\quad\\left(\\begin{array}{c}\n\\vdots \\\\\n\\sum_{j=1}^{n} \\tilde{\\theta}_{i, d, j} x_{j}^{\\top} \\gamma \\\\\n\\vdots\n\\end{array}\\right)\n$$\n\nto be linearly independent. This condition is closely related to that found in Bramoull\u00e9, Djebbari and Fortin (2009), where there are no residual terms $\\left\\{\\tilde{\\eta}_{i, k}\\right\\}_{i, k}$. As such, when $\\left\\{\\tilde{\\eta}_{i, k}\\right\\}_{i, k}$ are close to zero, the sum of the two matrices will also have full rank, satisfying our relevance condition. In cases where $\\left\\{\\tilde{\\eta}_{i, k}\\right\\}_{i, k}$ are nonzero, it is challenging to interpret the rank condition, but we can empirically check whether or not it holds in a given sample.\n\nTo simplify the notation of our identification results, let\n\n$$\n\\begin{aligned}\n& \\beta=\\left(\\begin{array}{llllllll}\n\\beta_{11} & \\beta_{21} & \\beta_{22} & \\cdots & \\beta_{1 \\bar{d}} & \\cdots & \\beta_{\\bar{d} \\bar{d}}\n\\end{array}\\right)^{\\top} \\\\\n& \\tilde{Y}_{i}=\\left(\\begin{array}{llllllllll}\n0 & \\cdots & 0 & \\tilde{Y}_{i, 1} & \\cdots & \\tilde{Y}_{i, d_{i}} & 0 & \\cdots 0\n\\end{array}\\right)^{\\top}\n\\end{aligned}\n$$\n\nso that the rank-dependent peer effect model (5) can be written as follows:\n\n$$\nY_{i}=\\tilde{Y}_{i}^{\\top} \\beta+x_{i}^{\\top} \\gamma+\\varepsilon_{i}=W_{i}^{\\top}\\binom{\\beta}{\\gamma}+\\varepsilon_{i}\n$$\n\nLet $W_{i}=\\left(\\tilde{Y}_{i}^{\\top}, x_{i}^{\\top}\\right)^{\\top} \\in \\mathbb{R}^{\\frac{\\bar{d}(\\bar{d}+1)}{2}+l}$ and $z_{i}=\\left(z_{i, 1}^{\\top}, \\ldots, z_{i, \\bar{d}}^{\\top}, x_{i}^{\\top}\\right)^{\\top}$. Lastly, let $\\mathbb{Y}, \\mathbb{W}$ and $\\mathbb{Z}$ denote the row-stacked matrices of $Y_{i}, W_{i}$ and $z_{i}$. Theorem 1 provides the identification result.\n\nTheorem 1. Suppose that Assumptions 2-4 hold and $n \\geq \\frac{\\bar{d}(\\bar{d}+1)}{2}+l$. Then, $\\beta$ and $\\gamma$ are identified from the moment condition below:\n\n$$\n\\mathbf{E}_{n}\\left[\\mathbb{Z}^{\\top} \\mathbb{W}\\right]\\binom{\\beta}{\\gamma}=\\mathbf{E}_{n}\\left[\\mathbb{Z}^{\\top} \\mathbb{Y}\\right]\n$$\n\nProof. See Appendix B.3.\nFor identification, we consider a fixed $n$ and $\\bar{d}$ environment. The minimal condition $n \\geq \\frac{\\bar{d}(\\bar{d}+1)}{2}+l$,\n\nalong with Assumption 4, guarantees that the matrix $\\mathbf{E}_{n}\\left[\\mathbb{Z}^{\\top} \\mathbb{W}\\right]$ has a left inverse. However, in practice, when $\\bar{d}$ is large relative to $n$, this can pose challenges. In such cases, it may be beneficial to consider an asymptotic framework where $\\bar{d}$ grows with $n$ and thus the dimension of $\\beta$ also grows with $n$. If the parameter $\\beta$ satisfies some sparsity or smoothness restrictions, it may be possible to take advantage of recent developments for high-dimensional models with many endogenous variables. See for example Belloni, Hansen and Newey (2022). However, this literature primarily analyses crosssectional data, and it is unclear if these results will extend to our setting due to the dependent nature of network data.\n\nThe moment condition (11) consists of $n$ different equations, one for each student $i=1, \\ldots, n$. Since $\\tilde{Y}_{i}$ concatenates $\\bar{d}$ different vectors of peer outcomes where only one out of the $\\bar{d}$ vectors is nonzero for a given student, the $n \\times\\left(\\frac{\\bar{d}(\\bar{d}+1)}{2}+l\\right)$ matrix $\\mathbf{E}_{n}\\left[\\mathbb{Z}^{\\top} \\mathbb{W}\\right]$ can also be decomposed into $\\bar{d}$ submatrices. Part b. of Assumption 4 gives us each of the $\\bar{d}$ submatrices having full rank, leading to $\\mathbf{E}_{n}\\left[\\mathbb{Z}^{\\top} \\mathbb{W}\\right]$ having full rank as a result. Given that $\\mathbf{E}_{n}\\left[\\mathbb{Z}^{\\top} \\mathbb{W}\\right]$ has full rank, it is trivial to write $\\beta$ and $\\gamma$ as functions of the conditional moments of $\\left\\{Y_{i}\\right\\}_{i=1}^{n}$. In the case of the TSLS estimand, the first stage coefficient matrix from regressing $W_{i}$ on $z_{i}$ is used. Let $\\Gamma$ denote the first stage coefficient matrix. Then,\n\n$$\n\\binom{\\beta T S L S}{\\gamma^{T S L S}}:=\\left(\\mathbf{E}_{n}\\left[(\\mathbb{Z} \\Gamma)^{\\top} \\mathbb{W}\\right]\\right)^{-1} \\mathbf{E}_{n}\\left[(\\mathbb{Z} \\Gamma)^{\\top} \\mathbb{Y}\\right]=\\binom{\\beta}{\\gamma}\n$$\n\nFor Sections 4 and 5, we use the sample analogue of the TSLS estimand as our estimator.",
      "tables": {},
      "images": {}
    },
    {
      "section_id": 6,
      "text": "# 3.1 Comparison to other peer effect estimands \n\nA natural question, given that our model generalizes the standard LIM model, is to what extent existing estimands recover the key parameters of interest from our model. A commonly accepted minimal standard for such estimands is that they represent weighted averages of the underlying heterogeneity, such as in the analysis of instrument variables (Mogstad and Torgovitsky, 2024) or the analysis of Difference-in-Difference estimands (De Chaisemartin and d'Haultfoeuille, 2020; Goodman-Bacon, 2021). To explore this, we first assume instruments that satisfy the relevance condition used in the LIM model and define a LIM estimand as follows:\n\n$$\n\\beta^{\\mathrm{LIM}}:=\\left(\\mathbf{E}_{n}\\left[\\mathbb{Z}^{\\mathrm{r}} \\mathbb{M}_{X} G \\mathbb{Y}\\right]\\right)^{-1} \\mathbf{E}_{n}\\left[\\mathbb{Z}^{\\mathrm{r}} \\mathbb{M}_{X} \\mathbb{Y}\\right]\n$$\n\nwhere $G=\\left(A_{i, j} / d_{i}\\right)_{i, j}$ and $\\mathbb{M}_{X}=I_{n}-\\mathbb{X}\\left(\\mathbb{X}^{\\mathrm{r}} \\mathbb{X}\\right)^{-1} \\mathbb{X}^{\\mathrm{r}}$ with $\\mathbb{X}$, a row-stacked matrix constructed with $\\left\\{x_{i}\\right\\}_{i=1}^{n}$. Similarly, for the LIS model, we define\n\n$$\n\\beta^{\\mathrm{LIS}}:=\\left(\\mathbf{E}_{n}\\left[\\mathbb{Z}^{\\mathrm{r}} \\mathbb{M}_{X} A \\mathbb{Y}\\right]\\right)^{-1} \\mathbf{E}_{n}\\left[\\mathbb{Z}^{\\mathrm{r}} \\mathbb{M}_{X} \\mathbb{Y}\\right]\n$$\n\nwhere $A=\\left(A_{i, j}\\right)_{i, j}$.",
      "tables": {},
      "images": {}
    },
    {
      "section_id": 7,
      "text": "# Assumption 5. \n\n$i$ There exist an instrument $\\left\\{z_{i}\\right\\}_{i=1}^{n}$, a known, predetermined function of $\\left\\{x_{i}, A_{i, j}\\right\\}_{1 \\leq i, j \\leq n}$, that satisfies $\\mathbf{E}_{n}\\left[\\mathbb{Z}^{\\mathrm{r}} \\mathbb{M}_{X} G \\mathbb{Y}\\right] \\neq 0$.\nii There exist an instrument $\\left\\{z_{i}\\right\\}_{i=1}^{n}$, a known, predetermined function of $\\left\\{x_{i}, A_{i, j}\\right\\}_{1 \\leq i, j \\leq n}$, that satisfies $\\mathbf{E}_{n}\\left[\\mathbb{Z}^{\\mathrm{r}} \\mathbb{M}_{X} A \\mathbb{Y}\\right] \\neq 0$.\n\nThese conditions are the same instrument relevance conditions used in the LIM model and the LIS model, as in Bramoull\u00e9, Djebbari and Fortin (2009).\n\nProposition 2. Under Assumption 2, 3 and 5-i,\n\n$$\n\\beta^{\\mathrm{LIM}}=\\sum_{d=1}^{\\bar{d}} \\sum_{k=1}^{d} w_{k, d}^{\\mathrm{LIM}} d \\beta_{k, d}\n$$\n\nwhere $\\sum_{d=1}^{\\bar{d}} \\sum_{k=1}^{d} w_{k, d}^{\\mathrm{LIM}}=1$ and $w_{k, d}^{\\mathrm{LIM}} \\lessgtr 0$. Similarly, under Assumptions 2, 3 and 5-ii,\n\n$$\n\\beta^{\\mathrm{LIS}}=\\sum_{d=1}^{\\bar{d}} \\sum_{k=1}^{d} w_{k, d}^{\\mathrm{LIS}} \\beta_{k, d}\n$$\n\nwhere $\\sum_{d=1}^{\\bar{d}} \\sum_{k=1}^{d} w_{k, d}^{\\mathrm{LIS}}=1$ and $w_{k, \\bar{d}}^{\\mathrm{LIS}} \\lessgtr 0$.\nProof. See Appendix B.4.\nNote that, in the case of LIM misspecification, the weights are applied not directly to $\\beta_{k, d}$ but to $d \\beta_{k, d}$. The rank-dependent peer effect coefficient $\\beta_{k, d}$ represents the impact of a single peer outcome\n\nwhen there are $d$ peers in total, so it should be rescaled by $d$ to interpret it as a coefficient on a 'representative' or'average' peer. For instance, when $\\beta_{1, d}=\\ldots=\\beta_{d, d}=\\beta$, we have:\n\n$$\n\\sum_{k=1}^{d} \\beta_{k, d} \\tilde{y}_{i, k}=d \\beta \\bar{y}_{i}\n$$\n\nwhere the coefficient on the average peer outcome is $d \\beta_{k, d}$.\nProposition 2 demonstrates that both the LIM estimand $\\beta^{\\text {LIM }}$ and the LIS estimand $\\beta^{\\text {LIS }}$ are weighted sums of the rank-dependent peer effect coefficients $\\left\\{\\beta_{k, d}\\right\\}_{k, d}$. While the weights sum to one, which is reasonable, there is no guarantee that the weights have the same sign. As a result, it is possible for all $\\beta_{k, d}$ to be positive, while the LIM estimand $\\beta^{\\text {LIM }}$ is negative, and vice versa. The expressions for the weights are provided in the Appendix.",
      "tables": {},
      "images": {}
    },
    {
      "section_id": 8,
      "text": "# 4 Simulation \n\nTo investigate the finite sample performance of the TSLS estimator for the rank-dependent peer effects, we simulate 1000 samples from the rank-dependent peer effect model while varying the model specifications. To investigate the small sample properties of the estimator, we consider sample sizes of either $n=100$ or $n=200$. The DGP we use is as follows: for $i=1, \\ldots, n$,\n\n$$\nY_{i}=\\gamma_{0}+\\gamma_{1} X_{i}+\\tilde{Y}_{i}^{\\top} \\beta+\\varepsilon_{i}\n$$\n\nand\n\n$$\n\\binom{X_{i}}{\\varepsilon_{i}} \\stackrel{\\text { iid }}{\\sim} \\mathcal{N}\\left(\\binom{0}{0},\\left(\\begin{array}{ll}\n1 & 0 \\\\\n0 & 1\n\\end{array}\\right)\\right)\n$$\n\nTo simulate the network, we first generate the links based on a logit model, defining\n\n$$\nA_{i, j}=\\mathbf{1}\\left\\{-4.5+R_{i, j} \\leq V_{i, j}\\right\\}\n$$\n\nwith $V_{i, j} \\stackrel{\\text { iid }}{\\sim}$ logit and $R_{i, j} \\sim N(0,1)$. We then drop links from individuals with more links than $\\bar{d}$ until all individuals have at most $\\bar{d}$ links. This procedure generates a network with a roughly\n\nTable 1: Comparison between the OLS estimator and the TSLS estimator\n\n![table_0](table_0)\n\nNotes: The values of the coefficients used in DGP are as follows: $\\gamma_{0}=1$ and $\\beta=(0.3,0.15,0.4)$. The instruments used in TSLS estimation are ordered peers' covariates. TSLS estimation is stratified in the sense that the dataset is separated into three subdata- $\\left\\{i: d_{i}=0\\right\\},\\left\\{i: d_{i}=1\\right\\}$ and $\\left\\{i: d_{i}=2\\right\\}$-and the sets of coefficients- $\\left(\\gamma_{0}, \\gamma_{1}\\right)$, $\\beta_{1,1}$ and $\\left(\\beta_{1,2}, \\beta_{2,2}\\right)$-are estimated from each subdata.\nuniform degree distribution, with very few individuals having zero links. For the results in this section we will fix the network across simulations. Results when we do not fix the network across simulations can be seen in Appendix C. Finally, to avoid unnecessary repetition in our tables, we will only show results for a subset of $\\beta$.\n\nThe instruments $\\left\\{Z_{i}=\\left(Z_{i, 1}, \\ldots, Z_{i, \\bar{d}}^{\\top}\\right)^{\\top}\\right\\}_{i=1}^{n}$ used in the TSLS estimation are constructed by taking ordered statistics of peers' covariate $\\left\\{X_{j}\\right\\}_{j: A_{i, j}=1}$ for each student $i . Z_{i, d}$ is a $d$-dimensional vector that orders $\\left\\{X_{j}\\right\\}_{j: A_{i, j}=1}$ when $d_{i}=d$ and contains zeros when $d_{i} \\neq d$. To avoid the simulations potentially suffering from the contamination bias discussed in Goldsmith-Pinkham, Hull and Koles\u00e1r (2024+), we stratify our estimator. We do this by splitting the dataset into $\\bar{d}+1$ strata of $\\left\\{i: d_{i}=0\\right\\}, \\ldots,\\left\\{i: d_{i}=\\bar{d}\\right\\}$ and the sets of the coefficients $\\left(\\gamma_{0}, \\gamma_{1}\\right), \\beta_{1,1}, \\ldots,\\left(\\beta_{1, \\bar{d}}, \\ldots, \\beta_{\\bar{d}, \\bar{d}}\\right)$ are separately estimated from each strata. A pooled version of our estimator generally performs similarly, but can sometimes be less robust. See Appendix C for a discussion.\n\nFirst, we set $\\bar{d}=2$. The bias and MSE of the TSLS estimator are compared to those of the OLS estimator in Table 1. In this table, two key model parameters, $\\gamma_{1}$ and $n$, vary across the columns. As expected, the OLS estimator shows a larger bias compared to the TSLS estimator. However, the TSLS estimator has a higher variance than the OLS estimator. Notably, as $\\left|\\gamma_{1}\\right|$ increases,\n\nTable 2: The TSLS estimation when the network is more connected\n\n![table_1](table_1)\n\nNotes: The values of the coefficients used in DGP are as follows: $n=200, \\gamma_{0}=1, \\beta_{1,1}=0.3, \\beta_{k, d}=\\frac{\\beta_{-\\text {max }}}{d}=\\frac{0.4}{d}$ for $k<d$ and $\\beta_{d, d}=\\beta_{\\max }=0.3$ for $d=2, \\ldots, 5$. The instruments used in TSLS estimation are ordered peers' covariates. The TSLS estimation is stratified in the sense that the dataset is separated into three subdata- $\\{i$ : $\\left.d_{i}=0\\right\\}, \\ldots,\\left\\{i: d_{i}=5\\right\\}$-and the sets of coefficients $-\\left(\\gamma_{0}, \\gamma_{1}\\right), \\ldots,\\left(\\beta_{1,5}, \\ldots, \\beta_{5,5}\\right)$-are estimated from each subdata. Panel A estimates the fully saturates model with fifteen $\\beta \\mathrm{s}$ and Panel B focuses on individuals with at least two peers and estimates the correctly specific model with two $\\beta \\mathrm{s}: \\beta_{-\\max }=0.4$ and $\\beta_{\\max }=0.3$.\nthe variance of the TSLS estimator decreases. This indicates the finite sample performance of the estimator depends on the existence of strong covariates.\n\nAdditionally, as $\\left|\\gamma_{1}\\right|$ increases, the performance of the OLS estimator also improves in terms of both bias and MSE. A larger $\\left|\\gamma_{1}\\right|$ means that the ordering of $\\left\\{Y_{i}\\right\\}_{i=1}^{n}$ relies less on the variation in $\\left\\{\\varepsilon_{i}\\right\\}_{i=1}^{n}$ and more on the variation in $\\left\\{\\gamma_{1} x_{i}\\right\\}_{i=1}^{n}$. If the endogeneity problem is exacerbated by the randomness in the mapping $\\left\\{Y_{j}\\right\\}_{j=1}^{n} \\mapsto \\tilde{Y}_{i, k}$, then a larger $\\left|\\gamma_{1}\\right|$ may help reduce bias by decreasing this randomness.\n\nNext, we increase the parameter space by setting $\\bar{d}=5$. Since the dimension of $\\beta$ is proportional to $\\bar{d}^{2}$, this introduces 15 different coefficients for the rank-dependent peer effect in our model. Panel\n\nTable 3: $R^{2}$ in the first stage regression\n\n![table_2](table_2)\n\nNotes: The values of the coefficients used in DGP are as follows: $n=200, \\gamma_{0}=1, \\beta_{1,1}=0.3, \\beta_{k, d}=\\frac{n \\cdot 1}{n}$ for $k<d$ and $\\beta_{d, d}=0.3$ for $d=2, \\ldots, 5$. The instruments used in TSLS estimation are ordered peers' covariates. The TSLS estimation is stratified in the sense that the dataset is separated into three subdata- $\\left\\{i: d_{i}=0\\right\\}, \\ldots,\\{i$ : $d_{i}=5\\}$-and the sets of coefficients $-\\left(\\gamma_{0}, \\gamma_{1}\\right), \\ldots,\\left(\\beta_{1,5}, \\ldots, \\beta_{5,5}\\right)$-are estimated from each subdata.\n\nA of Table 2 presents the bias and MSE of the TSLS estimator under this setting. We observe that the TSLS estimator suffers from significant bias and highly volatile variance when $\\gamma_{1}=1$ (columns 2 and 7). However, as $\\left|\\gamma_{1}\\right|$ increases, the variance of the TSLS estimator decreases, as shown in columns 8 through 10 .\n\nInterestingly, the MSE is larger for the coefficients $\\beta_{k, 5}$ where $k=2,3,4$, compared to $k=1,5$. This is related to our earlier observation that larger $\\left|\\gamma_{1}\\right|$ improves the performance of the OLS estimator. The identity of the $k$-th lowest-performing peer tends to fluctuate more frequently for $k=2,3,4$, leading to a more severe endogeneity problem from the randomness in the mapping $\\left\\{Y_{j}\\right\\}_{j=1}^{n} \\mapsto \\tilde{Y}_{i, k}$. In contrast, this issue is less pronounced for $k=1,5$. Therefore, it may be reasonable to impose smoothness restrictions on $\\beta_{k, d}$ for values of $k$ that are not close to 1 or $d$.\n\nTo discuss the empirical advantage of a smoothness restriction, we additionally considered a restricted peer effect model with correct smoothness restrictions: for $d=1, \\ldots, 5$,\n\n$$\n\\beta_{k, d}=\\frac{\\beta_{-\\max }}{d-1} \\quad \\forall k<d \\quad \\text { and } \\quad \\beta_{d, d}=\\beta_{\\max }\n$$\n\nWith the restricted model, we estimated only two peer effect parameters: $\\beta_{-\\text {max }}, \\beta_{\\text {max }}$. Panel B\n\nof Table 2 contains the estimation results. Both in terms of bias and MSE, correct smoothness restriction greatly improves the performance of the TSLS estimator when $\\left|\\gamma_{1}\\right|$ is small.\n\nFinally, Table 3 reports the average first-stage $R^{2}$ and the probability of the $R^{2}$ exceeding 0.7 for each of the endogenous variables $\\tilde{Y}_{1,5}, \\cdots, \\tilde{Y}_{5,5}$. The results show that a weak first-stage regression exacerbates the performance of the TSLS estimator. This suggests that the potential costs of allowing for a more complex parameter space in terms of peer effect coefficients can be mitigated by carefully selecting the instruments $\\left\\{Z_{i}\\right\\}_{i=1}^{n}$ to ensure a sufficiently strong first-stage regression.",
      "tables": {
        "table_0": "|  | Bias |  |  |  | MSE |  |  |  |\n| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |\n|  | $(1)$ | $(2)$ | $(3)$ | $(4)$ | $(5)$ | $(6)$ | $(7)$ | $(8)$ |\n| $\\hat{\\gamma}_{1}^{O L S}$ | -0.019 | -0.023 | -0.033 | -0.031 | 0.012 | 0.012 | 0.007 | 0.007 |\n| $\\hat{\\beta}_{1,2}^{O L S}$ | 0.120 | 0.054 | 0.112 | 0.045 | 0.035 | 0.011 | 0.017 | 0.004 |\n| $\\hat{\\gamma}_{1}^{T S L S}$ | -0.003 | -0.009 | -0.016 | -0.002 | 0.043 | 0.042 | 0.262 | 0.256 |\n| $\\hat{\\beta}_{1,2}^{T S L S}$ | -0.007 | 0.002 | -0.003 | -0.002 | 0.107 | 0.016 | 0.077 | 0.015 |\n| $\\gamma_{1}$ | 1 | 2 | 1 | 2 | 1 | 2 | 1 | 2 |\n| $n$ | 100 | 100 | 200 | 200 | 100 | 100 | 200 | 200 |",
        "table_1": "|  | Bias |  |  |  |  | MSE |  |  |  |  |\n| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |\n|  | (1) | (2) | (3) | (4) | (5) | (6) | (7) | (8) | (9) | (10) |\n| Panel A: Saturated model |  |  |  |  |  |  |  |  |  |  |\n| $\\beta_{1,2}$ | -0.005 | -0.000 | -0.004 | -0.001 | 0.001 | 0.049 | 0.260 | 0.023 | 0.010 | 0.003 |\n| $\\beta_{2,2}$ | 0.002 | -0.000 | 0.000 | -0.001 | -0.000 | 0.025 | 0.109 | 0.012 | 0.006 | 0.002 |\n| $\\beta_{1,5}$ |  | 0.058 | -0.008 | -0.002 | -0.002 |  | 1.872 | 0.305 | 0.082 | 0.017 |\n| $\\beta_{2,5}$ |  | 0.044 | 0.021 | -0.009 | 0.007 |  | 4.371 | 1.500 | 0.523 | 0.094 |\n| $\\beta_{3,5}$ |  | -0.022 | -0.019 | 0.031 | 0.000 |  | 5.635 | 2.233 | 0.788 | 0.143 |\n| $\\beta_{4,5}$ |  | -0.001 | 0.022 | -0.045 | -0.006 |  | 4.531 | 1.339 | 0.428 | 0.086 |\n| $\\beta_{5,5}$ |  | -0.029 | -0.016 | 0.018 | 0.004 |  | 1.300 | 0.240 | 0.072 | 0.013 |\n| Panel B: Restricted model |  |  |  |  |  |  |  |  |  |  |\n| $\\beta_{-\\text {max }}$ |  | -0.005 | -0.002 | 0.000 | 0.001 |  | 0.104 | 0.011 | 0.004 | 0.001 |\n| $\\beta_{\\text {max }}$ |  | -0.010 | -0.000 | -0.001 | -0.001 |  | 0.082 | 0.008 | 0.003 | 0.001 |\n| $\\gamma_{1}$ | 1 | 1 | 2 | 3 | 5 | 1 | 1 | 2 | 3 | 5 |\n| $\\bar{d}$ | 2 | 5 | 5 | 5 | 5 | 2 | 5 | 5 | 5 | 5 |",
        "table_2": "|  | Average first stage $R^{2}$ |  |  |  | $\\operatorname{Pr}\\left\\{R^{2} \\geq 0.7\\right\\}$ |  |  |  |\n| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |\n|  | (1) | (2) | (3) | (4) | (5) | (6) | (7) | (8) |\n| $\\tilde{Y}_{1,5}$ | 0.389 | 0.611 | 0.704 | 0.771 | 0.002 | 0.201 | 0.580 | 0.856 |\n| $\\tilde{Y}_{2,5}$ | 0.412 | 0.616 | 0.701 | 0.765 | 0.004 | 0.207 | 0.562 | 0.828 |\n| $\\tilde{Y}_{3,5}$ | 0.421 | 0.619 | 0.703 | 0.763 | 0.004 | 0.230 | 0.552 | 0.835 |\n| $\\tilde{Y}_{4,5}$ | 0.409 | 0.609 | 0.694 | 0.749 | 0.004 | 0.189 | 0.510 | 0.770 |\n| $\\tilde{Y}_{5,5}$ | 0.381 | 0.587 | 0.678 | 0.745 | 0.004 | 0.140 | 0.423 | 0.772 |\n| $\\gamma_{1}$ | 1 | 2 | 3 | 5 | 1 | 2 | 3 | 5 |\n| $\\bar{d}$ | 5 | 5 | 5 | 5 | 5 | 5 | 5 | 5 |"
      },
      "images": {}
    },
    {
      "section_id": 9,
      "text": "# 5 Empirical Illustration \n\nTo see how our model behaves with real data, we apply it to a dataset from Alne, Herstad and Myhre (2025), which is collected in two Norwegian middle schools and contains school grades, test scores for a nationwide test (\"National Test\") taken prior to entering middle school, parental background variables, and friendship network of the students. We follow the regression specification of Alne, Herstad and Myhre (2025); the GPA is the outcome variable with possible spillovers and the National Test score and other socioeconomic and demographic variables are the control covariates. To simplify the presentation, we focus on a subset of the control covariates used in Alne, Herstad and Myhre (2025). Similarly, we run the estimation only for individuals with more than two friends to avoid any potential contamination bias. The instruments are constructed with the National test score from the test the students took before they started in middle school, as it is arguably exogenous to shocks to GPA in middle school.\n\nIn this paper, we expand the LIM model to allow for ordered peer outcomes to affect a student differently, as in (3). Specifically, we focus on the highest-performing peer and the lowest-performing\n\nTable 4: Min/max models for educational peer effects\n\n![table_3](table_3)\n\nNotes: ${ }^{*} p<0.01 ;{ }^{* *} p<0.05 ;{ }^{* * *} p<0.01$. The standard errors are computed from the asymptotic variance formula discussed in Section A of the appendix.\npeer. Furthermore, whenever well-defined, we let\n\n$$\n\\begin{aligned}\n\\bar{Y}_{i,-1-d_{i}} & =\\frac{1}{d_{i}-2} \\sum_{k=2}^{d_{i}-1} \\tilde{Y}_{i, k} \\\\\n\\bar{Y}_{i,-1} & =\\frac{1}{d_{i}-1} \\sum_{k=2}^{d_{i}} \\tilde{Y}_{i, k} \\\\\n\\bar{Y}_{i,-d_{i}} & =\\frac{1}{d_{i}-1} \\sum_{k=1}^{d_{i}-1} \\tilde{Y}_{i, k}\n\\end{aligned}\n$$\n\nAs $\\tilde{Y}_{i, k}$ is the $k$-th lowest GPA among student $i$ 's peers, $\\widetilde{Y}_{i,-1-d_{i}}$ is the average GPA of student $i$ 's peers minus the one with the lowest GPA and the one with the highest GPA, and so on. For the instruments, we construct $z_{i, 1}, z_{i, d_{i}}, \\bar{z}_{i,-1-d_{i}}, \\bar{z}_{i,-1}$ and $\\bar{z}_{i,-d_{i}}$ accordingly, using the National Test score. For each specification, we use the corresponding instruments to the $\\tilde{Y}_{i}$ variables contained in the specification.\n\nAs controls for student background, we use the log of household income, whether the student was born in Norway, the average number of years the parents have been educated, the distance the students live from school as well as the student's gender.\n\nTable 4 shows the estimation results. There are five specifications we consider. The first is the classic LIM model. The second and third specifications separate out the lowest and highest friends GPA respectively. In the fourth we separate out both the highest and lowest GPA, while in the final specification we only include the highest and lowest GPA friends, not using the average GPA of the peers inbetween.\n\nWhile the estimates are noisy, there are indications that the majority of estimated peer effect in the LIM model is driven by $\\tilde{Y}_{d_{i}}$, the friend with the highest grade. We see that the coefficient on $\\tilde{Y}_{1}$ is consistently smaller than the coefficient on $\\tilde{Y}_{d_{i}}$. In our specification where we only separate out $\\tilde{Y}_{d_{i}}$, the coefficient on the remaining LIM component is almost zero. However, the estimate of the coefficient on $\\tilde{Y}_{d_{i}}$ is not significant in this specification. In total, this exercise shows that there may be large heterogeneity in peer spillovers in education masked by the estimated effect of the LIM model, though we do not have the power in this sample to conclude anything concrete.",
      "tables": {
        "table_3": "|  | Dependent variable: GPA |  |  |  |  |\n| :--: | :--: | :--: | :--: | :--: | :--: |\n|  | (1) | (2) | (3) | (4) | (5) |\n| $\\bar{Y}$ | $\\begin{aligned} & 0.483^{* * *} \\\\ & (0.131) \\end{aligned}$ |  |  |  |  |\n| $\\bar{Y}_{-d_{i}}$ |  |  | $\\begin{aligned} & -0.003 \\\\ & (0.278) \\end{aligned}$ |  |  |\n| $\\bar{Y}_{-1}$ |  | $\\begin{aligned} & 0.678^{* *} \\\\ & (0.295) \\end{aligned}$ |  |  |  |\n| $\\bar{Y}_{-1,-d_{i}}$ |  |  |  | $\\begin{aligned} & 0.156 \\\\ & (0.475) \\end{aligned}$ |  |\n| $\\hat{Y}_{d_{i}}$ |  |  | $\\begin{aligned} & 0.43 \\\\ & (0.313) \\end{aligned}$ | $\\begin{aligned} & 0.303 \\\\ & (0.391) \\end{aligned}$ | $\\begin{aligned} & 0.407^{* * *} \\\\ & (0.151) \\end{aligned}$ |\n| $\\tilde{Y}_{1}$ |  | $\\begin{aligned} & -0.067 \\\\ & (0.221) \\end{aligned}$ |  | $\\begin{aligned} & 0.138 \\\\ & (0.202) \\end{aligned}$ | $\\begin{aligned} & 0.18^{*} \\\\ & (0.106) \\end{aligned}$ |\n| Parent Income | $\\begin{aligned} & 0.146^{* *} \\\\ & (0.066) \\end{aligned}$ | $\\begin{aligned} & 0.15^{* *} \\\\ & (0.068) \\end{aligned}$ | $\\begin{aligned} & 0.148^{* *} \\\\ & (0.069) \\end{aligned}$ | $\\begin{aligned} & 0.135^{* *} \\\\ & (0.065) \\end{aligned}$ | $\\begin{aligned} & 0.136^{* *} \\\\ & (0.066) \\end{aligned}$ |\n| Born in Norway | $\\begin{aligned} & -0.277^{* *} \\\\ & (0.135) \\end{aligned}$ | $\\begin{aligned} & -0.26^{*} \\\\ & (0.136) \\end{aligned}$ | $\\begin{aligned} & -0.363^{* *} \\\\ & (0.148) \\end{aligned}$ | $\\begin{aligned} & -0.298^{* *} \\\\ & (0.149) \\end{aligned}$ | $\\begin{aligned} & -0.321^{* *} \\\\ & (0.139) \\end{aligned}$ |\n| National Test | $\\begin{aligned} & 0.388^{* * *} \\\\ & (0.053) \\end{aligned}$ | $\\begin{aligned} & 0.383^{* * *} \\\\ & (0.053) \\end{aligned}$ | $\\begin{aligned} & 0.401^{* * *} \\\\ & (0.052) \\end{aligned}$ | $\\begin{aligned} & 0.381^{* * *} \\\\ & (0.053) \\end{aligned}$ | $\\begin{aligned} & 0.381^{* * *} \\\\ & (0.053) \\end{aligned}$ |\n| Parental Education | $\\begin{aligned} & 0.053^{* * *} \\\\ & (0.016) \\end{aligned}$ | $\\begin{aligned} & 0.051^{* * *} \\\\ & (0.016) \\end{aligned}$ | $\\begin{aligned} & 0.049^{* * *} \\\\ & (0.017) \\end{aligned}$ | $\\begin{aligned} & 0.05^{* * *} \\\\ & (0.016) \\end{aligned}$ | $\\begin{aligned} & 0.05^{* * *} \\\\ & (0.016) \\end{aligned}$ |\n| Distance to School | $\\begin{aligned} & -0.011 \\\\ & (0.048) \\end{aligned}$ | $\\begin{aligned} & -0.015 \\\\ & (0.051) \\end{aligned}$ | $\\begin{aligned} & 0 \\\\ & (0.052) \\end{aligned}$ | $\\begin{aligned} & -0.022 \\\\ & (0.052) \\end{aligned}$ | $\\begin{aligned} & -0.024 \\\\ & (0.05) \\end{aligned}$ |\n| Female | $\\begin{aligned} & 0.468^{* * *} \\\\ & (0.101) \\end{aligned}$ | $\\begin{aligned} & 0.4^{* * *} \\\\ & (0.093) \\end{aligned}$ | $\\begin{aligned} & 0.586^{* * *} \\\\ & (0.103) \\end{aligned}$ | $\\begin{aligned} & 0.442^{* * *} \\\\ & (0.093) \\end{aligned}$ | $\\begin{aligned} & 0.466^{* * *} \\\\ & (0.104) \\end{aligned}$ |\n| Constant | $\\begin{aligned} & -1.377^{* * *} \\\\ & (0.345) \\end{aligned}$ | $\\begin{aligned} & -1.565^{* * *} \\\\ & (0.454) \\end{aligned}$ | $\\begin{aligned} & -1.83^{* * *} \\\\ & (0.477) \\end{aligned}$ | $\\begin{aligned} & -1.434^{* * *} \\\\ & (0.382) \\end{aligned}$ | $\\begin{aligned} & -1.488^{* * *} \\\\ & (0.387) \\end{aligned}$ |\n| Observations | 529 | 529 | 529 | 529 | 529 |\n| Adjusted R ${ }^{2}$ | 0.476 | 0.474 | 0.450 | 0.480 | 0.476 |"
      },
      "images": {}
    },
    {
      "section_id": 10,
      "text": "# 6 Conclusion \n\nThis paper introduced the rank-dependent peer effect model. In this model, how you affect your peer depends not only on your own outcome level but also on the outcomes of the other peers that they have. The construction of the peer effect in the model is flexible enough to allow us to discuss many interesting questions regarding how the composition of a peer group affects the peer effect: complementarity v. substitutability, returns to centrality, etc. Traditional peer effect models, such as the linear-in-means (LIM) model, tend to oversimplify the dynamics of peer influence by focusing on a single scalar parameter and assuming perfect substitutability among\n\npeers. This oversimplification neglects the heterogeneity within peer effects, where individuals may experience varying degrees of influence depending on the structure and nature of their interactions, across different empirical contexts. By developing the rank-dependent peer effect model, this paper allows researchers to investigate richer patterns of peer interactions, with specific peers-such as the highest or lowest performers-having disproportionately larger effects on outcomes in certain contexts.\n\nWhile we have focused on identification and estimation through TSLS, there are multiple avenues to establish estimators with better finite sample properties. For example, the model can benefit from having an estimator that has data-driven smoothness or sparsity property.\n\nFinally, this paper has only considered settings with exogenous networks. As work on incorporating endogenous networks into peer effect models continue to develop, it would similarly be interesting to see if similar approaches can be applied to the rank-dependent peer effect model.",
      "tables": {},
      "images": {}
    },
    {
      "section_id": 11,
      "text": "# APPENDIX\n## Appendix A Asymptotic theory for the TSLS estimator\n\nAssumption 6 gives a set of sufficient conditions for the asymptotic normality of the TSLS estimator. Recall the peer effect equation (10).",
      "tables": {},
      "images": {}
    },
    {
      "section_id": 12,
      "text": "## Assumption 6.\n\na. The two matrices\n\n$$\n\\frac{1}{n} \\sum_{i=1}^{n} z_{i} W_{i}^{\\top} \\quad \\text { and } \\quad \\frac{1}{n} \\sum_{i=1}^{n} z_{i} z_{i}^{\\top}\n$$\n\nconverge to full rank matrices (in probability) as $n \\rightarrow \\infty$.\nb. $\\frac{1}{\\sqrt{n}} \\sum_{i=1}^{n} z_{i} \\varepsilon_{i} \\xrightarrow{d} \\mathcal{N}\\left(0, \\Sigma_{W}\\right)$ with some $\\Sigma_{W}>0$ as $n \\rightarrow \\infty$.\n\nPart a. of Assumption 6 is the sample counterpart of the relevance conditions discussed in Section 3. Part b. assumes that $\\left\\{\\varepsilon_{i}\\right\\}_{i=1}^{n}$ satisfies some weak dependence condition and $\\left\\{z_{i}\\right\\}_{i=1}^{n}$ does not explode so that we have asymptotic normality on $\\frac{1}{\\sqrt{n}} \\sum_{i=1}^{n} z_{i} \\varepsilon_{i}$.\n\nTheorem 2. Assumptions 2-4 and 6 hold. Then,\n\n$$\n\\sqrt{n}\\binom{\\hat{\\beta}-\\beta}{\\hat{\\gamma}-\\gamma} \\xrightarrow{d} \\mathcal{N}(\\mathbf{0}, \\Sigma)\n$$\n\nas $n \\rightarrow \\infty$, with some consistently estimable positive definite matrix $\\Sigma$.\n\nProof. The TSLS estimator is\n\n$$\n\\begin{gathered}\n\\binom{\\hat{\\beta}}{\\hat{\\gamma}}=\\left(\\frac{1}{n} \\sum_{i=1}^{n} W_{i} z_{i}^{\\top}\\left(\\frac{1}{n} \\sum_{i=1}^{n} z_{i} z_{i}^{\\top}\\right)^{-1} \\frac{1}{n} \\sum_{i=1}^{n} z_{i} W_{i}^{\\top}\\right)^{-1} \\\\\n\\cdot \\frac{1}{n} \\sum_{i=1}^{n} W_{i} z_{i}^{\\top}\\left(\\frac{1}{n} \\sum_{i=1}^{n} z_{i} z_{i}^{\\top}\\right)^{-1} \\frac{1}{\\sqrt{n}} \\sum_{i=1}^{n} z_{i} Y_{i}\n\\end{gathered}\n$$\n\nThen,\n\n$$\n\\begin{aligned}\n& \\sqrt{n}\\binom{\\hat{\\beta}-\\beta}{\\hat{\\gamma}-\\gamma}=\\left(\\frac{1}{n} \\sum_{i=1}^{n} W_{i} z_{i}^{\\top}\\left(\\frac{1}{n} \\sum_{i=1}^{n} z_{i} z_{i}^{\\top}\\right)^{-1} \\frac{1}{n} \\sum_{i=1}^{n} z_{i} W_{i}^{\\top}\\right)^{-1} \\\\\n& \\cdot \\frac{1}{n} \\sum_{i=1}^{n} W_{i} z_{i}^{\\top}\\left(\\frac{1}{n} \\sum_{i=1}^{n} z_{i} z_{i}^{\\top}\\right)^{-1} \\frac{1}{\\sqrt{n}} \\sum_{i=1}^{n} z_{i} \\varepsilon_{i}\n\\end{aligned}\n$$\n\nBy Assumption $6 \\frac{1}{\\sqrt{n}} \\sum_{i=1}^{n} z_{i} \\varepsilon_{i} \\xrightarrow{d} \\mathcal{N}\\left(0, \\Sigma_{W}\\right)$, and the matrices\n\n$$\nC=\\operatorname{plim} \\frac{1}{n} \\sum_{i=1}^{n} z_{i} W_{i}^{\\top} \\quad \\text { and } \\quad B=\\operatorname{plim} \\frac{1}{n} \\sum_{i=1}^{n} z_{i} z_{i}^{\\top}\n$$\n\nexist and are full rank. Therefore by the continuous mapping theorem we get\n\n$$\n\\sqrt{n}\\binom{\\hat{\\beta}-\\beta}{\\hat{\\gamma}-\\gamma} \\xrightarrow{d} \\mathcal{N}(0, \\Sigma)\n$$\n\nWith $\\Sigma=\\left(C B^{-1} C\\right)^{-1} C B^{-1} \\Sigma_{W}\\left(\\left(C B^{-1} C\\right)^{-1} C B^{-1}\\right)^{\\top}$",
      "tables": {},
      "images": {}
    },
    {
      "section_id": 13,
      "text": "# Appendix B Proofs\n## B. 1 Proof for Proposition 1\n\nWe want to show that for any $\\left\\{x_{i}, \\epsilon_{i}\\right\\}_{i=1}^{n}$, the peer effect model (5) admits a unique equilibrium $\\left\\{y_{i}\\right\\}_{i=1}^{n}$ such that for $i=1, \\ldots, n$,\n\n$$\ny_{i}=\\sum_{k=1}^{d_{i}} \\tilde{y}_{i, k} \\beta_{k d_{i}}+x_{i}^{\\top} \\gamma+\\epsilon_{i}\n$$\n\n$\\tilde{y}_{i, k}$ is constructed in the same way as $\\tilde{Y}_{i, k}$.\nConsider a function $g: \\mathbb{R}^{n} \\rightarrow \\mathbb{R}^{n}$ such that\n\n$$\ng(y)=\\left(\\begin{array}{c}\ng_{1}(y) \\\\\n\\vdots \\\\\ng_{n}(y)\n\\end{array}\\right)=\\left(\\begin{array}{c}\n\\sum_{k=1}^{d_{1}} \\tilde{y}_{1, k} \\beta_{k d_{1}}+x_{1}^{\\top} \\gamma+\\epsilon_{1} \\\\\n\\vdots \\\\\n\\sum_{k=1}^{d_{n}} \\tilde{y}_{n, k} \\beta_{k d_{n}}+x_{n}^{\\top} \\gamma+\\epsilon_{n}\n\\end{array}\\right)\n$$\n\nwhen $y=\\left(y_{1}, \\ldots, y_{n}\\right)^{\\top}$. Note that the function $g$ depends on $\\left\\{x_{i}, A_{i j}, \\epsilon_{i}\\right\\}_{1 \\leq i, j \\leq n}$ in addition to $\\left\\{\\beta_{k, d}\\right\\}_{k, d}$ and $\\gamma$. We show that the function $g$ is a contraction mapping with the supremum norm: for any $y, y^{\\prime} \\in \\mathbb{R}^{n}$,\n\n$$\n\\left\\|g(y)-g\\left(y^{\\prime}\\right)\\right\\|_{\\infty} \\leq \\bar{\\beta}\\left\\|y-y^{\\prime}\\right\\|_{\\infty}\n$$\n\nFirstly, suppose that $y$ and $y^{\\prime}$ have the same order. The inequality holds trivially: for each $i$,\n\n$$\n\\begin{aligned}\n\\left|g_{i}(y)-g_{i}\\left(y^{\\prime}\\right)\\right| & =\\left|\\sum_{k=1}^{d_{i}}\\left(\\tilde{y}_{i, k}-\\tilde{y}_{i, k}^{\\prime}\\right) \\beta_{k, d_{i}}\\right| \\\\\n& \\leq \\sum_{k=1}^{d_{i}}\\left|\\beta_{k d_{i}}\\right| \\cdot\\left\\|y-y^{\\prime}\\right\\|_{\\infty} \\leq \\bar{\\beta}\\left\\|y-y^{\\prime}\\right\\|_{\\infty}\n\\end{aligned}\n$$\n\nwith some $\\bar{\\beta}=\\max _{d} \\sum_{k=1}^{d}\\left|\\beta_{k, d}\\right|<1$. The first inequality holds since $y$ and $y^{\\prime}$ have the same order and therefore $\\tilde{y}_{i, k}$ and $\\tilde{y}_{i, k}^{\\prime}$ are the outcome of the same individual: $\\left|\\tilde{y}_{i, k}-\\tilde{y}_{i, k}^{\\prime}\\right|$ is bounded by $\\left\\|y-y^{\\prime}\\right\\|_{\\infty}$. The second equality is from Assumption 2.\n\nSecondly, suppose that $y$ and $y^{\\prime}$ do not have the same order. ${ }^{5}$ Fix $i$ and $k$ and consider\n\n$$\n\\left|\\left(\\tilde{y}_{i, k}-\\tilde{y}_{i, k}^{\\prime}\\right) \\beta_{k, d_{i}}\\right|\n$$\n\nWhen individual $i$ 's $k$-th lowest performing peer under the outcome vector $y$ is the same individual with that under the outcome vector $y^{\\prime}$, the quantity above is bounded by $\\left|\\beta_{k d_{i}}\\right| \\cdot\\left\\|y-y^{\\prime}\\right\\|_{\\infty}$. Suppose that the order change affects individual $i$ 's $k$-th lowest performing peer and WLOG let $\\tilde{y}_{i, k}=y_{1}$ and $\\tilde{y}_{i, k}^{\\prime}=y_{2}{ }^{\\prime}$; individual $i$ 's $k$-th lowest performing peer is individual 1 under the outcome vector $y$ and is individual 2 under the outcome vector $y^{\\prime}$. Then,\n\n$$\n\\left|\\left(\\tilde{y}_{i, k}-\\tilde{y}_{i, k}^{\\prime}\\right) \\beta_{k, d_{i}}\\right| \\leq\\left|\\beta_{k d_{i}}\\right| \\cdot\\left|y_{1}-y_{2}{ }^{\\prime}\\right|\n$$\n\nand individual 1's rank among individual $i$ 's peers under the outcome vector $y^{\\prime}$ is either higher than $k$ or lower than $k$.\n\nCase 1. Individual 1's rank among individual $i$ 's peers under the outcome vector $y^{\\prime}$ is higher than $k$ : there exists some $k^{\\prime}>k$ such that $y_{1}{ }^{\\prime}=y_{i, k^{\\prime}}^{p}{ }^{\\prime}$. Then, we have that\n\n$$\ny_{1}^{\\prime}=y_{i, k^{\\prime}}^{p}{ }^{\\prime} \\geq \\tilde{y}_{i, k}^{\\prime}=y_{2}^{\\prime}\n$$\n\nand therefore\n\n$$\ny_{1}-y_{2}^{\\prime} \\geq y_{1}^{\\prime}-\\left\\|y-y^{\\prime}\\right\\|_{\\infty}-y_{2}^{\\prime} \\geq-\\left\\|y-y^{\\prime}\\right\\|_{\\infty}\n$$\n\nSince individual 1 is ranked higher under the outcome vector $y^{\\prime}$ compared to the outcome vector $y$ where his rank was $k$, there must be another individual $j \\neq 1$ whose rank is lower than or equal to $k$ under the outcome vector $y^{\\prime}$ and is higher than $k$ under the outcome vector $y$ :\n\n$$\ny_{j}^{\\prime} \\leq \\tilde{y}_{i, k}^{\\prime}=y_{2}^{\\prime} \\quad \\text { and } \\quad y_{j} \\geq \\tilde{y}_{i, k}=y_{1}\n$$\n\n[^0]\n[^0]:    ${ }^{5}$ It is assumed throughout the proof that some tie-breaking rule is applied here so that there is one-to-one relationship between an individual's peers and the ordered outcomes $y_{i 1}^{p}, \\ldots, y_{i d_{i}}^{p}$.\n\nand therefore\n\n$$\ny_{1}-y_{2}{ }^{\\prime} \\leq y_{j}-y_{2}{ }^{\\prime} \\leq y_{j}{ }^{\\prime}+\\left\\|y-y^{\\prime}\\right\\|_{\\infty}-y_{2}{ }^{\\prime} \\leq\\left\\|y-y^{\\prime}\\right\\|_{\\infty}\n$$\n\nBy combining the two inequalities, we get $\\left|y_{1}-y_{2}{ }^{\\prime}\\right| \\leq\\left\\|y-y^{\\prime}\\right\\|_{\\infty}$.\nCase 2. Individual 1's rank among individual $i$ 's peers under the outcome vector $y^{\\prime}$ is lower than $k$ : there exists some $k^{\\prime}<k$ such that $y_{1}{ }^{\\prime}=y_{i, k^{\\prime}}^{p}{ }^{\\prime}$. Then, we have that\n\n$$\ny_{1}{ }^{\\prime}=y_{i, k^{\\prime}}^{p}{ }^{\\prime} \\leq \\tilde{y}_{i, k}^{\\prime}=y_{2}{ }^{\\prime}\n$$\n\nand therefore\n\n$$\ny_{1}-y_{2}{ }^{\\prime} \\leq y_{1}{ }^{\\prime}+\\left\\|y-y^{\\prime}\\right\\|_{\\infty}-y_{2}{ }^{\\prime} \\leq\\left\\|y-y^{\\prime}\\right\\|_{\\infty}\n$$\n\nSince individual 1 is ranked lower under the outcome vector $y^{\\prime}$ compared to the outcome vector $y$ where his rank was $k$, there must be another individual $j \\neq 1$ whose rank is higher than or equal to $k$ under the outcome vector $y^{\\prime}$ and is lower than $k$ under the outcome vector $y$ :\n\n$$\ny_{j}{ }^{\\prime} \\geq \\tilde{y}_{i, k}^{\\prime}=y_{2}{ }^{\\prime} \\quad \\text { and } \\quad y_{j} \\leq \\tilde{y}_{i, k}=y_{1}\n$$\n\nand therefore\n\n$$\ny_{1}-y_{2}{ }^{\\prime} \\geq y_{j}-y_{2}{ }^{\\prime} \\geq y_{j}{ }^{\\prime}-\\left\\|y-y^{\\prime}\\right\\|_{\\infty}-y_{2}{ }^{\\prime} \\geq-\\left\\|y-y^{\\prime}\\right\\|_{\\infty}\n$$\n\nBy combining the two inequalities, we get $\\left|y_{1}-y_{2}{ }^{\\prime}\\right| \\leq\\left\\|y-y^{\\prime}\\right\\|_{\\infty}$.\nBy aggregating across $k$ for the fixed $i$ and then aggregating across $i$, we get\n\n$$\n\\left\\|g(y)-g\\left(y^{\\prime}\\right)\\right\\|_{\\infty} \\leq \\bar{\\beta}\\left\\|y-y^{\\prime}\\right\\|_{\\infty}\n$$\n\nAssume to the contrary that there exist $y, y^{\\prime} \\in \\mathbb{R}^{n}$ such that $y \\neq y^{\\prime}, y=g(y)$ and $y^{\\prime}=g\\left(y^{\\prime}\\right)$. Let\n\n$c=\\left\\|y-y^{\\prime}\\right\\|_{\\infty}>0$. Then,\n\n$$\nc=\\left\\|y-y^{\\prime}\\right\\|_{\\infty}=\\left\\|g(y)-g\\left(y^{\\prime}\\right)\\right\\|_{\\infty} \\leq \\bar{\\beta}\\left\\|y-y^{\\prime}\\right\\|_{\\infty} \\leq \\bar{\\beta} c<c\n$$\n\nfrom Assumption 2, leading to a contradiction.",
      "tables": {},
      "images": {}
    },
    {
      "section_id": 14,
      "text": "# B. 2 Proof for Corollary 1 \n\nLet $\\pi$ denote a ordering on $\\left\\{Y_{i}, \\ldots, Y_{n}\\right\\}$ with some tiebreaking rule.\n\n$$\n\\pi:\\{1, \\ldots, n\\} \\mapsto\\{1, \\ldots, n\\}\n$$\n\nand satisfies that $Y_{\\pi(1)} \\leq \\ldots \\leq Y_{\\pi(n)}$. Note that $\\pi$ is a function of $\\left\\{\\varepsilon_{i}\\right\\}_{i=1}^{n}$; from Proposition 1, we have shown that there exists a unique equilibrium and thus a unique ordering for each realization $\\left\\{\\epsilon_{i}\\right\\}_{i=1}^{n}$. Let $\\Pi$ denote the set of all possible ordering on $\\left\\{Y_{1}, \\ldots, Y_{n}\\right\\}$. $\\Pi$ is a function of $\\left\\{x_{i}, A_{i j}\\right\\}_{i, j}$ and the distribution of $\\left\\{\\varepsilon_{i}\\right\\}_{i}$.\n\nFor any realization of $\\left\\{\\epsilon_{i}\\right\\}_{i=1}^{n}$ and the corresponding ordering $\\pi$, there is a reduced-form linear relationship between $\\left\\{y_{i}\\right\\}_{i=1}^{n}$ and $\\left\\{x_{i}\\right\\}_{i=1}^{n}$ : construct a $n \\times n$ matrix $\\mathbb{B}(\\pi)$ such that\n\n$$\n\\begin{aligned}\n& \\mathbb{B}(\\pi)=\\left(\\beta_{i j}(\\pi)\\right)_{i, j} \\\\\n& \\beta_{i j}(\\pi)= \\begin{cases}0 & \\text { if } A_{i j}=0 \\\\\n\\beta_{k d_{i}} \\text { for some } k \\text { s.t. } \\sum_{j^{\\prime}=1}^{\\pi^{-1}(j)} A_{i \\pi\\left(j^{\\prime}\\right)}=k & \\text { if } A_{i j}=1\\end{cases}\n\\end{aligned}\n$$\n\n$\\mathbb{B}(\\pi)$ takes the ordering $\\pi$ as fixed and finds the corresponding rank-dependent coefficient $\\beta_{k, d}$ for each of the peer outcomes. Find that $\\left(I_{n}-\\mathbb{B}(\\pi)\\right)$ is invertible for any $\\pi$ : suppose that there is some $x \\neq \\mathbf{0}$ such that $x=\\mathbb{B}(\\pi) x$; for some $i$ such that $\\left|x_{i}\\right|=\\|x\\|_{\\infty}$,\n\n$$\n\\left|x_{i}\\right|=\\left|\\sum_{j=1}^{n} \\beta_{i j}(\\pi) x_{j}\\right| \\leq \\sum_{j=1}^{i}\\left|\\beta_{i j}(\\pi)\\right| \\cdot\\left|x_{j}\\right| \\leq \\bar{\\beta}\\left|x_{i}\\right|<\\left|x_{i}\\right|\n$$\n\nleading to a contradiction; $I-\\mathbb{B}(\\pi)$ is full rank. Then,\n\n$$\n\\begin{aligned}\n& \\mathbb{Y}=\\mathbb{B}(\\pi) \\mathbb{Y}+\\mathbb{X} \\gamma+\\mathbb{E} \\\\\n& \\mathbb{Y}=(I-\\mathbb{B}(\\pi))^{-1} \\mathbb{X} \\gamma+\\left(I_{n}-\\mathbb{B}(\\pi)\\right)^{-1} \\mathbb{E}\n\\end{aligned}\n$$\n\nWe have a reduced-form linear relationship between $\\left\\{y_{i}\\right\\}_{i=1}^{n}$ and $\\left\\{x_{i}\\right\\}_{i=1}^{n}$.\nSince the reduced-form relationship holds for every realization of $\\left\\{\\epsilon_{i}\\right\\}_{i=1}^{n}$ such that the ordering $\\pi$ stays the same, we can consider a conditional expectation of the linear relationship given the event that $\\left\\{\\varepsilon_{i}\\right\\}_{i=1}^{n}$ induces the ordering $\\pi$. Let $\\Pi$ denote the set of all possible orderings $\\pi$, then\n\n$$\n\\begin{aligned}\n\\mathbf{E}_{n}\\left[Y_{i}\\right] & =\\sum_{\\pi \\in \\Pi} \\sum_{j=1}^{n} \\theta_{i j}(\\pi)\\left(x_{j}^{\\top} \\gamma+\\mathbf{E}_{n}\\left[\\varepsilon_{j} \\mid \\pi\\right]\\right) \\cdot \\operatorname{Pr}_{n}\\{\\pi\\} \\\\\n& =\\sum_{j=1}^{n} \\theta_{i j} x_{j}^{\\top} \\gamma+\\eta_{i}\n\\end{aligned}\n$$\n\nwhere $\\left(\\theta_{i 1}(\\pi), \\ldots, \\theta_{i n}(\\pi)\\right)$ is the $i$-th row of the $n \\times n$ matrix $(I-\\mathbb{B}(\\pi))^{-1}$ and\n\n$$\n\\begin{aligned}\n\\theta_{i j} & =\\sum_{\\pi \\in \\Pi} \\theta_{i j}(\\pi) \\operatorname{Pr}_{n}\\{\\pi\\} \\\\\n\\eta_{i} & =\\sum_{\\pi \\in \\Pi} \\sum_{j=1}^{n} \\theta_{i j}(\\pi) \\mathbf{E}_{n}\\left[\\varepsilon_{j} \\mid \\pi\\right] \\cdot \\operatorname{Pr}_{n}\\{\\pi\\}\n\\end{aligned}\n$$\n\nLikewise, by taking a different student while summing over the ordering $\\pi$, we get\n\n$$\n\\begin{aligned}\n\\mathbf{E}_{n}\\left[\\tilde{Y}_{i, k}\\right] & =\\sum_{\\pi \\in \\Pi} \\sum_{j=1}^{n} \\tilde{\\theta}_{i, k, j}(\\pi)\\left(x_{j}^{\\top} \\gamma+\\mathbf{E}_{n}\\left[\\varepsilon_{j} \\mid \\pi\\right]\\right) \\cdot \\operatorname{Pr}_{n}\\{\\pi\\} \\\\\n& =\\sum_{j=1}^{n} \\tilde{\\theta}_{i, k, j} x_{j}^{\\top} \\gamma+\\tilde{\\eta}_{i, k}\n\\end{aligned}\n$$\n\nwhere $\\left(\\tilde{\\theta}_{i, k, 1}(\\pi), \\ldots, \\tilde{\\theta}_{i, k, n}(\\pi)\\right)$ is one row of the $n \\times n$ matrix $\\left(I_{n}-\\mathbb{B}(\\pi)\\right)^{-1}$, which corresponds to\n\nthe $k$-th lowest performing peer of student $i$, and\n\n$$\n\\begin{aligned}\n\\hat{\\theta}_{i, k, j} & =\\sum_{\\pi \\in \\Pi} \\hat{\\theta}_{i, k, j}(\\pi) \\operatorname{Pr}_{n}\\{\\pi\\} \\\\\n\\tilde{\\eta}_{i, k} & =\\sum_{\\pi \\in \\Pi} \\sum_{j=1}^{n} \\hat{\\theta}_{i, k, j}(\\pi) \\mathbf{E}_{n}\\left[\\varepsilon_{j} \\mid \\pi\\right] \\cdot \\operatorname{Pr}_{n}\\{\\pi\\}\n\\end{aligned}\n$$",
      "tables": {},
      "images": {}
    },
    {
      "section_id": 15,
      "text": "# B. 3 Proof for Theorem 1 \n\nConstruct a $\\frac{\\hat{d}(\\hat{d}+1)}{2} \\times 1$ vector $\\tilde{Y}_{i}$ such that\n\n$$\n\\tilde{Y}_{i}=\\left(\\begin{array}{lllllll}\n0 & \\cdots & Y_{i 1}^{p} & \\cdots & Y_{i d_{i}}^{p} & \\cdots & \\mathbf{0}_{\\hat{d}^{\\top}}\n\\end{array}\\right)\n$$\n\n$\\tilde{Y}_{i}$ stacks up (hypothetical) vectors of peer outcomes with varying peer numbers $d=1, \\ldots, \\hat{d}$; the peer outcome vector of peer number $d$ is nonzero only when $d=d_{i}$. Let $W_{i}=\\left(\\tilde{Y}_{i}^{\\top}, x_{i}{ }^{\\top}\\right)^{\\top}$. Then, the rank-dependent peer effect model can be written as follows:\n\n$$\nY_{i}=\\tilde{Y}_{i}^{\\top} \\beta+x_{i}^{\\top} \\gamma+\\varepsilon_{i}=W_{i}^{\\top}\\binom{\\beta}{\\gamma}+\\varepsilon_{i}\n$$\n\nLikewise, construct a vector of instrument $z_{i}$ such that $z_{i}$ stacks up vectors of instruments with varying peer numbers $d=1, \\ldots, \\hat{d}$.\n\n$$\nz_{i}=\\left(\\begin{array}{llll}\nz_{i 1} \\top & \\cdots & z_{i \\hat{d}^{\\top}} & x_{i}^{\\top}\n\\end{array}\\right)^{\\top}\n$$\n\n$z_{i d}$, the instrument vector of peer number $d$, is nonzero only when $d=d_{i}$.\n\nConsider a stacked up matrix of the peer effect model (5):\n\n$$\n\\begin{aligned}\n\\forall & =\\mathbb{W}\\binom{\\beta}{\\gamma}+\\mathbb{E} \\\\\n\\mathbb{Z}^{\\top} \\forall & =\\mathbb{Z}^{\\top} \\mathbb{W}\\binom{\\beta}{\\gamma}+\\mathbb{Z}^{\\top} \\mathbb{E}\n\\end{aligned}\n$$\n\nFrom Assumption 4, by taking expectation conditional upon $\\left\\{x_{i}, A_{i j}\\right\\}_{i, j}$,\n\n$$\n\\mathbf{E}_{n}\\left[\\mathbb{Z}^{\\top} \\forall\\right]=\\mathbf{E}_{n}\\left[\\mathbb{Z}^{\\top} \\mathbb{W}\\right]\\binom{\\beta}{\\gamma}\n$$\n\nThe parameter of interest $\\beta$ and $\\gamma$ are identified from the conditional distribution of $\\left\\{Y_{i}\\right\\}_{i=1}^{n}$ given $\\left\\{x_{i}, A_{i j}\\right\\}_{1 \\leq i, j \\leq n}$ when $\\mathbf{E}_{n}\\left[\\mathbb{Z}^{\\top} \\mathbb{W}\\right]$ is full rank.\n\nFrom Corollary 1, we have the tools to write out the matrix $\\mathbf{E}_{n}\\left[\\mathbb{Z}^{\\top} \\mathbb{W}\\right]$ :\n\n$$\n\\mathbf{E}_{n}\\left[\\mathbb{Z}^{\\top} \\mathbb{W}\\right]=\\left(\\begin{array}{cccccc}\nQ_{Z Y^{p}, 1} & \\mathbf{O}_{l \\times 2} & \\cdots & \\mathbf{O}_{l \\times \\tilde{d}} & Q_{Z X, 1} \\\\\n\\mathbf{O}_{2 l \\times 1} & Q_{Z Y^{p}, 2} & \\cdots & \\mathbf{O}_{2 l \\times \\tilde{d}} & Q_{Z X, 2} \\\\\n\\vdots & \\vdots & \\ddots & \\vdots & \\vdots \\\\\n\\mathbf{O}_{\\tilde{d} l \\times 1} & \\mathbf{O}_{\\tilde{d} l \\times 2} & \\cdots & Q_{Z Y^{p}, \\tilde{d}} & Q_{Z X, \\tilde{d}} \\\\\nQ_{X Y^{p}, 1} & Q_{X Y^{p}, 2} & \\cdots & Q_{X Y^{p}, \\tilde{d}} & Q_{X X}\n\\end{array}\\right)\n$$\n\nwhere\n\n$$\n\\begin{aligned}\nQ_{Z \\tilde{Y}, d} & =\\sum_{i=1}^{n} z_{i d}\\left(\\mathbf{E}_{n}\\left[\\tilde{Y}_{i, 1}\\right] \\quad \\cdots \\quad \\mathbf{E}_{n}\\left[\\tilde{Y}_{i, d_{i}}\\right]\\right) \\mathbf{1}\\left\\{d_{i}=d\\right\\} \\\\\nQ_{Z X, d} & =\\sum_{i=1}^{n} z_{i d} x_{i}^{\\top} \\mathbf{1}\\left\\{d_{i}=d\\right\\} \\\\\nQ_{X \\tilde{Y}, d} & =\\sum_{i=1}^{n} x_{i}\\left(\\mathbf{E}_{n}\\left[\\tilde{Y}_{i, 1}\\right] \\quad \\cdots \\quad \\mathbf{E}_{n}\\left[\\tilde{Y}_{i, d_{i}}\\right]\\right) \\mathbf{1}\\left\\{d_{i}=d\\right\\} \\\\\nQ_{X X} & =\\sum_{i=1}^{n} x_{i} x_{i}^{\\top}\n\\end{aligned}\n$$\n\nA slight abuse of notation is applied here: the row vectors in the summation of $Q_{Z \\tilde{Y}, d}$ and $Q_{X \\tilde{Y}, d}$ do\n\nnot have the same dimension, but the indicator $\\mathbf{1}\\left\\{d_{i}=d\\right\\}$ only selects the ones with $d$ components.\nThanks to the diagonal structure of $Q_{Z \\bar{Y}, 1}, \\ldots, Q_{Z \\bar{Y}, \\bar{d}}$, each submatrix\n\n$$\nQ_{d}:=\\left(\\begin{array}{ll}\nQ_{Z \\bar{Y}, d} & Q_{Z X, d} \\\\\nQ_{X \\bar{Y}, d} & Q_{X X}\n\\end{array}\\right)\n$$\n\nbeing full rank for $d=1, \\ldots, \\bar{d}$ implies that $\\mathbb{Z}^{\\top} \\mathbf{E}_{n}[\\mathbb{W}]$ is full rank. From the reduced-form representation of $\\mathbf{E}_{n}\\left[\\tilde{Y}_{i, k}\\right]$ with $\\theta$ and $\\eta$, we get\n\n$$\nQ_{d}=\\sum_{i=1}^{n}\\binom{z_{i, d}}{x_{i}}\\left(\\begin{array}{c}\n\\sum_{j=1}^{n} \\tilde{\\theta}_{i, 1, j} x_{j}^{\\top} \\gamma+\\tilde{\\eta}_{i, 1} \\\\\n\\vdots \\\\\n\\sum_{j=1}^{n} \\tilde{\\theta}_{i, d_{i}, j} x_{j}^{\\top} \\gamma+\\tilde{\\eta}_{i, d_{i}} \\\\\nx_{i}\n\\end{array}\\right)^{\\top} \\mathbf{1}\\left\\{d_{i}=d\\right\\}\n$$\n\nFrom Assumption 4, $Q_{d}$ has full rank.",
      "tables": {},
      "images": {}
    },
    {
      "section_id": 16,
      "text": "# B. 4 Proof for Proposition 2 \n\nThe LIM model is:\n\n$$\nY_{i}=\\beta^{\\mathrm{LIM}} \\bar{Y}_{i}+x_{i}^{\\top} \\gamma+\\varepsilon_{i}\n$$\n\nWith some $z_{i}$ that is a function of $\\left\\{x_{i}, A_{i, j}\\right\\}_{i, j}$ is used as instruments, the moment condition used in the estimation of the LIM estimator is:\n\n$$\n\\begin{aligned}\n\\mathbf{E}_{n}[\\mathbb{Y}] & =\\beta^{\\mathrm{LIM}} G \\mathbf{E}_{n}[\\mathbb{Y}]+\\mathbb{X} \\gamma \\\\\n\\mathbb{M}_{X} \\mathbf{E}_{n}[\\mathbb{Y}] & =\\beta^{\\mathrm{LIM}} \\mathbb{M}_{X} G \\mathbf{E}_{n}[\\mathbb{Y}]+\\mathbb{M}_{X} \\mathbb{X} \\gamma \\\\\n& =\\beta^{\\mathrm{LIM}} \\mathbb{M}_{X} G \\mathbf{E}_{n}[\\mathbb{Y}] \\\\\n\\mathbb{Z}^{\\top} \\mathbb{M}_{X} \\mathbf{E}_{n}[\\mathbb{Y}] & =\\beta^{\\mathrm{LIM}} \\mathbb{Z}^{\\top} \\mathbb{M}_{X} G \\mathbf{E}_{n}[\\mathbb{Y}] \\\\\n\\beta^{\\mathrm{LIM}} & =\\left(\\mathbb{Z}^{\\top} \\mathbb{M}_{X} G \\mathbf{E}_{n}[\\mathbb{Y}]\\right)^{-1} \\mathbb{Z}^{\\top} \\mathbb{M}_{X} \\mathbf{E}_{n}[\\mathbb{Y}]\n\\end{aligned}\n$$\n\nwhere $G$ is the row-normalized network adjacency matrix and\n\n$$\n\\mathbb{M}_{X}=I_{n}-\\mathbb{X}\\left(\\mathbb{X}^{\\top} \\mathbb{X}\\right)^{-1} \\mathbb{X}^{\\top}\n$$\n\nWe know that\n\n$$\n\\mathbf{E}_{n}\\left[Y_{i} \\mid\\left\\{x_{i}, A_{i j}\\right\\}_{i, j}\\right]=\\sum_{k=1}^{d_{i}} \\beta_{k, d} \\mathbf{E}_{n}\\left[\\tilde{Y}_{i, k}\\right]+x_{i}^{\\top} \\gamma\n$$\n\nfrom Assumption 4. Then, the misspecified parameter $\\beta^{\\mathrm{LIM}}$ becomes\n\n$$\n\\beta^{\\mathrm{LIM}}=\\left(\\mathbb{Z}^{\\top} \\mathbb{M}_{X} G \\mathbf{E}_{n}[\\mathbb{Y}]\\right)^{-1} \\mathbb{Z}^{\\top} \\mathbb{M}_{X}\\left(\\begin{array}{c}\n\\sum_{k=1}^{d_{1}} \\beta_{k, d} \\mathbf{E}_{n}\\left[\\tilde{Y}_{1, k}\\right] \\\\\n\\vdots \\\\\n\\sum_{k=1}^{d_{n}} \\beta_{k, d} \\mathbf{E}_{n}\\left[\\tilde{Y}_{n, k}\\right]\n\\end{array}\\right)\n$$\n\nBy rewriting the matrix multiplications as a summation with\n\n$$\n\\tilde{\\mathcal{A}}=\\sum_{i=1}^{n} z_{i} x_{i}^{\\top}\\left(\\sum_{i=1}^{n} x_{i} x_{i}^{\\top}\\right)^{-1}\n$$\n\nwe get\n\n$$\n\\begin{aligned}\n\\beta^{\\mathrm{LIM}} & =\\frac{\\sum_{i=1}^{n}\\left(z_{i}-\\tilde{\\mathcal{A}} x_{i}\\right) \\sum_{k=1}^{d_{i}} \\mathbf{E}_{n}\\left[\\tilde{Y}_{i, k}\\right] \\beta_{k, d}}{\\sum_{i=1}^{n}\\left(z_{i}-\\tilde{\\mathcal{A}} x_{i}\\right) \\frac{1}{d_{i}} \\sum_{k=1}^{d_{i}} \\mathbf{E}_{n}\\left[\\tilde{Y}_{i, k}\\right]} \\\\\n& =\\frac{\\sum_{d=1}^{\\tilde{d}} \\sum_{k=1}^{d} \\sum_{i=1}^{n} \\mathbf{E}_{n}\\left[\\left(z_{i}-\\tilde{\\mathcal{A}} x_{i}\\right) \\tilde{Y}_{i, k} \\mathbf{1}\\left\\{d_{i}=d\\right\\}\\right] \\beta_{k, d}}{\\sum_{d=1}^{\\tilde{d}} \\sum_{i=1}^{n} \\frac{1}{d} \\sum_{k=1}^{d} \\mathbf{E}_{n}\\left[\\left(z_{i}-\\tilde{\\mathcal{A}} x_{i}\\right) \\tilde{Y}_{i, k} \\mathbf{1}\\left\\{d_{i}=d\\right\\}\\right]}\n\\end{aligned}\n$$\n\nBy letting\n\n$$\nw_{k, d}^{\\mathrm{LIM}}=\\frac{\\sum_{i=1}^{n} \\frac{1}{d} \\mathbf{E}_{n}\\left[\\left(z_{i}-\\tilde{\\mathcal{A}} x_{i}\\right) \\tilde{Y}_{i, k} \\mathbf{1}\\left\\{d_{i}=d\\right\\}\\right]}{\\sum_{d=1}^{\\tilde{d}} \\sum_{k=1}^{d} \\sum_{i=1}^{n} \\frac{1}{d} \\mathbf{E}_{n}\\left[\\left(z_{i}-\\tilde{\\mathcal{A}} x_{i}\\right) \\tilde{Y}_{i, k} \\mathbf{1}\\left\\{d_{i}=d\\right\\}\\right]}\n$$\n\n$\\beta^{\\mathrm{LIM}}$ becomes\n\n$$\n\\beta^{\\mathrm{LIM}}=\\sum_{d=1}^{\\tilde{d}} \\sum_{k=1}^{d} w_{k, d}^{\\mathrm{LIM}} d \\beta_{k, d}\n$$\n\nThe weights satisfy the sum-to-one constraints: $\\sum_{d=1}^{\\bar{d}} \\sum_{k=1}^{d} w_{k, d}^{\\mathrm{LIM}}=1$.\nLikewise, for the LIS peer effect parameter, we get\n\n$$\n\\begin{aligned}\n\\beta^{\\mathrm{LIM}} & =\\frac{\\sum_{d=1}^{\\bar{d}} \\sum_{k=1}^{d} \\sum_{i=1}^{n} \\mathbf{E}_{n}\\left[\\left(z_{i}-\\overline{\\mathcal{A}} x_{i}\\right) \\hat{Y}_{i, k} \\mathbf{1}\\left\\{d_{i}=d\\right\\}\\right] \\beta_{k, d}}{\\sum_{d=1}^{\\bar{d}} \\sum_{i=1}^{n} \\mathbf{E}_{n}\\left[\\left(z_{i}-\\overline{\\mathcal{A}} x_{i}\\right) \\sum_{k=1}^{d} \\hat{Y}_{i, k} \\mathbf{1}\\left\\{d_{i}=d\\right\\}\\right]} \\\\\n& =\\sum_{d=1}^{d} \\sum_{k=1}^{d} w_{k, d}^{\\mathrm{LIS}} \\beta_{k, d}\n\\end{aligned}\n$$\n\nwhere\n\n$$\nw_{k, d}^{\\mathrm{LIS}}=\\frac{\\sum_{i=1}^{n} \\mathbf{E}_{n}\\left[\\left(z_{i}-\\overline{\\mathcal{A}} x_{i}\\right) \\hat{Y}_{i, k} \\mathbf{1}\\left\\{d_{i}=d\\right\\}\\right]}{\\sum_{d=1}^{\\bar{d}} \\sum_{k=1}^{d} \\sum_{i=1}^{n} \\mathbf{E}_{n}\\left[\\left(z_{i}-\\overline{\\mathcal{A}} x_{i}\\right) \\hat{Y}_{i, k} \\mathbf{1}\\left\\{d_{i}=d\\right\\}\\right]}\n$$\n\nAgain, the weights sum to one: $\\sum_{d=1}^{\\bar{d}} \\sum_{k=1}^{d} w_{k, d}^{\\mathrm{LIS}}=1$.\nWhen $z_{i}$ is not a scalar, we can modify the argument above and get similar expressions, by replacing $z_{i}-\\overline{\\mathcal{A}} x_{i}$ with $c^{\\top}\\left(z_{i}-\\overline{\\mathcal{A}} x_{i}\\right)$ with some weighting $c$. In the canonical TSLS case, the weighting vector is\n\n$$\nc^{\\top}=\\mathbf{E}_{n}\\left[\\mathbb{Y}^{\\top} G^{\\top} \\mathbb{M}_{X} \\mathbb{Z}\\left(\\mathbb{Z}^{\\top} \\mathbb{Z}\\right)^{-1}\\right]\n$$\n\nmisspecification weights depend on the weighting matrix when the LIM or LIS is overidentified.",
      "tables": {},
      "images": {}
    },
    {
      "section_id": 17,
      "text": "# Appendix C Supplementary Simulation Results \n\nThis appendix presents additional simulation results that are complementary to those in the main text. We first show a simulation set-up similar to our empirical design, and then give versions of Tables $1,2,3$ when we re-draw the network in each iteration.",
      "tables": {},
      "images": {}
    },
    {
      "section_id": 18,
      "text": "## C. 1 Simulation of empirical set-up\n\nTo make these simulations closer to the empirical application, we no longer drop links to make the maximum number of links equal $\\bar{d}$. This results in a network where the average number of friends is around 5 , and the maximum number around 12 .\n\nWe will investigate the performance of the estimator for different levels of instrument strength, sample size and for two different estimators. Our sample size will be either one or two networks with 300 individuals. When the second network is included, it has an identical network structure to the first network. The first of our two estimators is a pooled estimator that estimates all our parameters simultaneously. The second stratifies the sample by excluding individuals with less than three links.\n\nAs we can see from Table 5, the pooled estimator struggles to estimate the parameter for $\\hat{Y}_{1,1}$ in a smaller sample with a weaker instrument. This is not too surprising, as there are only six individuals with only one link in the network we simulate. Interestingly, the poor estimation of this parameter also spreads to the rest of the variables in the model. However, this contamination disappears as we get either a larger sample or a stronger instruments. This indicates the pooling estimator is most vulnerable when either there are very few individuals with a given number of friends, or if the instruments are weak. The stratified estimator is also robust to the badly estimated variable, reinforcing how stratification makes our estimators more robust.\n\nTable 5: Simulating our empirical specification\n\n![table_4](table_4)\n\nNotes: The values of the coefficients used in DGP are as follows: $n=200, \\gamma_{0}=1, \\beta_{1,1}=0.3, \\beta_{k, d}=\\frac{\\beta_{\\text {mid }}}{d}=\\frac{0.15}{1}$ for $1<k<d$ for all $d>1, \\beta_{1, d}=\\beta_{\\text {min }}=0.15$ and $\\beta_{d, d}=\\beta_{\\text {max }}=0.3$ for all $d>1$. The instruments used in TSLS estimation are ordered peers' covariates.",
      "tables": {
        "table_4": "|  | Bias |  |  |  | MSE |  |  |  |\n| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |\n|  | $(1)$ | $(2)$ | $(3)$ | $(4)$ | $(5)$ | $(6)$ | $(7)$ | $(8)$ |\n| Panel A: Pooled Estimator |  |  |  |  |  |  |  |  |\n| $\\beta_{1,1}$ | $-0.180$ | 0.049 | $-0.002$ | $-0.062$ | 46.034 | 34.758 | 3.291 | 3.057 |\n| $\\beta_{\\text {min }}$ | $-0.002$ | $-0.009$ | $-0.006$ | 0.004 | 1.460 | 0.096 | 0.048 | 0.013 |\n| $\\beta_{\\text {max }}$ | $-0.065$ | 0.012 | $-0.004$ | $-0.003$ | 10.088 | 0.111 | 0.076 | 0.010 |\n| $\\beta_{\\text {mid }}$ | 0.053 | $-0.001$ | 0.007 | $-0.001$ | 15.705 | 0.012 | 0.062 | 0.006 |\n| Panel B: Stratified Estimator |  |  |  |  |  |  |  |  |\n| $\\beta_{1,1}$ |  |  |  |  |  |  |  |  |\n| $\\beta_{\\text {min }}$ | $-0.014$ | $-0.001$ | $-0.005$ | 0.001 | 0.131 | 0.005 | 0.026 | 0.002 |\n| $\\beta_{\\text {max }}$ | $-0.012$ | 0.003 | $-0.004$ | $-0.001$ | 0.150 | 0.004 | 0.026 | 0.002 |\n| $\\beta_{\\text {mid }}$ | 0.023 | $-0.002$ | 0.006 | $-0.001$ | 0.569 | 0.014 | 0.094 | 0.007 |\n| $\\gamma_{1}$ | 1 | 2 | 1 | 2 | 1 | 2 | 1 | 2 |\n| $n_{\\text {network }}$ | 1 | 1 | 2 | 2 | 1 | 1 | 2 | 2 |"
      },
      "images": {}
    },
    {
      "section_id": 19,
      "text": "# C. 2 Simulation results with networks re-drawn\n\nTable 6: Comparison between the OLS estimator and the TSLS estimator\n\n![table_5](table_5)\n\nNotes: The values of the coefficients used in DGP are as follows: $\\gamma_{0}=1$ and $\\beta=(0.3,0.15,0.4)$. The instruments used in TSLS estimation are ordered peers' covariates. TSLS estimation is stratified in the sense that the dataset is separated into three subdata $-\\left\\{i: d_{i}=0\\right\\},\\left\\{i: d_{i}=1\\right\\}$ and $\\left\\{i: d_{i}=2\\right\\}$-and the sets of coefficients- $\\left(\\gamma_{0}, \\gamma_{1}\\right)$, $\\beta_{1,1}$ and $\\left(\\beta_{1,2}, \\beta_{2,2}\\right)$-are estimated from each subdata.\n\nTable 7: The TSLS estimation when the network is more connected\n\n![table_6](table_6)\n\nNotes: The values of the coefficients used in DGP are as follows: $n=200, \\gamma_{0}=1, \\beta_{1,1}=0.3, \\beta_{k, d}=\\frac{\\beta_{-\\max }}{d}=\\frac{0.4}{d}$ for $k<d$ and $\\beta_{d, d}=\\beta_{\\max }=0.3$ for $d=2, \\ldots, 5$. The instruments used in TSLS estimation are ordered peers' covariates. The TSLS estimation is stratified in the sense that the dataset is separated into three subdata- $\\{i$ : $\\left.d_{i}=0\\right\\}, \\ldots,\\left\\{i: d_{i}=5\\right\\}$-and the sets of coefficients $-\\left(\\gamma_{0}, \\gamma_{1}\\right), \\ldots,\\left(\\beta_{1,5}, \\ldots, \\beta_{5,5}\\right)$-are estimated from each subdata. Panel A estimates the fully saturates model with fifteen $\\beta \\mathrm{s}$ and Panel B focuses on individuals with at least two peers and estimates the correctly specified model with two $\\beta \\mathrm{s}: \\beta_{-\\max }=0.4$ and $\\beta_{\\max }=0.3$.\n\nTable 8: $R^{2}$ in the first stage regression\n\n![table_7](table_7)\n\nNotes: The values of the coefficients used in DGP are as follows: $n=200, \\gamma_{0}=1, \\beta_{1,1}=0.3, \\beta_{k, d}=\\frac{0.4}{3}$ for $k<d$ and $\\beta_{d, d}=0.3$ for $d=2, \\ldots, 5$. The instruments used in TSLS estimation are ordered peers' covariates. The TSLS estimation is stratified in the sense that the dataset is separated into three subdata- $\\left\\{i: d_{i}=0\\right\\}, \\ldots,\\{i$ : $d_{i}=5\\}$-and the sets of coefficients $-\\left(\\gamma_{0}, \\gamma_{1}\\right), \\ldots,\\left(\\beta_{1,5}, \\ldots, \\beta_{5,5}\\right)$-are estimated from each subdata.",
      "tables": {
        "table_5": "|  | Bias |  |  |  | MSE |  |  |  |\n| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |\n|  | $(1)$ | $(2)$ | $(3)$ | $(4)$ | $(5)$ | $(6)$ | $(7)$ | $(8)$ |\n| $\\hat{\\gamma}_{1}^{O L S}$ | $-0.028$ | $-0.020$ | $-0.030$ | $-0.030$ | 0.013 | 0.011 | 0.006 | 0.007 |\n| $\\hat{\\beta}_{1,2}^{O L S}$ | 0.122 | 0.052 | 0.126 | 0.049 | 0.037 | 0.011 | 0.022 | 0.005 |\n| $\\hat{\\gamma}_{1}^{T S L S}$ | 0.001 | 0.009 | $-0.002$ | $-0.006$ | 0.051 | 0.047 | 0.046 | 0.049 |\n| $\\hat{\\beta}_{1,2}^{T S L S}$ | $-0.016$ | $-0.001$ | $-0.001$ | 0.004 | 0.113 | 0.016 | 0.039 | 0.007 |\n| $\\gamma_{1}$ | 1 | 2 | 1 | 2 | 1 | 2 | 1 | 2 |\n| $n$ | 100 | 100 | 200 | 200 | 100 | 100 | 200 | 200 |",
        "table_6": "|  | Bias |  |  |  |  | MSE |  |  |  |  |\n| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |\n|  | (1) | (2) | (3) | (4) | (5) | (6) | (7) | (8) | (9) | (10) |\n| Panel A: Saturated model |  |  |  |  |  |  |  |  |  |  |\n| $\\beta_{1,2}$ | 0.002 | 0.009 | $-0.001$ | $-0.002$ | $-0.001$ | 0.039 | 0.339 | 0.030 | 0.013 | 0.004 |\n| $\\beta_{2,2}$ | $-0.002$ | $-0.004$ | $-0.005$ | 0.003 | 0.000 | 0.018 | 0.142 | 0.017 | 0.008 | 0.003 |\n| $\\beta_{1,5}$ |  | 0.018 | 0.030 | 0.018 | 0.004 |  | 1.855 | 0.352 | 0.129 | 0.030 |\n| $\\beta_{2,5}$ |  | 0.168 | $-0.069$ | 0.007 | 0.007 |  | 6.665 | 1.952 | 0.899 | 0.248 |\n| $\\beta_{3,5}$ |  | $-0.236$ | 0.065 | $-0.046$ | $-0.022$ |  | 10.501 | 2.895 | 1.368 | 0.404 |\n| $\\beta_{4,5}$ |  | 0.130 | $-0.038$ | 0.009 | 0.020 |  | 6.664 | 1.961 | 0.688 | 0.162 |\n| $\\beta_{5,5}$ |  | $-0.044$ | 0.009 | 0.015 | $-0.005$ |  | 1.842 | 0.300 | 0.087 | 0.020 |\n| Panel B: Restricted model |  |  |  |  |  |  |  |  |  |  |\n| $\\beta_{-\\max }$ |  | $-0.001$ | $-0.002$ | 0.003 | 0.001 |  | 0.109 | 0.010 | 0.004 | 0.001 |\n| $\\beta_{\\max }$ |  | $-0.012$ | $-0.003$ | $-0.004$ | $-0.001$ |  | 0.101 | 0.007 | 0.003 | 0.001 |\n| $\\gamma_{1}$ | 1 | 1 | 2 | 3 | 5 | 1 | 1 | 2 | 3 | 5 |\n| $\\tilde{d}$ | 2 | 5 | 5 | 5 | 5 | 2 | 5 | 5 | 5 | 5 |",
        "table_7": "| LHS | Average first stage $R^{2}$ |  |  |  | $\\operatorname{Pr}\\left\\{R^{2} \\geq 0.7\\right\\}$ |  |  |  |\n| :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |\n|  | (1) | (2) | (3) | (4) | (5) | (6) | (7) | (8) |\n| $\\tilde{Y}_{1,5}$ | 0.396 | 0.614 | 0.715 | 0.775 | 0.004 | 0.240 | 0.603 | 0.849 |\n| $\\tilde{Y}_{2,5}$ | 0.423 | 0.625 | 0.709 | 0.766 | 0.009 | 0.245 | 0.569 | 0.839 |\n| $\\tilde{Y}_{3,5}$ | 0.429 | 0.622 | 0.708 | 0.768 | 0.003 | 0.228 | 0.574 | 0.865 |\n| $\\tilde{Y}_{4,5}$ | 0.418 | 0.613 | 0.696 | 0.761 | 0.008 | 0.211 | 0.524 | 0.821 |\n| $\\tilde{Y}_{5,5}$ | 0.382 | 0.587 | 0.683 | 0.746 | 0.004 | 0.168 | 0.470 | 0.757 |\n| $\\gamma_{1}$ | 1 | 2 | 3 | 5 | 1 | 2 | 3 | 5 |\n| $\\bar{d}$ | 5 | 5 | 5 | 5 | 5 | 5 | 5 | 5 |"
      },
      "images": {}
    },
    {
      "section_id": 20,
      "text": "# References \n\nAlne, Ragnar, Eyo I. Herstad, and Andreas Myhre. 2025. \"How Socioeconomic and Parental Background Shape Peer Networks and Educational Spillovers.\" Available on SSRN: https://www.ssrn.com/abstract=5160331.\n\nBelloni, Alexandre, Christian Hansen, and Whitney Newey. 2022. \"High-dimensional linear models with many endogenous variables.\" Journal of Econometrics, 228(1): 4-26.\n\nBoucher, Vincent, Michelle Rendall, Philip Ushchev, and Yves Zenou. 2024. \"Toward a general theory of peer effects.\" Econometrica, 92(2): 543-565.\n\nBramoull\u00e9, Yann, Habiba Djebbari, and Bernard Fortin. 2009. \"Identification of peer effects through social networks.\" Journal of Econometrics, 150(1): 41-55.\n\nBramoull\u00e9, Yann, Habiba Djebbari, and Bernard Fortin. 2020. \"Peer effects in networks: A survey.\" Annual Review of Economics, 12(1): 603-629.\n\nDe Chaisemartin, Cl\u00e9ment, and Xavier d'Haultfoeuille. 2020. \"Two-way fixed effects estimators with heterogeneous treatment effects.\" American Economic Review, 110(9): 2964-2996.\n\nDe Paula, Aureo. 2013. \"Econometric analysis of games with multiple equilibria.\" Annu. Rev. Econ., 5(1): 107-131.\n\nFoster, Gigi. 2006. \"It's not your peers, and it's not your friends: Some progress toward understanding the educational peer effect mechanism.\" Journal of Public Economics, 90(8-9): 14551475 .\n\nGazze, Ludovica, Claudia Persico, and Sandra Spirovska. 2024. \"The long-run spillover effects of pollution: How exposure to lead affects everyone in the classroom.\" Journal of Labor Economics, 42(2): 357-394.\n\nGoldsmith-Pinkham, Paul, and Guido W Imbens. 2013. \"Social networks and the identification of peer effects.\" Journal of Business \\& Economic Statistics, 31(3): 253-264.\n\nGoldsmith-Pinkham, Paul, Peter Hull, and Michal Koles\u00e1r. 2024+. \"Contamination bias in linear regressions.\" The American Economic Review.\n\nGoodman-Bacon, Andrew. 2021. \"Difference-in-differences with variation in treatment timing.\" Journal of Econometrics, 225(2): 254-277.\n\nGuryan, Jonathan, Kory Kroft, and Matthew J Notowidigdo. 2009. \"Peer effects in the workplace: Evidence from random groupings in professional golf tournaments.\" American Economic Journal: Applied Economics, 1(4): 34-68.\n\nHan, Li, and Tao Li. 2009. \"The gender difference of peer influence in higher education.\" Economics of Education review, 28(1): 129-134.\n\nHsieh, Chih-Sheng, and Lung Fei Lee. 2016. \"A social interactions model with endogenous friendship formation and selectivity.\" Journal of Applied Econometrics, 31(2): 301-319.\n\nJochmans, Koen. 2023. \"Peer effects and endogenous social interactions.\" Journal of Econometrics, 235(2): 1203-1214.\n\nJohnsson, Ida, and Hyungsik Roger Moon. 2021. \"Estimation of peer effects in endogenous social networks: Control function approach.\" Review of Economics and Statistics, 103(2): 328345 .\n\nKang, Changhui. 2007. \"Classroom peer effects and academic achievement: Quasi-randomization evidence from South Korea.\" Journal of Urban Economics, 61(3): 458-495.\n\nManski, Charles F. 1993. \"Identification of endogenous social effects: The reflection problem.\" The Review of Economic Studies, 60(3): 531-542.\n\nMasten, Matthew A. 2018. \"Random coefficients on endogenous variables in simultaneous equations models.\" The Review of Economic Studies, 85(2): 1193-1250.\n\nMogstad, Magne, and Alexander Torgovitsky. 2024. \"Instrumental Variables with Unobserved Heterogeneity in Treatment Effects.\" National Bureau of Economic Research.\n\nSacerdote, Bruce. 2001. \"Peer effects with random assignment: Results for Dartmouth roommates.\" The Quarterly journal of economics, 116(2): 681-704.\n\nSacerdote, Bruce. 2011. \"Peer effects in education: How might they work, how big are they and how much do we know thus far?\" In Handbook of the Economics of Education. Vol. 3, 249-277. Elsevier.\n\nTao, Ji, and Lung-fei Lee. 2014. \"A social interaction model with an extreme order statistic.\" The Econometrics Journal, 17(3): 197-240.\n\nTincani, Michela M. 2024. \"Heterogeneous Peer Effects and Rank Concerns in the Classroom.\" CEPR Discussion Paper No. 18921. CEPR Press, Paris \\& London. https://cepr.org/publications/dp18921.",
      "tables": {},
      "images": {}
    }
  ],
  "id": "2410.14317v2",
  "authors": [
    "Eyo I. Herstad",
    "Myungkou Shin"
  ],
  "categories": [
    "econ.EM"
  ],
  "abstract": "We develop a model that captures peer effect heterogeneity by modeling the\nendogenous spillover to be linear in ordered peer outcomes. Unlike the\ncanonical linear-in-means model, our approach accounts for the distribution of\npeer outcomes as well as the size of peer groups. Under a minimal condition,\nour model admits a unique equilibrium and is therefore tractable and\nidentified. Simulations show our estimator has good finite sample performance.\nFinally, we apply our model to educational data from Norway, finding that\nhigher-performing friends disproportionately drive GPA spillovers. Our\nframework provides new insights into the structure of peer effects beyond\naggregate measures.",
  "updated": "2025-02-28T20:31:36Z",
  "published": "2024-10-18T09:25:20Z"
}