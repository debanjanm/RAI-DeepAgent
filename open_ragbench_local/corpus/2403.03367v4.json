{
  "title": "am-AMM: An Auction-Managed Automated Market Maker",
  "sections": [
    {
      "section_id": 0,
      "text": "#### Abstract\n\nAutomated market makers (AMMs) have emerged as the dominant market mechanism for trading on decentralized exchanges implemented on blockchains. This paper presents a single mechanism that targets two important unsolved problems for AMMs: reducing losses to informed orderflow, and maximizing revenue from uninformed orderflow. The \"auction-managed AMM\" works by running a censorship-resistant onchain auction for the right to temporarily act as \"pool manager\" for a constant-product AMM. The pool manager sets the swap fee rate on the pool, and also receives the accrued fees from swaps. The pool manager can exclusively capture some arbitrage by trading against the pool in response to small price movements, and also can set swap fees incorporating price sensitivity of retail orderflow and adapting to changing market conditions, with the benefits from both ultimately accruing to liquidity providers. Liquidity providers can enter and exit the pool freely in response to changing rent, though they must pay a small fee on withdrawal. We prove that under certain assumptions, this AMM should have higher liquidity in equilibrium than any standard, fixed-fee AMM.",
      "tables": {},
      "images": {}
    },
    {
      "section_id": 1,
      "text": "## 1. Introduction\n\nLiquidity providers (LPs) for automated market makers (AMMs) want to minimize their losses to arbitrageurs while maximizing fee revenue from retail flow. Each of these is a major unsolved problem in AMM design. Minimizing losses to arbitrageurs (which can be characterized as \"lossvs-rebalancing,\" or LVR) requires either setting high fees or relying on some other mechanism to capture the profits from information or latency arbitrage and mitigate losses to agents (arbitrageurs), who possess superior information on the market value of the asset and snipe stale prices posted by the AMM. Meanwhile, the optimal fee for a given asset pair depends on how retail volume for that pair responds to fees - a difficult problem that is not easy to model. Moreover, the optimal fee may be dynamic and vary with other market variables such as volatility or overall market volume. In standard fixed-fee AMMs (ff-AMMs), these problems compound and interfere with each\n\n[^0]\n[^0]:    *The second author is supported by the Briger Family Digital Finance Lab at Columbia Business School, and is an advisor to Paradigm and to fintech companies. The authors wish to thank Agostino Capponi, Mallesh Pai, and Anthony Zhang for helpful comments.\n\nother: liquidity providers must choose a pool with fees high enough to reduce arbitrage opportunities while still low enough to capture value from retail flow. Additionally, liquidity providers must make this choice statically and for themselves, and if they disagree, liquidity ends up fragmented across multiple pools.\n\nIn this paper, we propose the auction-managed AMM (am-AMM), a new AMM design that targets both LVR reduction and fee optimization with one mechanism. The mechanism incentivizes sophisticated market participants to capture some of the value leaked by the AMM, and also lets those market participants set fees at a level that optimizes revenue from retail traders. The pool maintains synchronous composability with other onchain contracts, does not require price oracles, and is resistant to censorship. It also ensures accessibility, meaning that liquidity on the pool can always be traded against with some capped fee. Under certain assumptions, we prove that the am-AMM will attract more liquidity than any fixed-fee constant product AMM pool (with any fee up to the cap), in equilibrium.\n\nThe am-AMM is a constant-product AMM. The AMM utilizes an onchain censorship-resistant \"Harberger lease\" auction to find the highest bidder. The current highest bidder in the ongoing auction, known as the manager, pays rent to liquidity providers. In exchange, the manager can dynamically set the swap fee rate (up to some maximum cap), and receives all swap fees collected by the pool. This allows the manager to capture small arbitrage opportunities each block by trading on the pool, since they can trade with effectively zero fee. It also incentivizes them to set the swap fee in order to maximize revenue from uninformed flow. Liquidity providers can enter and exit the pool freely (though they pay a small withdrawal fee).\n\nThe am-AMM has some drawbacks. It may provide even fewer protections against sandwich attacks than a fixed-fee AMM, since the pool manager's ability to trade without fees allows them to profit by pushing any publicly visible transaction to its limit price. It also could contribute to centralization of block builder infrastructure. We think these limitations and drawbacks warrant future study, as does the problem of making this feature work with concentrated liquidity Adams et al. (2021).\n\nRelated literature. While automated market makers are newer compared to many financial market primitives, the literature on the subject is growing rapidly. The concept of AMMs can be traced back to Hanson (2007) and Othman et al. (2013). Early literature on the current implementations of AMMs includes Angeris et al. (2019), Angeris and Chitra (2020), Lehar and Parlour (2021), Capponi and Jia (2021), and Hasbrouck et al. (2022). Implementation details of automated market makers are described in Adams et al. (2020) and Adams et al. (2021). Furthermore, Adams et al. (2023b) describes a forthcoming platform for customizable AMMs.\n\nOur paper builds directly on the loss-vs-rebalancing framework established in Milionis et al. (2022) and Milionis et al. (2023) as a model for evaluating designs for AMMs. Contemporaneous with the this paper, Ma and Crapis (2024) analyze liquidity provision in AMMs with a similar model of LP profitability and noise trader demand as the present paper.\n\nThe idea described in this paper is an instance of an ex ante auction for the right to capture the\n\narbitrage profit from the block, an idea first proposed by Alex Herrmann from Gnosis as the \"MEV capturing AMM\" (McAMM) in Herrmann (2022). This paper extends that concept to allow the manager to also select the fee charged to retail traders and collect those fees, thus using a similar mechanism to address an independent problem. Also, unlike the McAMM, the auction proposed here guarantees the property of accessibility - people can trade against the pool even if the current manager has not submitted a transaction in this block.\n\nOur paper also proposes a way to optimize fees that takes into account the difficult-to-model demand function for retail orderflow. Some AMMs, such as Uniswap v3 (Adams et al., 2021) address this problem by letting liquidity providers choose between different static \"fee tiers.\" This puts the responsibility for optimizing fees on individual liquidity providers, can lead to some fragmentation of liquidity. Other automated market makers have implemented dynamic fees on individual pools, including Trader Joe v2.1 (MountainFarmer et al., 2022), Curve v2 (Egorov and GmbH), 2021), and Mooniswap (Bukov and Melnik, 2020), as well as Nezlobin (2023). Cartea et al. (2023) propose a design involving dynamic fees and dynamic price impact functions. While innovative, these dynamic fee implementations are not necessarily optimized for maximizing liquidity. The am-AMM is a first attempt at a provably incentive-compatible dynamic fee, where the fee is set by the market in a way that should always attract more liquidity than any fixed-fee AMM.",
      "tables": {},
      "images": {}
    },
    {
      "section_id": 2,
      "text": "# 2. Auction Design \n\nThe auction is designed to set up a censorship-resistant version of the two-stage game modelled in Section 3.2, where (1) potential managers bid for the right to set and earn the trading fee in a future block; and (2) liquidity providers respond by adding or removing liquidity. The auction uses a delay parameter $K$. The rules of the auction are designed so that both the rent and the pool manager for block $N$ are locked in as of block $N-K$.\nHarberger lease. The right to be the manager of a pool is set in a special onchain auction we call a \"Harberger lease\" (named after the \"Harberger taxes\" popularized by Posner and Weyl (2018)). This is a continuously held English auction where bids are expressed in terms of rent per block. The top bid at any given time determines the manager for the pool, who pays the rent to liquidity providers in the pool for as long as that bid is active.\n\nThe rent is denominated and paid in pool tokens, and is paid out of the pool manager's deposit to all pool LP token holders proportional to their stake (thus effectively increasing the value of those pool tokens). This ensures that pool tokens remain fungible and that rent is compounded automatically.\nBidding rules. Each bid specifies a per-block rent $R$. When the bid is placed, it must include a deposit $D$, which must be a multiple of $R$ and must be at least $R \\cdot K$. Newly placed bids do not become active immediately, but are delayed by $K$ blocks. When either a new high bid becomes active, or the current pool manager's deposit is depleted, the new high bidder usurps the current pool manager. The contract enforces a minimum bid increment.\n\nThe top bid cannot be cancelled, but can reduce its deposit as long as it leave a minimum deposit of $D_{\\text {top }} \\geq R_{\\text {top }} K$. The contract keeps track of the next bid (which is either the next-highest bid after the current top bid, or a bid that is higher than the top bid but is not yet active). If the top bid does not have enough rent to pay for $K$ blocks - that is, if $\\frac{D_{\\text {top }}}{R_{\\text {top }}}<K$, then the next bid cannot be canceled, but must leave at least enough deposit such that $\\frac{D_{\\text {top }}}{R_{\\text {top }}}+\\frac{D_{\\text {next }}}{R_{\\text {next }}} \\geq K$.\nPool manager rights. The current pool manager can adjust the swap fee for the next block at any time, subject to a fixed fee cap $f_{\\text {max }}$. The pool manager also receives all swap fees collected by the pool. Since the pool manager receives swap fees, they are effectively able to swap on the pool with zero fee. This means that they can capture arbitrages from small price movements that no other arbitrageur would be able to profitably capture. However, if the price moves by more than the current fee in a single block - in other words, if it moves outside the \"no-trade region\" (Milionis et al., 2023) - then some of the profit could leak to other arbitrageurs, as discussed in Section 3.2.\nCensorship resistance. The delay parameter $K$ should be chosen such that there is a negligible probability that anyone can censor the base layer for $K$ blocks in a row. This prevents someone from stealing MEV from a high-volatility block by usurping the current manager and then censoring arbitrage transactions for $K$ blocks. It also ensures that liquidity providers can respond to changes in rent by adding or removing liquidity before the new rent takes effect.\nWithdrawal fees. Liquidity providers are free to enter or exit at any time. This allows them to respond to anticipated changes in rent during the $K$-block delay. However, when liquidity providers exit, they must pay a small withdrawal fee to the current manager. This prevents liquidity providers from withdrawing liquidity after volatility is realized but before the current manager has the opportunity to execute an arbitrage transaction. As shown in Appendix B, even a very small withdrawal fee - less than 0.13 basis points, if the fee cap is $1 \\%$ - can ensure that strategic liquidity provider withdrawals cannot reduce the manager's profit from a given arbitrage opportunity below the amount assumed in Section 3. This fee could alternatively be replaced with a withdrawal delay for a similar effect.",
      "tables": {},
      "images": {}
    },
    {
      "section_id": 3,
      "text": "# 3. Theory \n\nOur starting point is a model inspired by Milionis et al. (2022) and Milionis et al. (2023), which consider an AMM trading a risky asset (denoted by $x$ ) versus the num\u00e9raire (denoted by $y$ ), and that the risky asset has a fundamental price at all times (for example, on an infinitely deep centralized exchange). As in Milionis et al. (2023), we assume that traders can only trade on the pool at discrete block generation times.\n\nOur setting is consistent with and can be structurally microfounded in the full setting of Milionis et al. (2023), which assumes that blocks arrival times follow a Poisson process and that the asset's price follows geometric Brownian motion parameterized by volatility $\\sigma>0$, but our theorems do not depend on those assumptions. Instead we describe the model primitives in reduced\n\nform, with weaker assumptions, and provide examples that show that those models would satisfy the assumptions.\n\nWe will restrict to the case of a constant product market maker, ${ }^{1}$ with invariant $\\sqrt{x y}=L$, where we denote the reserve quantities by $(x, y)$ and the pool liquidity level by $L$. If the price of the risky asset is given by $P$, the value of the the pool reserves is given by $V(L) \\triangleq 2 \\sqrt{P} L$, as a function of the available liquidity $L$. We assume the pool charges a proportional trading fee $f \\in\\left[0, f_{\\max }\\right]$.\n\nWe consider a setting where there are two types of traders: (1) noise traders, who trade for idiosyncratic reasons and generate fee income for the pool; and (2) arbitrageurs, who seek to exploit price differences between the pool and the fundamental price, and create adverse selection costs for the pool. Here, the $\\mathrm{P} \\& \\mathrm{~L}$ of LPs is a jump process, stochastically jumping at instances of block generation. We will consider the expected aggregate instantaneous rate of $\\mathrm{P} \\& \\mathrm{~L}$ of LPs per unit time, where we are averaging over stochasticity in future price changes, or, equivalently, assuming that exposure to market risk of the risky asset has been hedged.\nNoise traders. We assume there exists a population of noise traders that trade for idiosyncratic reasons (e.g., convenience of executing on chain) and not for informational reasons. Hence, economically, in our model noise traders serve exclusively to generate fee income for the pool. Given pool fee $f \\geq 0$ and liquidity $L \\geq 0$, denote by $H(f, L)$ the expected total volume of noise trades arriving per unit time, denominated in the num\u00e9raire, so that $f H(f, L)$ is the total rate per unit time of fee revenue generated by the noise traders. We will assume that:\n\nAssumption 1 (Noise trader demand). For $L>0$, define\n\n$$\nH_{0}(f, L) \\triangleq H(f, L) / V(L)\n$$\n\nto be the expected noise trader volume per unit time per unit of pool value, we assume that $H_{0}(\\cdot, \\cdot)$ is a continuous function satisfying:\n\n1. For all $L>0, H_{0}(f, L)$ is a decreasing function of $f$.\n2. For all $f \\in\\left[0, f_{\\max }\\right], H_{0}(f, L)$ is strictly decreasing function of $L$. Moreover, $H_{0}(f, L) \\downarrow 0$ as $L \\rightarrow \\infty$, and $H_{0}(f, L) \\uparrow \\infty$ as $L \\rightarrow 0$.\n\nPart 1 asserts that noise trader demand is decreasing in the price (fee) charged. Part 2 implies that the noise trader is sub-linear in pool value or liquidity, i.e., noise trader demand is satiated.\nExample 1. Consider $H(f, L) \\triangleq c_{0} L^{\\alpha} \\exp \\left(-c_{1} f\\right)$, where $c_{0}, c_{1}>0$ and $\\alpha \\in(0,1)$ are parameters that could be estimated from transaction data, and may be time varying or may depend on\n\n[^0]\n[^0]:    ${ }^{1}$ The key property of the constant product market maker we use is that the arbitrage profits and arbitrage excess scale linearly with pool value, where the constant of proportionality does not depend on the price. This property holds more generally for geometric mean market makers, and our results would trivially extend there. Beyond that, when considering more general invariant curves, there may be additional second order effects due to the price changing over time horizon of the LP investment. If price movements over the scale of the LP investment horizon are not large, these effects may not be significant, and we would expect the high level insights of our model to continue to apply to general invariant curves.\n\nother market parameters such as volatility or broader market volume. This liquidity dependence is consistent with the model proposed by Hasbrouck et al. (2023).\n\nArbitrageur profits. We assume there is a competitive and deep market of arbitrageurs monitoring prices in the AMM and exploiting price differences between the AMM and the fundamental price. Denote by $\\operatorname{ARB} \\_$PROFIT $(f, L)$ the expected profit to arbitrageurs per unit time, given fee $f \\in$ $\\left[0, f_{\\max }\\right]$ and liquidity $L \\geq 0$. We make the following assumption:\nAssumption 2 (Arbitrageur profits). For $L>0$, we assume that\n\n$$\n\\operatorname{ARB} \\_ \\operatorname{PROFIT}(f, L)=\\operatorname{AP}_{0}(f) V(L)\n$$\n\nwhere $\\mathrm{AP}_{0}(\\cdot)$ is a continuous, decreasing function.\nAssumption 2 guarantees that arbitrage profits scale linearly with the pool value or liquidity, in contrast to noise trader volume. This is because we assume, by nature of engaging in riskless activity, arbs have access to infinite capital for arbitrage activity, and arbitrage demand will not be satiated so long as arbitrage opportunities are available. Assumption 2 also implies that, holding liquidity fixed, arbitrageur profits are decreasing in the fee $f$, this is because the fee is a friction that limits arbitrage.\n\nThis assumption does not depend on a particular model for either the asset price's behavior or for block generation times, but we show that it can be structurally microfounded in one such model, as illustrated here: ${ }^{2}$\n\nExample 2. Consider a setting where the risky asset's price follows geometric Brownian motion parameterized by volatility $\\sigma>0$ and blocks are generated at the arrivals of a Poisson process of rate $\\Delta t^{-1}$, with $\\Delta t$ being the average interblock time. Milionis et al. (2023) establish that, when $\\Delta t<8 \\sigma^{2}$,\n\n$$\n\\operatorname{ARB} \\_ \\operatorname{PROFIT}(f, L)=\\frac{\\sigma^{2}}{8} \\frac{1}{1+\\frac{f}{\\sigma \\sqrt{\\Delta t / 2}}} \\frac{e^{+f / 2}+e^{-f / 2}}{2\\left(1-\\sigma^{2} \\Delta t / 8\\right)} V(L)\n$$\n\nThis satisfies Assumption 2.",
      "tables": {},
      "images": {}
    },
    {
      "section_id": 4,
      "text": "# 3.1. Fixed-Fee AMM Model \n\nAs a benchmark, we consider the standard AMM design with a fixed fee $f \\in\\left[0, f_{\\max }\\right]$, which we refer to as a fixed-fee AMM (ff-AMM). Following the discussion above, we define the instantaneous rate of aggregate expected $\\mathrm{P} \\& \\mathrm{~L}$ of LPs in this pool in excess of the risk free rate according to\n\n$$\n\\begin{aligned}\n\\Pi_{\\mathrm{ff}}^{\\mathrm{LP}}(f, L) & \\triangleq f H(f, L)-\\operatorname{ARB} \\_ \\operatorname{PROFIT}(f, L)-r V(L) \\\\\n& =\\left(f H_{0}(f, L)-\\mathrm{AP}_{0}(f)-r\\right) V(L)\n\\end{aligned}\n$$\n\n[^0]\n[^0]:    ${ }^{2}$ See Section 4 for further discussion.\n\nwhere the first term in the sum is the revenue from noise traders, the second term is the loss to arbs, and the final term is a capital charge, where $r>0$ is the risk-free rate. Under free entry and exit of LPs, we define the equilibrium in the fixed-fee AMM according to a zero profit condition:\nLemma 1 (ff-AMM equilibrium). Given fee $f \\in\\left[0, f_{\\max }\\right]$, define a liquidity level $L^{*}>0$ to be a competitive equilibrium if LPs earn zero profit in excess of the risk free rate, i.e., $\\Pi_{\\mathrm{ff}}^{\\mathrm{LP}}\\left(f, L^{*}\\right)=0$. Then, for any $f \\in\\left[0, f_{\\max }\\right]$, a unique equilibrium level of liquidity $L^{*}=L_{\\mathrm{ff}}(f)$ exists.",
      "tables": {},
      "images": {}
    },
    {
      "section_id": 5,
      "text": "# 3.2. Auction-Managed AMM Model \n\nIn this section, we consider the auction-managed AMM design.\nArbitrageur excess. In the am-AMM, the pool manager collects all of the fee revenue, and therefore, effectively, can also trade against the pool without paying any fees. Therefore, the pool will suffer adverse selection costs of ARB_PROFIT $(0, L)$, independent of the fee level $f$. However, the manager does not collect all of these fees as income. Instead, note that whenever the mispricing in the pool exceeds the fee $f$, some of that mispricing can be profitably captured by agents other than the manager. We denote by $\\operatorname{ARB} \\_$EXCESS $(f, L)$ the instantaneous rate of expected arbitrage profit per unit time forgone by the manager. We assume that:\nAssumption 3 (Arbitrageur excess). For $L>0$, we assume that\n\n$$\n\\operatorname{ARB} \\_ \\operatorname{EXCESS}(f, L)=\\mathrm{AE}_{0}(f) V(L)\n$$\n\nwith $\\mathrm{AE}_{0}(f)$ a continuous, decreasing function that satisfies $\\mathrm{AE}_{0}(f) \\leq \\mathrm{AP}_{0}(f)$, for all $f \\in\\left[0, f_{\\max }\\right]$, and where the inequality is strict if $f>0$.\n\nAssumption 3 is largely analogous to Assumption 2, and can be similarly microfounded by a stochastic model, as shown in Example 4, but does not depend on that model. The strict inequality assumption simply asserts that some of the arbitrage profit is captured by the manager.\nExample 3. One extreme setting is the McAMM design of Herrmann (2022). There, no trades can occur in an AMM in a given block unless the pool manager has a transaction earlier in the block to \"unlock\" the pool. Hence the pool manager is guaranteed to be the first transaction in everybody and can capture all arbitrage profits. In this case, ARB_EXCESS $(f, L)=0$.\nExample 4. In Section 4, we develop structural microfoundations of a model for arbitrageur excess in the setting of Milionis et al. (2023), where the risky asset's price follows geometric Brownian motion parameterized by volatility $\\sigma>0$ and blocks are generated at the arrivals of a Poisson process of rate $\\Delta t^{-1}$, with $\\Delta t$ being the average interblock time. In that setting, we assume that (1) the pool manager fully monetizes any arbitrage where the mispricing is less than the fee $f$, and (2) when the mispricing exceeds the fee $f$, other arbitrageurs correct the mispricing back to the fee level $f$ before the pool manager can trade, and hence the pool manager is only able to monetize the\n\nportion of the arbitrage up to $f$. Then, we establish that, when $\\Delta t<8 \\sigma^{2}$,\n\n$$\n\\operatorname{ARB}_{-} \\operatorname{EXCESS}(f, L)=\\frac{\\sigma^{2}}{8} \\exp \\left(-\\frac{f}{\\sigma \\sqrt{\\Delta t / 2}}\\right) \\frac{e^{+f / 2}+e^{-f / 2}}{2\\left(1-\\sigma^{2} \\Delta t / 8\\right)} V(L)\n$$\n\nThis satisfies the conditions of Assumption 3.\nComparing Example 2 and Example 4, we see that $\\operatorname{ARB}_{-} \\operatorname{EXCESS}(f, L) \\ll \\operatorname{ARB}_{-} \\operatorname{PROFIT}(f, L)$ in the sense that\n\n$$\n\\frac{\\text { ARB_EXCESS }(f, L)}{\\text { ARB_PROFIT }(f, L)}=\\frac{\\mathrm{AE}_{0}(f, L)}{\\mathrm{AP}_{0}(f, L)}=\\left(1+\\frac{f}{\\sigma \\sqrt{\\Delta t / 2}}\\right) \\exp \\left(-\\frac{f}{\\sigma \\sqrt{\\Delta t / 2}}\\right)\n$$\n\nwhich is exponentially vanishing in $f / \\sigma \\sqrt{\\Delta t}$.\nEquilibrium. We imagine a game that proceeds in two steps: (1) agents bid rent $R$, the agent with the highest rent wins the auction and is declared the pool manager, with the right to determine the trading fee $f$ and earn all fees; and (2) LPs determine aggregate liquidity $L$ given $R$. Based on the discussion above, the $\\mathrm{P} \\& \\mathrm{~L}$ of the manager per unit time is given by\n\n$$\n\\begin{aligned}\n\\Pi_{\\mathrm{am}}^{\\mathrm{MGR}}(R, L) & \\triangleq \\max _{f \\in\\left[0, f_{\\max }\\right]}\\{f H(f, L)+\\mathrm{ARB}_{-} \\operatorname{PROFIT}(0, L) \\\\\n& -\\mathrm{ARB}_{-} \\operatorname{EXCESS}(f, L)-R\\} \\\\\n& =\\max _{f \\in\\left[0, f_{\\max }\\right]}\\left\\{f H_{0}(f, L)+\\mathrm{AP}_{0}(0)-\\mathrm{AE}_{0}(f)\\right\\} V(L)-R\n\\end{aligned}\n$$\n\nThe maximization is because the manager is free to set the fee, and we assume they will do so to maximize $\\mathrm{P} \\& \\mathrm{~L}$. The first term captures the fact that the manager retains all fee revenue. The second and third terms capture the fact that the manager earns arbitrage profits as if it pays no fees, except for the arbitrage excess. The final term captures the fact that the manager pays rent. On the other hand, the LPs in aggregate earn P\\&L per unit time given by\n\n$$\n\\Pi_{\\mathrm{am}}^{\\mathrm{LP}}(R, L) \\triangleq R-\\mathrm{ARB}_{-} \\operatorname{PROFIT}(0, L)-r V(L)=R-\\left(\\mathrm{AP}_{0}(0)+r\\right) V(L)\n$$\n\nHere, the first term is the rent payment made by the manager, the second term is the adverse selection cost (which is as if no fees are charged), and the third term is the cost of capital. Given these definitions, we have that:\nTheorem 1 (am-AMM equilibrium). $\\left(R^{*}, L^{*}\\right)$ is a competitive equilibrium of the am-AMM if the zero profit conditions ${ }^{3}$\n\n$$\n\\Pi_{\\mathrm{am}}^{\\mathrm{MGR}}\\left(R^{*}, L^{*}\\right)=0, \\quad \\Pi_{\\mathrm{am}}^{\\mathrm{LP}}\\left(R^{*}, L^{*}\\right)=0\n$$\n\n[^0]\n[^0]:    ${ }^{3}$ Here, we assume that entry and exit are frictionless for LPs, ignoring the withdrawal fees. This is justified if the liquidity provision decision horizon is sufficiently long so that, amortized over its length, the withdrawal fees are de minimus.\n\nare satisfied. An equilibrium $\\left(R^{*}, L^{*}\\right)$ must exist, with equilibrium fees\n\n$$\nf^{*} \\in \\underset{f \\in\\left[0, f_{\\max }\\right]}{\\operatorname{argmax}} f H_{0}(f, L)-\\mathrm{AE}_{0}(f)\n$$\n\nand satisfies $L^{*}>L_{\\mathrm{ff}}(f)$, for all $f \\geq 0$. Therefore, in equilibrium, the am-AMM will have higher liquidity than any ff-AMM.\n\nTheorem 1 establishes that the equilibrium liquidity for the am-AMM is larger than that of any ff-AMM. Beyond that, it gives insight into the equilibrium fee $f^{*}$ set in the am-AMM: from (4), the pool operator will seek to set the fee to maximize noise trader revenue adjusted for arbitrageur excess. As a comparison, consider the fee level $f_{\\text {opt }}$ that exclusively maximizes noise trader revenue, i.e.,\n\n$$\nf_{\\text {opt }} \\in \\underset{f \\in\\left[0, f_{\\max }\\right]}{\\operatorname{argmax}} f H_{0}\\left(f, L^{*}\\right)\n$$\n\nIf we assume that the revenue function $f \\mapsto f H_{0}\\left(f, L^{*}\\right)$ is concave, and the arbitrageur excess function $\\mathrm{AE}_{0}(f)$ is convex, then a comparison of first order conditions for (4)-(5) reveals that $f_{\\text {opt }} \\leq f^{*}$, i.e., the am-AMM will set fees higher than is purely revenue optimal. However, by virtue of the optimality of $f^{*}$ in (4), we have that\n\n$$\nf_{\\text {opt }} H_{0}\\left(f_{\\text {opt }}, L^{*}\\right)-f^{*} H_{0}\\left(f^{*}, L^{*}\\right) \\leq \\mathrm{AE}_{0}\\left(f_{\\text {opt }}\\right)-\\mathrm{AE}_{0}\\left(f^{*}\\right) \\leq \\mathrm{AE}_{0}\\left(f_{\\text {opt }}\\right)\n$$\n\nIn the arbitrageur excess model of Example $4, \\mathrm{AE}_{0}\\left(f_{\\text {opt }}\\right)$ may be very small (since it is exponentially vanishing in blocktime, for example), and in such cases (6) would imply that $f^{*}$ is also nearly optimal from a noise trader revenue perspective.",
      "tables": {},
      "images": {}
    },
    {
      "section_id": 6,
      "text": "# 4. A Structural Model for Arbitrageur Excess \n\nIn this section, we will derive the structural model for arbitrageur excess of Example 4, following the arbitrageur profits model of Milionis et al. (2023) and of Example 2.\nFee structure. In order to simplify formulas, Milionis et al. (2023) uses a fee structure wherein a proportional fee of $e^{+\\gamma}-1=\\gamma+o(\\gamma)$ is charged for purchases of the risky asset from the pool, while a proportional fee of $1-e^{-\\gamma}=\\gamma+o(\\gamma)$ is charged for sales of the risky asset to the pool - these are symmetric fees in log-price space. This is different than the setting in this paper, where we assume a fee proportional $f$ which is the same for buys or sells - that is, symmetric in (linear) price space. In order to facilitate comparison with Milionis et al. (2023), we will make the approximation $f=\\gamma$. As illustrated in Example 1 of Milionis et al. (2023), for practical parameter values, this does not make a significant difference.\nAsset price dynamics. Denote by $P_{t}$ the fundamental price of the asset, which follows a geometric Brownian motion with drift $\\mu>0$ and volatility $\\sigma>0$, and denote by $\\tilde{P}_{t}$ the implied spot price of the asset in the pool. Define $z_{t} \\triangleq \\log P_{t} / \\tilde{P}_{t}$ to be the log-mispricing at time $t$. When $t$ is not a block\n\ngeneration time, It\u00f4's lemma implies that $z_{t}$ is governed by the stochastic differential equation\n\n$$\nd z_{t}=\\left(\\mu-\\frac{1}{2} \\sigma^{2}\\right) d t+\\sigma d B_{t}\n$$\n\nwhere $B_{t}$ is a Brownian motion. We will make the symmetry assumption that $\\mu=\\frac{1}{2} \\sigma^{2}$, so that $z_{t}$ is a driftless, (scaled) Brownian motion.\nBlock time dynamics. We assume that blocks are generated according to a Poisson process with mean interarrival time $\\Delta t$. Denote the block generation times by $0<\\tau_{1}<\\tau_{2}<\\ldots$. At instances $t=\\tau_{i}$ when blocks are generated, we imagine that\n\n1. If the $\\left|z_{t-}\\right| \\geq f$ (i.e., the mispricing immediately before block generation exceeds the fee), we imagine an arbitrageur is able to trade until the mispricing is equal to the fee, and thus earns profits that are not captured by the pool operator. These profits then become part of arbitrageur excess. Following the derivation of Milionis et al. (2023), the instaneous profit from arbitrageur excess when price is $P=P_{t}$ and the mispricing is $z=z_{t-}$ due to buying (respectively, selling) is given by\n\n$$\n\\begin{aligned}\n& A_{+}(P, z) \\triangleq\\left[P\\left\\{x^{*}\\left(P e^{-z}\\right)-x^{*}\\left(P e^{-f}\\right)\\right\\}+e^{+f}\\left\\{y^{*}\\left(P e^{-z}\\right)-y^{*}\\left(P e^{-f}\\right)\\right\\}\\right] \\mathbb{I}_{\\{z>+f\\}} \\geq 0 \\\\\n& A_{-}(P, z) \\triangleq\\left[P\\left\\{x^{*}\\left(P e^{-z}\\right)-x^{*}\\left(P e^{+f}\\right)\\right\\}+e^{-f}\\left\\{y^{*}\\left(P e^{-z}\\right)-y^{*}\\left(P e^{+f}\\right)\\right\\}\\right] \\mathbb{I}_{\\{z<-f\\}} \\geq 0\n\\end{aligned}\n$$\n\nHere, the holdings of the pool when implied price is $P$ are given by $x^{*}(P) \\triangleq L / \\sqrt{P}, y^{*}(P)=$ $L \\sqrt{P}$.\n2. After the arbitrageur trades, the pool operator corrects any remaining mispricing, so that $z_{t}=0$.\n\nIntensity of arbitrageur excess. The intensity or instaneous rate of arbitrageur excess per dollar of pool value per unit time is given by\n\n$$\n\\mathrm{AE}_{0}(f)=\\frac{\\mathrm{ARB}_{-} \\operatorname{EXCESS}(f, L)}{V(L)}=\\frac{1}{\\Delta t} \\mathrm{E}\\left[\\frac{A_{+}(P, z)+A_{-}(P, z)}{V(L)}\\right]\n$$\n\nwhere the expectation is over $z=z_{\\tau}$ at the next block generation time $\\tau$, i.e., $z \\sim N\\left(0, \\sigma^{2} \\tau\\right)$ with $\\tau \\sim \\operatorname{Exp}\\left(\\Delta t^{-1}\\right)$.\n\nObserve that\n\n$$\n\\begin{aligned}\n\\frac{A_{+}(P, z)}{V(L)} & =\\frac{1}{2 L \\sqrt{P}}\\left[P\\left\\{x^{*}\\left(P e^{-z}\\right)-x^{*}\\left(P e^{-f}\\right)\\right\\}+e^{+f}\\left\\{y^{*}\\left(P e^{-z}\\right)-y^{*}\\left(P e^{-f}\\right)\\right\\}\\right] \\mathbb{I}_{\\{z>+f\\}} \\\\\n& =\\frac{1}{2}\\left[\\left\\{e^{+z / 2}-e^{+f / 2}\\right\\}+e^{+f}\\left\\{e^{-z / 2}-e^{-f / 2}\\right\\}\\right] \\mathbb{I}_{\\{z>+f\\}} \\\\\n& =\\frac{1}{2} e^{+f / 2}\\left[e^{+(z-f) / 2}-2+e^{-(z-f) / 2}\\right] \\mathbb{I}_{\\{z>+f\\}} \\\\\n\\frac{A_{-}(P, z)}{V(L)} & =\\frac{1}{2 L \\sqrt{P}}\\left[P\\left\\{x^{*}\\left(P e^{-z}\\right)-x^{*}\\left(P e^{+f}\\right)\\right\\}+e^{-f}\\left\\{y^{*}\\left(P e^{-z}\\right)-y^{*}\\left(P e^{+f}\\right)\\right\\}\\right] \\mathbb{I}_{\\{z<-f\\}} \\\\\n& =\\frac{1}{2}\\left[\\left\\{e^{+z / 2}-e^{-f / 2}\\right\\}+e^{-f}\\left\\{e^{-z / 2}-e^{+f / 2}\\right\\}\\right] \\mathbb{I}_{\\{z<-f\\}} \\\\\n& =\\frac{1}{2} e^{-f / 2}\\left[e^{+(z+f) / 2}-2+e^{-(z+f) / 2}\\right] \\mathbb{I}_{\\{z<-f\\}}\n\\end{aligned}\n$$\n\nTaking expectations of the first term, conditioned on the block generation time $\\tau$, we have $z \\sim N\\left(0, \\sigma^{2} \\tau\\right)$, so that\n\n$$\n\\begin{aligned}\n\\mathrm{E}\\left[\\left.\\frac{A_{+}(P, z)}{V(L)} \\right\\rvert\\, \\tau\\right]= & -e^{\\frac{f}{2}}+\\frac{1}{2}\\left(e^{f}+1\\right) e^{\\frac{\\sigma^{2} z}{8}}-\\frac{1}{2} e^{f} e^{\\frac{\\sigma^{2} z}{8}} \\operatorname{erf}\\left(\\frac{\\sigma^{2} \\tau+2 f}{2 \\sqrt{2} \\sigma \\sqrt{\\tau}}\\right) \\\\\n& +\\frac{1}{2} e^{\\frac{\\sigma^{2} z}{8}} \\operatorname{erf}\\left(\\frac{\\sigma^{2} \\tau-2 f}{2 \\sqrt{2} \\sigma \\sqrt{\\tau}}\\right)+e^{\\frac{f}{2}} \\operatorname{erf}\\left(\\frac{f}{\\sigma \\sqrt{\\tau} \\sqrt{2}}\\right)\n\\end{aligned}\n$$\n\nTaking expectations over $\\tau \\sim \\operatorname{Exp}\\left(\\Delta t^{-1}\\right)$, assuming that $\\Delta t<8 \\sigma^{2}$,\n\n$$\n\\frac{1}{\\Delta t} \\mathrm{E}\\left[\\frac{A_{+}(P, z)}{V(L)}\\right]=\\frac{\\sigma^{2}}{8} \\exp \\left(-\\frac{f}{\\sigma \\sqrt{\\Delta t / 2}}\\right) \\frac{e^{+f / 2}}{2\\left(1-\\sigma^{2} \\Delta t / 8\\right)}\n$$\n\nSimilarly, for the other term,\n\n$$\n\\frac{1}{\\Delta t} \\mathrm{E}\\left[\\frac{A_{-}(P, z)}{V(L)}\\right]=\\frac{\\sigma^{2}}{8} \\exp \\left(-\\frac{f}{\\sigma \\sqrt{\\Delta t / 2}}\\right) \\frac{e^{-f / 2}}{2\\left(1-\\sigma^{2} \\Delta t / 8\\right)}\n$$\n\nCombining these results yields the arbitrageur excess expression in (3).\nDiscussion. The expressions (1) for arbitrageur profits and (3) for arb excess have an interesting common structure. In both cases, the expressions can be decomposed into the product of (1) the probability that an arbitrageur can trade at the next block time; and (2) the expected profit conditioned on trade. In the arbitrageur profits expression, the probability of trade is given by\n\n$$\n\\frac{1}{1+\\frac{f}{\\sigma \\sqrt{\\Delta t / 2}}}\n$$\n\nwhile in the arbitrageur excess expression, it is given by\n\n$$\n\\exp \\left(-\\frac{f}{\\sigma \\sqrt{\\Delta t / 2}}\\right)\n$$\n\nIn both cases, however, the expected profit conditioned on trade is the same. Thus, the fact that arbitrageur excess is less than arbitrageur profits is driven by the fact that the probability of trade is (exponentially) less. This, in turn, is because the pool operator drives the mispricing to zero at the end of every block, making large mispricings at the beginning of the next block unlikely.",
      "tables": {},
      "images": {}
    },
    {
      "section_id": 7,
      "text": "# 5. Discussion \n\nAdvantages. One desirable characteristic of the auction-managed AMM is that it shifts the strategic burden of determining the optimal fee from passive LPs to the pool manager, who, in turn will set the fee according to (4), which seeks to set fees to optimize revenue from noise traders, adjusted by arb excess paid to arbitraguers. This makes sense, since the pool manager is assumed to be a more sophisticated entity that can perform off-chain modeling and analysis to estimate noise trader sensitivity and losses to arbs.\n\nOur model captures the most visible and salient features that drive noise trader demand (the fee and the liquidity). However, as argued by Milionis et al. (2023) and Rao and Shah (2023), noise traders may also be concerned with the accuracy of prices in the pool. Relative to an outside reference price (e.g., the price on infinitely deep centralized exchange), noise traders pay an effective spread which is the sum of the trading fee of the pool (deterministic, positive) and the relative mispricing of the pool (stochastic, could be positive or negative). In general noise traders will prefer pools with less relative mispricing. An additional benefit of the am-AMM over the ff-AMM is that the quoted prices are more accurate. This is because the pool operator of an am-AMM faces no fees in performing arbitrage trades against the pool, and is able to correct smaller price discrepancies.\n\nThere is also an important transfer of risk between the LPs and the pool manager: in the am-AMM, the LPs earn rent payments instead of noise trader fees. Since these rent payments are determined ex ante, in equilibrium, they incorporate the expected value of future noise trader fee revenue, in contrast to the actual noise trader fee revenue, which arrives in a lumpy and stochastic fashion and goes to the pool manager. Although it is beyond the scope of the analysis we have presented (which assumes risk neutrality), this risk transfer is likely welfare improving since the pool manager is likely a larger and better capitalized entity than a typical passive LP, and is thus less risk averse.\nDrawbacks. The auction-managed AMM is not without drawbacks. First, the pool manager's ability to effectively trade on the pool with zero spread exacerbates the \"sandwich attack\" problem with onchain AMMs, as discussed generally by Daian et al. (2020); Zhou et al. (2021); Adams et al. (2023a). A party that can trade with zero fees can profit by pushing any publicly visible swap transaction to its limit price. This is a meaningful drawback - which could hurt swappers or ultimately discourage retail flow, thus potentially invalidating the assumption in Section 3 that retail flow is only a function of liquidity and fee - but known mitigations for general sandwich attacks could be applied, such as verifiable sequencing rules (Ferreira and Parkes, 2022), private\n\nrelays (Adams et al., 2023a), or offchain filler auctions (Adams et al., 2023c).\nSecond, the ex ante auction for the arbitrage opportunity could have effects on the market for block building. The pool manager's exclusive right to capture some arbitrage profit from a pool could give them an advantage in the block builder auction, similar to the advantages enjoyed by builders with private orderflow discussed by Gupta et al. (2023). Additionally, while the am-AMM allows any party to bid on the pool manager position, parties with greater sophistication or access to private orderflow may be more likely to win the auction. On the other hand, by capturing some arbitrage profit and reducing the power of block proposers, the am-AMM could mitigate some of the harmful pressures that MEV puts on the blockchain consensus mechanism. We think these possible consequences warrant further study.\n\nLastly, one disadvantage of the am-AMM over the McAMM discussed by Herrmann (2022) is that the current manager does not capture the \"arbitrage excess\" that results from single-block price movements beyond the no-trade region, as discussed in Section 3. This creates an incentive for the manager to set a higher fee than the one that optimizes total fee revenue. This could be fixed by requiring the manager to unlock the pool at every block, at the cost of sacrificing the accessibility property.\n\nFuture work. In this paper, we focus on constant product market makers. Extending this design to other AMMs - and particularly to concentrated liquidity AMMs, in which different liquidity providers may have different returns during the same period and may go in or out of range as a result of price changes - is left for future work.\n\nImplementing this mechanism is also left for future work. Since we first made this paper available, there has been at least one open-source third-party implementation BidDog (2024).",
      "tables": {},
      "images": {}
    },
    {
      "section_id": 8,
      "text": "# References \n\nAustin Adams, Benjamin Y Chan, Sarit Markovich, and Xin Wan. 2023a. The Costs of Swapping on the Uniswap Protocol. arXiv preprint arXiv:2309.13648 (2023).\n\nHayden Adams, Moody Salem, Noah Zinsmeister, Sara Reynolds, Austin Adams, Will Pote, Mark Toda, Alice Henshaw, Emily Williams, and Dan Robinson. 2023b. Uniswap v4 Core [Draft]. https://github.com/Uniswap/v4-core/blob/main/docs/whitepaper-v4.pdf\n\nHayden Adams, Noah Zinsmeister, and Dan Robinson. 2020. Uniswap v2 Core. Retrieved Jun 12, 2023 from https://uniswap.org/whitepaper.pdf\n\nHayden Adams, Noah Zinsmeister, Moody Salem, River Keefer, and Dan Robinson. 2021. Uniswap v3 Core. Retrieved Jun 12, 2023 from https://uniswap.org/whitepaper-v3.pdf\n\nHayden Adams, Noah Zinsmeister, Mark Toda, Emily Williams, Xin Wan, Matteo Leibowitz, Will Pote, Allen Lin, Eric Zhong, Zhiyuan Yang, Riley Campbell, Alex Karys, and Dan Robinson. 2023c. UniswapX. https://uniswap.org/whitepaper-uniswapx.pdf\n\nGuillermo Angeris and Tarun Chitra. 2020. Improved price oracles: Constant function market makers. In Proceedings of the 2nd ACM Conference on Advances in Financial Technologies. 80-91.\n\nGuillermo Angeris, Hsien-Tang Kao, Rei Chiang, Charlie Noyes, and Tarun Chitra. 2019. An analysis of Uniswap markets. arXiv preprint arXiv:1911.03380 (2019).\n\nBidDog. 2024. BidDog: Open source implementation of am-AMM auctions. https://github.com/Bunniapp/biddog Accessed: 2024-05-22.\n\nAnton Bukov and Mikhail Melnik. 2020. Mooniswap by 1inch.exchange. Retrieved Sept 18, 2023 from https://mooniswap.exchange/docs/MooniswapWhitePaper-v1.0.pdf\n\nAgostino Capponi and Ruizhe Jia. 2021. The adoption of blockchain-based decentralized exchanges. arXiv preprint arXiv:2103.08842 (2021).\n\n\u00c1lvaro Cartea, Fay\u00e7al Drissi, Leandro S\u00e1nchez-Betancourt, David Siska, and Lukasz Szpruch. 2023. Automated market makers designs beyond constant functions. Available at SSRN 4459177 (2023).\n\nPhilip Daian, Steven Goldfeder, Tyler Kell, Yunqi Li, Xueyuan Zhao, Iddo Bentov, Lorenz Breidenbach, and Ari Juels. 2020. Flash boys 2.0: Frontrunning in decentralized exchanges, miner extractable value, and consensus instability. In 2020 IEEE Symposium on Security and Privacy (SP). IEEE, 910-927.\n\nMichael Egorov and Curve Finance (Swiss Stake GmbH). 2021. Automatic market-making with dynamic peg. Retrieved Sept 18, 2023 from https://classic.curve.fi/files/crypto-pools-paper.pdf\n\nMatheus VX Ferreira and David C Parkes. 2022. Credible decentralized exchange design via verifiable sequencing rules. arXiv preprint arXiv:2209.15569 (2022).\n\nTivas Gupta, Mallesh M Pai, and Max Resnick. 2023. The centralizing effects of private order flow on proposer-builder separation. arXiv preprint arXiv:2305.19150 (2023).\n\nRobin Hanson. 2007. Logarithmic markets coring rules for modular combinatorial information aggregation. The Journal of Prediction Markets 1, 1 (2007), 3-15.\n\nJoel Hasbrouck, Thomas J Rivera, and Fahad Saleh. 2022. The need for fees at a dex: How increases in fees can increase dex trading volume. Available at $S S R N$ (2022).\n\nJoel Hasbrouck, Thomas J. Rivera, and Fahad Saleh. 2023. An Economic Model of a Decentralized Exchange with Concentrated Liquidity. (2023). Working paper.\n\nAlex Herrmann. 2022. MEV capturing AMM (McAMM). Retrieved Sept 18, 2023 from https://ethresear.ch/t/mev-capturing-amm-mcamm/13336\n\nAlfred Lehar and Christine A Parlour. 2021. Decentralized exchanges. Available at SSRN 3905316 (2021).\nJulian Ma and Davide Crapis. 2024. The Cost of Permissionless Liquidity Provision in Automated Market Makers. arXiv preprint arXiv:2402.18256 (2024).\n\nJason Milionis, Ciamac C Moallemi, and Tim Roughgarden. 2023. Automated Market Making and Arbitrage Profits in the Presence of Fees. arXiv preprint arXiv:2305.14604 (2023).\n\nJason Milionis, Ciamac C. Moallemi, Tim Roughgarden, and Anthony Lee Zhang. 2022. Automated Market Making and Loss-Versus-Rebalancing. https://doi.org/10.48550/ARXIV.2208.06046\n\nMountainFarmer, Louis, Hanzo, Wawa, Murloc, and Fish. 2022. JOE v2.1 Liquidity Book. Retrieved Sept 18, 2023 from https://github.com/traderjoe-xyz/LB-Whitepaper/blob/main/Joe\\ v2\\ Liquidity\\ Book\\ Whitep\n\nAlex Nezlobin. 2023. Twitter thread. Retrieved Dec 3, 2023 from https://twitter.com/0x94305/status/1674857993740111872\n\nAbraham Othman, David M Pennock, Daniel M Reeves, and Tuomas Sandholm. 2013. A practical liquiditysensitive automated market maker. ACM Transactions on Economics and Computation (TEAC) 1, 3 (2013), 1-25.\n\nEric A. Posner and E. Glen Weyl. 2018. Radical Markets: Uprooting Capitalism and Democracy for a Just Society. Princeton University Press, Princeton, NJ.\n\nRithvik Rao and Nihar Shah. 2023. Triangle Fees. arXiv:2306.17316 [q-fin.MF]\nLiyi Zhou, Kaihua Qin, Christof Ferreira Torres, Duc V Le, and Arthur Gervais. 2021. High-frequency trading on decentralized on-chain exchanges. In 2021 IEEE Symposium on Security and Privacy (SP). IEEE, $428-445$.",
      "tables": {},
      "images": {}
    },
    {
      "section_id": 9,
      "text": "# A. Proofs \n\nProof of Lemma 1. Given fixed $f \\in\\left[0, f_{\\max }\\right]$, define $G(L) \\triangleq f H_{0}(f, L)-\\mathrm{AP}_{0}(f)-r$. By Assumption 1(2) and Assumption 2, this is a continuous function, and\n\n$$\n\\lim _{L \\rightarrow 0} G(L)=\\infty, \\quad \\lim _{L \\rightarrow \\infty} G(L)=-\\mathrm{AP}_{0}(f)-r<0\n$$\n\nBy the intermediate value theorem, there exists $L^{*}>0$ with $G\\left(L^{*}\\right)=0$, comparing with (2), this must be an equilibrium. This equilibrium is unique since $G(\\cdot)$ is strictly monotonic.\n\nProof of Theorem 1. First, we will prove that the equilibrium $\\left(R^{*}, L^{*}\\right)$ exists. Solving for $R^{*}$ in the condition $\\Pi_{\\mathrm{am}}^{\\mathrm{MGR}}\\left(R^{*}, L^{*}\\right)=0$ and substituting into $\\Pi_{\\mathrm{am}}^{\\mathrm{LP}}\\left(R^{*}, L^{*}\\right)=0$, we have that $L^{*}$ must satisfy $G\\left(L^{*}\\right)=0$ where\n\n$$\nG(L) \\triangleq \\max _{f \\in\\left[0, f_{\\max }\\right]} f H_{0}(f, L)-\\mathrm{AE}_{0}(f)-r\n$$\n\nFrom Assumption 1 and Assumption 2, this function is continuous, and\n\n$$\n\\begin{gathered}\n\\lim _{L \\rightarrow \\infty} G(L)=\\max _{f \\in\\left[0, f_{\\max }\\right]}-\\mathrm{AE}_{0}(f)-r=-\\mathrm{AE}_{0}(0)-r<0 \\\\\n\\lim _{L \\rightarrow 0} G(L) \\geq \\lim _{L \\rightarrow 0} f H_{0}(f, L)-\\mathrm{AE}_{0}(f)-r=\\infty>0\n\\end{gathered}\n$$\n\nfor any $f \\in\\left(0, f_{\\max }\\right]$. By the intermediate value theorem, an equilibrium $\\left(R^{*}, L^{*}\\right)$ must exist.\nIn order to compare with the ff-AMM, define\n\n$$\nL_{\\max } \\triangleq \\max _{f \\in\\left[0, f_{\\max }\\right]} L_{\\mathrm{ff}}(f)\n$$\n\nto be the maximum level of liquidity that can be achieved in the ff-AMM, and denote by $f^{*}$ the maximizing fee. Define\n\n$$\nR_{\\max } \\triangleq\\left(\\mathrm{AP}_{0}(0)+r\\right) V\\left(L_{\\max }\\right)\n$$\n\nFrom the zero profit condition $\\Pi_{\\mathrm{am}}^{\\mathrm{LP}}\\left(R_{\\max }, L_{\\max }\\right)=0$, it is clear that a rent payment of $R_{\\max }$ will\n\nincentivize liquidity $L_{\\max }$. Under such a rent payment, the pool manager earns profits\n\n$$\n\\begin{aligned}\n\\Pi_{\\mathrm{am}}^{\\mathrm{MGR}}\\left(R_{\\max }, L_{\\max }\\right) & =\\left(\\mathrm{AP}_{0}(0)+\\max _{f \\in\\left[0, f_{\\max }\\right]} f H_{0}\\left(f, L_{\\max }\\right)-\\mathrm{AE}_{0}(f)\\right) V\\left(L_{\\max }\\right)-R_{\\max } \\\\\n& \\geq\\left(\\mathrm{AP}_{0}(0)+f^{*} H_{0}\\left(f^{*}, L_{\\max }\\right)-\\mathrm{AE}_{0}\\left(f^{*}\\right)\\right) V\\left(L_{\\max }\\right)-R_{\\max } \\\\\n& =\\left(\\mathrm{AP}_{0}(0)+\\mathrm{AP}_{0}\\left(f^{*}\\right)+r-\\mathrm{AE}_{0}\\left(f^{*}\\right)\\right) V\\left(L_{\\max }\\right)-R_{\\max } \\\\\n& =\\left(\\mathrm{AP}_{0}(0)+\\mathrm{AP}_{0}\\left(f^{*}\\right)+r-\\mathrm{AE}_{0}\\left(f^{*}\\right)\\right) V\\left(L_{\\max }\\right)-\\left(\\mathrm{AP}_{0}(0)+r\\right) V\\left(L_{\\max }\\right) \\\\\n& =\\left(\\mathrm{AP}_{0}\\left(f^{*}\\right)-\\mathrm{AE}_{0}\\left(f^{*}\\right)\\right) V\\left(L_{\\max }\\right) \\\\\n& >0\n\\end{aligned}\n$$\n\nHere, the first inequality follows from the suboptimality of $f^{*}$ for the am-AMM, and we also use the fact that $\\Pi_{0}^{L^{p}}\\left(f^{*}, L_{\\max }\\right)=0$ since it is an equilibrium for the ff-AMM. The last equality follows from Assumption 3.\n\nSince the pool manager earns positive profits when the rent is $R_{\\max }$, and equilibrium rent $R^{*}$ musty satisfy $R^{*}>R_{\\max }$, therefore and equilibrium fee-auction AMM utility $L^{*}>L_{\\max }$.",
      "tables": {},
      "images": {}
    },
    {
      "section_id": 10,
      "text": "# B. Withdrawal Fees \n\nHere, we show that a withdrawal fee of $1-\\frac{2 \\sqrt{f_{\\text {cap }}}}{f_{\\text {cap }}+1}$ is sufficient to protect managers from strategic liquidity withdrawals. With a fee cap of $1 \\%$, this comes out to approximately $0.00001238 \\%$, or about 0.1238 basis points - a $\\$ 12.38$ fee on a $\\$ 1$ million position.\n\nOur goal is to set a withdrawal fee to prevent opportunistic withdrawals of liquidity (in response to arbitrage opportunities) from reducing manager profits. Under our assumptions, the manager's profit from a given arbitrage opportunity is capped once the price moves by $f_{\\text {cap }}$, the maximum allowable swap fee. Any larger price move results in MEV for the block proposer (since any arbitrageur can capture the excess portion with a swap), rather than profit for the manager. Therefore, we only need to set a withdrawal fee that is greater than the value from arbing that liquidity in response to an increase of a factor of $f_{\\text {cap }}$. (A decrease by a factor of $f_{\\text {cap }}$ will result in a smaller arbitrage opportunity.)\n\nFor this proof, we use the same conventions as Section 3, where reserves are expressed in terms of two assets $x$ and $y$, asset $y$ is defined as the num\u00e9raire for all prices and valuations, and \"liquidity\" for a position is defined as $\\sqrt{x y}$ where $x$ and $y$ are the position's reserves of assets $x$ and $y$, respectively.\n\nSuppose without loss of generality that a liquidity provider is providing 1 unit of liquidity, and the current midpoint price on the AMM is $p_{\\text {amm }}$. Since $p_{\\text {amm }}=\\frac{y_{\\text {now }}}{x_{\\text {now }}}$ and $x_{\\text {now }} \\cdot y_{\\text {now }}=1$, the liquidity provider's current reserves of assets X and Y are $x_{\\text {now }}=\\frac{1}{\\sqrt{p_{\\text {amm }}}}$ and $y_{\\text {now }}=\\sqrt{p_{\\text {amm }}}$.\n\nWe suppose price has increased by $f_{\\text {cap }}$, making the true price $p_{\\text {true }}=f_{\\text {cap }} \\cdot p_{\\text {amm }}$.\nThe current valuation of the liquidity is:\n\n$$\nv_{\\text {now }}=p_{\\text {true }} \\cdot x_{\\text {now }}+y_{\\text {now }}=f_{\\text {cap }} \\cdot p_{\\text {amm }} \\cdot \\frac{1}{\\sqrt{p_{\\text {amm }}}}+\\sqrt{p_{\\text {amm }}}=\\left(1+f_{\\text {cap }}\\right) \\cdot \\sqrt{p_{\\text {amm }}}\n$$\n\nThe valuation of the liquidity after the manager arbitrages the pool to $p_{\\text {true }}\\left(f_{\\text {cap }} \\cdot p_{\\text {amm }}\\right)$ would be:\n\n$$\nv_{\\text {after }}=f_{\\text {cap }} \\cdot p_{\\text {amm }} \\cdot \\frac{1}{\\sqrt{f_{\\text {cap }} \\cdot p_{\\text {amm }}}}+\\sqrt{f_{\\text {cap }} \\cdot p_{\\text {amm }}}=2 \\cdot \\sqrt{f_{\\text {cap }} \\cdot p_{\\text {amm }}}\n$$\n\nTo prevent strategic withdrawal from being profitable for liquidity providers at the expense of managers, we can impose a withdrawal fee of $\\frac{v_{\\text {now }}-v_{\\text {after }}}{v_{\\text {now }}}$, which simplifies to:\n\n$$\nf_{\\text {withdrawal }}=\\frac{v_{\\text {now }}-v_{\\text {after }}}{v_{\\text {now }}}=1-\\frac{2 \\cdot \\sqrt{f_{\\text {cap }}}}{1+f_{\\text {cap }}}\n$$",
      "tables": {},
      "images": {}
    }
  ],
  "id": "2403.03367v4",
  "authors": [
    "Austin Adams",
    "Ciamac C. Moallemi",
    "Sara Reynolds",
    "Dan Robinson"
  ],
  "categories": [
    "q-fin.TR",
    "cs.GT",
    "math.OC",
    "q-fin.MF"
  ],
  "abstract": "Automated market makers (AMMs) have emerged as the dominant market mechanism\nfor trading on decentralized exchanges implemented on blockchains. This paper\npresents a single mechanism that targets two important unsolved problems for\nAMMs: reducing losses to informed orderflow, and maximizing revenue from\nuninformed orderflow. The ``auction-managed AMM'' works by running a\ncensorship-resistant onchain auction for the right to temporarily act as ``pool\nmanager'' for a constant-product AMM. The pool manager sets the swap fee rate\non the pool, and also receives the accrued fees from swaps. The pool manager\ncan exclusively capture some arbitrage by trading against the pool in response\nto small price movements, and also can set swap fees incorporating price\nsensitivity of retail orderflow and adapting to changing market conditions,\nwith the benefits from both ultimately accruing to liquidity providers.\nLiquidity providers can enter and exit the pool freely in response to changing\nrent, though they must pay a small fee on withdrawal. We prove that under\ncertain assumptions, this AMM should have higher liquidity in equilibrium than\nany standard, fixed-fee AMM.",
  "updated": "2025-02-12T17:16:51Z",
  "published": "2024-03-05T23:28:50Z"
}