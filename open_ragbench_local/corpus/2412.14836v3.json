{"title": "Sparse induced subgraphs in $P_7$-free graphs of bounded clique number", "sections": [{"section_id": 0, "text": "## Abstract\n\nMany natural computational problems, including e.g. Max Weight Independent Set, Feedback Vertex Set, or Vertex Planarization, can be unified under an umbrella of finding the largest sparse induced subgraph, that satisfies some property definable in $\\mathrm{CMSO}_{2}$ logic. It is believed that each problem expressible with this formalism can be solved in polynomial time in graphs that exclude a fixed path as an induced subgraph. This belief is supported by the existence of a quasipolynomial-time algorithm by Gartland, Lokshtanov, Pilipczuk, Pilipczuk, and Rz\u0105\u017cewski [STOC 2021], and a recent polynomial-time algorithm for $P_{6}$-free graphs by Chudnovsky, McCarty, Pilipczuk, Pilipczuk, and Rz\u0105\u017cewski [SODA 2024].\n\nIn this work we extend polynomial-time tractability of all such problems to $P_{7}$-free graphs of bounded clique number.", "tables": {}, "images": {}}, {"section_id": 1, "text": "## 1 Introduction\n\nWhen studying computationally hard problems, a natural question to investigate is whether they become tractable when input instances are somehow \"well-structured\". In particular, in algorithmic graph theory, we often study the complexity of certain (hard in general) problems, when restricted to specific graph classes. Significant attention is given to classes that are hereditary, i.e., closed under vertex deletion.\n\nPotential maximal cliques. Arguably, the problem that is best studied in this context is Max Weight Independent Set (MWIS) in which we are given a vertex-weighted graph and we ask for a set of pairwise non-adjacent vertices of maximum possible weight. Investigating the complexity of MWIS in restricted graphs classes led to discovering numerous new tools and techniques in algorithmic graph theory $[24,21,18,16]$. One of such general techniques is the framework of potential maximal cliques by Bouchitt\u00e9 and Todinca [7, 8]. Intuitively speaking, a potential maximal clique (or PMC for short) in a graph $G$ is a bag of a \"reasonable\" tree decomposition of $G$ (see Section 2 for a formal definition). The key contribution of Bouchitt\u00e9 and Todinca [7, 8] is showing that:\n\n1. the family $\\mathcal{F}$ of PMCs in a graph $G$ can be enumerated in time polynomial in $|V(G)|$ and $|\\mathcal{F}|$, and\n[^0]\n[^0]:    ${ }^{\\dagger}$ Princeton University, United States Of America (mchudnov@math.princeton.edu). Supported by NSF Grant DMS-2348219 and by AFOSR grant FA9550-22-1-0083.\n    ${ }^{\\dagger}$ University of Warsaw, Poland (j. czyzewska@mimuw.edu.pl). Supported by Polish National Science Centre SONATA BIS-12 grant number 2022/46/E/ST6/00143.\n    ${ }^{\\ddagger}$ University of Warsaw, Poland (k.kluk@mimuw.edu.pl). Supported by Polish National Science Centre SONATA BIS-12 grant number 2022/46/E/ST6/00143.\n    ${ }^{\\text {S }}$ University of Warsaw, Poland (m.pilipczuk@mimuw.edu.pl). Supported by Polish National Science Centre SONATA BIS-12 grant number 2022/46/E/ST6/00143.\n    ${ }^{\\text {W }}$ Warsaw University of Technology \\& University of Warsaw, Poland (pawe\u0142.rzazewski@pw.edu.pl). Supported by the European Research Council (ERC) under the European Union's Horizon 2020 research and innovation programme grant agreement number 948057 .\n\n2. given a family $\\mathcal{F}$ containing all PMCs of $G$ (and possibly some other sets as well), MWIS can be solved in time polynomial in $|V(G)|$ and $|\\mathcal{F}|$ by mimicking natural dynamic programming on an appropriate (but unknown) tree decomposition.\n\nConsequently, MWIS admits a polynomial-time algorithm when restricted to any class with polynomially many PMCs. (Here we say that a class $\\mathcal{X}$ of graphs has polynomially many PMCs if there exists a polynomial $\\mathrm{p}$, such that the number of PMCs in any $n$-vertex graph in $\\mathcal{X}$ is at most $\\mathrm{p}(n)$.)\n\nLater this framework was extended by Fomin, Todinca, and Villanger [19] to the problem of finding a large \"sparse\" (here meaning: of bounded treewidth) induced subgraph satisfying certain $\\mathrm{CMSO}_{2}$ formula $\\psi$. ( $\\mathrm{CMSO}_{2}$ stands for Counting Monadic Second Order logic, which is a logic where one can use vertex/edge variables, vertex/edge set variables, quantifications over these variables, and standard propositional operands.) Formally, for a given integer $d$ and a fixed $\\mathrm{CMSO}_{2}$ formula $\\psi$ with one free set variable, the (tw $\\leq d, \\psi$ )-MWIS problem (here 'MWIS' stands for 'max weight induced subgraph') is defined as follows.\n$($ tw $\\leq d, \\psi)$-MWIS\nInput: A graph $G$ equipped with a weight function $\\mathfrak{w}: V(G) \\rightarrow \\mathbb{Q}_{+}$.\nTask: Find a pair $(\\mathrm{Sol}, X)$ such that\n\n- $X \\subseteq$ Sol $\\subseteq V(G)$,\n- $G[$ Sol $]$ is of treewidth at most $d$,\n- $G[$ Sol $]=\\psi(X)$,\n- $X$ is of maximum weight subject to the conditions above, or conclude that no such pair exists.\n\nAs shown by Fomin, Todinca, and Villanger [19], every problem expressible in this formalism can be solved in polynomial time on classes of graphs with polynomially many potential maximal cliques.\n\nNote that if $d=0$ and $\\psi$ is a formula satisfied by all sets, then (tw $\\leq d, \\psi$ )-MWIS is exactly MWIS. It turns out that (tw $\\leq d, \\psi$ )-MWIS captures several other well known computational problems (see also the discussion in $[19,30]$ ), e.g.;\n\n- Feedback Vertex Set (one of Karp's original 21 NP-complete problems [28]), equivalent by complementation to finding an induced forest of maximum weight,\n- Even Cycle Transversal [35, 34, 2], equivalent by complementation to finding an induced graph whose every block is an odd cycle,\n- finding a largest weight induced subgraph whose every component is a cycle,\n- finding a maximum number of pairwise disjoint and non-adjacent induced cycles.\n\nMWIS in graphs excluding a long induced path. Despite all advantages of the Bouchitt\u00e9-Todinca framework, its applicability is somehow limited, as there are numerous natural hereditary graphs classes that do not have polynomially many PMCs. Can we use at least some parts of the framework outside its natural habitat?\n\nA notorious open question in algorithmic graph theory is whether MWIS (and, more generally, (tw $\\leq d, \\psi$ )-MWIS) can be solved in polynomial time in graphs that exclude a fixed path as an induced subgraph. It is believed that this question has an affirmative answer, which is supported by the existence of a quasipolynomial-time algorithm of Gartland, Lokshtanov, Pilipczuk, Pilipczuk, and Rz\u0105\u017cewski [20, 37, 22]. However, if it comes to polynomial-time algorithms, we know much less.\n\nA polynomial-time algorithm for MWIS (as well as for many other problems) in $P_{4}$-free graphs (i.e., graphs that exclude a 4 -vertex path as an induced subgraph; analogously we define $P_{1}$-free graphs for any $t$ ), was discovered already in 1980s [14]. In today's terms we would say that these graphs have bounded clique-width and thus polynomial-time algorithms for many natural problems, including (tw $\\leq d, \\psi$ )-MWIS, follow from a celebrated theorem by Courcelle, Makowsky, and Rotics [15]. However, already the $P_{5}$-free case proved to be quite challenging. In 2014, Lokshtanov, Vatshelle, and Villanger [31] showed that Max Weight Independent Set admits a polynomial-time algorithm in $P_{5}$-free graphs - by adapting the framework of Bouchitt\u00e9 and Todinca. Let us emphasize that $P_{5}$-free graphs might have exponentially many PMCs, so the approach discussed above cannot be applied directly. Instead, Lokshtanov, Vatshelle, and Villanger proved that in polynomial time one can enumerate a family of some PMCs, and this family is sufficient to solve MWIS via dynamic programming.\n\nBy extending this method (and adding a significant layer of technical complicacy), Grzesik, Klimo\u0161ov\u00e1, Pilipczuk, and Pilipczuk [23] managed to show that MWIS is polynomially-solvable in $P_{6}$-free graphs.\n\nSome time later, Abrishami, Chudnovsky, Pilipczuk, Rz\u0105\u017cewski, and Seymour [1] revisited the $P_{5^{-}}$ free case and introduced major twist to the method: they proved that in order to solve MWIS and its generalizations, one does not have to have PMCs exactly, but it is sufficient to enumerate their containers: supersets that do not introduce any new vertices of the (unknown) optimum solution. They also proved that containers for all PMCs in $P_{5}$-free graphs can be enumerated in polynomial time, circumventing the problem of exponentially many PMCs and significantly simplifying the approach of Lokshtanov, Vatshelle, and Villanger [31]. This result yields a polynomial-time algorithm for (tw $\\leq$ $d, \\psi)$-MWIS in $P_{5}$-free graphs.\n\nBy further relaxing the notion of a container (to a carver), Chudnovsky, McCarty, Pilipczuk, Pilipczuk, and Rz\u0105\u017cewski [13] managed to extend polynomial-time solvability of (tw $\\leq d, \\psi$ )-MWIS to the class of $P_{6}$-free graphs.\n\nOur contribution. In this work we push the boundary of tractability of (tw $\\leq d, \\psi$ )-MWIS in $P_{1^{-}}$ free graphs by showing the following result.\nTheorem 1.1. For every fixed integers $d, k$, and a $\\mathrm{CMSO}_{2}$ formula $\\psi$, the (tw $\\leq d, \\psi$ )-MWIS problem can be solved in polynomial time in $P_{1}$-free graphs with clique number at most $k$.\n\nQuite interestingly, in $P_{1}$-free graphs, the boundedness of treewidth is equivalent to the boundedness of degeneracy and to the boundedness of treedepth [4] (see also Section 2). Thus, Theorem 1.1 yields a polynomial-time algorithm for problems like:\n\n- Vertex Planarization [27, 36], which asks for a largest induced planar subgraph, or\n- for constant $k$, finding a largest set of vertices inducing a subgraph of maximum degree at most $k$ (see, e.g., [26]).\nLet us remark that the idea of investigating $P_{1}$-free graphs of bounded clique number was considered before. Brettel, Horsfield, Munaro, and Paulusma [11] showed that $P_{5}$-free graphs of bounded clique number (actually, a superclass of these graphs) have bounded mim-width, which gives a uniform approach to solve many classic problems in this class of graphs [3]. Pilipczuk and Rz\u0105\u017cewski [38] showed that $P_{6}$-free graphs of bounded clique number have polynomially many PMCs and thus the framework of Bouchitt\u00e9 and Todinca can be applied here directly. However, this is no longer true for $P_{1}$-free graphs (even bipartite). On the other hand, Brandst\u00e4dt and Mosca [9] provided a polynomialtime algorithm for MWIS in $P_{7}$-free triangle-free graphs. However, they used a rather ad-hoc approach that works well for MWIS, but gives little hope to generalize it to more complicated instances of (tw $\\leq d, \\psi$ )-MWIS. Our work vastly extends the latter two results.", "tables": {}, "images": {}}, {"section_id": 2, "text": "# 1.1 Technical overview \n\nAs mentioned, in $P_{1}$-free graphs the width parameters treewidth, treedepth, and degeneracy are functionally equivalent [4]. Furthermore, as discussed in [13], the property of having treewidth, treedepth,\n\nor degeneracy at most $d$ can be expressed as a $\\mathrm{CMSO}_{2}$ formula of size depending on $d$ only. Consequently, if we define problems $(\\operatorname{td} \\leq d, \\psi)$-MWIS and $(\\operatorname{deg} \\leq d, \\psi)$-MWIS analogously as (tw $\\leq d, \\psi$ )MWIS, but with respect to treedepth and degeneracy, these three formalisms describe the same family of problems, when restricted to $P_{t}$-free graphs.\n\nFollowing [13], the treedepth formalism is the most handy; we henceforth work with (td $\\leq$ $d, \\psi)$-MWIS. Furthermore, it is more convenient to work not just with induced subgraphs of bounded treedepth, but with treedepth-d structures: induced subgraphs of treedepth at most $d$ with a fixed elimination forest; formal definition can be found in Section 2.\n\nLet $\\mathcal{T}$ be a treedepth- $d$ structure in $G$; think of $\\mathcal{T}$ as the sought solution to the $(\\operatorname{td} \\leq d, \\psi)$-MWIS problem in question. As proven in [19] (and cast onto the current setting in [13]), there exists a tree decomposition $(T, \\beta)$ of $G$ whose every bag is either contained in $N[v]$ for a leaf $v$ of $\\mathcal{T}$, or whose intersection with $\\mathcal{T}$ is contained in a single root-to-leaf path of $\\mathcal{T}$, excluding the leaf. We call the latter bags $\\mathcal{T}$-avoiding.\n\nFurthermore, the framework of [19] shows how to solve $(\\operatorname{td} \\leq d, \\psi)$-MWIS given a family $\\mathcal{F}$ of subsets of $V(G)$ with the promise that all bags of such tree decomposition $(T, \\beta)$ are in $\\mathcal{F}$. In [1], it is shown that it suffices for $\\mathcal{F}$ to contain only containers of bounded defect for bags in $(T, \\beta)$ : we require that there exists a universal constant $\\bar{d}$ such that for every $t \\in V(T)$ there exists $A \\in \\mathcal{F}$ such that the bag $\\beta(t)$ is contained in $A$ and $A$ contains at most $\\bar{d}$ elements of $\\mathcal{T}$.\n\nNote that if $v$ is a leaf of $\\mathcal{T}$, then $N[v]$ may contain only ancestors of $v$ among the vertices of $\\mathcal{T}$, so $N[v]$ is an excellent container for any bag contained in $N[v]$. Thus, it suffices to provide containers for $\\mathcal{T}$-avoiding bags. This is how [1] solved $(\\operatorname{td} \\leq d, \\psi)$-MWIS in $P_{5}$-free graphs; by generalizing the definition of a container to a carver, the same approach is applied to $P_{6}$-free graphs in [13].\n\nIn fact, for a treedepth- $d$ structure $\\mathcal{T}$, the tree decomposition $(T, \\beta)$ of [19] is constructed as follows: it is shown that there exists a minimal chordal completion $F$ of $G$ (i.e., an inclusion-wise minimal set of edges to add to $G$ to make it chordal) whose addition keeps $\\mathcal{T}$ a treedepth- $d$ structure, and $(T, \\beta)$ is any clique tree of $G+F$. A potential maximal clique (PMC for short) is a maximal clique in $G+F$ for some minimal chordal completion $F$ of $G$. Both [1] and [13] actually provide containers/carvers for every treedepth- $d$ structure in $G$ and an arbitrary choice of a $\\mathcal{T}$-avoiding PMC in $G$. Furthermore, [13] provides an example of a family of $P_{7}$-free triangle-free graphs where such a statement is impossible (i.e., any such family of containers/carvers would need to be of exponential size).\n\nHowever, the algorithmic framework of $[19,1,13]$ requires only that the provided family $\\mathcal{F}$ contains containers/carvers for all bags of only one \"good\" tree decomposition $(T, \\beta)$, and only for the sought solution $\\mathcal{T}$. This should be contrasted with all $\\mathcal{T}$-avoiding PMCs, which is in some sense the set of all reasonable $\\mathcal{T}$-avoiding bags, and for all treedepth- $d$ structures $\\mathcal{T}$. Thus, if we want to tackle $P_{7}$-free graphs of bounded clique number, we need to significantly deviate from the path of $[1,13]$ and either use the power of the choice of $(T, \\beta)$ or the fact that we need to handle only $\\mathcal{T}$ being the optimum solution to the problem we are solving.\n\nThe assumption of bounded clique number allows us to quickly reduce the case of finding a container for a PMC to finding a container for a minimal separator. For a set $S \\subseteq V(G)$, a connected component $A$ of $G-S$ is full to $S$ if $N(A)=S$; a set $S$ is a minimal separator if it has at least two full components. A classic fact about PMCs [8] is that for every potential maximal clique $\\Omega$ and for every connected component $D$ of $G-\\Omega$, the set $N(D)$ is a minimal separator. By a classic result of Gy\u00e1rf\u00e1s, the class of $P_{t}$-free graphs is $\\chi$-bounded, in particular, if $G$ is $P_{t}$-free and $\\omega(G) \\leq k$ (where $\\omega(G)$ is the number of vertices in a largest clique in $G$ ), then $\\chi(G) \\leq(t-1)^{k-1}$. This, combined with a VC-dimension argument based on the classic result of Ding, Seymour, and Winkler [17], shows the following:\n\nLemma 1.2. For every $t$ and $k$ there exists $c$ such that for every $P_{t}$-free graph $G$ with $\\omega(G) \\leq k$ and any PMC $\\Omega$ of $G$ one of the two following conditions hold:\n\n1. there exists $v \\in \\Omega$ such that $\\Omega=N[v]$, or\n2. there exists a family $\\mathcal{D} \\subseteq \\infty(G-\\Omega)$ of size at most $c$ such that $\\Omega=\\bigcup_{D \\in \\mathcal{D}} N(D)$.\n\nThat is, except for a simple case $N[v]=\\Omega$ for some $v \\in \\Omega$, the $\\mathrm{PMC} \\Omega$ is a union of a constant number of minimal separators. Hence, it suffices to generate a family $\\mathcal{F}^{\\prime}$ of containers for $\\mathcal{T}$-avoiding minimal separators (which are defined analogously to $\\mathcal{T}$-avoiding bags) and take $\\mathcal{F}$ to be the family of unions of all tuples of at most $c$ elements of $\\mathcal{F}^{\\prime}$.\n\nLet $G$ be a $P_{\\mathrm{T}}$-free graph with $\\omega(G) \\leq k$. We start as in [1,13]: let $\\mathcal{T}$ be an arbitrary treedepth- $d$ structure in $G$ and let $S$ be a minimal separator in $G$ with full components $A$ and $B$ such that $S$ is $\\mathcal{T}$-avoiding. We want to design a polynomial-time algorithm that outputs a family $\\mathcal{F}^{\\prime}$ of subsets of $V(G)$ that contains a container for $\\Omega$. The algorithm naturally does not know $\\mathcal{T}$ nor $S$; the convenient and natural way of describing the algorithm as performing some nondeterministic guesses about $\\mathcal{T}$ and $S$, with the goal of outputting a container for $S$ in the end. We succeed if the number of subcases coming from the guesses is polynomial in the size of $G$ and the family $\\mathcal{F}^{\\prime}$ consists of all containers generated by all possible runs of the algorithm.\n\nWe almost succeed with this quest in Section 3. That is, we are able to guess an \"almost container\" $K$ for $S: K$ contains a constant number of vertices of $\\mathcal{T}$ and we identified a set $\\mathcal{D}$ of tricky connected components of $G-K$ that are contained in $A \\cup B \\cup S$; all other connected components of $G-K$ are contained in $A$, in $B$, or in some other connected component of $G-S$. Every tricky component $D \\in \\mathcal{D}$ is somewhat simpler: we identify a subset $\\emptyset \\neq L(D) \\subsetneq D$ such that if $\\mathcal{C}(D)$ is the family of all connected components of $G[L(D)]$ and of $G[D \\backslash L(D)]$, then every $C \\in \\mathcal{C}(D)$ is a module of $G[D]$. (A set $A \\subseteq V(G)$ is a module in $G$ if every vertex $v \\in V(G) \\backslash A$ is either complete to $A$ or anti-complete to $A$; more on modules in Section 2.)\n\nObserve now that every connected component $C \\in \\mathcal{C}(D)$ satisfies $\\omega(G[C])<\\omega(G) \\leq k$, as $D \\backslash C$ contains a vertex complete to $C$. Hence, we can recurse on $C$, understanding it fully (more precisely, finding optimum partial solutions; the definition of this \"partial\" requires a lot of $\\mathrm{CMSO}_{2}$ mumbling).\n\nFurthermore, we observe that the quotient graph $G[D] / \\mathcal{C}(D)$ is bipartite. Thus, if we can understand how to solve $(\\operatorname{td} \\leq d, \\psi)$-MWIS on $P_{\\mathrm{T}}$-free bipartite graphs, then we should be done: the partial solutions from components $C \\in \\mathcal{C}(D)$, combined with the understanding of the $P_{\\mathrm{T}}$-free bipartite graph $G[D] / \\mathcal{C}(D)$ should give all partial solutions of $G[D]$ for every $D \\in \\mathcal{D}$. This, in turn, should give an understanding on how $(\\operatorname{td} \\leq d, \\psi)$-MWIS behaves on $K \\cup \\bigcup \\mathcal{D}$. As $S \\subseteq K \\cup \\bigcup \\mathcal{D}$, this should suffice to solve $(\\operatorname{td} \\leq d, \\psi)$-MWIS on $G$ using $(K, \\mathcal{D}, L)$ as an object that plays the role of the container for $S$.\n\nExplaining properly all \"should\"s from the previous paragraph is quite involved and tedious and done in Section 5. In this overview, let us focus on the more interesting case of solving $(\\operatorname{td} \\leq d, \\psi)$ MWIS in $P_{\\mathrm{T}}$-free bipartite graphs. Here, we actually prove the following result in Section 4.\n\nTheorem 1.3. There exists an algorithm that, given a $P_{\\mathrm{T}}$-free bipartite graph $G$ and an integer $d>0$, runs in time $n^{2^{\\mathcal{D}\\left(d^{3}\\right)}}$ and computes a family $\\mathcal{C}$ of subsets of $V(G)$ with the following guarantee: for every Sol $\\subseteq V(G)$ such that $G[\\mathrm{Sol}]$ is of treedepth at most $d$, there exists a tree decomposition $(T, \\beta)$ of $G$ such that for every $t \\in V(T)$ we have $\\beta(t) \\in \\mathcal{C}$ and $|\\beta(t) \\cap \\mathrm{Sol}|=2^{2^{\\mathcal{D}\\left(d^{3}\\right)}}$.\n\nWe remark that Theorem 1.3 is not needed if one just wants to solve the MWIS problem, as this problem can be solved in general bipartite graphs using matching or flow techniques. Thus, if one is interested only in finding a maximum-weight independent set, Section 4 can be omitted.\n\nOn the other hand, our work identified the bipartite case as an interesting subcase in exploring tractability of $(\\operatorname{td} \\leq d, \\psi)$-MWIS in $P_{\\mathrm{T}}$-free graphs. To state a precise problem for future work, we propose polynomial-time tractability of Feedback Vertex Set in $P_{\\mathrm{T}}$-free bipartite graphs. Meanwhile, Theorem 1.3 and its proof in Section 4 can be of independent interest.\n\nLet us also mention that if one is only interested in solving Feedback Vertex Set in $P_{\\mathrm{T}}$-free bipartite graphs, instead of using our Theorem 1.3, one can follow a different approach. Lozin and Zamaraev [33] provided a deep analysis of the structure of bipartite $P_{\\mathrm{T}}$-free graphs which implies that in particular they have bounded mim-width and the corresponding decomposition can be found efficiently. This yields a polynomial-time algorithm for Feedback Vertex Set [3]. However, it it far for clear what other cases $(\\operatorname{td} \\leq d, \\psi)$-MWIS can be solved efficiently in bounded-mim-width graphs.\n\nThe proof of Theorem 1.3 starts from the work of Kloks, Liu, and Poon [29], who showed that chordal bipartite graphs have polynomial number of PMCs, and thus $(\\operatorname{td} \\leq d, \\psi)$-MWIS problem is solvable in this graph class by the direct application of the PMC framework of Bouchitt\u00e9 and Todinca. (A graph $G$ is chordal bipartite if it is bipartite and does not contain induced cycles longer than 4.) A $P_{7}$-free bipartite graph is almost chordal bipartite: it can contain six-vertex cycles.\n\nWe would like to add some edges to the input graph $G$ so that it becomes chordal bipartite. Let $C=c_{1}-c_{2}-\\ldots-c_{6}-c_{1}$ be an induced six-vertex cycle in $G$; we would like to add the edge $c_{1} c_{4}$ to keep $G$ bipartite but break $C$. We show that, if one chooses $C$ carefully, one can do it so that $G$ remains $P_{7}$-free. However, such an addition may break the sought solution $\\mathcal{T}$ : if $c_{1}, c_{4} \\in V(\\mathcal{T})$ but are incomparable in the elimination forest $\\mathcal{T}$, then $\\mathcal{T}$ is no longer a treedepth- $d$ structure in $G+\\left\\{c_{1} c_{4}\\right\\}$.\n\nWe remedy this by a thorough investigation of the structure of the neighborhood of a six-vertex cycle in a $P_{7}$-free graph, loosely inspired by [5]. On a high level, we show that there is a branching process with polynomial number of outcomes that in some sense \"correctly\" completes $G$ to a chordal bipartite graph, proving Theorem 1.3.\n\nTo sum up, the proof of Theorem 1.1 consists of three ingredients. First, in Section 3 we show the guesswork that leads to a polynomial number of candidate \"almost containers\" $(K, \\mathcal{D}, L)$ for a minimal separator $S$ in the input graph $G$. Second, in Section 4 we focus on bipartite graphs and prove Theorem 1.3. Finally, in Section 5, we show how these two tools combine with the dynamic programming framework of $[19,1,13]$ to prove Theorem 1.1.\n\nLet us emphasize that even if we aim to solve Feedback Vertex Set in $P_{7}$-free graphs of bounded clique number and use our approach to reduce the problem to the bipartite case, the problem we need to solve the latter class is not just Feedback Vertex Set, but a certain extension variant considering $\\mathrm{CMSO}_{2}$ types. Thus even in this case the boundedness of mim-width implied by the work of Lozin and Zamaraev [33] is not sufficient as the known algorithm for bounded-mim-width graphs cannot handle such a problem. Consequently, we need to use Theorem 1.3.", "tables": {}, "images": {}}, {"section_id": 3, "text": "# 2 Preliminaries \n\nFor an integer $n$, by $[n]$ we denote the set $\\{1,2, \\ldots, n\\}$.\nThe set of vertices of graph $G$ is denoted as $V(G)$ and the set of edges as $E(G)$. An edge joining vertices $v$ and $u$ is denoted as $u v$. By $N(v)$ we denote the set of neighbors of the vertex $v$ (called its open neighborhood). By $N[v]$ we denote $N(v) \\cup\\{v\\}$ (called themclosed neighborhood). Given a set of vertices $S$, we define its open neighborhood $N(S)$ as $\\left(\\bigcup_{v \\in S} N(v)\\right) \\backslash S$ and its closed neighborhood $N[S]$ as $\\left(\\bigcup_{v \\in S} N[v]\\right)$.\n\nA graph $H$ is an induced subgraph of $G$ if it can be obtained by vertex deletions. zosta\u0142o tylko to co napisa\u0142am We do not distinguish between sets of vertices and subgraphs induced by them; in cases when it might cause a confusion we write $G[A]$ for an subgraph induced by $A \\subseteq V(G)$. We use $G-A$ as a shorthand for $G[V(G) \\backslash A]$.\n\nA class of graphs $\\mathcal{C}$ is a set of graphs. We say that a graph $G$ is $H$-free if $G$ does not contain any induced subgraph isomorphic to $H$. A class $\\mathcal{C}$ is $H$-free if all graphs $G \\in \\mathcal{C}$ are $H$-free. By $P_{t}$ we denote the path on $t$ vertices. A $P_{4}$-free graph is called a cograph. By $C_{t}$ we denote the cycle on $t$ vertices. The length of a path or a cycle is the number of edges in it.\n\nGiven a graph $G$ and its subset of vertices $A$, a set of connected components of $G-A$ is denoted as $\\operatorname{cc}(G-A)$.\n\nWe say that a vertex $v$ is complete to a set of vertices $B$ if $v$ is adjacent to all vertices in $B$. Similarly, a set of vertices $A$ is complete to a set of vertices $B$ if every vertex of $A$ is complete to $B$.\n\nWe say that a vertex $v$ is anticomplete to a set of vertices $B$ if $v$ has no neighbors in $B$. Similarly, a set of vertices $A$ is anticomplete to a set of vertices $B$ if $N(A) \\cap B=\\emptyset$.\n\nA module $M$ is a non-empty subset of vertices of graph $G$ such that every vertex $v \\in V(G) \\backslash M$ is adjacent either to all vertices of $M$ or to none of them. A module is called\n\n- strong if for any other module $M^{\\prime}$ either $M \\subseteq M^{\\prime}, M^{\\prime} \\subseteq M$ or $M \\cap M^{\\prime}=\\emptyset$\n\n- proper if $M$ is a proper subset of $V(G)$\n- maximal if it is proper and strong and is not contained in any other proper module\n\nModules $M$ and $M^{\\prime}$ are called adjacent if each vertex of $M$ is complete to $M^{\\prime}$ and $M \\cap M^{\\prime}=\\emptyset$.\nNote that for any graph on at least two vertices the family of maximal modules form a partition of $V(G)$.\n\nGiven a graph $G$ and the collection of vertex-disjoint modules $M$, the quotient graph $G / M$ is constructed by replacing each module of $M$ with a single vertex, with the same neighbors as the original vertices of the module.\n\nA set of pairwise non-adjacent vertices in a graph $G$ is called independent, while a set of pairwise adjacent vertices is a called clique.\n\nA subgraph $H$ of $G$, which is a connected component in the complement of $G$, is called an anticomponent.", "tables": {}, "images": {}}, {"section_id": 4, "text": "# 2.1 PMCs and chordal completions \n\nA graph $G$ is called chordal if all its induced cycles are of length 3 . Note that all induced subgraphs of a chordal graph are also chordal.\n\nA graph $H$ is called a supergraph of $G$ if $V(H)=V(G)$ and $E(G) \\subseteq E(H)$. A graph $H$ is called a chordal completion of $G$ if $H$ is a supergraph of $G$ and $H$ is a chordal graph. A chordal completion $H$ of $G$ is called minimal if it does not contain any proper subgraph which is also a chordal completion of $G$. Alternatively, we denote a chordal completion $H$ of $G$ as $G+F$, where $F$ is a set of non-edges in $G$ : then $E(H)=E(G) \\cup F$.\n\nA set of vertices $\\Omega \\subseteq V(G)$ is called a potential maximal clique or a PMC if there exists a minimal chordal completion $H$ of $G$ in which $\\Omega$ is a maximal clique.\n\nLet us recall a classic result characterizing potential maximal cliques.\nLemma 2.1 (see [8]). Given a graph $G$, a set of vertices $\\Omega$ is a PMC if and only if the following conditions are fulfilled:\n\n1. For each connected component $D$ of $G-\\Omega$, the set $N(D)$ is a proper subset of $\\Omega$.\n2. If $u v$ is a non-edge of $G$, with $u, v \\in \\Omega$, then there exists a component $D$ of $G-\\Omega$ such that $u, v \\in N(D)$.\n\nWe say that a set of vertices $S$ is a $(u, v)$ - separator if $u$ and $v$ belong to distinct components in $G-S$. A $(u, v)$-separator $S$ is called minimal if no proper subset of $S$ is a $(u, v)$-separator. A set of vertices $S$ is called a minimal separator of graph $G$ if there exists a pair of vertices $u$ and $v$ such that $S$ is a minimal $(u, v)$-separator.\n\nGiven a set of vertices $S$, we say that a component $D \\in \\mathrm{cc}(G-S)$ is a full component of $S$ if $N(D)=S$. It is easy to prove that $S$ is a minimal separator of $G$ if and only if it has at least two full components. It was proven (see [8]) that if $\\Omega$ is a PMC in $G$, then for every component $D$ of $G-\\Omega$ the set $N(D)$ is a minimal separator with $D$ as a full component and another full component containing $\\Omega \\backslash N(D)$.\n\nBouchitt\u00e9 and Todinca $[7,8]$ showed a close relation between potential maximal cliques and minimal separators.\n\nTheorem 2.2 (see $[7,8]$ ). If $G$ is an $n$-vertex graph with a minimal separators and $b$ potential maximal cliques, then $b \\leq n\\left(a^{2}+a+1\\right)$ and $a \\leq n b$. Furthermore, given a graph $G$, one can in time polynomial in the input and output the list of all its minimal separators and potential maximal cliques.", "tables": {}, "images": {}}, {"section_id": 5, "text": "# 2.2 Treedepth structures and treewidth \n\nThe rooted forest $\\mathcal{T}$ is a forest in which each component has exactly one distinguished vertex, called a root. A path in a rooted forest is called vertical if it connects a vertex and any of its ancestors. Given a vertex $v$, we define its depth as the number of vertices on the path connecting $v$ and the root (so the root has depth 1). The height of the rooted forest $\\mathcal{T}$ is equal to the maximum depth of a vertex of $\\mathcal{T}$. By $\\mathcal{T}^{\\alpha}$ we denote a set of vertices of $\\mathcal{T}$ of depth exactly $\\alpha$. We also write $\\mathcal{T}^{>\\alpha}$ for $\\bigcup_{\\alpha^{\\prime}>\\alpha} \\mathcal{T}^{\\alpha^{\\prime}}$.\n\nWe say that vertices $u$ and $v$ are $\\mathcal{T}$-comparable if they can be connected via a vertical path. Otherwise, we say that they are $\\mathcal{T}$-incomparable. An elimination forest of graph $G$ is a rooted forest $\\mathcal{T}$ such that $V(\\mathcal{T})=V(G)$ and for each edge $u v \\in E(G)$ vertices $u$ and $v$ are $\\mathcal{T}$-comparable. We define the treedepth of graph $G$ as the minimum height of any possible elimination forest of graph $G$.\n\nGiven a graph $G$ and an integer $d$, a treedepth- $d$ structure (the notion first proposed in [13]) is a rooted forest $\\mathcal{T}$ of height at most $d$ such that $V(\\mathcal{T})$ is a subset of $V(G)$ and $\\mathcal{T}$ is an elimination forest of the subgraph of $G$ induced by $V(\\mathcal{T})$. A treedepth- $d$ structure $\\mathcal{T}$ is a substructure of a treedepth- $d$ structure $\\mathcal{T}^{\\prime}$ if $\\mathcal{T}$ is a subgraph of $\\mathcal{T}^{\\prime}$ (as a rooted forest) and every root of $\\mathcal{T}$ is also a root of $\\mathcal{T}^{\\prime}$. A treedepth- $d$ structure $\\mathcal{T}$ is called maximal if there is no treedepth- $d$ structure $\\mathcal{T}^{\\prime}$ such that $\\mathcal{T}$ is a substructure of $\\mathcal{T}^{\\prime}$ and $\\mathcal{T} \\neq \\mathcal{T}^{\\prime}$. Equivalently, $\\mathcal{T}$ is maximal if it cannot be extended by adding a leaf preserving the bound on the height of $\\mathcal{T}$.\n\nTo avoid notational clutter, we sometimes treat $\\mathcal{T}$ as set of vertices, for example in expressions $|A \\cap \\mathcal{T}|$.\n\nGiven a treedepth- $d$ structure $\\mathcal{T}$ of graph $G$, a chordal completion $G+F$ is $\\mathcal{T}$-aligned if for any edge $u v \\in F$ the following conditions hold:\n\n1. neither $u$ and $v$ is a vertex of depth $d$ in $\\mathcal{T}$,\n2. if both $u$ and $v$ belong to $V(\\mathcal{T})$, then $u$ and $v$ are $\\mathcal{T}$-comparable.\n\nThe second condition guarantees that $\\mathcal{T}$ is a treedepth- $d$ structure in $G+F$. It was proven (see Lemma 2.11 in [13]) that for any treedepth- $d$ structure in graph $G$, there exists a minimal chordal completion $G+F$ which is $\\mathcal{T}$-aligned. We say that a PMC is $\\mathcal{T}$-avoiding if it is a maximal clique in some minimal chordal completion which is $\\mathcal{T}$-aligned and does not contain any vertex of $\\mathcal{T}$ of depth d.\n\nGiven a treedepth- $d$ structure $\\mathcal{T}$, we say that a set $S^{\\prime}$ is a $\\mathcal{T}$-container of defect $f$ (or a container of defect $f$ if $\\mathcal{T}$ is known from the context) for a set $S$ if $S \\subseteq S^{\\prime}$ and $\\left|S^{\\prime} \\cap V(\\mathcal{T})\\right|-|S \\cap V(\\mathcal{T})| \\leq f$. Note we have $S \\cap V(\\mathcal{T}) \\subseteq S^{\\prime} \\cap V(\\mathcal{T})$, so the defect $f$ describes how many additional vertices of $V(\\mathcal{T})$ belong to $S^{\\prime}$.\n\nNow we can cite the Lemma 2.12 from [13], which shows how to deal with PMCs, which are $\\mathcal{T}$ aligned and contain vertices of $\\mathcal{T}$ of depth $d$ :\n\nLemma 2.3 (see Lemma 2.12 in [13]). For each positive integer d, there is a polynomial-time algorithm which takes in a graph $G$ and returns a collection $L \\subseteq 2^{V(G)}$ such that for any maximal treedepth- $d$ structure $\\mathcal{T}$ in $G$, any $\\mathcal{T}$-aligned minimal chordal completion $G+F$ of $G$, and any maximal clique $\\Omega$ of $G+F$ which contains a depth-d vertex of $\\mathcal{T}, L$ contains a set $\\widetilde{\\Omega}$ that is a container for $\\Omega$ of defect 0 , i.e., $\\Omega \\subseteq \\widetilde{\\Omega}$ and $\\widetilde{\\Omega} \\cap \\mathcal{T}=\\Omega \\cap \\mathcal{T}$.\n\nIn our paper we will also need Lemma 2.13 from [13], which shows how to use the maximality of a treedepth- $d$ structure:\n\nLemma 2.4 (see Lemma 2.13 in [13]). Let $G$ be a graph, $d$ be a positive integer, and $\\mathcal{T}$ be a maximal treedepth- $d$ structure in $G$. Then for any $\\mathcal{T}$-avoiding potential maximal clique $\\Omega$ of $G$, each vertex in $\\Omega \\backslash \\mathcal{T}$ has a neighbor in $\\mathcal{T}-\\Omega$.\n\nA tree decomposition of a graph $G$ is a pair $\\mathcal{T}=(T, \\beta)$, where $T$ is a tree and $\\beta$ is a function assigning each node $v \\in V(T)$ a subset of vertices $\\beta(v) \\subseteq V(G)$, called a bag of $v$ such that the following conditions are fulfilled:\n\n- for each $u \\in V(G)$ a set of nodes of $T$ whose bags contain $u$ induces a connected non-empty subtree of $T$;\n- for each edge $u_{1} u_{2} \\in E(G)$ there exists a node $v \\in V(T)$ such that $\\beta(v)$ contains $u_{1}, u_{2}$.\n\nA width of a tree decomposition $\\mathcal{T}$ is equal to $\\max _{x \\in V(T)}|\\beta(x)|-1$. The minimum width over all tree decompositions of a graph $G$ is called the treewidth of $G$ and is denoted as $\\operatorname{tw}(G)$.", "tables": {}, "images": {}}, {"section_id": 6, "text": "# 2.3 MWIS \n\nIn all problems of interest in this paper, the input graph $G$ comes with vertex weights that are positive rational numbers.\n\nFor fixed integer $d \\geq 0$ and $\\mathrm{CMSO}_{2}$ formula $\\phi$ with one free vertex set variable, the $(\\operatorname{td} \\leq d, \\phi)$ MWIS problem takes in input a vertex-weighted graph $G$ and asks for a pair (Sol, $X$ ) where $X \\subseteq$ Sol $\\subseteq V(G), G[$ Sol $]$ is of treedepth at most $d$, and $\\phi(X)$ is satisfied in $G[$ Sol $]$, and, subject to the above, the weight of $X$ is maximized (or a negative answer if such a pair does not exist.)\n$(\\operatorname{td} \\leq d, \\psi)$-MWIS\nInput: A graph $G$ equipped with a weight function $\\mathfrak{w}: V(G) \\rightarrow \\mathbb{Z}_{+}$.\nTask: Find a pair $(\\mathrm{Sol}, X)$ such that\n\n- $X \\subseteq$ Sol $\\subseteq V(G)$,\n- $G[$ Sol $]$ is of treedepth at most $d$,\n- $G[$ Sol $]=\\psi(X)$,\n- $X$ is of maximum weight subject to the conditions above, or conclude that no such pair exists.\n\nSimilarly as in [13], for a solution (Sol, $X$ ) we will be mostly looking at some maximal treedepth- $d$ structure $\\mathcal{T}$ that contains Sol.", "tables": {}, "images": {}}, {"section_id": 7, "text": "### 2.4 Structural lemmas\n\nIn this section we present some structural lemmas about $P_{7}$-free graphs. Beforehand, we need the following notation.\n\nBy $X_{1}-X_{2}-\\cdots-X_{k}$ we denote a path $v_{1}-v_{2}-\\cdots-v_{k}$, where $v_{i}$ is some vertex belonging to $X_{i}$ for each $i \\in[k]$. If $X_{i}$ is singleton $\\left\\{x_{i}\\right\\}$ for some $i$, we write $-x_{i}-$ instead $-\\left\\{x_{i}\\right\\}-$.\n\nLemma 2.5. Let $S$ be a minimal separator in a $P_{7}$-free graph $G$ and let $A$ and $B$ be the full components to $S$. There exists a subset $Z \\subseteq A$ such that $Z$ is a cograph and $S \\backslash N(Z)$ is complete to $B$.\n\nProof. Let $F$ be a set of vertices of $S$ which are complete to $B$. Let $Z$ be a minimal connected subgraph of $A$ such that $S \\backslash F \\subseteq N(Z)$.\n\nLet $Q$ be a maximal induced path in $Z$ and let $v$ be its endpoint. Note that $v$ cannot be a cutvertex of $Z$ - otherwise we could extend our maximal path $Q$. By the minimality of $Z$ there exists a vertex $w \\in S \\backslash F$ such that $N(w) \\cap Z=\\{v\\}$. Let $B_{1}$ be $N(w) \\cap B$ and $B_{2}=B \\backslash B_{1}$. As $S$ is the minimal separator and $B$ is a full component to $S$, the set $B_{1}$ is non-empty. Since $w \\notin F$, the set $B_{2}$ is non-empty. As $B$ is a connected component, then there exist $x_{1} \\in B_{1}, x_{2} \\in B_{2}$, which are adjacent.\n\nLet $P=Q-w-x_{1}-x_{2}$. Note that $P$ is an induced path in $G$. We assumed that $G$ is $P_{7}$-free, thus $|P|<7$, which implies $|Q| \\leq 3$. Thus, $Z$ is a cograph.\n\nLemma 2.6 (see Lemma 4.2 in [23]). Let $S$ be a minimal separator in graph $G$ and let $A$ be a full component to $S$ and $|A| \\geq 2$. Let $p$ and $q$ be any two distinct vertices of $A$ belonging to different maximal proper adjacent strong modules of $G[A]$. Then, for each vertex $v \\in S$ at least one of the following conditions is fulfilled:\n\n1. there exists an induced path $v-A-A-A$\n2. we have $v \\in N(p) \\cup N(q)$\n3. $\\overline{G[A]}$ is disconnected and $N(v) \\cap A$ consists of some connected components of $\\overline{G[A]}$\n\nCorollary 2.7 (compare Lemma 8 in [38]). Let $S$ be a minimal separator in graph $G$ and let $A$ and $B$ be full components to $S$. There exists a set $X \\subseteq A(X \\subseteq B)$ of size at most $\\omega(G)$ such that for each vertex $v$ belonging to $S \\backslash N(X)$ there exists an induced path $v-A-A-A(v-B-B-B)$.\n\nProof. If $|A|<2$, then we simply take $X=A$. Suppose then that $A$ consists of least two vertices. Let $Q$ be a set of such vertices $v \\in S$ such that there exists an induced path $v-A-A-A$. If the complement of $G[A]$ is disconnected, then we choose one vertex from each connected component of $\\overline{G[A]}$ and create a set $X$ from the chosen vertices. If $\\overline{G[A]}$ is connected, let us pick any two vertices belonging to different maximal proper adjacent modules of $G[A]$ and construct $X$ this way. In both cases we have $|X| \\leq \\omega(G)$. By Lemma 2.6 for any vertex $v \\in S \\backslash N(X)$ we have $v \\in Q$. We prove the statement for $B$ in symmetrical way.\n\nWe will also need the following lemma, which was proved in [23].\nLemma 2.8 (see Lemma 4.1 in [23]). Let $\\left(X, \\leq_{1}\\right)$ and $\\left(X, \\leq_{2}\\right)$ be two partial orders on the set $X$ such that any pair of elements of $X$ is comparable in $\\leq_{1}$ or in $\\leq_{2}$. Then, there exists an element $v$ such that for any element $x \\in X$ we have $v \\leq_{1} x$ or $v \\leq_{2} x$.\n\nWe say that sets $A$ and $B$ are comparable by inclusion if $A \\subseteq B$ or $B \\subseteq A$.\nLemma 2.9. Let $G$ be a $P_{7}$-free graph and let $Z$ be an induced subgraph of $G$, which is a connected cograph. Let $I \\subseteq V(G) \\backslash N[Z]$ be an independent set and let $J \\subseteq N(Z) \\cap N(I)$ an independent set. Then there exist sets of vertices $Q_{Z} \\subseteq Z$ and $Q_{I} \\subseteq I$ such that $J \\subseteq N\\left(Q_{Z}\\right) \\cup N\\left(Q_{I}\\right)$ and $\\left|Q_{Z}\\right|,\\left|Q_{I}\\right| \\leq$ $(\\omega(Z)+1)!$\n\nProof. Let $f: \\mathbb{N} \\rightarrow \\mathbb{N}$ be defined recursively as $f(1)=1$ and $f(k) \\leq k(1+f(k-1))$ for $k \\geq 2$. A straightforward induction shows that for every $k \\in \\mathbb{N}$ we have $f(k) \\leq(k+1)$ !\n\nWe will prove the lemma by the induction on $\\omega(Z)$ and with the bound $\\left|Q_{I}\\right|,\\left|Q_{Z}\\right| \\leq f(\\omega(Z))$. For the base case, if $\\omega(Z)=1$, then $Z$ contains only one vertex $v$ and $J \\subseteq N(v)$. Thus, the induction holds for $\\omega(Z)=1$.\n\nLet us assume now that $\\omega(Z)>1$. Let $Z_{1}, \\ldots, Z_{l}$ be anticomponents of $Z$. Note that $l \\leq \\omega(Z)$. Since $Z$ is a connected cograph with $\\omega(Z)>1$, we know that $l>1$. For each $i \\in[l]$ we choose an arbitrary vertex $z_{i} \\in Z_{i}$. Let $\\left\\{Z_{i}^{1}, Z_{i}^{2}, \\ldots, Z_{i}^{m_{i}}\\right\\}$ be a set of connected components of $Z_{i}-z_{i}$.\n\nLet $J^{\\prime}=J \\backslash N\\left(\\left\\{z_{1}, \\ldots, z_{l}\\right\\}\\right)$. We split now $J^{\\prime}$ depending on the neighborhood in $Z$. Let $J_{i}^{\\prime}=$ $\\left(J^{\\prime} \\cap N\\left(Z_{i}\\right)\\right) \\backslash N\\left(Z_{1} \\cup \\cdots \\cup Z_{i-1}\\right)$.\n\nSuppose that $m_{i} \\geq 2$. Let us consider two partial orders on $J_{i}^{\\prime}$ :\n\n- $\\leq_{1}: u \\leq_{1} v \\Leftrightarrow N(u) \\cap I \\subseteq N(v) \\cap I$\n- $\\leq_{2}: u \\leq_{2} v \\Leftrightarrow\\left\\{j \\in\\left[m_{i}\\right] \\mid u \\in N\\left(Z_{i}^{j}\\right)\\right\\} \\subseteq\\left\\{j \\in\\left[m_{i}\\right] \\mid v \\in N\\left(Z_{i}^{j}\\right)\\right\\}$\n\nSuppose that there exist vertices $x, y \\in J_{i}^{\\prime}$ which are incomparable in both $\\leq_{1}$ and $\\leq_{2}$. Then there exists vertices $x_{i}, y_{i} \\in I$ such that $x_{i} x, y_{i} y \\in E(G)$, but $x y_{i}, x_{i} y \\notin E(G)$. Similarly, there exist connected components $Z_{i}^{j_{x}}$ and $Z_{i}^{j_{y}}$ such that $x \\in N\\left(Z_{i}^{j_{x}}\\right)$ and $y \\in N\\left(Z_{i}^{j_{y}}\\right)$, but $y \\notin N\\left(Z_{i}^{j_{x}}\\right)$ and $x \\notin N\\left(Z_{i}^{j_{y}}\\right)$. So there exist induced paths $P_{x}$ and $P_{y}$ connecting $x$ and respectively $y$ with $z_{i^{\\prime}}$, where\n\n$i^{\\prime} \\in[l] \\backslash\\{i\\}$ such that $P_{x} \\subseteq V\\left(Z_{i}^{j_{x}}\\right)$ and $P_{y} \\subseteq V\\left(Z_{i}^{j_{y}}\\right)$. Since $x, y \\notin N\\left(z_{i^{\\prime}}\\right)$, each of $P_{x}$ and $P_{y}$ must contain at least one vertex. Then a path $x_{i}-x-P_{x}-z_{i^{\\prime}}-P_{y}-y-y_{i}$ is an induced path of at least 7 vertices, a contradiction.\n\nThus each pair of elements of $J_{i}^{\\prime}$ is comparable in $\\leq_{1}$ or $\\leq_{2}$. Then by Lemma 2.8 there exists a vertex $w_{i} \\in J_{i}^{\\prime}$ such that any other vertex $v \\in J_{i}^{\\prime}$ we have $w_{i} \\leq_{1} v$ or $w_{i} \\leq_{2} v$. Let $u_{w_{i}}^{t}$ be any vertex in $N\\left(w_{i}\\right) \\cap I$ - such vertex exists because $J \\subseteq N(I)$. Let $j_{w_{i}}$ be any index such that $N\\left(w_{i}\\right) \\cap Z_{i}^{j_{w_{i}}} \\neq \\emptyset$ (such component exists, because of the definition of $J_{i}$ and the assumption $m_{i} \\geq 2$ ). Then $J_{i}^{\\prime} \\subseteq N\\left(u_{w_{i}}^{t}\\right) \\cup N\\left(Z_{i}^{j_{w_{i}}}\\right)$. Since $Z_{i}$ is the anticomponent, $\\omega\\left(Z_{i}^{j_{w_{i}}}\\right) \\leq \\omega\\left(Z_{i}\\right) \\leq \\omega(Z)-1$. By the inductive assumption, applied to a connected cograph $Z_{i}^{j_{w_{i}}}, J_{i}^{\\prime} \\backslash N\\left(u_{w_{i}}^{t}\\right)$ and $I$, there exist sets $Q_{Z}^{i}$ and $Q_{I}^{i}$ of size at most $f(\\omega(Z)-1)$ such that $J_{i}^{\\prime} \\backslash N\\left(u_{w_{i}}^{t}\\right) \\subseteq N\\left(Q_{Z}^{i}\\right) \\cup N\\left(Q_{I}^{i}\\right)$.\n\nWe are left with cases $m_{i}=0$ and $m_{i}=1$. In the former, $Z_{i}=\\left\\{z_{i}\\right\\}$ and $J_{i}^{\\prime}=\\emptyset$. We take then $Q_{Z}^{i}=Q_{I}^{i}=\\emptyset$. If $m_{i}=1$, then $J_{i}^{\\prime} \\subseteq N\\left(Z_{i}^{1}\\right)$. We can use directly inductive assumption to $Z_{i}^{1}, J_{i}^{\\prime}$ and $I$, getting sets $Q_{Z}^{i}$ and $Q_{I}^{i}$ such that $J_{i} \\subseteq N\\left(Q_{Z}^{i}\\right) \\cup N\\left(Q_{I}^{i}\\right)$.\n\nLet $Q_{Z}=\\left\\{z_{1}, \\ldots, z_{l}\\right\\} \\cup \\bigcup_{i \\in[l]} Q_{Z}^{i}$ and $Q_{I}=\\left\\{u_{w_{1}}^{t}, \\ldots, u_{w_{l}}^{t}\\right\\} \\cup \\bigcup_{i \\in[l]} Q_{I}^{i}$. Then\n\n$$\n\\left|Q_{Z}\\right|,\\left|Q_{I}\\right| \\leq \\omega(Z)+\\omega(Z) \\cdot f(\\omega(Z)-1)=f(\\omega(Z))\n$$\n\nWe also have\n\n$$\nJ \\subseteq N\\left(\\left\\{z_{1}, \\ldots, z_{l}\\right\\}\\right) \\cup J^{\\prime}=N\\left(\\left\\{z_{1}, \\ldots, z_{l}\\right\\}\\right) \\cup \\bigcup_{i \\in[l]} J_{i}^{\\prime} \\subseteq N\\left(Q_{Z}\\right) \\cup N\\left(Q_{I}\\right)\n$$", "tables": {}, "images": {}}, {"section_id": 8, "text": "# 2.5 $\\chi$-boundness \n\nBy $\\omega(G)$ we denote the clique number of $G$, i.e. a size of the maximal clique being a subgraph of $G$. By $\\chi(G)$ we denote the chromatic number of graph $G$, i.e. the minimal number of colors required to properly color vertices of graph $G$ (so no two adjacent vertices get the same color assigned). For any graph $G$ we have $\\omega(G) \\leq \\chi(G)$. There exist graphs with large girth and large chromatic number, so we cannot hope for bound $\\chi(G) \\leq f(\\omega(G))$ for any graph $G$. This leads us to the notion of $\\chi$-boundness, which was discussed by Gy\u00e1rf\u00e1s in [25]. We say that a class $\\mathcal{C}$ is $\\chi$-bounded if there exists a function $f: \\mathbb{N} \\rightarrow \\mathbb{N}$ such that for any graph $G \\in \\mathcal{C}$ we have $\\chi(G) \\leq f(\\omega(G))$.\n\nGy\u00e1rf\u00e1s proved in [25] the following theorem:\nTheorem 2.10 (Theorem 2.4 in [25]). Class of graphs excluding $P_{t}$ is $\\chi$-bounded and a function $f_{n}(x)=$ $(t-1)^{x-1}$ is a suitable bounding function.\n\nProof of this theorem, presented in [25], is constructive and it shows that a $P_{t}$-free graph $G$ can be colored with $(t-1)^{\\omega(G)-1}$ colors (i.e. divided into color classes) in polynomial time.", "tables": {}, "images": {}}, {"section_id": 9, "text": "### 2.6 2VC-dimension\n\nThe notion of Vapnik-Chervonenkis dimension was introduced by Vapnik and Chervonenkis in [39]. In graphs it is usually applied with the set of vertices as a universe and the family of closed neighborhoods as family of sets. Here, we will use VC-dimension in a slightly different setting.\n\nLet $(U, \\mathcal{F})$ be a set system: let $U$ be a set and $\\mathcal{F}$ be a family of subsets of $U$. The $2 V C$-dimension of a set system $(U, \\mathcal{F})$, denoted as $2 \\mathrm{VCdim}(U, \\mathcal{F})$ is a maximal size of a set $X \\subseteq U$ such that for every subset $Y \\subseteq X$ of size 2 there exists $A \\in \\mathcal{F}$ such that $A \\cap X=Y$.\n\nFor a set system $(U, \\mathcal{F})$, we define a dual set system as $(\\mathcal{F}, \\widetilde{U})$, where $\\widetilde{U}=\\left\\{x^{*} \\mid x \\in U\\right\\}$ and $x^{*}=\\{F \\in \\mathcal{F} \\mid x \\in F\\}$. Then a dual $2 V C$-dimension of set system $(U, \\mathcal{F})$, denoted as $2 \\mathrm{VCdim}^{*}(U, \\mathcal{F})$, is a 2 VC -dimension of its dual system, i.e. the size of a maximal $\\mathcal{F}^{\\prime} \\subseteq \\mathcal{F}$ such that for every distinct $A, B \\in \\mathcal{F}^{\\prime}$ there exists $u \\in U$ such that $\\{C \\in \\mathcal{F}^{\\prime} \\mid u \\in C\\}=\\{A, B\\}$.\n\nGiven a set system $(U, \\mathcal{F})$, let $\\nu(U, \\mathcal{F})$ be a maximal size of a subfamily $\\mathcal{F}^{\\prime} \\subseteq \\mathcal{F}$ of pairwise disjoint sets and let $\\tau(U, \\mathcal{F})$ be a minimal size of a set $A \\subseteq U$ such that for every $F \\in \\mathcal{F}$ we have $F \\cap A \\neq \\emptyset$.\n\nDing, Seymour and Winkler proved the lemma in [17], bounding $\\tau$ as a function of $\\lambda$ and $\\nu$. They used the language of hypergraphs, which we translated here to set systems.\n\nLemma 2.11 (compare (1.1) in [17]). For any set system $\\mathcal{S}=(U, \\mathcal{F})$ we have\n\n$$\n\\tau(\\mathcal{S}) \\leq 11 \\cdot 2 \\mathrm{VCdim}^{*}(\\mathcal{S})^{2}\\left(2 \\mathrm{VCdim}^{*}(\\mathcal{S})+\\nu(\\mathcal{S})+3\\right)\\binom{2 \\mathrm{VCdim}^{*}(\\mathcal{S})+\\nu(\\mathcal{S})}{\\nu(\\mathcal{S})}^{2}\n$$\n\nCorollary 2.12. For every $t$ there exists $c$ such that for every $P_{t}$-free graph $G$, a PMC $\\Omega$ in $G$ and an independent set $I \\subseteq \\Omega$ such that for every vertex $v \\in I$ there exists a component $D \\in \\operatorname{cc}(G-\\Omega)$ such that $v \\in N(D)$, there exists a family $\\mathcal{D} \\subseteq \\operatorname{cc}(G-\\Omega)$ of size at most $c$ such that $I \\subseteq \\bigcup_{D \\in \\mathcal{D}} N(D)$.\n\nProof. Let us consider a set system $\\mathcal{S}=\\left(\\operatorname{cc}(G-\\Omega),\\left\\{\\mathcal{D}_{v} \\mid v \\in I\\right\\}\\right)$, where $\\mathcal{D}_{v}=\\{D \\in \\operatorname{cc}(G-\\Omega) \\mid$ $v \\in N(D)\\}$. By Lemma 2.1 we know that for every two non-adjacent vertices $u, v \\in \\Omega$ there exists a component $D \\in \\operatorname{cc}(G-\\Omega)$ such that $u, v \\in N(D)$. Hence, $\\nu(\\mathcal{S})=1$, as $I$ is an independent set. Let us denote $\\left\\lceil\\frac{t}{2}\\right\\rceil+1$ as $p$. We will show now that $2 \\mathrm{VCdim}^{*}(\\mathcal{S})<p$. Suppose otherwise - then there exists a subfamily $\\mathcal{F}^{\\prime}=\\left\\{\\mathcal{D}_{v_{1}}, \\mathcal{D}_{v_{2}}, \\ldots, \\mathcal{D}_{v_{p}}\\right\\}$ such that for every $j, k \\in\\left[\\frac{t}{2}\\right]$ there exists a component $D \\in \\operatorname{cc}(G-\\Omega)$ such that $\\left\\{\\mathcal{D}_{i} \\in \\mathcal{F}^{\\prime} \\mid D \\in \\mathcal{D}_{i}\\right\\}=\\left\\{\\mathcal{D}_{v_{i}}, \\mathcal{D}_{v_{j}}\\right\\}$. In other words, for every two distinct vertices $u, w \\in\\left\\{v_{1}, \\ldots, v_{p}\\right\\} \\subseteq I$ there exists a component $D \\in \\operatorname{cc}(G-\\Omega)$ such that $u, w \\in N(D)$, but no other $v_{i} \\in N(D)$ and therefore a minimal path $P_{u w} \\subseteq D$ connecting $u$ and $w$ (note that $P_{u w}$ may contain just one vertex). Let us consider a path $v_{1}-P_{v_{1} v_{2}}-v_{2}-P_{v_{2} v_{3}}-v_{3}-\\cdots-P_{v_{p-1} v_{p}}-v_{p}$. Note that it is an induced path in $G$ of length $p+p-1 \\geq t$, which is a contradiction. Thus, $2 \\mathrm{VCdim}^{*}(\\mathcal{S})<p$.\n\nNote that $\\tau(\\mathcal{S})$ is a minimal size of a set $\\mathcal{D} \\subseteq \\operatorname{cc}(G-\\Omega)$ such that for every $v \\in I$ there exists $D \\in \\mathcal{D}$ such that $v \\in N(D)$. By Lemma 2.11 we get that $\\tau(S)$ is bounded by a function of $p$, so a function of $t$.\n\nWe immediately get the following corollary.\nCorollary 2.13. For every $t$ and $k$ there exists $c$ such that for every $P_{t}$-free graph $G$ with $\\omega(G) \\leq k$ and a PMC $\\Omega$ one of the two following conditions hold:\n\n1. there exists $v \\in \\Omega$ such that for every component $D \\in \\operatorname{cc}(G-\\Omega)$ we have $v \\notin N(D)$\n2. there exists a family $\\mathcal{D} \\subseteq \\operatorname{cc}(G-\\Omega)$ of size at most $c$ such that $\\Omega=\\bigcup_{D \\in \\mathcal{D}} N(D)$", "tables": {}, "images": {}}, {"section_id": 10, "text": "# 3 Approximating minimal separators \n\nThis section is devoted to the proof of the following theorem.\nTheorem 3.1. Let $d, k \\geq 1$ be fixed integers. Given a $P_{7}$-free graph $G$ with $\\omega(G) \\leq k$, one can in polynomial time compute a family $\\mathcal{F}$ with the following guarantee: for every maximal treedepth-d structure $\\mathcal{T}$ and every $\\mathcal{T}$-avoiding minimal separator $S$ in $G$ with full components $A$ and $B$, there exists $(K, \\mathcal{D}, L) \\in \\mathcal{F}$ satisfying the following:\n\n- $K \\subseteq V(G), S \\cap \\mathcal{T} \\subseteq K$, and $|K \\cap \\mathcal{T}|=\\mathcal{O}_{k, d}(1)$;\n- $\\mathcal{D}$ is a subset of the family of connected components of $G-K$;\n- $L$ is a function that assigns to every $D \\in \\mathcal{D}$ a subset $\\emptyset \\neq L(D) \\subsetneq D$ such that every connected component of either $G[L(D)]$ or of $G[D \\backslash L(D)]$ is a module of $G[D]$;\n- for every connected component $D$ of $G-K$, one of the following holds:\n- $D$ is a subset of a single connected component of $G-S$; or\n\nProof. Let $G$ be as in the theorem statement. Using Theorem 2.10, we compute a coloring of $G$ into $c \\leq 6^{k-1}$ color classes and denote them by $V^{1}, \\ldots, V^{c}$. In what follows, we will frequently divide various subsets of $V(G)$ into color classes; for a set $X$, we usually denote $X \\cap V^{i}$ by $X^{i}$ for brevity and call the sets $X^{1}, \\ldots, X^{c}$ the color classes of $X$.\n\nLet $\\mathcal{T}$ be a maximal treedepth- $d$ structure in $G$. Let $S$ be a $\\mathcal{T}$-avoiding minimal separator in graph $G$ and let $A$ and $B$ be the full components to $S$. We follow here a way from presentation from [1, 13]: we want to guess the tuple $(K, \\mathcal{D}, L)$ for $(S, A, B)$ by making a guesswork that ends up in a polynomial number of options. That is, we describe a nondeterministic polynomial-time algorithm that\n\n1. has a polynomial number of possible runs,\n2. in every run, the algorithm either outputs a tuple $(K, \\mathcal{D}, L)$ as in the lemma statement or terminates without outputting any tuple, and\n3. for every $\\mathcal{T}, S, A$, and $B$ as above, there exists a run of the algorithm that produces a tuple $(K, \\mathcal{D}, L)$ fitting $\\mathcal{T}, S, A$, and $B$ as in the lemma statement.\n\nTo compute the desired family $\\mathcal{F}$, we iterate over all possible runs of the algorithm and collect all output tuples $(K, \\mathcal{D}, L)$. The nondeterministic algorithm does not know $\\mathcal{T}, S, A$, nor $B$, but is able to nondeterministically guess some properties of them; however, in such guesses we need to control the number of possible runs (branches) so that their total number is polynomial. For example, while we cannot guess the entire set $S$, we can for example guess one leaf of $\\mathcal{T}$ that is contained in $A$ (there are $n$ options) or a specific vertex of $S$.\n\nLet $X_{A}$ be a subset of $A$ of size at most $k$ such that for each vertex $v \\in S \\backslash N\\left(X_{A}\\right)$ there exists an induced path $v-A-A-A$. Analogously, we define $X_{B}$ as a subset of $B$ of size at most $k$ such that for every vertex $v \\in S \\backslash N\\left(X_{B}\\right)$ there exists an induced path $v-B-B-B$. Such subsets exists by Corollary 2.7.\n\nSuppose that there exists $v \\in S \\backslash\\left(N\\left(X_{A}\\right) \\cup N\\left(X_{B}\\right)\\right)$. Then $v$ belongs to $S \\backslash N\\left(X_{B}\\right)$ and $S \\backslash N\\left(X_{A}\\right)$, so there exists induced paths $v-B-B-B$ and $v-A-A-A$. By joining them, we create a $P_{7}$ which is a contradiction. Thus, $S \\subseteq N\\left(X_{A}\\right) \\cup N\\left(X_{B}\\right)$. Moreover, note that $N\\left(X_{A}\\right) \\cap N\\left(X_{B}\\right) \\subseteq S$.\n\nWe will maintain a set $\\widehat{S}$ which will serve as our current candidate for $K$. We initiate $\\widehat{S}=\\emptyset$. We will refer to $\\widehat{S}$ as \"our container\" for the set $S$.\n\nWe (nondeterministically) guess sets $X_{A}, X_{B}$ and leafs $p_{A}$ and $p_{B}$ of $\\mathcal{T}$, belonging to respectively $A$ and $B$. By Lemma 2.4 such vertices exists, as we are guessing vertices of maximal depth in $\\mathcal{T} \\cap A$ and $\\mathcal{T} \\cap B$. We also know that there exists suitable guesses for $X_{A}$ and $X_{B}$, fulfilling the above definitions. Since $\\left|X_{A}\\right|,\\left|X_{B}\\right| \\leq k$, there is a polynomial number of options for this guess.\n\nThen we add to $\\widehat{S}$ vertices of $N\\left(X_{A} \\cup\\left\\{p_{A}\\right\\}\\right) \\cap N\\left(X_{B} \\cup\\left\\{p_{B}\\right\\}\\right)$ and $N\\left(p_{A}\\right) \\cup N\\left(p_{B}\\right)$. We also guess $\\mathcal{T} \\cap S$ and add them to $\\widehat{S}$. Since $S$ is $\\mathcal{T}$-avoiding, $|\\mathcal{T} \\cap S| \\leq d-1$.\n\nNote that we added to $\\widehat{S}$ at most $d-1$ ancestors of $p_{A}$ among vertices in $N\\left(p_{A}\\right)$ and at most $d-1$ ancestors of $p_{B}$ among vertices in $N\\left(p_{B}\\right)$ in the treedepth- $d$ structure.\n\nLet $S_{A}=S \\backslash N\\left(X_{A}\\right)$ and $S_{B}=S \\backslash N\\left(X_{B}\\right)$. Note that $S_{A}$ and $S_{B}$ are subsets of respectively $N\\left(X_{B}\\right)$ and $N\\left(X_{A}\\right)$.\n\nWe now focus on vertices of $S$, which have neighbors in connected components others than $A$ and $B$. Let $\\widehat{S}=N(V(G) \\backslash(A \\cup B \\cup S))$, note that $\\widehat{S} \\subseteq S$, and let $\\widehat{S_{A}}=\\widehat{S} \\cap S_{A}$ and $\\widehat{S_{B}}=\\widehat{S} \\cap S_{B}$. We divide $\\widehat{S_{A}}$ and $\\widehat{S_{B}}$ into color classes: $\\widehat{S_{A}^{1}}, \\widehat{S_{A}^{2}}, \\ldots, \\widehat{S_{A}^{c}}$ and $\\widehat{S_{B}^{1}}, \\widehat{S_{B}^{2}}, \\ldots, \\widehat{S_{B}^{c}}$. We need the following lemma in order to put these vertices into our container.\n\nClaim 3.2. For any $i \\in[c]$, if $\\widehat{S_{A}^{i}} \\neq \\emptyset$, then there exists a component $D_{A}^{i} \\in \\operatorname{cc}(G-(A \\cup S \\cup B))$ and vertices $a_{A}^{i}, b_{A}^{i}, c_{A}^{i} \\in A$ such that a set of vertices $\\widehat{S_{A}^{i}}$ is a subset of $N\\left(D_{A}^{i}\\right) \\cup\\left(N\\left(\\left\\{a_{A}^{i}, b_{A}^{i}, c_{A}^{i}\\right\\}\\right) \\cap N\\left(X_{B}\\right)\\right)$. A symmetrical statement holds for $B$.\n\nProof. Let $v$ be a vertex in $\\widehat{S_{A}^{i}}$ which has the neighbors in the least number of connected components of $G-(A \\cup S \\cup B)$. Then there exists an induced path $v-A-A-A-$ let $a_{A}^{i}, b_{A}^{i}, c_{A}^{i}$ be vertices of $A$ such that $v-a_{A}^{i}-b_{A}^{i}-c_{A}^{i}$ is an induced path. Let $D_{A}^{i}$ be any connected component of $G-(A \\cup S \\cup B)$ such that $v \\in N\\left(D_{A}^{i}\\right)$.\n\nSuppose that there exists a vertex $u \\in \\widehat{S_{A}^{i}}$ which does not belong to a set $N\\left(D_{A}^{i}\\right) \\cup\\left(N\\left(\\left\\{a_{A}^{i}, b_{A}^{i}, c_{A}^{i}\\right\\}\\right)\\right.$ $\\cap N\\left(X_{B}\\right)$ ). As $\\widehat{S_{A}^{i}}$ is a color class, $u$ and $v$ are non-adjacent. However, we can connect them via $B$, as each vertex in $S_{A}$ has a neighbor in $X_{B}$ and $B$ is a connected component. Let $Q \\subseteq B$ be a path (maybe on just one vertex) such that $u-Q-v$ is an induced path in $G$. By the minimality of $v$, we know that there exists a connected component $D^{\\prime} \\in \\operatorname{cc}(G-(A \\cup S \\cup B))$ and a vertex $w \\in D^{\\prime}$ such that $v \\notin N\\left(D^{\\prime}\\right)$ and $u$ and $w$ are adjacent. Then $w-u-Q-v-a_{A}^{i}-b_{A}^{i}-c_{A}^{i}$ is an induced path on at least seven vertices; a contradiction. Thus, $\\widehat{S_{A}^{c}} \\subseteq N\\left(D_{A}^{i}\\right) \\cup\\left(N\\left(\\left\\{a_{A}^{i}, b_{A}^{i}, c_{A}^{i}\\right\\}\\right) \\cap N\\left(X_{B}\\right)\\right)$.\n\nThe proof for $B$ is symmetrical.\nNote that each component $D \\in \\operatorname{cc}(G-(A \\cup S \\cup B))$ is a connected component of $G-S$, different from $A$ and $B$. Since $S \\subseteq N\\left(X_{A}\\right) \\cup N\\left(X_{B}\\right) \\subseteq A \\cup S \\cup B$, then $D \\in \\operatorname{cc}\\left(G-\\left(N\\left(X_{A}\\right) \\cup N\\left(X_{B}\\right)\\right)\\right)$. Therefore each connected component of $G-(A \\cup S \\cup B)$ can be guessed.\n\nNow we use Claim 3.2 to expand $\\widetilde{S}$ and therefore to cover $\\widetilde{S}$. For each $\\widetilde{S_{A}^{i}}$ such that $i \\in[c]$ we guess if $\\widehat{S_{A}^{i}} \\neq \\emptyset$ and, if this is the case, we guess a connected component $D_{i}$ in $G-\\left(N\\left(X_{A}\\right) \\cup N\\left(X_{B}\\right)\\right)$ and vertices $a^{i}, b^{i}, c^{i}$ and we add $N\\left(D_{i}\\right) \\cup\\left(N\\left(\\left\\{a^{i}, b^{i}, c^{i}\\right\\}\\right) \\cap N\\left(X_{B}\\right)\\right)$ to $\\widetilde{S}$. We do symmetric guesses for each $\\widetilde{S_{B}^{i}}$ for each $i \\in[c]$.\n\nAt this point, all vertices of $S \\backslash \\widetilde{S}$ have neighbors only in $A \\cup S \\cup B$. We will use the following two claims to cover some vertices which have two incomparable neighbors in $\\mathcal{T}$.\n\nFix $\\alpha \\in[d]$. Let $S_{A}^{\\alpha}$ be a subset of $S_{A} \\backslash \\widetilde{S}$, consisting of these vertices of $S_{A}$ which have at least two neighbors in $\\mathcal{T}^{\\alpha} \\cap B$. Let us divide $S_{A}^{\\alpha}$ into color classes $S_{A}^{\\alpha, 1}, S_{A}^{\\alpha, 2}, \\ldots, S_{A}^{\\alpha, c}$. Similarly, let $S_{B}^{\\alpha}$ be a subset of $S_{B} \\backslash \\widetilde{S}$, consisting of these vertices of $S_{B}$ which have two neighbors in $\\mathcal{T}^{\\alpha} \\cap A$. Again, we divide $S_{B}^{\\alpha}$ into color classes $S_{B}^{\\alpha, 1}, S_{B}^{\\alpha, 2}, \\ldots, S_{B}^{\\alpha, c}$.\nClaim 3.3. For each $\\alpha \\in[d]$ and $i \\in[c]$ there exist $Q_{Z} \\subseteq A$ of size at most $2(k+1)$ !, and disjoint sets of vertices $Q_{I}^{1}, Q_{I}^{2} \\subseteq \\mathcal{T}^{\\alpha} \\cap B$ of size at most $(k+1)$ ! each, such that\n\n$$\nS_{A}^{\\alpha, i} \\subseteq\\left(N\\left(Q_{Z}\\right) \\cap N\\left(X_{B}\\right)\\right) \\cup\\left(\\bigcup_{x \\in Q_{I}^{1}} \\bigcup_{y \\in\\left(Q_{I}^{1} \\cup Q_{I}^{2}\\right) \\backslash\\{x\\}} N(x) \\cap N(y)\\right)\n$$\n\nA symmetrical statement holds for $S_{B}^{\\alpha, i}$ for each $\\alpha \\in[d]$ and $i \\in[c]$.\nProof. Let us fix $\\alpha \\in[d]$ and $i \\in[c]$. We consider $S_{A}^{\\alpha, i}$, for shorthand denoted here as $J$. Since $J$ is a color class, it is an independent set. By Lemma 2.5 there exists a connected cograph $Z$ in $A$ such that $S \\backslash N(Z)$ is complete to $B$. Therefore $J \\subseteq N(Z)$ (vertices belonging to $S$ which are complete to $B$ belong to $N\\left(p_{B}\\right)$, so they belong to $\\widetilde{S}$ ). Let $I^{1}$ be set of vertices of $\\mathcal{T}^{\\alpha}$ belonging to $B$. Note that $I^{1}$ is an independent set. By Lemma 2.9 there exist sets $Q_{I}^{1} \\subseteq I^{1}$ and $Q_{Z}^{1} \\subseteq Z$ of size at most $(k+1)$ ! each such that $J \\subseteq N\\left(Q_{I}^{1}\\right) \\cup N\\left(Q_{Z}^{1}\\right)$. Note that $N\\left(Q_{Z}^{1}\\right) \\cap S_{A}^{\\alpha, i} \\subseteq N\\left(Q_{Z}^{1}\\right) \\cap N\\left(X_{B}\\right)$.\n\nLet us denote $N\\left(Q_{Z}^{1}\\right) \\cap N\\left(X_{B}\\right) \\cup \\bigcup_{x, y \\in Q_{I}^{1}, x \\neq y} N(x) \\cap N(y)$ as $X$. Let $J^{2}=J \\backslash X$ and $I^{2}=$ $I^{1} \\backslash Q_{I}^{1}$. Note that if $v \\in J^{2}$, then $v$ has exactly one neighbor in $Q_{I}^{1}$, so it has a neighbor in $I^{2}$. We again use Lemma 2.9, there exists sets $Q_{I}^{2} \\subseteq I^{2}$ and $Q_{Z}^{2} \\subseteq Z$ of size at most $(k+1)$ ! such that $J^{2} \\subseteq N\\left(Q_{I}^{2}\\right) \\cup N\\left(Q_{Z}^{2}\\right)$.\n\nThen we have $J^{2} \\subseteq\\left(N\\left(Q_{Z}^{2}\\right) \\cap N\\left(X_{B}\\right)\\right) \\cup\\left(\\bigcup_{x \\in Q_{I}^{1}} \\bigcup_{y \\in Q_{I}^{2}} N(x) \\cap N(y)\\right)$. Thus $J$ is indeed a subset of\n\n$$\nS_{A}^{\\alpha, i} \\subseteq\\left(\\left(N\\left(Q_{Z}^{1} \\cup Q_{Z}^{2}\\right) \\cap N\\left(X_{B}\\right)\\right) \\cup\\left(\\bigcup_{x \\in Q_{I}^{1}} \\bigcup_{y \\in\\left(Q_{I}^{1} \\cup Q_{I}^{2}\\right) \\backslash\\{x\\}} N(x) \\cap N(y)\\right)\\right)\n$$\n\nSetting $Q_{Z}=Q_{Z}^{1} \\cup Q_{Z}^{2}$ concludes the proof; the proof for $B$ is symmetric.\nFor every $\\alpha \\in[d]$ and $i \\in[c]$ we guess if $S_{A}^{\\alpha, i}$ of $S_{A}^{\\alpha}$ is nonempty, and if it is the case, then we guess sets $Q_{Z}^{i}, Q_{I}^{1, i}, Q_{I}^{2, i}$. By Claim 3.3 we know that there exist suitable guesses such that $S_{A}^{\\alpha, i}$ is contained in\n\n$$\n\\left(\\left(N\\left(Q_{Z}^{i}\\right) \\cap N\\left(X_{B}\\right)\\right) \\cup\\left(\\bigcup_{x \\in Q_{I}^{1, i}} \\bigcup_{y \\in\\left(Q_{I}^{1, i} \\cup Q_{I}^{2, i}\\right) \\backslash\\{x\\}} N(x) \\cap N(y)\\right)\\right)\n$$\n\nwhich we denote as $X^{\\alpha, i}$ (note that $X_{B}$ is already guessed). Then for each $\\alpha \\in[d]$ and $i \\in[c]$ we add $X^{\\alpha, i}$ to $\\widetilde{S}$.\n\nWe need to bound how many vertices of $\\mathcal{T}$ are added to $\\widetilde{S}$. Per each $X^{\\alpha, i}$ we may have added to $\\widetilde{S}$ vertices from $\\mathcal{T}$, which are ancestors of two vertices belonging to $Q_{I}^{1, i}$ and $Q_{I}^{2, i}$. So we added at most $d \\cdot\\left|Q_{I}^{1, i} \\cup Q_{I}^{2, i}\\right|^{2}$. So the number of vertices of $\\mathcal{T}$ in $\\widetilde{S}$ increased by at most $d \\cdot c \\cdot d \\cdot 4((k+1)!)^{2}$.\n\nWe follow the same steps for each color class $S_{B}^{\\alpha, i}$ of $S_{B}^{\\alpha}$, guessing the sets and putting vertices into $\\widetilde{S}$. Symmetrically, this step increases the number of vertices of $\\mathcal{T}$ in $\\widetilde{S}$ by at most $4 c d^{2}((k+1)!)^{2}$.\n\nWe put into $\\widetilde{S}$ vertices of $S_{A}$ (resp. $S_{B}$ ), which have at least two neighbors on the same level in $\\mathcal{T} \\cap B$ (resp. $\\mathcal{T} \\cap A$ ). We will use now a similar idea to put into $\\widetilde{S}$ some vertices of $S$ which have two incomparable neighbors in $\\mathcal{T}$ of two different levels.\n\nFix distinct $\\alpha, \\beta \\in[d]$. Let $S_{A}^{\\alpha, \\beta}$ be a subset of $S_{A} \\backslash \\widetilde{S}$ consisting of these vertices of $S_{A}$ which have two incomparable neighbors in $\\mathcal{T} \\cap B$ - one of depth $\\alpha$ in $\\mathcal{T}$ and another of depth $\\beta$ in $\\mathcal{T}$. Note that each vertex $v \\in S_{A}^{\\alpha, \\beta}$ has exactly one vertex in $\\mathcal{T}^{\\alpha} \\cap B$ and exactly one in $\\mathcal{T}^{\\beta} \\cap B$, as vertices having at least two neighbors in either of these two sets already belong to $\\widetilde{S}$. We divide each $S_{A}^{\\alpha, \\beta}$ into color classes $S_{A}^{\\alpha, \\beta, 1}, S_{A}^{\\alpha, \\beta, 2}, \\ldots, S_{A}^{\\alpha, \\beta, c}$. Let us define $S_{B}^{\\alpha, \\beta, i}$ in a symmetrical way.\nClaim 3.4. For each distinct $\\alpha, \\beta \\in[d]$ and $i \\in[c]$ there exist a set $Q_{Z} \\subseteq A$ of size at most $2(k+1)$ !, and sets $Q_{I}^{1}$ and $Q_{I}^{2}$, which are subsets of respectively $\\mathcal{T}^{\\alpha} \\cap B$ and $\\mathcal{T}^{\\beta} \\cap B$ of size at most $(k+1)$ ! such that\n\n$$\nS_{A}^{\\alpha, \\beta, i} \\subseteq\\left(N\\left(Q_{Z}\\right) \\cap N\\left(X_{B}\\right)\\right) \\cup \\bigcup_{\\substack{x \\in Q_{I}^{1} \\bigcup y \\in Q_{I}^{2} \\\\ x, y \\text { incomparable in } \\mathcal{T}}} N(x) \\cap N(y)\n$$\n\nA symmetric statement holds for $S_{B}^{\\alpha, \\beta, i}$ for each distinct $\\alpha, \\beta \\in[d]$ and $i \\in[c]$.\nProof. Let us fix distinct $\\alpha, \\beta \\in[d]$ and $c \\in[c]$. We consider $S_{A}^{\\alpha, \\beta, i}$, for short denoted here as $J$. By Lemma 2.5, there exists a connected cograph $Z$ in $A$ such that $S \\backslash N(Z)$ is complete to $B$. Therefore $J \\subseteq N(Z)$. We apply Lemma 2.9 to $Z, J$ and $\\mathcal{T}^{\\alpha} \\cap B$, getting sets $Q_{Z}^{1}$ and $Q_{I}^{1}$ such that $S_{A}^{\\alpha, \\beta, i} \\subseteq$ $N\\left(Q_{Z}^{1}\\right) \\cup N\\left(Q_{I}^{1}\\right)$. We also apply Lemma 2.9 to $Z, J$ and $\\mathcal{T}^{\\beta} \\cap B$, getting sets $Q_{Z}^{2}$ and $Q_{I}^{2}$ such that $S_{A}^{\\alpha, \\beta, i} \\subseteq N\\left(Q_{Z}^{2}\\right) \\cup N\\left(Q_{I}^{2}\\right)$. Let $Q_{Z}=Q_{Z}^{1} \\cup Q_{Z}^{2}$.\n\nNote that\n\n$$\nS_{A}^{\\alpha, \\beta, i} \\backslash N\\left(Q_{Z}\\right) \\subseteq\\left\\{N(x) \\cap N(y) \\mid x \\in Q_{I}^{1}, y \\in Q_{I}^{2}, x \\text { and } y \\text { are incomparable in } \\mathcal{T}\\right\\}\n$$\n\nwhich holds by the definition of $S_{A}^{\\alpha, \\beta, i}$. As $N\\left(Q_{Z}^{1} \\cup Q_{Z}^{2}\\right) \\cap S_{A}^{\\alpha, \\beta, i} \\subseteq N\\left(Q_{Z}\\right) \\cap N\\left(X_{B}\\right)$, we get\n\n$$\nS_{A}^{\\alpha, \\beta, i} \\subseteq\\left(N\\left(Q_{Z}\\right) \\cap N\\left(X_{B}\\right)\\right) \\cup \\bigcup_{\\substack{x \\in Q_{I}^{1} \\bigcup y \\in Q_{I}^{2} \\\\ x, y \\text { incomparable }}} N(x) \\cap N(y)\n$$\n\nThe symmetrical proof holds for $B$.\n\nFor each $\\alpha, \\beta \\in[d]$ and $i \\in[c]$ we guess id $S_{A}^{\\alpha, \\beta, i}$ is nonempty, and if this is the case, we guess sets $Q_{Z}, Q_{I}^{1}$ and $Q_{I}^{2}$. By Claim 3.4 we know that there exists suitable guesses such that $S_{A}^{\\alpha, \\beta, i}$ is contained in\n\n$$\n\\left(N\\left(Q_{Z}\\right) \\cap N\\left(X_{B}\\right)\\right) \\cup \\bigcup_{\\substack{x \\in Q_{I}^{1} \\\\ x, y \\text { incomparable }}} N(x) \\cap N(y)\n$$\n\nwhich we denote as $X^{\\alpha, \\beta, i}$. For each distinct $\\alpha, \\beta \\in[d]$ and $i \\in[c]$ we add $X^{\\alpha, \\beta, i}$ to $\\widetilde{S}_{c}$.\nWith each $X^{\\alpha, \\beta, i}$ we may have added at most $d \\cdot\\left|Q_{I}^{1} \\cup Q_{I}^{2}\\right|^{2}$ vertices from $\\mathcal{T}$ to $\\widetilde{S}$, so the size of $\\mathcal{T} \\cap \\widetilde{S}$ increases by at most $d \\cdot d \\cdot c \\cdot d(2(k+1)!)^{2}$ after adding all $X^{\\alpha, \\beta, i}$ s.\n\nWe follow the same steps for $S_{B}^{\\alpha, \\beta, i}$, guessing the sets and adding vertices to $\\widetilde{S}$. The increase of $|\\mathcal{T} \\cap \\widetilde{S}|$ is bounded similarly.\n\nAt this moment, for every vertex $v \\in S_{A} \\backslash \\widetilde{S}$ there are no incomparable vertices in $N(v) \\cap \\mathcal{T} \\cap B$. A symmetrical statement holds for vertices belonging to $S_{B} \\backslash \\widetilde{S}$.\n\nFix $\\alpha \\in[d]$. Let us denote set $\\left\\{v \\in S_{A} \\backslash \\widetilde{S} \\mid N(v) \\cap A \\cap \\mathcal{T}^{\\alpha} \\neq \\emptyset\\right\\}$ as $\\overline{S_{A}^{\\alpha}}$. Let us divide $\\overline{S_{A}^{\\alpha}}$ into color classes: $\\overline{S_{A}^{\\alpha, 1}}, \\overline{S_{A}^{\\alpha, 2}}, \\ldots, \\overline{S_{A}^{\\alpha, c}}$. Similarly, let $\\overline{S_{B}^{\\alpha}}=\\left\\{v \\in S_{B} \\backslash \\widetilde{S} \\mid N(v) \\cap B \\cap T^{\\alpha} \\neq \\emptyset\\right\\}$ and let $\\overline{S_{B}^{\\alpha, 1}}, \\overline{S_{B}^{\\alpha, 2}}, \\ldots, \\overline{S_{B}^{\\alpha, c}}$ be color classes of $\\overline{S_{B}^{\\alpha}}$.\nClaim 3.5. For each $i \\in[c]$ and $\\alpha \\in[d]$, if $\\overline{S_{A}^{\\alpha, i}} \\neq \\emptyset$, there exists vertices $p^{\\alpha, i}, p_{1}^{\\alpha, i}, p_{2}^{\\alpha, i} \\in \\mathcal{T}^{\\alpha} \\cap A$ and vertices $a^{\\alpha, i}, b^{\\alpha, i}, c^{\\alpha, i} \\in A$ inducing a $P_{3}$ such that every $v \\in \\overline{S_{A}^{\\alpha, i}}$ is either adjacent to at least one of the vertices $p^{\\alpha, i}, p_{1}^{\\alpha, i}, p_{2}^{\\alpha, i}, a^{\\alpha, i}, b^{\\alpha, i}, c^{\\alpha, i}$ or satisfies the following: every $u \\in N(v) \\cap A \\cap \\mathcal{T}^{\\alpha}$ has a neighbor among vertices $a^{\\alpha, i}, b^{\\alpha, i}, c^{\\alpha, i}$.\n\nA symmetrical statement holds for $\\overline{S_{B}^{\\alpha, i}}$ for each $\\alpha \\in[d]$ and $i \\in[c]$.\nProof. Let us fix $i \\in[c]$ and $\\alpha \\in[d]$. We consider $\\overline{S_{A}^{\\alpha, i}}$, for short denoted here as $J$. Let $v^{\\alpha, i} \\in J$ be a vertex, minimizing $\\left|N\\left(v^{\\alpha, i}\\right) \\cap A \\cap \\mathcal{T}^{\\alpha}\\right|$. By the definition of $S_{A}$, there exists an induced path $v^{\\alpha, i}-a^{\\alpha, i}-b^{\\alpha, i}-c^{\\alpha, i}$, where $a^{\\alpha, i}, b^{\\alpha, i}, c^{\\alpha, i} \\in A$. Let $p^{\\alpha, i}$ be any vertex belonging to $N\\left(v^{\\alpha, i}\\right) \\cap A \\cap \\mathcal{T}^{\\alpha}$. Let\n\n$$\nJ_{1}=\\left\\{v \\in J \\backslash\\left(N\\left(a^{\\alpha, i}, b^{\\alpha, i}, c^{\\alpha, i}, p^{\\alpha, i}\\right) \\cap N\\left(X_{B}\\right)\\right) \\mid N(v) \\cap N\\left(v^{\\alpha, i}\\right) \\cap A \\cap \\mathcal{T}^{\\alpha} \\neq \\emptyset\\right\\}\n$$\n\nLet us consider two partial orders on vertices of $J_{1}$ :\n\n- $\\leq_{1}: u \\leq_{1} w \\Leftrightarrow\\left(\\left(N(u) \\cap A \\cap \\mathcal{T}^{\\alpha}\\right) \\cap N\\left(v^{\\alpha, i}\\right)\\right) \\subseteq\\left(\\left(N(w) \\cap A \\cap \\mathcal{T}^{\\alpha}\\right) \\cap N\\left(v^{\\alpha, i}\\right)\\right)$\n- $\\leq_{2}: u \\leq_{2} w \\Leftrightarrow\\left(\\left(N(u) \\cap A \\cap \\mathcal{T}^{\\alpha}\\right) \\backslash N\\left(v^{\\alpha, i}\\right)\\right) \\subseteq\\left(\\left(N(w) \\cap A \\cap \\mathcal{T}^{\\alpha}\\right) \\backslash N\\left(v^{\\alpha, i}\\right)\\right)$\n\nNote that for every $w \\in J_{1}$ the set $\\left(\\left(N(w) \\cap A \\cap \\mathcal{T}^{\\alpha}\\right) \\cap N\\left(v^{\\alpha, i}\\right)\\right)$ is non-empty by the definition of $J_{1}$ and the set $\\left(\\left(N(w) \\cap A \\cap \\mathcal{T}^{\\alpha}\\right) \\backslash N\\left(v^{\\alpha, i}\\right)\\right)$ is non-empty by the choice of $v^{\\alpha, i}$ and the exclusion of neighbors of $p^{\\alpha, i}$ in $J_{1}$.\n\nSuppose that there exists $u$ and $w$, which are incomparable in both orders. Then we can choose following vertices:\n\n- $x_{1} \\in\\left(N(u) \\cap A \\cap \\mathcal{T}^{\\alpha}\\right) \\backslash N\\left(w, v^{\\alpha, i}\\right)$\n- $x_{2} \\in\\left(N(w) \\cap A \\cap \\mathcal{T}^{\\alpha}\\right) \\backslash N\\left(u, v^{\\alpha, i}\\right)$\n- $y_{1} \\in\\left(N(u) \\cap N\\left(v^{\\alpha, i}\\right) \\cap A \\cap \\mathcal{T}^{\\alpha}\\right) \\backslash N(w)$\n- $y_{2} \\in\\left(N(w) \\cap N\\left(v^{\\alpha, i}\\right) \\cap A \\cap \\mathcal{T}^{\\alpha}\\right) \\backslash N(u)$\n\nThen a path $x_{1}-u-y_{1}-v^{\\alpha, i}-y_{2}-w-x_{2}$ is an induced $P_{\\uparrow}$, which is a contradiction. Thus, any pair of vertices of $J_{1}$ is comparable in at least one of the orders.\n\nBy Lemma 2.8 there exists a vertex $v_{1}^{\\alpha, i}$ such that for any other vertex $w \\in J_{1}$ we have $v_{1}^{\\alpha, i} \\leq_{1} w$ or $v_{1}^{\\alpha, i} \\leq_{2} w$. Let us choose vertices $p_{1}^{\\alpha, i} \\in\\left(N\\left(v_{1}^{\\alpha, i}\\right) \\cap A \\cap \\mathcal{T}^{\\alpha} \\cap N\\left(v^{\\alpha, i}\\right)\\right)$ and $p_{2}^{\\alpha, i} \\in\\left(N\\left(v_{1}^{\\alpha, i}\\right) \\cap A \\cap \\mathcal{T}^{\\alpha} \\backslash N\\left(v^{\\alpha, i}\\right)\\right)$. Then for any $w \\in J_{1}$ we have $w \\in N\\left(p_{1}^{\\alpha, i}, p_{2}^{\\alpha, i}\\right) \\cap N\\left(X_{B}\\right)$.\n\nConsider now $v \\in J \\backslash N\\left(p^{\\alpha, i}, p_{1}^{\\alpha, i}, p_{2}^{\\alpha, i}, a^{\\alpha, i}, b^{\\alpha, i}, c^{\\alpha, i}\\right)$; note that $v \\notin J_{1}$. Let $u \\in N(v) \\cap \\mathcal{T}^{\\alpha} \\cap A$. As $v \\notin J_{1}, u v^{\\alpha, i} \\notin E(G)$. Let $Q \\subseteq B$ be ap ath (maybe on just one vertex) such that $v-Q-v^{\\alpha, i}$ is an induced path in $G$. Then, $c^{\\alpha, i}-b^{\\alpha, i}-a^{\\alpha, i}-v^{\\alpha, i}-Q-v-u$ contains an induced $P_{\\tau}$ unless $u$ is adjacent to at least one of the vertices $a^{\\alpha, i}, b^{\\alpha, i}, c^{\\alpha, i}$. This finishes the proof.\n\nFor every $i \\in[c]$ and $\\alpha \\in[d]$, we guess if $\\overline{S_{A}^{\\alpha, i}}$ is nonempty and, if this is the case, we guess the vertices $p^{\\alpha, i}, p_{1}^{\\alpha, i}, p_{2}^{\\alpha, i}, a^{\\alpha, i}, b^{\\alpha, i}, c^{\\alpha, i}$ of Claim 3.5 and put\n\n$$\nN\\left(p^{\\alpha, i}, p_{1}^{\\alpha, i}, p_{2}^{\\alpha, i}, a^{\\alpha, i}, b^{\\alpha, i}, c^{\\alpha, i}\\right) \\cap N\\left(X_{B}\\right)\n$$\n\ninto $\\widetilde{S}$. Perform a symmetrical operation with the roles of $A$ and $B$ swapped.\nLet $K_{A}=\\left\\{a^{\\alpha, i}, b^{\\alpha, i}, c^{\\alpha, i} \\mid i \\in[c], \\alpha \\in[d]\\right\\}$. At this point, for every $w \\in S_{A} \\backslash \\widetilde{S}$, all neighbors of $w$ in $\\mathcal{T} \\cap A$ are in $N\\left(K_{A}\\right)$, while $N\\left(K_{A}\\right) \\subseteq A \\cup S$. Symmetrically we define $K_{B}$. Note that $\\left|K_{A}\\right|,\\left|K_{B}\\right| \\leq 3 c d$.\n\nLet $A^{1}, A^{2}, \\ldots, A^{c}$ and $B^{1}, B^{2}, \\ldots, B^{c}$ be color classes of $A$ and $B$, respectively. For every $i, j \\in$ $[c]$ and $\\alpha \\in[d]$, let $\\overline{S_{A}^{\\alpha, i, j}}$ be the set of those vertices of $\\overline{S_{A}^{\\alpha, i}} \\backslash \\widetilde{S}$ that have a neighbor in $B^{j}$. Symmetrically we define $\\overline{S_{B}^{\\alpha, i, j}}$.\n\nClaim 3.6. For each $i, j \\in[c]$ and $\\alpha \\in[d]$, if $\\overline{S_{A}^{\\alpha, i, j}} \\backslash \\widetilde{S} \\neq \\emptyset$, then there exist $q^{\\alpha, i, j} \\in A$ and $v^{\\alpha, i, j} \\in \\overline{S_{A}^{\\alpha, i, j}}$ such that every vertex $v \\in \\overline{S_{A}^{\\alpha, i, j}} \\backslash\\left(N\\left(q^{\\alpha, i, j}\\right) \\cap N\\left(X_{B}\\right)\\right)$ satisfies $N(v) \\cap B^{j} \\subseteq N\\left(v^{\\alpha, i, j}\\right) \\cap B^{j}$.\n\nA symmetrical statement holds for $\\overline{S_{B}^{\\alpha, i, j}}$ for each $\\alpha \\in[d]$ and $i \\in[c]$.\nProof. Fix $i, j \\in[c]$ and $\\alpha \\in[d]$ and for brevity denote $J=\\overline{S_{A}^{\\alpha, i, j}}$.\nLet us consider two orders on $J$ :\n\n- $\\leq_{1}: u \\leq_{1} w \\Leftrightarrow N(u) \\cap A \\cap \\mathcal{T}^{\\alpha} \\subseteq N(w) \\cap A \\cap \\mathcal{T}^{\\alpha}$\n- $\\leq_{2}: u \\leq_{2} w \\Leftrightarrow\\left(N(u) \\cap B^{j}\\right) \\supseteq\\left(N(w) \\cap B^{j}\\right)$\n\nSuppose that there exist vertices $u$ and $w$ in $J$, which are incomparable in both orders. Then we choose $x_{1} \\in N(u) \\cap A \\cap T^{\\alpha} \\backslash N(w)$ and $x_{2} \\in N(w) \\cap A \\cap T^{\\alpha} \\backslash N(u)$, and $y_{1} \\in N(u) \\cap B^{j} \\backslash N(w)$ and $y_{2} \\in N(w) \\cap B^{j} \\backslash N(u)$. Then $x_{1}-u-y_{1}$ and $x_{2}-w-y_{2}$ are induced paths on 3 vertices and there are no edges between these two paths. As $x_{1}, x_{2} \\in N\\left(a^{\\alpha, i}, b^{\\alpha, i}, c^{\\alpha, i}\\right)$, we can connect these two paths via vertices $a^{\\alpha, i}, b^{\\alpha, i}, c^{\\alpha, i}$, finding then an induced $P_{\\tau}$, which is a contradiction. Thus any pair of vertices is comparable in at least one of these orders.\n\nBy Lemma 2.8 there exists a vertex $v^{\\alpha, i, j} \\in J$ such that for any other vertex $w \\in J$ we have $v^{\\alpha, i, j} \\leq_{1} w$ or $v^{\\alpha, i, j} \\leq_{2} w$. Let $q^{\\alpha, i, j}$ be a vertex belonging to $N\\left(v^{\\alpha, i, j}\\right) \\cap A \\cap \\mathcal{T}^{\\alpha}$. Then for each $w \\in J$ we have $w \\in N\\left(q^{\\alpha, i, j}\\right) \\cap N\\left(X_{B}\\right)$ or $N(w) \\cap B^{j} \\subseteq N\\left(v^{\\alpha, i, j}\\right) \\cap B^{j}$. This finishes the proof of the claim.\n\nFor every $i, j \\in[c]$ and $\\alpha \\in[d]$, guess if $\\overline{S_{A}^{\\alpha, i, j}}$ is nonempty and, if this is the case, guess the vertices $q^{\\alpha, i, j}$ and $v^{\\alpha, i, j}$ of Claim 3.6. Add $N\\left(q^{\\alpha, i, j}\\right) \\cap N\\left(X_{B}\\right)$ and $N\\left(v^{\\alpha, i, j}\\right) \\backslash N\\left(K_{A}\\right)$ to $\\widetilde{S}$.\n\nNote that in the last step we do not add any elements of $N\\left(v^{\\alpha, i, j}\\right) \\cap \\mathcal{T} \\cap A$ to $\\widetilde{S}$. As $v^{\\alpha, i, j} \\notin \\widetilde{S}$ prior to this step and $N\\left(v^{\\alpha, i, j}\\right) \\cap \\mathcal{T} \\cap B$ is of size at most $d$, we add at most $d^{2} c^{2}$ vertices of $\\mathcal{T}$ to $\\widetilde{S}$ in this step.\n\nWe perform a symmetric operation with $A$ and $B$ swapped.\nAt this moment, for every $v \\in S_{A} \\backslash \\widetilde{S}$, we have $N(v) \\cap A \\cap \\mathcal{T} \\subseteq N\\left(K_{A}\\right)$ and $N(v) \\cap B \\subseteq \\widetilde{S}$ and, symmetrically, for every $v \\in S_{B} \\backslash \\widetilde{S}$, we have $N(v) \\cap B \\cap \\mathcal{T} \\subseteq N\\left(K_{B}\\right)$ and $N(v) \\cap A \\subseteq \\widetilde{S}$.\n\nRecall that $\\left|X_{B}\\right| \\leq k$ and $\\left|K_{B}\\right| \\leq 3 c d$. Let $\\widehat{X_{B}}$ be the smallest connected subgraph of $B$, which contains $X_{B} \\cup K_{B}$; as $G$ is $P_{7}$-free, $\\left|\\widehat{X_{B}}\\right| \\leq 7(k+3 c d)$. Symmetrically define $\\widehat{X_{A}}$. Guess $\\widehat{X_{A}}, \\widehat{X_{B}}$ and add $N\\left(\\widehat{X_{A}}\\right) \\cap N\\left(\\widehat{X_{B}}\\right)$ to $\\widetilde{S}$.\n\nWe now perform the following cleaning operation.\n\n1. Guess all vertices of $\\mathcal{T} \\cap \\widetilde{S}$ and, for every $v \\in \\mathcal{T} \\cap \\widetilde{S}$, guess all ancestors of $v$ in $\\mathcal{T}$. Add those ancestors to $\\widetilde{S}$; this increases the size of $\\mathcal{T} \\cap \\widetilde{S}$ by at most a factor of $d$. Now $\\mathcal{T} \\cap \\widetilde{S}$ is a sub-treedepth- $d$ structure of $\\mathcal{T}$.\n2. Guess the depths and parent/child relation in $\\mathcal{T}$ of vertices of $\\mathcal{T} \\cap \\widetilde{S}$. In particular, this guess determines which pairs of vertices are incomparable in $\\mathcal{T}$.\n3. For every pair $u, v$ of vertices of $\\mathcal{T} \\cap \\widetilde{S}$ that are incomparable in $\\mathcal{T}$, add $N(u) \\cap N(v)$ to $\\widetilde{S}$.\n4. For every $v \\in \\mathcal{T}^{d} \\cap \\widetilde{S}$, add $N(v)$ to $\\widetilde{S}$.\n\nNote that due to the first step, subsequent steps do not add any new vertex of $\\mathcal{T}$ to $\\widetilde{S}$.\nAfter the above cleaning, for every $v \\in V(G) \\backslash \\widetilde{S}$, all vertices of $N(v) \\cap \\mathcal{T} \\cap \\widetilde{S}$ are comparable in $\\mathcal{T}$ and do not contain any vertex of $\\mathcal{T}^{d}$. In particular, as $\\mathcal{T}$ is maximal, $v$ has a neighbor in $\\mathcal{T} \\backslash \\widetilde{S}$. Consequently, every vertex of $S_{A} \\backslash \\widetilde{S}$ has a neighbor in $(A \\backslash \\widetilde{S}) \\cap \\mathcal{T}$ and every vertex of $S_{B} \\backslash \\widetilde{S}$ has a neighbor in $(B \\backslash \\widetilde{S}) \\cap \\mathcal{T}$.\n\nWe infer that the connected components of $G-\\widetilde{S}$ are of the following types:\n(clean) Contained in a connected component of $G-S$ (i.e., in $A$, in $B$, or in $G-(A \\cup S \\cup B)$ ), or\n(dirty) Contained in $A \\cup S \\cup B$, with a nonempty intersection both with $S$ and $A \\cup B$.\nObserve that the clean components are disjoint with $N\\left(\\widehat{X_{A}}\\right)$ or with $N\\left(\\widehat{X_{B}}\\right)$ (or both), while the dirty components have nonempty intersection both with $N\\left(\\widehat{X_{A}}\\right)$ and $N\\left(\\widehat{X_{B}}\\right)$, as $S_{A} \\subseteq N\\left(\\widehat{X_{B}}\\right)$, while every vertex of $S_{A} \\backslash \\widetilde{S}$ has a neighbor in $((A \\backslash \\widetilde{S}) \\cap \\mathcal{T})$, which in turn has a neighbor in $K_{A} \\subseteq \\widehat{X_{A}}$, and symmetrically for $B$. Hence, the algorithm can distinguish clean and dirty components.\n\nIn what follows, in a number of steps we will add some vertices to $\\widetilde{S}$, but we will be only adding vertices of $S$. After the updates, we will continue using the nomenclature of clean/dirty components of $G-\\widetilde{S}$, and they always refer to the current value of $\\widetilde{S}$. Note that, as long as we keep the invariant that every vertex of $S_{A} \\backslash \\widetilde{S}$ has a neighbor in $(A \\backslash \\widetilde{S}) \\backslash \\mathcal{T}$ (which is maintained trivially if we add only vertices of $S$ to $\\widetilde{S}$ ), then the method of distinguishing clean and dirty components from the previous paragraph still works.\n\nWe now branch if $S_{A} \\backslash \\widetilde{S}=\\emptyset$. If this is the case, then every dirty component $C$ satisfies $C \\cap$ $N\\left(\\widehat{X_{A}}\\right)=C \\cap S$. We insert $C \\cap N\\left(\\widehat{X_{A}}\\right)$ into $\\widetilde{S}$ for every dirty component $C$. As a result, $S \\subseteq \\widetilde{S}$ while $|\\widetilde{S} \\cap \\mathcal{T}|=\\mathcal{O}_{k, d}(1)$. We insert $(K:=\\widetilde{S}, \\mathcal{D}:=\\emptyset, L:=\\emptyset)$ into $\\mathcal{F}$ and conclude this branch.\n\nSymmetrically we handle a branch $S_{B} \\backslash \\widetilde{S}=\\emptyset$. In the remaining branch, we assume that both $S_{A} \\backslash \\widetilde{S}$ and $S_{B} \\backslash \\widetilde{S}$ are nonempty.\n\nLet $\\widehat{X_{B}}=\\widehat{X_{B}} \\cap N\\left(S_{A} \\backslash \\widetilde{S}\\right)$; note that as $S_{A} \\backslash \\widetilde{S} \\neq \\emptyset$ and $S_{A} \\subseteq N\\left(X_{B}\\right)$, we have $\\widehat{X_{B}} \\neq \\emptyset$. We symmetrically define $\\widehat{X_{A}}$ and observe it is nonempty, too.\n\nWe now focus on connected components of $B \\backslash \\widetilde{S}$. Let $C$ be such a component. Note that $C$ has no neighbors in $S_{A} \\backslash \\widetilde{S}$; hence $C$ is also a connected component of $G-\\widetilde{S}-N\\left(X_{A}\\right)$, and thus can be guessed if needed.\nClaim 3.7. For every connected component $C$ of $B \\backslash \\widetilde{S}$,\n\n1. every $x \\in \\widehat{X_{B}}$ is either complete or anticomplete to $C$, and\n2. if the whole $\\widehat{X_{B}}$ is anticomplete to $C$, then the whole $\\widehat{X_{B}}$ is anticomplete to $C$.\n\nA symmetrical statement holds with $A$ and $B$ swapped.\n\nProof. For the first point, assume there exists $x \\in \\widehat{X_{B}}$ with an induced $P_{3}$ of the form $x-C-C$. Let $y$ be any neighbor of $x$ in $S_{A} \\backslash \\widehat{S}$. Observe that there would exist an induced $P_{7}$ of the form $C-C-x-y-A-A-A$. a contradiction.\n\nIf $C$ is antiadjacent to $\\widehat{X_{B}}$ but has a neighbor in $\\widehat{X_{B}}$, then as $\\widehat{X_{B}} \\neq \\emptyset$ there exists a path $Q$ from $\\widehat{X_{B}}$ via $\\widehat{X_{B}}$ to $C$ of length at least 2 ; let $x$ be its endpoint in $\\widehat{X_{B}}$ and let $y$ be a neighbor of $x$ in $S_{A} \\backslash \\widehat{S}$. Then there exists a $P_{7}$ of the form $Q-y-A-A-A$, a contradiction.\n\nClaim 3.7 distinguishes two types of components of $B \\backslash \\widehat{S}$ : those antiadjacent to $\\widehat{X_{B}}$ and those complete to at least one vertex of $\\widehat{X_{B}}$. Let $\\mathcal{B}_{0}$ and $\\mathcal{B}_{1}$ be the families of components of the first and second type, respectively. Symmetrically define $\\mathcal{A}_{0}$ and $\\mathcal{A}_{1}$.\n\nRecall that every vertex of $S_{B} \\backslash \\widehat{S}$ has a neighbor in $(B \\backslash \\widehat{S}) \\cap \\mathcal{T}$, which in turn has a neighbor in $K_{B} \\subseteq \\widehat{X_{B}}$. This implies the following.\nClaim 3.8. Every vertex of $S_{B} \\backslash \\widehat{S}$ has a neighbor in a component of $\\mathcal{B}_{1}$. Symmetrically, every vertex of $S_{A} \\backslash \\widehat{S}$ has a neighbor in a component of $\\mathcal{A}_{1}$.\n\nFor $v \\in S_{B} \\backslash \\widehat{S}$, let $N_{\\mathcal{B}_{0}}(v)=\\left\\{C \\in \\mathcal{B}_{0} \\mid C \\cap N(v) \\neq \\emptyset\\right\\}$ and $N_{\\mathcal{B}_{1}}(v)=\\left\\{C \\in \\mathcal{B}_{1} \\mid C \\cap N(v) \\neq \\emptyset\\right\\}$.\nWe now sort out adjacencies between $S_{B} \\backslash \\widehat{S}$ and $\\mathcal{B}_{0}$. Let $S_{B, 0}$ be the set of vertices belonging to $S_{B} \\backslash \\widehat{S}$ which have a neighbor in a component of $\\mathcal{B}_{0}$. Let $S_{B, 0}^{1}, S_{B, 0}^{2}, \\ldots, S_{B, 0}^{c}$ be color classes of $S_{B, 0}$. Symmetrically, we define $S_{A, 0}$ and color classes $S_{A, 0}^{c}, \\ldots, S_{A, 0}^{c}$.\nClaim 3.9. For every $i \\in[c]$, if $S_{B, 0}^{i}$ is nonempty, then there exist two components $B_{0, i, 0}$ and $B_{0, i, 1}$ of $B \\backslash \\widehat{S}$ such that $S_{B, 0}^{i} \\subseteq N\\left(B_{0, i, 0} \\cup B_{0, i, 1}\\right)$.\n\nA symmetrical statement holds with $A$ and $B$ swapped.\nProof. Fix $i \\in[c]$. Then we consider two orders on $S_{B, 0}^{i}$ :\n\n- $\\leq_{1}: x \\leq_{1} y \\Leftrightarrow N_{\\mathcal{B}_{1}}(x) \\subseteq N_{\\mathcal{B}_{1}}(y)$\n- $\\leq_{2}: x \\leq_{2} y \\Leftrightarrow N_{\\mathcal{B}_{0}}(x) \\subseteq N_{\\mathcal{B}_{0}}(y)$;\n\nSuppose that there exist $x$ and $y$, which are incomparable in both orders. Then we can choose\n\n- $C_{x} \\in N_{\\mathcal{B}_{1}}(x) \\backslash N_{\\mathcal{B}_{1}}(y)$\n- $C_{y} \\in N_{\\mathcal{B}_{1}}(y) \\backslash N_{\\mathcal{B}_{1}}(x)$\n- $D_{x} \\in N_{\\mathcal{B}_{0}}(x) \\backslash N_{\\mathcal{B}_{0}}(y)$\n- $D_{y} \\in N_{\\mathcal{B}_{0}}(y) \\backslash N_{\\mathcal{B}_{0}}(x)$.\n\nThere are no edges between $C_{x} \\cup D_{x} \\cup\\{x\\}$ and $C_{y} \\cup D_{y} \\cup\\{y\\}$. Then, there is an induced $P_{7}$ of the form $D_{x}-x-C_{x}-\\widehat{X_{B}}-C_{y}-y-D_{y}$, a contradiction. Thus any pair of vertices is comparable in at least one order.\n\nBy Lemma 2.8 we can choose a vertex $v^{i} \\in S_{B, 0}^{i}$ such that for any other vertex $y \\in S_{B, 0}^{i}$ we have $v^{i} \\leq_{1} y$ or $v^{i} \\leq_{2} y$. Hence, any $B_{0, i, 0} \\in N_{\\mathcal{B}_{0}}\\left(v^{i}\\right)$ (which exists by the definition of $S_{B, 0}$ ) and any $B_{0, i, 1} \\in N_{\\mathcal{B}_{1}}\\left(v^{i}\\right)$ (which we exists by Claim 3.8) would do the job.\n\nAs discussed, components of $\\mathcal{B}_{0} \\cup \\mathcal{B}_{1}$ are components of $G-\\widehat{S}-N\\left(X_{A}\\right)$ and can be guessed. For every $i \\in[c]$, we guess $B_{0, i, 0}$ and $B_{0, i, 1}$ and add $N\\left(B_{0, i, 0} \\cup B_{0, i, 1}\\right) \\cap N\\left(X_{A}\\right)$ to $\\widehat{S}$.\n\nWe perform a symmetrical operation for $A$. As a result, no vertex of $S_{B} \\backslash \\widehat{S}$ has a neighbor in a component of $\\mathcal{B}_{0}$ and no vertex of $S_{A} \\backslash \\widehat{S}$ has a neighbor in $\\mathcal{A}_{0}$. Also, we added to $\\widehat{S}$ only vertices of $S$, so in particular no vertex of $\\mathcal{T}$ was added to $\\widehat{S}$ and the families $\\mathcal{B}_{0}, \\mathcal{B}_{1}, \\mathcal{A}_{0}$, and $\\mathcal{A}_{1}$ stay intact.\n\nWe say that $x \\in S_{B} \\backslash \\widehat{S}$ is mixed to a component $C \\in \\mathcal{B}_{1}$ if there exists an induced path $x-C-C$ or, equivalently, $x$ is neither complete nor anticomplete to $C$. A component $C \\in \\mathcal{B}_{1}$ is problematic if there is $x \\in S_{B} \\backslash \\widehat{S}$ that is mixed to $C$. For $x \\in S_{B} \\backslash \\widehat{S}$ we denote by $\\operatorname{Prob}(x) \\subseteq \\mathcal{B}_{1}$ the set\n\nof components $x$ is mixed to and by $\\operatorname{All}(x) \\subseteq \\mathcal{B}_{1}$ the set of components $x$ is mixed or complete to. Let $S_{B}^{P}$ be the set of all vertices of $S_{B} \\backslash \\widetilde{S}$ that are mixed to at least one component of $\\mathcal{B}_{1}$ (i.e., $\\left.S_{B}^{P}=\\left\\{x \\in S_{B} \\backslash \\widetilde{S} \\mid \\operatorname{Prob}(x) \\neq \\emptyset\\right\\}\\right)$ and let $S_{B}^{P, 1}, S_{B}^{P, 2}, \\ldots, S_{B}^{P, c}$ be color classes of $S_{B}^{P}$. We introduce symmetrical definitions with $A$ and $B$ swapped.\nClaim 3.10. For each $i \\in[c]$ and any pair of vertices $v_{1}, v_{2} \\in S_{B}^{P, i}$ we have either $\\operatorname{Prob}\\left(v_{1}\\right) \\subseteq \\operatorname{All}\\left(v_{2}\\right)$ or $\\operatorname{Prob}\\left(v_{2}\\right) \\subseteq \\operatorname{All}\\left(v_{1}\\right)$. A symmetrical statement holds for any pair of vertices of $S_{A}^{P, i}$ for each $i \\in[c]$.\nProof. Fix $i \\in[c]$. Suppose that there exist vertices $v_{1}$ and $v_{2}$ in $S_{B}^{P, i}$ and components $C_{v_{1}} \\in \\operatorname{Prob}\\left(v_{1}\\right) \\backslash$ $\\operatorname{All}\\left(v_{2}\\right)$ and $C_{v_{2}} \\in \\operatorname{Prob}\\left(v_{2}\\right) \\backslash \\operatorname{All}\\left(v_{1}\\right)$. Then there exist two induced $P_{3} s v_{1}-C_{v_{1}}-C_{v_{1}}$ and $v_{2}-C_{v_{2}}-C_{v_{2}}$, which can be connected via $\\widetilde{X_{A}}$, so we can find a $P_{\\uparrow}$, a contradiction.\n\nClaim 3.11. For every $i \\in[c]$ there exists components $C_{v^{i}}, C_{u^{i}}^{1}, C_{u^{i}}^{2} \\in \\mathcal{B}_{1}$ such that $S_{B}^{P, i} \\subseteq\\left(N\\left(C_{v^{i}}\\right) \\cup N\\left(C_{u^{i}}^{1}\\right) \\cup N\\left(C_{u^{i}}^{2}\\right)\\right) \\cap N\\left(\\widetilde{X_{A}}\\right)$. A symmetrical statement holds for $S_{A}^{P, i}$ for each $i \\in[c]$.\n\nProof. Fix $i \\in[c]$. Let $v^{i} \\in S_{B}^{P, i}$ be a vertex, which has neighbors in the smallest number of problematic components. Choose any $C_{v^{i}} \\in \\operatorname{Prob}\\left(v^{i}\\right)$. Let $w$ be any vertex in $S_{B}^{P, i} \\backslash\\left(N\\left(C_{v^{i}}\\right) \\cap N\\left(X_{A}\\right)\\right)$. Since $C_{v^{i}} \\in \\operatorname{Prob}\\left(v^{i}\\right) \\backslash \\operatorname{All}(w)$, by Claim 3.10 we know that $\\operatorname{Prob}(w) \\subseteq \\operatorname{All}\\left(v^{i}\\right)$. By the minimality of $v^{i}$, we know that $\\operatorname{All}(w) \\backslash \\operatorname{All}\\left(v^{i}\\right) \\neq \\emptyset$. Let us consider two orders on $S_{B}^{P, i} \\backslash\\left(N\\left(C_{v^{i}}\\right) \\cap N\\left(X_{A}\\right)\\right)$ :\n\n- $\\leq_{1}: u \\leq_{1} w \\Leftrightarrow\\left\\{C \\in \\operatorname{All}\\left(v^{i}\\right) \\mid N(u) \\cap C \\neq \\emptyset\\right\\} \\subseteq\\left\\{C \\in \\operatorname{All}\\left(v^{i}\\right) \\mid N(w) \\cap C \\neq \\emptyset\\right\\}$\n- $\\leq_{2}: u \\leq_{1} w \\Leftrightarrow\\left\\{C \\in \\mathcal{B}_{1} \\backslash \\operatorname{All}\\left(v^{i}\\right) \\mid N(u) \\cap C \\neq \\emptyset\\right\\} \\subseteq\\left\\{C \\in \\mathcal{B}_{1} \\backslash \\operatorname{All}\\left(v^{i}\\right) \\mid N(w) \\cap C \\neq \\emptyset\\right\\}$\n\nNote that for every $u \\in S_{B}^{P, i} \\backslash\\left(N\\left(C_{v^{i}}\\right) \\cap N\\left(\\widetilde{X_{A}}\\right)\\right)$ the set $\\left\\{C \\in \\operatorname{All}\\left(v^{i}\\right) \\mid N(u) \\cap C \\neq \\emptyset\\right\\}$ is non-empty, as by Claim 3.10 we have $\\emptyset \\neq \\operatorname{Prob}(u) \\subseteq \\operatorname{All}\\left(v^{i}\\right)$. Similarly, for every $u \\in S_{B}^{P, i} \\backslash\\left(N\\left(C_{v^{i}}\\right) \\cap N\\left(\\widetilde{X_{A}}\\right)\\right)$ the set $\\left\\{C \\in \\mathcal{B}_{1} \\backslash \\operatorname{All}\\left(v^{i}\\right) \\mid N(u) \\cap C \\neq \\emptyset\\right\\}$ is non-empty by the choice of $v^{i}$ and the exclusion of $N\\left(C_{v^{i}}\\right)$.\n\nSuppose that there exist $u$ and $w$ which are incomparable in both these orders. Then we can choose the following components:\n\n- $C_{u}^{1} \\in \\operatorname{All}\\left(v^{i}\\right)$ such that $N(u) \\cap C_{u}^{1} \\neq \\emptyset$ and $N(w) \\cap C_{u}^{1}=\\emptyset$\n- $C_{u}^{2} \\in \\mathcal{B}_{1} \\backslash \\operatorname{All}\\left(v^{i}\\right)$ such that $N(u) \\cap C_{u}^{2} \\neq \\emptyset$ and $N(w) \\cap C_{u}^{2}=\\emptyset$\n- $C_{w}^{1} \\in \\operatorname{All}\\left(v^{i}\\right)$ such that $N(w) \\cap C_{w}^{1} \\neq \\emptyset$ and $N(u) \\cap C_{u}^{1}=\\emptyset$\n- $C_{w}^{2} \\in \\mathcal{B}_{1} \\backslash \\operatorname{All}\\left(v^{i}\\right)$ such that $N(w) \\cap C_{w}^{2} \\neq \\emptyset$ and $N(u) \\cap C_{u}^{1}=\\emptyset$\n\nThen there exists a path $C_{u}^{2}-u-C_{u}^{1}-v^{i}-C_{w}^{1}-w-C_{w}^{2}$ that contains a $P_{\\uparrow}$, a contradiction. Hence, any pair of vertices is comparable in at least one order.\n\nTherefore by Lemma 2.8 there exists a vertex $u^{i}$ such that for any other vertex $w \\in S_{B}^{P, i} \\backslash\\left(N\\left(C_{v}\\right) \\cap\\right.$ $\\left.N\\left(\\widetilde{X_{A}}\\right)\\right)$ we have $u^{i} \\leq_{1} w$ or $u^{i} \\leq_{2} w$. Let $C_{u^{i}}^{1} \\in \\operatorname{All}\\left(v^{i}\\right)$ and $C_{u^{i}}^{2} \\in \\mathcal{B}_{1} \\backslash \\operatorname{All}\\left(v^{i}\\right)$ such that $N\\left(u^{i}\\right) \\cap C_{u}^{1} \\neq \\emptyset$ and $N\\left(u^{i}\\right) \\cap C_{u}^{2} \\neq \\emptyset$. Then by the choice of $u^{i}$ we have that $S_{B}^{P, i} \\backslash\\left(N\\left(C_{v^{i}}\\right) \\cap N\\left(\\widetilde{X_{A}}\\right)\\right) \\subseteq$ $\\left(N\\left(C_{u^{i}}^{1}\\right) \\cup N\\left(C_{u^{i}}^{2}\\right)\\right) \\cap N\\left(\\widetilde{X_{A}}\\right)$. Therefore $S_{B}^{P, i} \\subseteq\\left(N\\left(C_{v^{i}}\\right) \\cup N\\left(C_{u^{i}}^{1}\\right) \\cup N\\left(C_{u^{i}}^{2}\\right)\\right) \\cap N\\left(\\widetilde{X_{A}}\\right)$.\n\nBy symmetry, we show that there exist sought components $C_{v^{i}}, C_{u^{i}}^{1}, C_{u^{i}}^{2} \\in \\mathcal{A}_{1}$ for each $S_{A}^{P, i}$.\nFor every $i \\in[c]$, we guess components $C_{v^{i}}, C_{u^{i}}^{1}$ and $C_{u^{i}}^{2}$ in $\\mathcal{B}_{1}$ whose existence is guaranteed by Claim 3.11, and add $\\left(N\\left(C_{v^{i}}\\right) \\cup N\\left(C_{u^{i}}^{1}\\right) \\cup N\\left(C_{u^{i}}^{2}\\right)\\right) \\cap N\\left(\\widetilde{X_{A}}\\right)$ to $\\widetilde{S}$. We perform symmetric operation for $S_{A}^{P, i}$.\n\nBy Claim 3.11, we have $S_{A}^{P} \\cup S_{B}^{P} \\subseteq \\widetilde{S}$, while we added only vertices of $S$ to $\\widetilde{S}$. Now, every vertex of $S_{B} \\backslash \\widetilde{S}$ is complete or anticomplete to every component of $\\mathcal{B}_{1}$ (and anticomplete to every component of $\\mathcal{B}_{0}$ ).\n\nConsequently, for every dirty component $C$, every connected component of $C \\cap B$ is a module of $G[C]$ and every connected component of $C \\cap A$ is a module of $G[C]$. Furthermore, observe that thanks to Claim 3.7 for every dirty component $C$, we have $C \\cap N\\left(\\overline{X_{A}}\\right)=\\left(C \\cap A\\right) \\cup\\left(C \\cap S_{B}\\right)$ and $C \\cap N\\left(\\overline{X_{B}}\\right)=(C \\cap B) \\cup\\left(C \\cap S_{A}\\right)$. That is, $\\left(C \\cap N\\left(\\overline{X_{A}}\\right)\\right)$ and $\\left(C \\cap N\\left(\\overline{X_{B}}\\right)\\right)$ is a partition of $C$ which the algorithm can compute. Moreover, every connected component of $G\\left[C \\cap N\\left(\\overline{X_{A}}\\right)\\right]$ is either a component of $A \\backslash \\widetilde{S}$ or a component of $S_{B} \\backslash \\widetilde{S}$ and every connected component of $G\\left[C \\cap N\\left(\\overline{X_{B}}\\right)\\right]$ is either a component of $B \\backslash \\widetilde{S}$ or a component of $S_{A} \\backslash \\widetilde{S}$.\n\nSince every connected component of $C \\cap B$ and of $C \\cap A$ is a module of $G[C]$, we know that all components of $G\\left[C \\cap N\\left(\\overline{X_{A}}\\right)\\right]$ or of $G\\left[C \\cap N\\left(\\overline{X_{B}}\\right)\\right]$ that are not modules of $G[C]$ are part of $\\widetilde{S}$. That is, we perform the following step exhaustively: while there exists a dirty component $C$ and a component $C^{\\prime}$ of either $G\\left[C \\cap N\\left(\\overline{X_{A}}\\right)\\right]$ or $G\\left[C \\cap N\\left(\\overline{X_{B}}\\right)\\right]$ that is not a module of $G[C]$, move $C^{\\prime}$ to $\\widetilde{S}$. This step, again, adds only vertices belonging to $S$ to $\\widetilde{S}$.\n\nIn the end, for every dirty component $C,\\left(C \\cap \\overline{X_{A}}, C \\cap \\overline{X_{B}}\\right)$ is a partition of $C$ such that every component of $G\\left[C \\cap \\overline{X_{A}}\\right]$ and every component of $G\\left[C \\cap \\overline{X_{B}}\\right]$ is a module of $G[C]$. Let $\\mathcal{D}$ be the set of dirty components and, for $C \\in \\mathcal{D}$, let $L(C)=C \\cap \\overline{X_{A}}$. Then, $(K:=\\widetilde{S}, \\mathcal{D}, L)$ satisfies the requirements of the lemma for $(A, S, B)$ and we add this tuple to $\\mathcal{F}$.\n\nThis finishes the proof of Theorem 3.1.", "tables": {}, "images": {}}, {"section_id": 11, "text": "# $4 \\quad P_{7}$-free bipartite graphs \n\nIn this section we focus on $P_{7}$-free bipartite graphs. We prove the following theorem.\nTheorem 4.1. There exists an algorithm that, given a $P_{7}$-free bipartite graph $G$ and an integer $d>0$, runs in time $n^{2^{2 \\mathcal{O}\\left(d^{3}\\right)}}$ and computes a family $\\mathcal{C}$ of subsets of $V(G)$ with the following guarantee: for every treedepth-d structure $\\mathcal{T}$ in $G$, there exists a tree decomposition $(T, \\beta)$ of $G$ such that for every $t \\in V(T)$ we have $\\beta(t) \\in \\mathcal{C}$ and $|\\beta(t) \\cap \\mathcal{T}|=2^{2^{\\mathcal{O}\\left(d^{3}\\right)}}$.\n\nThe general approach is to reduce to the case of chordal bipartite graphs. Recall that a bipartite graph is chordal bipartite if its every cycle of length longer than 4 has a chord (i.e., the only induced cycles are of length 4).\n\nThe class of MWIS problems is tractable on chordal bipartite graphs thanks to the following result of Kloks, Liu, and Poon (and the general algorithm of Fomin, Todinca, and Villanger [19]).\nTheorem 4.2 (Corollary 2 of [29]). A chordal bipartite graph on $n$ vertices and $m$ edges has $\\mathcal{O}(n+m)$ minimal separators.\n\nObserve that $P_{7}$-free bipartite graphs are \"almost\" chordal bipartite: they only additionally allow $C_{6}$ as an induced subgraph. Our approach is to add edges to the input graph so that it becomes chordal bipartite, without destroying the sought solution. To this end, the following folklore characterization will be handy.\n\nLemma 4.3 (folklore). Let $G$ be a bipartite graph with bipartition $V_{1}, V_{2}$. Then, $G$ is chordal bipartite if and only if for every minimal separator $S$ of $G, S \\cap V_{1}$ is complete to $S \\cap V_{2}$ (i.e., the separator induces a complete bipartite graph, also called a biclique).\n\nProof. In one direction, assume that $G$ contains a cycle $C$ of length $\\ell \\geq 6$ as an induced subgraph and let $x_{1}, x_{2}, \\ldots, x_{\\ell}$ be consecutive vertices of $C$. Then, $\\left\\{x_{2}, x_{3}\\right\\}$ and $\\left\\{x_{5}, \\ldots, x_{\\ell}\\right\\}$ are anticomplete. Furthermore, any minimal separator separating these sets contains $x_{1}$ and $x_{4}$, which are nonadjacent and on the opposite bipartition sides of $G$\n\nIn the other direction, let $S$ be a minimal separator of $G$ with two full components $A, B$ and vertices $x \\in S \\cap V_{1}, y \\in S \\cap V_{2}, x y \\notin E(G)$. Observe that, thanks to the bipartiteness of $G$, a shortest path from $x$ to $y$ via $A$ is of length at least 3 , and similarly via $B$. These two shortest path together form an induced cycle of length at least 6 .\n\nLemma 4.3 motivates the following process of completing a $P_{7}$-free bipartite graph $G$ into a chordal bipartite graph: while $G$ contains a minimal separator $S$ that violates the statement of Lemma 4.3, complete $G[S]$ into a biclique. In Section 4.1 we analyse this process and show that it is well-behaved on $P_{7}$-free graphs, in particular, does not lead outside the class of $P_{7}$-free bipartite graphs.", "tables": {}, "images": {}}, {"section_id": 12, "text": "# 4.1 Completing to a chordal bipartite graph \n\nThroughout the rest of this section we assume that the input graph $G$ has a fixed bipartition into sets $V_{1}, V_{2}$ (this is an ordered partition). We remark that we will often look at certain induced subgraphs of $G$ that are not necessarily connected, but a vertex never changes its side of the bipartition.\n\nLemma 4.3 motivates the following definition. Let $G$ be a bipartite graph with bipartition $V_{1}, V_{2}$, and let $S$ be a minimal separator of $G$. We say that $S$ induces a biclique if $S \\cap V_{1}$ is complete to $S \\cap V_{2}$. The operation of completing $S$ into a biclique turns $G$ into a graph $G+F:=(V(G), E(G) \\cup F)$, where $F=\\left\\{u v \\mid u \\in S \\cap V_{1}, v \\in S \\cap V_{2}, u v \\notin E(G)\\right\\}$.\n\nThe following lemma is pivotal to our completion process.\nLemma 4.4. Let $G$ be a $P_{7}$-free bipartite graph. Let $S$ be a minimal separator and let $A$ and $B$ be two full components of $S$. Let $G+F$ be the result of completing $S$ into a biclique. Then $G+F$ is also $P_{7}$-free.\n\nProof. By contradiction, suppose that $G+F$ contains a $P_{7}$. Let $Q$ be a $P_{7}$ in $G+F$, which minimizes $|E(Q) \\cap F|$ among all $P_{7}$ s contained in $G+F$.\n\nAs $G$ is $P_{7}$-free, $E(Q) \\cap F \\neq \\emptyset$. Consequently, $|V(Q) \\cap S| \\geq 2$. We consider several cases.\nCase A. $|V(Q) \\cap S|=2$.\nLet $V(Q) \\cap S=\\{x, y\\}$. Note that $E(Q) \\cap F=\\{x y\\}$, i.e., $x y \\in F$ and $x y \\notin E(G)$. Let $Q_{x}$ and $Q_{y}$ be the components of $Q-\\{x y\\}$ that contain $x$ and $y$, respectively.\n\nSince $|V(Q) \\backslash S|=5$, without loss of generality assume that $Q_{x}$ is of length at most 2 and $Q_{y}$ is of length at least 3 . Note that $Q_{y} \\backslash\\{y\\}$ is contained in a single component of $G-S$; without loss of generality assume that this component is not $A$. Let $R$ be a shortest path from $x$ to $y$ via $A$; note that $R$ has at least 3 edges. Then, the concatenation of $R$ and $Q_{y}$ is an induced path in $G$ on at least 7 vertices, a contradiction.\n\nCase B. $|V(Q) \\cap S|>2$.\nAs $S$ induces a biclique in $G+F$, we have $|V(Q) \\cap S|=3$ and $V(Q) \\cap S$ consists of three consecutive vertices of $Q$; call these vertices $x, y, z$ (in the order of appearance on $Q$, i.e., $x y, y z \\in E(G) \\cup F$ ).\n\nAs $E(Q) \\cap F \\neq \\emptyset$, either $x y \\in F$ or $y z \\in F$ (or both). Without loss of generality, we can assume that $x y \\in F$. Note that $y z$ may or may not belong to $F$.\n\nLet $Q_{x}$ and $Q_{z}$ be the components of $Q-\\{y\\}$ that contain $x$ and $z$, respectively. Each of $Q_{x}-\\{x\\}$ and $Q_{z}-\\{z\\}$ is contained in a single component of $G-S$. By the symmetry between $A$ and $B$, we assume that $Q_{z}-\\{z\\}$ is not contained in $A$.\n\nLet $R$ be a shortest path from $x$ to $y$ via $A$; as before, $R$ is of length at least 3 . Let $p$ be the neighbor of $x$ on $R$.\n\nIn the following we consider cases depending on the position of $x$ on $Q$.\n\n1. Vertex $x$ is the first or the second vertex of $Q$, i.e., $Q_{x}$ is of length at most 1 .\n\nIf $p z \\in E(G)$, then substituting $y$ with $p$ on $Q$ yields a $P_{7}$ in $G$. If $p z \\notin E(G)$, then the concatenation of $Q_{z}$, the edge $y z$, and $R-\\{x\\}$ is an induced path on at least 7 vertices either in $G$ (if $y z \\in E(G)$ ) or in $G+F$ with strictly fewer edges of $F$ than $Q$ (if $y z \\in F$ ). In all cases, we get a contradiction.\n2. There are at least three vertices before $x$ on the path $Q$, i.e., $Q_{x}$ is of length at least 3 .\n\nIf $Q_{x}-\\{x\\}$ is contained in $A$, then let $R^{\\prime}$ be a shortest path from $x$ to $y$ via $B$, and otherwise let $R^{\\prime}:=R$. Then, the concatenation of $R^{\\prime}$ and $Q_{x}$ is an induced path in $G$ on at least 7 vertices, a contradiction.\n\n3. Vertices $x, y, z$ are the middle vertices of $Q$, i.e., both $Q_{x}$ and $Q_{z}$ are of length 2 .\n\nIf there exists a component $C \\in \\operatorname{cc}(G-S)$ such that $x, z \\in N(C)$ and $V(Q) \\cap C=\\emptyset$, then we can connect $x$ and $z$ via a shortest path $R_{C}$ in $C$. Then the concatenation of $Q_{x}, R_{C}$, and $Q_{z}$ is an induced path on at least 7 vertices, a contradiction.\nIf there is no such component $C$, then $Q$ must be of a form $a_{1}-a_{2}-x-y-z-b_{2}-b_{1}$, where $a_{1}, a_{2} \\in A$ and $b_{1}, b_{2} \\in B$. Note that if there is a path connecting $x$ and $z$ via $A$ or $B$ with at least 3 intermediate vertices, then we can extend this path with either $a_{2}$ and $a_{1}$ or $b_{2}$ and $b_{1}$ to get a $P_{7}$. Similarly, if there a path connecting $x$ and $y$ (or $y$ and $z$ if $y z \\in F$ ) via $A$ or $B$ with at least four intermediate vertices, then we can also extend it with $a_{2}$ and $a_{1}$ or $b_{2}$ and $b_{1}$ to get a $P_{7}$. Consequently, $R$ is of the form $x-p-q-y$ with $p, q \\in A$.\nWe make the following observation. If there exists $u \\in A$ such that $x, z \\in N(u)$ and $a_{1} \\notin N(u)$, then a path $a_{1}-a_{2}-x-u-z-b_{2}-b_{1}$ is a $P_{7}$ in $G$. Thus any vertex in $A$ which is a neighbor of $x$ and $z$ is also a neighbor of $a_{1}$. By symmetry any vertex in $B$ which is a neighbor of $x$ and $z$ is also a neighbor of $b_{1}$.\nSuppose now that $p z \\in E(G)$. By the observation above, we have $p a_{1} \\in E(G)$. If $a_{2} q \\notin E(G)$, then a path $a_{2}-a_{1}-p-q-y-B-B$ is a $P_{7}$ in $G$, a contradiction (here, $y-B-B$ stands for any two-edge path from $y$ into $B$, which exists as $B$ is connected and contains at least 2 vertices). Otherwise, a path $a_{1}-a_{2}-q-y-z-b_{2}-b_{1}$ is an induced $P_{7}$ in $G+F$, which has strictly fewer edges in $F$ than $Q$, a contradiction.\nTherefore, $p z \\notin E(G)$. If $y z \\in E(G)$, then a path $x-p-q-y-z-b_{2}-b_{1}$ is an induced $P_{7}$ in $G$. Thus $y z \\in F$. Let $R^{\\prime}$ be the shortest path connecting $y$ and $z$ via $B$. We have that $R^{\\prime}=$ $z-p^{\\prime}-q^{\\prime}-y$ for some $p^{\\prime}, q^{\\prime} \\in B$. If $p^{\\prime} x \\in E(G)$, then we can conclude in an analogous way to a case if $p z \\in E(G)$. Therefore we can assume that $p^{\\prime} x \\notin E(G)$. The path $x-p-q-y-q^{\\prime}-p^{\\prime}-z$ is an induced $P_{7}$ in $G$ then, which is the final contradiction.\n\nThis completes the proof.\nIn the next lemma, we establish that completing a minimal separator into a biclique in a $P_{7}$-free graph does not create new $C_{6} \\mathrm{~s}$.\n\nLemma 4.5. Let $G$ be a $P_{7}$-free bipartite graph. Let $S$ be a minimal separator in $G$ and let $A$ and $B$ two full components of $S$. Let $G+F$ be the result of completing $S$ into a biclique. Let $C$ be an induced $C_{6}$ in $G+F$. Then, $C$ is also an induced $C_{6}$ in $G$.\n\nProof. By contradiction, suppose that $E(C) \\cap F \\neq \\emptyset$. As $S$ in a biclique in $G+F, V(C) \\cap S$ contains either two or three consecutive vertices of $C$. Thus, $P:=C \\backslash S$ is a path and belongs to exactly one component of $G-S$. Without loss of generality, we can assume that $P$ does not lie in $B$, i.e., $C \\cap B=\\emptyset$.\n\nLet $x, z \\in V(C) \\cap S$ be the two vertices of $C$ adjacent on $C$ to the vertices of $P$. Note that $x z \\notin E(G)$ : either $|V(C) \\cap S|=3$ and $x, z$ are on the same biparteness side of $G$ or $|V(C) \\cap S|=2$ and then $x z \\in F$.\n\nLet $R$ be the shortest path from $x$ to $z$ via $B$. Then, $R \\cup P$ induce a hole $C^{\\prime}$ in $G$. Since $R$ is of length at least $2, C^{\\prime}$ is not shorter than $C$. Since $G$ is $P_{7}$-free, $C^{\\prime}$ is a six-vertex hole. This can only happen if $R$ is of length 2 and $V(C) \\cap S=\\{x, y, z\\}$ for some $y \\in S$. Then, $C=x-y-z-r-q-p-x$, where $p, q, r$ lie in a single component of $G-S$ different than $B$. Without loss of generality, we can assume that $y z \\in F$. Then we can find a shortest path $R^{\\prime}$, which connects $y$ and $z$ via $B$; it is of length at least 3. Then the path $R-r-q-p$ is an induced path in $G$ on at least 7 vertices, a contradiction.\n\nLet $G$ be a $P_{7}$-free bipartite graph with fixed bipartition $V_{1}, V_{2}$, and let $\\mathcal{T}$ be a treedepth- $d$ structure in $G$. A tuple $(C, x, y)$ is a bad $C_{6}$ (with respect to $\\mathcal{T}$ ) in $G$ if $C$ is an induced six-vertex cycle in $G$, and $x \\in V_{1}, y \\in V_{2}$ are two vertices that are at the same time (a) opposite vertices of $C$, and (b) incomparable vertices of $\\mathcal{T}$. That is, if one adds the edge $x y$ to $G$ (which can be done without violating\n\nthe biparteness of $G$ ), then one breaks the treedepth- $d$ structure $\\mathcal{T}$, i.e., $\\mathcal{T}$ is not a treedepth- $d$ structure in $G+x y$.\n\nWe have the following simple corollary of Lemma 4.5.\nLemma 4.6. Let $G$ be a $P_{7}$-free bipartite graph, let $\\mathcal{T}$ be a treedepth- $d$ structure in $G$, let $S$ be a minimal separator in $G$, and let $G+F$ be a result of completing $S$ into a biclique. Assume that there is no bad $C_{6}$ in $G$ with respect to $\\mathcal{T}$. Then, $\\mathcal{T}$ is a treedepth- $d$ structure in $G+F$ and, furthermore, there is no bad $C_{6}$ in $G+F$ with respect to $\\mathcal{T}$.\n\nProof. Let $A$ and $B$ be two full components of $S$. Let $x y \\in F$ be arbitrary. Let $R_{A}$ and $R_{B}$ be shortest paths from $x$ to $y$ via $A$ and $B$, respectively. Then, the concatenation of $R_{A}$ and $R_{B}$ is an induced cycle $C$ in $G$; since $G$ is $P_{7}$-free, $C$ is a six-vertex cycle with $x$ and $y$ being two opposite vertices. Since $(C, x, y)$ is not a bad $C_{6}$ w.r.t. $\\mathcal{T}$, the addition of the edge $x y$ does not break the treedepth- $d$ structure $\\mathcal{T}$. Since the choice of $x y \\in F$ was arbitrary, $\\mathcal{T}$ is a treedepth- $d$ structure in $G+F$. Furthermore, Lemma 4.5 ensures that every $C_{6}$ in $G+F$ is also present in $G$; thus, $G+F$ does not contain a bad $C_{6}$ w.r.t. $\\mathcal{T}$.\n\nWe conclude this section with the following enumeration.\nLemma 4.7. There exists an algorithm that, given a $P_{7}$-free bipartite graph $G$ and an integer $d$, runs in polynomial time and returns a family $\\mathcal{C}$ of subsets of $V(G)$ of size $\\mathcal{O}\\left(|V(G)|^{5}\\right)$ with the following property: for every treedepth- $d$ structure $\\mathcal{T}$ in $G$ that admits no bad $C_{6}$, there exists a tree decomposition $(T, \\beta)$ of $G$ such that for every $t \\in V(T)$, the set $\\beta(t)$ belongs to $\\mathcal{C}$ and $\\beta(t)$ contains at most $d$ elements of $\\mathcal{T}$.\n\nProof. Consider the following process. Start with $\\widehat{G}:=G$. While $\\widehat{G}$ is not chordal bipartite, find an induced six-vertex cycle $C$ in $G$, fix two opposite vertices $x$ and $y$ in $C$, find a minimal separator $S$ in $G$ that contains $x$ and $y$ (note that any minimal separator separating the two components of $C-\\{x, y\\}$ would do), complete $S$ into a biclique obtaining $\\widehat{G}+F$, and set $\\widehat{G}:=\\widehat{G}+F$.\n\nLemma 4.4 ensures that $\\widehat{G}$ stays $P_{7}$-free bipartite. Lemma 4.6 ensures that every treedepth- $d$ structure $\\mathcal{T}$ in $G$ that admits no bad $C_{6}$ remains so in $\\widehat{G}$.\n\nBy Theorem 4.2, $\\widehat{G}$ has $\\mathcal{O}\\left(|V(G)|^{2}\\right)$ minimal separators. By Theorem 2.2, $\\widehat{G}$ has $\\mathcal{O}\\left(|V(G)|^{5}\\right)$ potential maximal cliques and they can be enumerated in polynomial time. We return the list of all potential maximal cliques of $\\widehat{G}$ as $\\mathcal{C}$.\n\nAs shown in [13], there exists a minimal chordal completion $F$ of $\\widehat{G}$ such that for every maximal clique $\\Omega$ of $\\widehat{G}+F$, the set $\\Omega \\cap \\mathcal{T}$ is contained in a single leaf-to-root path in $\\mathcal{T}$ and thus is of size at most $d$. Since all these maximal cliques are enumerated in $\\mathcal{C}$, any clique tree of $\\widehat{G}+F$ serves as the promised tree decomposition $(T, \\beta)$.", "tables": {}, "images": {}}, {"section_id": 13, "text": "# 4.2 Cleaning \n\nIn this section we define a branching step that cleans a specific part of the graph. The step will be general enough to be applicable in many contexts.\n\nLet $G$ be a $P_{7}$-free bipartite graph. We say that a triple $(A, B, C)$ of pairwise disjoint vertex sets of $G$ is $\\bigvee$-free if there are no two anticomplete $P_{3} \\mathrm{~s}$ of the form $A-B-C$. Note that such a configuration naturally appears in a $P_{7}$-free bipartite graph if $A \\cup C$ is in one side on the bipartition, $B$ is in the other side, and there is an additional vertex $v$ in the same side as $B$ such that $A \\subseteq N(v)$ but $C \\cap N(v)=\\emptyset$.\n\nIn our case, $\\bigvee$-free sets appear naturally in the following context.\nLemma 4.8. Let $G$ be a $P_{7}$-free bipartite graph with a fixed bipartition $V_{1}, V_{2}$. Let $A$ and $C$ be two disjoint subsets contained in $V_{i}$, for some $i \\in\\{1,2\\}$, and let $B \\subseteq V_{3-i}$. Furthermore, assume that there exists a vertex $v \\in V_{3-i} \\backslash B$ such that $A \\subseteq N(v)$ but $C \\cap N(v)=\\emptyset$. Then, $(A, B, C)$ is $\\bigvee$-free.\n\nProof. Any two anticomplete $P_{3} \\mathrm{~s}$ of the form $A-B-C$, together with $v$, induce a $P_{7}$ in $G$.\n\nRecall that in our setting, we have some unknown treedepth- $d$ structure $\\mathcal{T}$ in $G$ and we are building a container for it. That is, we are happy with inserting any number of vertices of $G$ into the container, as long as we are guaranteed that we insert only a constant number of vertices of $\\mathcal{T}$ along the way. In the case of a $\\bigvee$-free triple $(A, B, C)$, we would like to simplify this part of $G$ by filtering out vertices of $B$ that have neighbors both in $A$ and in $C$. To achieve this goal, we will guess a set $X \\subseteq A \\cup B \\cup C$ that on one hand contains (in one of the branches) at most a constant number of vertices of the fixed unknown $\\mathcal{T}$, and on the other hand satisfies the following: no $b \\in B \\backslash X$ has a neighbor both in $A \\backslash X$ and in $C \\backslash X$.\n\nTo this end, we will rely on the following simple yet powerful observation. Observe that if $(A, B, C)$ is $\\bigvee$-free and both $A \\cup C$ and $B$ are independent sets (which happen, in particular, if $A \\cup C$ is on one side of the bipartition and $B$ is on the other side of the bipartition), then, for every distinct $b_{1}, b_{2} \\in B$ either $N\\left(b_{1}\\right) \\cap A$ and $N\\left(b_{2}\\right) \\cap A$ are comparable by inclusion or $N\\left(b_{1}\\right) \\cap C$ and $N\\left(b_{2}\\right) \\cap C$ are comparable by inclusion. This allows to use Lemma 2.8 on subsets of $B$, with the orders $\\leq_{1}$ and $\\leq_{2}$ being inclusion of the neighborhoods in $A$ and $C$, respectively. This observation is the engine of the following lemma that formalizes our goal of filtering out vertices of $B$ that have neighbors both in $A$ and in C.\n\nLemma 4.9. Fix an integer d. Let $G$ be a graph, and let $(A, B, C)$ be a $\\bigvee$-free triple in $G$ with both $A \\cup C$ and $B$ being independent set. Then one can in polynomial time enumerate a family $\\mathcal{F}$ of subsets of $A \\cup B \\cup C$ of size at most $n^{4(d+1)^{s}}$ with the following guarantee:\n\n- For every $X \\in \\mathcal{F}$, there is no $b \\in B \\backslash X$ with both $N(b) \\cap(A \\backslash X)$ and $N(b) \\cap(C \\backslash X)$ nonempty.\n- For every treedepth- $d$ structure $\\mathcal{T}$ in $G$, there exists $X \\in \\mathcal{F}$ such that $|X \\cap \\mathcal{T}| \\leq d^{2}(d+1)$.\n\nProof. Fix a treedepth- $d$ structure $\\mathcal{T}$ in $G$. We will describe the process of enumerating the elements of $\\mathcal{F}$ as a branching algorithm, guessing some properties of $\\mathcal{T}$. The number of leaves of the branching will be polynomial in the size of $G$ and in each leaf of the branching we will output one set $X$ that satisfies the second property for every $\\mathcal{T}$ that agrees with the guesses made in this leaf.\n\nFor every $b \\in B$, let $\\iota_{A}(b)$ be the maximum integer $1 \\leq \\alpha \\leq d$ such that $N(b) \\cap A \\cap \\mathcal{T}^{\\alpha}$ contains at least two vertices; $\\iota_{A}(b)=0$ if such a $\\alpha$ does not exist. Similarly define $\\iota_{C}(b)$ with respect to $N(b) \\cap C \\cap \\mathcal{T}^{\\alpha}$. For $0 \\leq \\alpha, \\beta \\leq d$, let $B_{\\alpha, \\beta}=\\left\\{b \\in B \\mid \\iota_{A}(b)=\\alpha \\wedge \\iota_{C}(b)=\\beta\\right\\}$. Note that sets $B_{\\alpha, \\beta}$ form a partition of $B$.\n\nInitialize $X=\\emptyset$. For every $0 \\leq \\alpha, \\beta \\leq d$, we we will guess some set of vertices and include them into $X$. We will argue that there will be a branch where the vertices guessed for $\\alpha, \\beta$ ensure that every vertex from $B_{\\alpha, \\beta} \\backslash X$ satisfies the first statement of the lemma. Thus, for (at least) one of sets $X$ generated in the process, the statement will hold for every vertex in $B \\backslash X$.\n\nConsider fixed $0 \\leq \\alpha, \\beta \\leq d$. If $B_{\\alpha, \\beta}$ is empty, there is nothing to do, so assume otherwise. Define the following two orders $\\leq_{1}$ and $\\leq_{2}$ on $B_{\\alpha, \\beta}$ :\n\n$$\n\\begin{array}{ll}\nb \\leq_{1} b^{\\prime} \\Longleftrightarrow N(b) \\cap A \\supseteq N\\left(b^{\\prime}\\right) \\cap A, & \\text { if } \\alpha=0 \\\\\nb \\leq_{1} b^{\\prime} \\Longleftrightarrow N(b) \\cap A \\cap \\mathcal{T}^{\\alpha} \\subseteq N\\left(b^{\\prime}\\right) \\cap A \\cap \\mathcal{T}^{\\alpha} & \\text { if } \\alpha>0 \\\\\nb \\leq_{2} b^{\\prime} \\Longleftrightarrow N(b) \\cap C \\supseteq N\\left(b^{\\prime}\\right) \\cap C, & \\text { if } \\beta=0 \\\\\nb \\leq_{2} b^{\\prime} \\Longleftrightarrow N(b) \\cap C \\cap \\mathcal{T}^{\\beta} \\subseteq N\\left(b^{\\prime}\\right) \\cap C \\cap \\mathcal{T}^{\\beta} & \\text { if } \\beta>0\n\\end{array}\n$$\n\nApply Lemma 2.8 to $B_{\\alpha, \\beta}$ with $\\leq_{1}$ and $\\leq_{2}$, obtaining a vertex $b_{\\alpha, \\beta}^{*}$.\nIf $\\alpha=0$, guess $b_{\\alpha, \\beta}^{*}$ and add $N\\left(b_{\\alpha, \\beta}^{*}\\right) \\cap A$ to $X$. This adds at most $d$ vertices of $\\mathcal{T}$ to $X$, while adds to $X$ all vertices of $N(b) \\cap A$ such that $b \\in B_{\\alpha, \\beta}$ and $b_{\\alpha, \\beta}^{*} \\leq_{1} b$.\n\nIf $\\alpha>0$, guess two elements $a_{\\alpha, \\beta}^{1}, a_{\\alpha, \\beta}^{2} \\in N\\left(b_{\\alpha, \\beta}^{*}\\right) \\cap A \\cap \\mathcal{T}^{\\alpha}$ and add $N\\left(a_{\\alpha, \\beta}^{1}\\right) \\cap N\\left(a_{\\alpha, \\beta}^{2}\\right) \\cap B$ to $X$. This adds at most $(\\alpha-1)$ vertices of $\\mathcal{T}$ to $X$, while adds to $X$ every $b \\in B_{\\alpha, \\beta}$ such that $b_{\\alpha, \\beta}^{*} \\leq_{1} b$.\n\nPerform symmetrical operation for $\\beta$ and $C$ : If $\\beta=0$, guess $b_{\\alpha, \\beta}^{*}$ and add $N\\left(b_{\\alpha, \\beta}^{*}\\right) \\cap C$ to $X$. This adds at most $d$ vertices of $\\mathcal{T}$ to $X$, while adds to $X$ all vertices of $N(b) \\cap C$ such that $b \\in B_{\\alpha, \\beta}$ and\n\n$b_{\\alpha, \\beta}^{*} \\leq_{2} b$. If $\\beta>0$, guess two elements $c_{\\alpha, \\beta}^{1}, c_{\\alpha, \\beta}^{2} \\in N\\left(b_{\\alpha, \\beta}^{*}\\right) \\cap C \\cap \\mathcal{T}^{\\beta}$ and add $N\\left(c_{\\alpha, \\beta}^{1}\\right) \\cap N\\left(c_{\\alpha, \\beta}^{2}\\right) \\cap B$ to $X$. This adds at most $(\\beta-1)$ vertices of $\\mathcal{T}$ to $X$, while adds to $X$ every $b \\in B_{\\alpha, \\beta}$ such that $b_{\\alpha, \\beta}^{*} \\leq_{2} b$.\n\nFinally, add the resulting set $X$ to $\\mathcal{F}$ if it satisfies the first bullet point of the statement.\nWe have already argued that in the branch when all guesses concerning $\\mathcal{T}$ are correct, the first bullet point of the statement is satisfied. Furthermore, the size of $\\mathcal{T} \\cap X$ is bounded by\n\n$$\n\\sum_{\\alpha=1}^{d} \\sum_{\\beta=1}^{d}(\\alpha+\\beta)=2 d \\frac{d(d+1)}{2}=d^{2}(d+1)\n$$\n\nFinally, observe that the number of branches is bounded by $n^{4(d+1)^{2}}$ as for every $0 \\leq \\alpha, \\beta \\leq d$ we guess at most four vertices of $G$.\n\nThanks to Lemma 4.8, Lemma 4.9 is applicable in the following setting.\nDefinition 4.10. Let $G$ be a $P_{7}$-free bipartite graph with a fixed bipartition $V_{1}, V_{2}$ and let $Z \\subseteq V(G)$. The neighborhood partition with respect to $Z$ is a partition $\\mathcal{Z}$ of $V(G) \\backslash Z$ into sets depending on (1) their side in the bipartition, and (2) their neighborhood in $Z$. More precisely,\n\n$$\n\\mathcal{Z}=\\left\\{A_{i, Y} \\mid i \\in\\{1,2\\}, Y \\subseteq Z \\cap V_{3-i}\\right\\}\n$$\n\nwhere\n\n$$\nA_{i, Y}=\\left\\{v \\in(V(G) \\backslash Z) \\cap V_{i} \\mid N(v) \\cap Z=Y\\right\\}\n$$\n\nLemma 4.11. Let $G$ be a $P_{7}$-free bipartite graph with a fixed bipartition $V_{1}, V_{2}$, let $Z \\subseteq V(G)$, and let $\\mathcal{Z}$ be the neighborhood partition with respect to $Z$. Then, for every distinct $A, B, C \\in \\mathcal{Z}$, the triple $(A, B, C)$ is $\\bigvee$-free.\n\nProof. There is no $P_{3}$ of the form $A-B-C$ unless $A$ and $C$ are on one side of the bipartition, and $B$ is on the other side of the bipartition. Then, by the definition of $\\mathcal{Z}$, the vertices of $A$ and the vertices of $C$ differ in their neighborhood in $Z$ : there exists $v \\in Z$ such that either $N(v) \\cap(A \\cup C)=A$ or $N(v) \\cap(A \\cup C)=C$. Then, the claim follows from Lemma 4.8 and the symmetry of $A, C$.\n\nWe summarize this section with the following cleaning step. We remark that if $G$ is connected, the assumption of a fixed bipartition is not needed, as a connected bipartite graph has only one bipartition.\n\nLemma 4.12. Let $G$ be a $P_{7}$-free bipartite graph with a fixed bipartition $V_{1}, V_{2}$, let $Z \\subseteq V(G)$, and let $\\mathcal{Z}$ be the neighborhood partition with respect to $Z$. Then one can in time $|V(G)|^{2^{3|Z|} \\cdot \\mathcal{O}\\left(d^{2}\\right)}$ enumerate a family $\\mathcal{F}$ of at most $n^{4(d+1)^{2} 2^{3|Z|}}$ subsets of $V(G) \\backslash Z$ with the following properties:\n\n- For every $X \\in \\mathcal{F}$, for every $v \\in V(G) \\backslash X$, the elements of $N(v) \\backslash(X \\cup Z)$ are contained in a single set of $\\mathcal{Z}$.\n- For every treedepth-d structure $\\mathcal{T}$ in $G$, there exists $X \\in \\mathcal{F}$ such that $|X \\cap \\mathcal{T}| \\leq 2^{3|Z|} \\cdot d^{2}(d+1)$.\n\nProof. Observe that $|\\mathcal{Z}| \\leq 2^{|Z|}+1$. Let $\\mathcal{Z}^{3}$ be the family of all triples $(A, B, C)$ where $A, B, C$ are distinct elements of $\\mathcal{Z}$. For every triple $(A, B, C) \\in \\mathcal{Z}^{3}$, we apply Lemma 4.9 obtaining a family $\\mathcal{F}_{(A, B, C)}$; Lemma 4.11 asserts that the assumptions are satisfied. For every triple $\\left(X_{(A, B, C)}\\right)_{(A, B, C) \\in \\mathcal{Z}^{3}}$ $\\in \\prod_{(A, B, C) \\in \\mathcal{Z}^{3}} \\mathcal{F}_{(A, B, C)}$ insert $\\bigcup_{(A, B, C) \\in \\mathcal{Z}^{3}} X_{(A, B, C)}$ into $\\mathcal{F}$. The promised guarantees and size bounds are immediate from Lemma 4.9 and the bound $|\\mathcal{Z}| \\leq 2^{|Z|+1}$, which implies $\\left|\\mathcal{Z}^{3}\\right| \\leq\\left(2^{|Z|}+1\\right)$. $2^{|Z|} \\cdot\\left(2^{|Z|}-1\\right) \\leq 2^{3|Z|}$.", "tables": {}, "images": {}}, {"section_id": 14, "text": "# 4.3 Structural properties of a bad $C_{6}$ \n\nThe tools developed in Section 4.1 allow us to solve $(\\operatorname{td} \\leq d, \\phi)$-MWIS on $G$, assuming that there is no bad $C_{6}$ w.r.t. the solution treedepth- $d$ structure $\\mathcal{T}$. In this section we investigate properties of bad $C_{6}$ s.\n\nWe will often denote an induced $C_{6}$ as $C=c_{1}-c_{2}-\\ldots-c_{6}-c_{1}$. We implicitly assume that the indices behave cyclically, i.e., $c_{7}=c_{1}$ etc. Then $\\left(c_{1}, c_{7},\\left(c_{2}, c_{5}\\right),\\left(c_{3}, c_{6}\\right)\\right.$ are pairs of the opposite vertices in $C$.\n\nWe will need the following observation implicit in [6]; here we provide a proof for completeness.\nLemma 4.13. Let $G$ be a $P_{7}$-free bipartite graph, let $C=c_{1}-c_{2}-\\ldots-c_{6}-c_{1}$ be an induced $C_{6}$ in $G$, and let $D$ be a connected component of $G-N[V(C)]$ that contains at least two vertices. Then, for every $v \\in N(D)$, the set $N(v) \\cap V(C)$ equals to either $\\left\\{c_{1}, c_{3}, c_{5}\\right\\}$ or $\\left\\{c_{2}, c_{4}, c_{6}\\right\\}$.\n\nProof. Let $v \\in N(D)$. Since $|D|>1$, there exists a $P_{3}$ of the form $v-D-D$. By the definition of $D$, $v \\in N(V(C))$. Observe that if $c_{i} \\in N(v)$, then $c_{i+2} \\in N(v)$, as otherwise $G$ contains the following $P_{7}: c_{i+3}-c_{i+2}-c_{i+1}-c_{i}-v-D-D$. The lemma follows.\n\nFor an induced six-vertex-cycle $C=c_{1}-c_{2}-\\ldots-c_{6}-c_{1}$, denote\n\n$$\n\\begin{aligned}\n& S_{1}^{C}=\\left\\{v \\in N(V(C)) \\mid N(v) \\cap V(C)=\\left\\{c_{1}, c_{3}, c_{5}\\right\\}\\right\\} \\\\\n& S_{2}^{C}=\\left\\{v \\in N(V(C)) \\mid N(v) \\cap V(C)=\\left\\{c_{2}, c_{4}, c_{6}\\right\\}\\right\\}\n\\end{aligned}\n$$\n\nFurthermore, let $\\mathrm{MR}_{C}$ be the union of vertex sets of all connected components of $G-N[V(C)]$ that contain at least 2 vertices. (MR stands for the \"main remainder\".) With this notation, Lemma 4.13 states that $N\\left(\\mathrm{MR}_{C}\\right) \\subseteq S_{1}^{C} \\cup S_{2}^{C}$.\n\nGreatly simplifying, our algorithm will guess a bad $C_{6}(C, x, y)$, resolve $N[V(C)]$ using cleaning, and recurse on connected components of $\\mathrm{MR}_{C}$. To restrict the space of possible recursive calls, we need the following observation.\n\nLemma 4.14. Let $G$ be a $P_{7}$-free bipartite graph with a fixed bipartition $V_{1}, V_{2}$, and let $\\mathcal{B}$ be a family of pairwise disjoint and anticomplete subsets of $V(G)$ such that for every $B \\in \\mathcal{B}, G[B]$ is connected and $|B|>1$. Let $D$ be a connected component of $G-\\bigcup_{B \\in \\mathcal{B}} N[B]$, let $C$ be the connected component of $G$ that contains $D$. Then, for every $i \\in\\{1,2\\}$, either $N(D) \\cap V_{i}=\\emptyset$ or there exists a single set $B_{i} \\in \\mathcal{B}$ such that $N(D) \\cap V_{i} \\subseteq N\\left(B_{i}\\right)$. Consequently, there exists a subfamily $\\mathcal{B}^{\\prime} \\subseteq \\mathcal{B}$ of size at most 2 such that $N(D) \\subseteq \\bigcup_{B \\in \\mathcal{B}^{\\prime}} N[B]$ (i.e., $D$ is a connected component of $G-\\bigcup_{B \\in \\mathcal{B}^{\\prime}} N[B]$ ).\n\nProof. Let $\\mathcal{B}_{i} \\subseteq \\mathcal{B}$ be an inclusion-wise minimal set such that $\\bigcup_{B \\in \\mathcal{B}_{i}} N(B) \\supseteq N(D) \\cap V_{i}$. Assume $\\left|\\mathcal{B}_{i}\\right|>1$; let $B, B^{\\prime} \\in \\mathcal{B}_{i}$ be distinct. By minimality, there exists $v, v^{\\prime} \\in N(D) \\cap V_{i}$ such that $v \\in$ $N(B) \\backslash N\\left(B^{\\prime}\\right)$ and $v^{\\prime} \\in N\\left(B^{\\prime}\\right) \\backslash N(B)$. Since $|B|,\\left|B^{\\prime}\\right|>1$, there exists an induced $P_{3}$ of the form $v-B-B$ and an induced $P_{3}$ of the form $v^{\\prime}-B^{\\prime}-B^{\\prime}$. Let $Q$ be a shortest path from $v$ to $v^{\\prime}$ via $D$. Then, there exists an induced path in $G$ of the form $B-B-v-Q-v^{\\prime}-B^{\\prime}-B^{\\prime}$ and this path has at least 7 vertices, a contradiction.\n\nLet $\\mathcal{T}$ be a treedepth- $d$ structure in $G$. A set $A \\subseteq V(G)$ is $\\mathcal{T}$-rich if there exists $\\alpha \\in[d]$ such that $\\left|A \\cap \\mathcal{T}^{\\alpha}\\right|>1$, and $\\mathcal{T}$-poor otherwise. For $\\alpha \\in[d]$ and $v \\in \\mathcal{T}^{\\alpha}$, we denote by depth $(v)=\\alpha$ the depth of $v$. The depth of a bad $C_{6}(C, x, y)$ is the pair depth $(C, x, y):=($ depth $(x)$, depth $(y)) \\in[d] \\times[d]$. As the depth of a bad $C_{6}$ is a pair, in order to compare depths of bad $C_{6} \\mathrm{~s}$, we introduce a total order $\\prec$ on $[d] \\times[d]$ as the lexicographical comparison of $(\\operatorname{depth}(x)+\\operatorname{depth}(y), \\operatorname{depth}(x))$, i.e.,\n\n$$\n(1,1) \\prec(1,2) \\prec(2,1) \\prec(1,3) \\prec(2,2) \\prec(3,1) \\prec \\ldots \\prec(d-1, d) \\prec(d, d-1) \\prec(d, d)\n$$\n\nA bad $C_{6}$ is $\\prec$-maximal if there is no other bad $C_{6}$ whose depth is larger in the $\\prec$ order.\nWe have the following observation.\n\nLemma 4.15. Let $G$ be a $P_{7}$-free bipartite graph with a fixed bipartition $V_{1}, V_{2}$, and let $\\mathcal{T}$ be a treedepth$d$ structure in $G$. Let $(C, x, y)$ be a bad $C_{6}$ with depth $(C, x, y)=(\\alpha, \\beta)$. If $S_{1}^{C}$ contains at least two vertices of $\\mathcal{T}^{\\alpha^{\\prime}}$ for some $\\alpha^{\\prime} \\in[d]$, then $\\alpha^{\\prime}>\\alpha$. Similarly, if $S_{2}^{C}$ contains at least two vertices of $\\mathcal{T}^{\\beta^{\\prime}}$ for some $\\beta^{\\prime} \\in[d]$, then $\\beta^{\\prime}>\\beta$.\n\nFurthermore, if both $S_{1}^{C}$ and $S_{2}^{C}$ are $\\mathcal{T}$-rich, then there exists a bad $C_{6}$ in $G$ of depth $\\left(\\beta^{\\prime}, \\alpha^{\\prime}\\right)$ for some $\\alpha^{\\prime}>\\alpha$ and $\\beta^{\\prime}>\\beta$. Consequently, if $(C, x, y)$ is a $\\prec$-maximal bad $C_{6}$, then either $S_{1}^{C}$ or $S_{2}^{C}$ is $\\mathcal{T}$-poor (possibly both).\n\nProof. Let $C=c_{1}-c_{2}-\\ldots-c_{6}-c_{1}$ where $c_{1}=x$ and $c_{4}=y$. Assume that $S_{1}^{C}$ contains two vertices $x^{\\prime}, x^{\\prime \\prime} \\in \\mathcal{T}^{\\alpha^{\\prime}}$; as $x x^{\\prime}, x x^{\\prime \\prime} \\in E(G)$ and $x \\in \\mathcal{T}^{\\alpha}$, we have $\\alpha^{\\prime}>\\alpha$ and $x^{\\prime}, x^{\\prime \\prime}$ are descendants of $x$ in $\\mathcal{T}$. Similarly, if $S_{2}^{C}$ contains two vertices $y^{\\prime}, y^{\\prime \\prime} \\in \\mathcal{T}^{\\beta^{\\prime}}$, then $\\beta^{\\prime}>\\beta$ and $y^{\\prime}, y^{\\prime \\prime}$ are descendants of $y$ in $\\mathcal{T}$. This proves the first part of the lemma.\n\nIf both of the above happen, then since $x$ and $y$ are incomparable in $\\mathcal{T}, x^{\\prime}$ and $y^{\\prime}$ are also incomparable in $\\mathcal{T}$. Then, $C^{\\prime}=x^{\\prime}-c_{3}-c_{2}-y^{\\prime}-c_{6}-c_{5}-x^{\\prime}$ is an induced $C_{6}$ and $\\left(C^{\\prime}, y^{\\prime}, x^{\\prime}\\right)$ is a bad $C_{6}$ of depth $\\left(\\beta^{\\prime}, \\alpha^{\\prime}\\right)$. As $\\alpha^{\\prime}>\\alpha$ and $\\beta^{\\prime}>\\beta$, we have that $\\alpha^{\\prime}+\\beta^{\\prime}>\\alpha+\\beta$ and thus $(\\alpha, \\beta) \\prec\\left(\\beta^{\\prime}, \\alpha^{\\prime}\\right)$.\n\nWe will need the following nomenclature. The class of a bad $C_{6}(C, x, y)$ (with respect to some fixed treedepth- $d$ structure $\\mathcal{T}$ ) is the pair of bits indicating whether $S_{1}^{C}$ is $\\mathcal{T}$-poor and whether $S_{2}^{C}$ is $\\mathcal{T}$-poor. Let Cls be the set of possible classes (i.e., $|\\mathrm{Cls}|=4$ ). We will usually denote them as poor/poor, rich/poor, poor/rich, and rich/rich.\n\nInformally speaking, if $(C, x, y)$ is a $\\prec$-maximal bad $C_{6}$ that is of poor/poor class with respect to $\\mathcal{T}$ (where $(\\mathcal{T}, X)$ is the sought solution), then it is relatively easy to separate $N[V(C)]$ from $\\mathrm{MR}_{C}$, as $S_{1}^{C} \\cup S_{2}^{C}$ contains at most $2 d$ vertices of the solution. However, if $S_{1}^{C}$ or $S_{2}^{C}$ is $\\mathcal{T}$-rich, the situation requires a bit more work. The next few lemmata investigate such a situation.\n\nLemma 4.16. Let $G$ be a $P_{7}$-free bipartite graph with a fixed bipartition $V_{1}, V_{2}$, let $Z \\subseteq V(G)$ be connected, and let $D, D^{\\prime}$ be two connected components of $G-N[Z]$ that are of size at least 2 each. Then, for every $i \\in\\{1,2\\}$, the sets $N(D) \\cap V_{i}$ and $N\\left(D^{\\prime}\\right) \\cap V_{i}$ are comparable by inclusion.\n\nProof. Assume the contrary, let $x \\in\\left(N(D) \\backslash N\\left(D^{\\prime}\\right)\\right) \\cap V_{i}$ and $x^{\\prime} \\in\\left(N\\left(D^{\\prime}\\right) \\backslash N(D)\\right) \\cap V_{i}$. By the existence of $x$ and $x^{\\prime}$, we observe that $Z, x, x^{\\prime}, D, D^{\\prime}$ lie all in the same connected component of $G$ and $x, x^{\\prime} \\in N(Z)$. Let $Q$ be the shortest path from $x$ to $x^{\\prime}$ via $Z$. Since $|D|,\\left|D^{\\prime}\\right|>1$, there exists an induced $P_{3}$ of the form $x-D-D$ and an induced $P_{3}$ of the form $x^{\\prime}-D^{\\prime}-D^{\\prime}$. But then there exists an induced path of the form $D-D-x-Q-x^{\\prime}-D^{\\prime}-D^{\\prime}$, which has at least 7 vertices, a contradiction.\n\nThe most frequent usage of Lemma 4.16 will be when $Z=V(C)$ for some bad $C_{6}(C, x, y)$. Then, $D, D^{\\prime}$ are connected components of $\\mathrm{MR}_{C}$ and Lemma 4.16 asserts that for every $i \\in\\{1,2\\}$, the neighborhoods $N(D) \\cap S_{i}^{C}$ and $N\\left(D^{\\prime}\\right) \\cap S_{i}^{C}$ are comparable by inclusion.\n\nLemma 4.17. Let $G$ be a $P_{7}$-free bipartite graph with a fixed bipartition $V_{1}, V_{2}$. Let $\\mathcal{T}$ be a treedepth- $d$ structure in $G$ and let $\\left(C, x_{1}, x_{2}\\right)$ be a bad $C_{6}$ w.r.t. $\\mathcal{T}$. Let $\\left(\\alpha_{1}, \\alpha_{2}\\right)=\\operatorname{depth}\\left(C, x_{1}, x_{2}\\right)$. Let $i \\in\\{1,2\\}$ and assume that $S_{3-i}^{C}$ contains a vertex of $\\mathcal{T}^{>\\alpha_{i}}$.\n\nA bad $C_{6}\\left(C^{\\prime}, x_{1}^{\\prime}, x_{2}^{\\prime}\\right)$ is called similar to $\\left(C, x_{1}, x_{2}\\right)$ if (a) $C$ is disjoint and anticomplete to $C^{\\prime}$, (b) $\\operatorname{depth}\\left(C^{\\prime}, x_{1}^{\\prime}, x_{2}^{\\prime}\\right)=\\operatorname{depth}\\left(C, x_{1}, x_{2}\\right)$, and (c) the component $D^{\\prime}$ of $G\\left[\\mathrm{MR}_{C}\\right]$ that contains $C^{\\prime}$ is adjacent to at least one vertex of $S_{3-i}^{C} \\cap \\mathcal{T}^{>\\alpha_{i}}$,\n\nThen, for every bad $C_{6}\\left(C^{\\prime}, x_{1}^{\\prime}, x_{2}^{\\prime}\\right)$ that is similar to $\\left(C, x_{1}, x_{2}\\right)$, the following holds.\n\n1. $C^{\\prime}$ is anticomplete to $S_{3-i}^{C} \\cap \\mathcal{T}^{>\\alpha_{i}}$.\n2. For every $u \\in S_{3-i}^{C} \\cap \\mathcal{T}^{>\\alpha_{i}} \\cap N\\left(D^{\\prime}\\right)$ there exists $v \\in D^{\\prime}$ that is a neighbor of $u$ and belongs to $S_{i}^{C^{\\prime}}$.\n3. For every other bad $C_{6}\\left(C^{\\prime \\prime}, x_{1}^{\\prime \\prime}, x_{2}^{\\prime \\prime}\\right)$ that is similar to $\\left(C, x_{1}, x_{2}\\right), C^{\\prime \\prime}$ is contained in $D^{\\prime}$.\n\nProof. As $C$ and $C^{\\prime}$ are disjoint and anticomplete, $C^{\\prime}$ lies in $\\mathrm{MR}_{C}$ and $C$ lies in $\\mathrm{MR}_{C^{\\prime}}$.\nConsequently, if $u \\in N\\left(D^{\\prime}\\right)$ has a neighbor in $C^{\\prime}$, then $u \\in S_{1}^{C^{\\prime}} \\cup S_{2}^{C^{\\prime}}$, that is, $u$ is adjacent to all three vertices of $C^{\\prime}$ from the same bipartition side. If additionally $u \\in S_{3-i}^{C}$, then $u$ is adjacent to both $x_{i}$ and $x_{i}^{\\prime}$; as these vertices are both in $\\mathcal{T}^{\\alpha_{i}}, u$ cannot belong to $\\mathcal{T}^{>\\alpha_{i}}$. This proves the first point.\n\nLet $u \\in N\\left(D^{\\prime}\\right) \\cap \\mathcal{T}^{>\\alpha_{i}} \\cap S_{3-i}^{C}$ and let $Q$ be a shortest path from $u$ to $V\\left(C^{\\prime}\\right)$ via $D^{\\prime}$. Let $v$ be the penultimate (i.e., just before the endpoint in $V\\left(C^{\\prime}\\right)$ ) vertex of $Q$. The first point asserts that $u$ is anticomplete to $C^{\\prime}$, i.e., $v \\neq u$. Since $u \\in N(V(C))$ and $C \\subseteq \\mathrm{MR}_{C^{\\prime}}$, by Lemma 4.13, $v \\in S_{1}^{C^{\\prime}} \\cup S_{2}^{C^{\\prime}}$. Note that there exists an induced $P_{3}$ of the form $v-C^{\\prime}-C^{\\prime}$ and an induced $P_{3}$ of the form $u-C-C$. Then, $G$ contains an induced path $C^{\\prime}-C^{\\prime}-v-Q-u-C-C$. Since $G$ is $P_{7}$-free, $Q$ is of length one, i.e., $v u \\in E(G)$. As $u$ and $v$ are on different sides of the bipartition, this proves the second point.\n\nFor the third point, let $\\left(C^{\\prime \\prime}, x_{1}^{\\prime \\prime}, x_{2}^{\\prime \\prime}\\right)$ be a bad $C_{6}$ w.r.t. $\\mathcal{T}$ that is similar to $\\left(C, x_{1}, x_{2}\\right)$, but contained in a component $D^{\\prime \\prime} \\neq D^{\\prime}$ of $G\\left[\\mathrm{MR}_{C}\\right]$. Pick any $u^{\\prime} \\in S_{3-i}^{C} \\cap \\mathcal{T}^{>\\alpha_{i}} \\cap N\\left(D^{\\prime}\\right)$ and let $v^{\\prime} \\in D^{\\prime}$ be the vertex whose existence is asserted in the second point for $\\left(C^{\\prime}, x_{1}^{\\prime}, x_{2}^{\\prime}\\right)$. Pick any $u^{\\prime \\prime} \\in S_{3-i}^{C} \\cap \\mathcal{T}^{>\\alpha_{i}} \\cap N\\left(D^{\\prime \\prime}\\right)$ (possibly $u^{\\prime}=u^{\\prime \\prime}$ ) and let $v^{\\prime \\prime} \\in D^{\\prime \\prime}$ be the vertex whose existence is asserted in the second point for $\\left(C^{\\prime \\prime}, x_{1}^{\\prime \\prime}, x_{2}^{\\prime \\prime}\\right)$. Note that there exists an induced $P_{4}$ of the form $u^{\\prime}-v^{\\prime}-C^{\\prime}-C^{\\prime}$ and an induced $P_{4}$ of the form $u^{\\prime \\prime}-v^{\\prime \\prime}-C^{\\prime \\prime}-C^{\\prime \\prime}$. By possibly connecting these two $P_{4}$ s via $C$ (if $u^{\\prime} \\neq u^{\\prime \\prime}$ ), we obtain an induced path in $G$ on at least 7 vertices, a contradiction. This proves the third point.\n\nLemma 4.18. Let $G$ be a $P_{7}$-free bipartite graph with a fixed bipartition $V_{1}, V_{2}$. Let $\\mathcal{T}$ be a treedepth-t structure in $G$, and let $\\left(C, x_{1}, x_{2}\\right)$ and $\\left(C^{\\prime}, x_{1}^{\\prime}, x_{2}^{\\prime}\\right)$ be two disjoint and anticomplete bad $C_{6} s$ w.r.t. $\\mathcal{T}$ that are in the same connected component of $G$ such that $\\left(\\alpha_{1}, \\alpha_{2}\\right)=\\operatorname{depth}\\left(C, x_{1}, x_{2}\\right)=\\operatorname{depth}\\left(C^{\\prime}, x_{1}^{\\prime}, x_{2}^{\\prime}\\right)$. Furthermore, let $u \\in\\left(S_{1}^{C} \\cup S_{2}^{C}\\right) \\backslash N\\left[V\\left(C^{\\prime}\\right)\\right]$ and $v \\in\\left(S_{1}^{C^{\\prime}} \\cup S_{2}^{C^{\\prime}}\\right) \\backslash N[V(C)]$ with $u v \\in E(G)$. Denote $Z=V(C) \\cup V\\left(C^{\\prime}\\right) \\cup\\{u, v\\}$. Then, for every connected component $D$ of $G-N[Z]$, the following holds.\n\n1. If $|D|>1$, then $N(D) \\subseteq N\\left(V(C) \\cup V\\left(C^{\\prime}\\right)\\right)$.\n2. if additionally $D$ contains a bad $C_{6}\\left(C^{\\prime \\prime}, x_{1}^{\\prime \\prime}, x_{2}^{\\prime \\prime}\\right)$ with depth $\\left(C^{\\prime \\prime}, x_{1}^{\\prime \\prime}, x_{2}^{\\prime \\prime}\\right)=\\left(\\alpha_{1}, \\alpha_{2}\\right)$, then $N(D) \\cap$ $V_{1}$ and $N(D) \\cap V_{2}$ are $\\mathcal{T}$-poor.\nProof. Let $D$ be a connected component of $G-N[Z]$ with $|D|>1$.\nLet $w \\in N(D)$. By the definition of $D, w$ is adjacent to at least one vertex of $Z$. If $w$ is anticomplete to both $V(C)$ and $V\\left(C^{\\prime}\\right)$, then there exists an induced $P_{5}$ of the form $w-v-u-C-C$ or $w-u-$ $v-C^{\\prime}-C^{\\prime}$. If $|D|>1$, then there exists an induced $P_{3}$ of the form $w-D-D$, resulting in a $P_{7}$ with the aforementioned $P_{5}$, a contradiction. Thus, $N(D) \\subseteq N(V(C)) \\cup N\\left(V\\left(C^{\\prime}\\right)\\right)$, as promised in the first point.\n\nLet now $\\left(C^{\\prime \\prime}, x_{1}^{\\prime \\prime}, x_{2}^{\\prime \\prime}\\right)$ be as in the second point and assume $w \\in N(D) \\cap \\mathcal{T}$. Let $i \\in\\{1,2\\}$ be such that $w \\in V_{3-i}$. By Lemma 4.13, $w$ is either anticomplete to $C$ or $w \\in S_{i}^{C}$ and, similarly, $w$ is either anticomplete to $C^{\\prime}$ or $w \\in S_{i}^{C^{\\prime}}$. We have already established that $w \\in N(V(C)) \\cup N\\left(V\\left(C^{\\prime}\\right)\\right)$, that is, $w \\in S_{i}^{C} \\cup S_{i}^{C^{\\prime}}$; in particular, $w$ is adjacent to either $x_{i}$ or $x_{i}^{\\prime}$.\n\nAssume first that $w$ is adjacent to at most one vertex of the set $\\left\\{x_{i}, x_{i}^{\\prime}, x_{i}^{\\prime \\prime}\\right\\}$. Then, $w$ is adjacent to at least one vertex of $Z$, but is not complete to all vertices of $Z$ on the opposite side of the bipartition. Consequently, there exists an induced $P_{4}$ of the form $w-Z-Z-Z$. Furthermore, as $w$ is adjacent to $x_{i}$ or $x_{i}^{\\prime}$, we know that $w$ is nonadjacent to $x_{i}^{\\prime \\prime}$. By Lemma 4.13, $w$ is anticomplete to $C^{\\prime \\prime}$. However, then a shortest path from $w$ to $C^{\\prime \\prime}$ via $D$, with one more step in $C^{\\prime \\prime}$, gives an induced $P_{4}$ of the form $w-D-D-D$. Concatenated with the already established $P_{4}$ of the form $w-Z-Z-Z$ this gives a $P_{7}$ in $G$, a contradiction.\n\nHence, $w$ is adjacent to at least two of the vertices of $\\left\\{x_{i}, x_{i}^{\\prime}, x_{i}^{\\prime \\prime}\\right\\}$. Since all these vertices are of depth $\\alpha_{i}$ in $\\mathcal{T}, w$ is a common ancestor of all vertices of $N(w) \\cap\\left\\{x_{i}, x_{i}^{\\prime}, x_{i}^{\\prime \\prime}\\right\\}$. As the choice of $w \\in \\mathcal{T} \\cap N(D)$ was arbitrary, this proves that $N(D) \\cap V_{1}$ and $N(D) \\cap V_{2}$ are $\\mathcal{T}$-poor, as desired.", "tables": {}, "images": {}}, {"section_id": 15, "text": "# 4.4 The algorithm \n\nArmed with the structural insights from the previous sections, we are ready to present the algorithm of Theorem 4.1. It will be a recursive procedure that takes as input an induced subgraph $G[A]$ of $G$ and\n\nattempts at decomposing $G[A]$. (The recursive call will take also a number of additional parameters on input to guide the recursion; these will be described shortly.) Similarly as it was done in [13], we will describe the algorithm as guessing properties of a fixed hypothetical treedepth- $d$ structure $\\mathcal{T}$ in $G$ that we want to handle.\n\nWe define\n\n$$\n\\begin{aligned}\nh_{\\max } & :=48(d+1)^{3} \\\\\nd_{\\max } & :=2^{43}(d+1)^{3}\n\\end{aligned}\n$$\n\nRecursion arguments and guarantee. A recursive call, apart from the induced subgraph $G[A]$, takes as input two integers $\\alpha_{1}, \\alpha_{2} \\in[d]$, a subset ActiveCls $\\subseteq$ Cls, and a function $\\gamma$ : ActiveCls $\\rightarrow \\mathbb{N}$. Let $h$ be the recursion depth of the recursive call in question.\n\nThe goal is to compute a family $\\mathcal{C}$ of subsets of $A$ with the following guarantee for every treedepth- $d$ structure $\\mathcal{T}$.\n\nRecursion guarantee. Suppose the following hold:\n\n- There is no bad $C_{6}(C, x, y)$ w.r.t. $\\mathcal{T}$ with $V(C) \\subseteq A$, and $\\left(\\alpha_{1}, \\alpha_{2}\\right) \\prec(\\operatorname{depth}(x), \\operatorname{depth}(y))$.\n- For every bad $C_{6}(C, x, y)$ w.r.t. $\\mathcal{T}$ with $V(C) \\subseteq A$, and $\\left(\\alpha_{1}, \\alpha_{2}\\right)=(\\operatorname{depth}(x), \\operatorname{depth}(y))$, the class c of $(C, x, y)$ belongs to ActiveCls. Furthermore, the number of vertices of $\\mathcal{T} \\backslash A$ that are adjacent to $V(C)$ is at least $\\gamma(\\mathrm{c})$.\n- $N(A) \\cap \\mathcal{T}$ is of size at most $d_{\\max }^{4 b}$.\n\nThen there exists a tree decomposition $(T, \\beta)$ of $G[A]$ such that for every $t \\in V(T)$ we have $\\beta(t) \\in \\mathcal{C}$ and $|\\beta(t) \\cap \\mathcal{T}| \\leq d_{\\max }^{4 t+1}$.\n\nWe will maintain the following progress in the recursion. For a call on $G[A],\\left(\\alpha_{1}, \\alpha_{2}\\right)$, ActiveCls, and $\\gamma$, a direct subcall on $G\\left[A^{\\prime}\\right],\\left(\\alpha_{1}^{\\prime}, \\alpha_{2}^{\\prime}\\right)$, ActiveCls ${ }^{\\prime}, \\gamma^{\\prime}$ satisfies:\n\n- $\\left(\\alpha_{1}^{\\prime}, \\alpha_{2}^{\\prime}\\right) \\prec\\left(\\alpha_{1}, \\alpha_{2}\\right)$, or\n- $\\left(\\alpha_{1}^{\\prime}, \\alpha_{2}^{\\prime}\\right)=\\left(\\alpha_{1}, \\alpha_{2}\\right)$ and\n- ActiveCls' $\\subsetneq$ ActiveCls, or\n- ActiveCls' $=$ ActiveCls, $\\gamma(\\mathrm{c}) \\leq 12 d$ for every $\\mathrm{c} \\in$ ActiveCls, $\\gamma^{\\prime}(\\mathrm{c}) \\geq \\gamma(\\mathrm{c})$ for every $\\mathrm{c} \\in$ ActiveCls, and $\\gamma^{\\prime}(\\mathrm{c})>\\gamma(\\mathrm{c})$ for at least one $\\mathrm{c} \\in$ ActiveCls.\n\nThis progress property will always be immediate from the description of the algorithm and thus usually not checked explicitly. Note that this progress property bounds the depth of the recursion by $(d+1)^{2}$. $(48 d+4) \\leq h_{\\max }$.\n\nLeaves of the recursion. The recursion reaches its leaf when either $G[A]$ is $C_{6}$-free (hence chordal bipartite) or we have $\\left(\\alpha_{1}, \\alpha_{2}\\right)=(1,1)$ and ActiveCls $=\\emptyset$. In both cases, for every $\\mathcal{T}$ that satisfies the premise of the recursion guarantee, there is no bad $C_{6}$ w.r.t. $\\mathcal{T}$. Hence, it suffices to invoke the algorithm of Lemma 4.7 to $G[A]$ and return the computed family $\\mathcal{C}$.\n\nRecursion. Let us focus on a recursive call with input $G[A],\\left(\\alpha_{1}, \\alpha_{2}\\right)$, ActiveCls, and $\\gamma$. If $G[A]$ is disconnected, we recurse on each connected component independently and return the union of the returned families. Hence, we assume that $G[A]$ is connected.\n\nLet $\\mathcal{T}$ be a treedepth- $d$ structure in $G$ that satisfies the premise of the recursion guarantee. Thanks to Lemma 4.15, we can delete rich/rich from ActiveCls and the domain of $\\gamma$, if it is present there. If ActiveCls $=\\emptyset$, then there are no bad $C_{6} \\mathrm{~s}(C, x, y)$ of level $\\left(\\alpha_{1}, \\alpha_{2}\\right)$, so we can recurse on the immediate\n\npredecessor of $\\left(\\alpha_{1}, \\alpha_{2}\\right)$ in the $\\prec$ order, with ActiveCls $=$ Cls and $\\gamma \\equiv 0$, and pass on the set $\\mathcal{C}$ returned by this call.\n\nIf there exists $\\mathrm{c} \\in$ ActiveCls with $\\gamma(\\mathrm{c})>12 d$, proceed as follows. Observe that if $(C, x, y)$ is a bad $C_{6}$ of level $\\left(\\alpha_{1}, \\alpha_{2}\\right)$ and of class c with $V(C) \\subseteq A$, then there is $c \\in V(C)$ that is adjacent to at least two vertices in $N(A) \\cap \\mathcal{T}$. Iterate over all possible choices of $N(A) \\cap \\mathcal{T}$ (there is only a polynomial number of them thanks to the recursion guarantee premise) together with the levels of vertices of $N(A) \\cap \\mathcal{T}$. Let $B$ be the union, over all pairs $\\left(u, u^{\\prime}\\right)$ of distinct vertices of $N(A) \\cap \\mathcal{T}$ of the same level, of the sets $N(u) \\cap N\\left(u^{\\prime}\\right) \\cap A$. Recurse on $G[A \\backslash B],\\left(\\alpha_{1}, \\alpha_{2}\\right)$, and ActiveCls $\\backslash\\{\\mathrm{c}\\}$, obtaining a set $\\mathcal{C}_{B}$. Finally, return the union of all sets $\\left\\{B \\cup D \\mid D \\in \\mathcal{C}_{B}\\right\\}$ constructed in this process.\n\nNote that there is only a $(d n)^{d_{\\max }^{h}}=n^{d_{\\max }^{d^{2} / d^{2} / 2}}$ choices of $N(A) \\cap \\mathcal{T}$ together with its levels and, for every pair $\\left(u, u^{\\prime}\\right)$, the set $N(u) \\cap N\\left(u^{\\prime}\\right)$ contains at most $(d-1)$ vertices of $\\mathcal{T}$. Hence, the set $B$ constructed in the branch where all information on $N(A) \\cap \\mathcal{T}$ is guessed correctly satisfies $|B \\cap \\mathcal{T}| \\leq$ $(d-1)\\binom{d_{\\max }^{h}}{2} \\leq d_{\\max }^{4^{h+1}}$. Consequently, in this branch the premise of the recursion guarantee for $\\mathcal{T}$ is satisfied for the recursive subcalls; if $\\left(T^{\\prime}, \\beta^{\\prime}\\right)$ is the tree decomposition promised for $G[A \\backslash B]$ and $\\mathcal{T}$, then we can construct the promised tree decomposition $(T, \\beta)$ by taking $T=T^{\\prime}$ and $\\beta(t)=\\beta^{\\prime}(t) \\cup B$ for every $t \\in V\\left(T^{\\prime}\\right)$.\n\nWe are left with the case $\\gamma(\\mathrm{c}) \\leq 12 d$ for every $\\mathrm{c} \\in$ ActiveCls. Pick $\\mathrm{c} \\in$ ActiveCls, preferably rich/poor or poor/rich if one of those belong to ActiveCls. The algorithm will perform an internal dynamic programming routine on a carefully chosen family of subsets of $A$. We say that a set $A^{\\prime} \\subseteq A$ is well-shaped if there is a family $\\mathcal{B}$ consisting of at most two connected subsets of $A$, each on at least 2 and at most 14 vertices, such that $A^{\\prime}$ is a connected component of $G[A]-N\\left[\\bigcup_{B \\in \\mathcal{B}} B\\right]$. Let $\\mathcal{A}$ be the set of well-shaped sets; note that $|\\mathcal{A}| \\leq|A|^{29}$ and $\\mathcal{A}$ can be computed in polynomial time.\n\nA well-shaped set $A^{\\prime}$ is $\\mathcal{T}$-regular if there exists a family $\\mathcal{B}$ witnessing that $A^{\\prime}$ is well-shaped such that for every $B \\in \\mathcal{B}$ and $i \\in\\{1,2\\}$, the set $N\\left(A^{\\prime}\\right) \\cap A \\cap N(B) \\cap V_{i}$ is $\\mathcal{T}$-poor. Note that if $A^{\\prime}$ is $\\mathcal{T}$-regular, then $\\left|N\\left(A^{\\prime}\\right) \\cap A \\cap \\mathcal{T}\\right| \\leq 4 d$.\n\nNote that $A$ is $\\mathcal{T}$-regular (in particular, $A \\in \\mathcal{A}$ ), as witnessed by $\\mathcal{B}=\\emptyset$ (recall that $G[A]$ is connected).\n\nFor every $A^{\\prime} \\in \\mathcal{A}$, in the order of increasing size of $A^{\\prime}$, we will compute a family $\\mathcal{C}\\left(A^{\\prime}\\right)$ of subsets of $A \\cap N\\left[A^{\\prime}\\right]$ with the following guarantee: if $A^{\\prime}$ is $\\mathcal{T}$-regular, then there exists a tree decomposition $(T, \\beta)$ of $G\\left[N\\left[A^{\\prime}\\right] \\cap A\\right]$ such that for every $t \\in V(T)$ we have $\\beta(t) \\in \\mathcal{C}\\left(A^{\\prime}\\right)$ and $\\left|\\beta(t) \\cap \\mathcal{T}\\right| \\leq d_{\\max }^{4^{h+1}}$. The family $\\mathcal{C}(A)$ is the desired output of the recursive call.\n\nLemma 4.14 ensures that the following process does not lead outside $\\mathcal{A}$.\nClaim 4.19. Let $A^{\\prime} \\in \\mathcal{A}$, let $B$ be a connected subset of $G\\left[A^{\\prime}\\right]$ on at least 2 and at most 14 vertices, and let $D$ be a connected component of $G\\left[A^{\\prime} \\backslash N[B]\\right]$. Then, $D \\in \\mathcal{A}$. Furthermore, if $A^{\\prime}$ is $\\mathcal{T}$-regular and, for every $\\alpha \\in\\{1,2\\}$, the set $N(D) \\cap A \\cap N(B) \\cap V_{\\alpha}$ is $\\mathcal{T}$-poor, then $D$ is $\\mathcal{T}$-regular, too.\n\nProof. Let $\\mathcal{B}$ be a family witnessing $A^{\\prime} \\in \\mathcal{A}$. Let $\\mathcal{B}^{\\prime}=\\mathcal{B} \\cup\\{B\\}$. Then, $D$ is a connected component of $G[A]-\\bigcup_{B^{\\prime} \\in \\mathcal{B}^{\\prime}} N\\left[B^{\\prime}\\right]$ and the family $\\mathcal{B}^{\\prime}$ satisfies the requirements of Lemma 4.14 in the graph $G[A]$. Hence, there is a subfamily $\\mathcal{B}^{\\prime \\prime} \\subseteq \\mathcal{B}^{\\prime}$ of size at most 2 such that $D$ is a connected component of $G[A]-\\bigcup_{B^{\\prime \\prime} \\in \\mathcal{B}^{\\prime \\prime}} N\\left[B^{\\prime \\prime}\\right]$. Then, $\\mathcal{B}^{\\prime \\prime}$ witnesses that $D \\in \\mathcal{A}$.\n\nFor the second statement, observe that if $\\mathcal{B}$ witnesses that $A^{\\prime}$ is $\\mathcal{T}$-regular, then so does $\\mathcal{B}^{\\prime \\prime}$ for $D$.\n\nWe emphasize here that the set $N(D) \\cap A \\cap N(B) \\cap V_{i}$ in Claim 4.19 may contain vertices outside $A^{\\prime}$ and our control of the number of vertices of $\\mathcal{T}$ in this set is very important for the correctness of the algorithm.\n\nFix $A^{\\prime} \\in \\mathcal{A}$. A bad $C_{6}(C, x, y)$ of level $\\left(\\alpha_{1}, \\alpha_{2}\\right)$ and of class c with $V(C) \\subseteq A^{\\prime}$ is henceforth called a relevant $C_{6}$.\n\nGuess if $\\mathcal{T}$ contains a relevant $C_{6}$. For the \"no\" branch, recurse on $G\\left[A^{\\prime}\\right],\\left(\\alpha_{1}, \\alpha_{2}\\right)$, and ActiveCls $\\backslash$ $\\{\\mathrm{c}\\}$, and put every returned set into the computed family $\\mathcal{C}\\left(A^{\\prime}\\right)$.\n\nFor the \"yes\" branch, proceed as follows. For a connected set $A^{\\prime \\prime} \\subseteq A^{\\prime}$, a relevant $C_{6}(C, x, y)$ in $G\\left[A^{\\prime \\prime}\\right]$ is extremal if it maximizes the number of vertices in its main remainder in $G\\left[A^{\\prime \\prime}\\right]$ and, subject to the above, it minimizes the number of vertices of $\\mathcal{T}$ in $N[V(C)] \\cap A^{\\prime \\prime}$.\n\nFinding a pivot set $Z$. We will now identify (by branching) a connected set $Z \\subseteq A^{\\prime}$ with the following properties.\n\n- $Z$ is of one of the following forms:\n(single $C_{6}$ ) $V(C)$, where $(C, x, y)$ is an extremal relevant $C_{6}$ in $G\\left[A^{\\prime}\\right]$, or\n(double $C_{6}$ ) $V(C) \\cup V\\left(C^{\\prime}\\right) \\cup\\{u, v\\}$, where $(C, x, y)$ is an extremal relevant $C_{6}$ in $G\\left[A^{\\prime}\\right]$, $\\left(C^{\\prime}, x^{\\prime}, y^{\\prime}\\right)$ is a relevant $C_{6}$ that is extremal in a connected component $D^{\\prime}$ of $G\\left[A^{\\prime}\\right]-$ $N[V(C)], u \\in S_{1}^{C^{\\prime}} \\cap A^{\\prime} \\cap \\mathcal{T}$ for some $i \\in\\{1,2\\}, u \\notin N\\left(V\\left(C^{\\prime}\\right)\\right), v \\in S_{3-i}^{C^{\\prime}} \\cap D^{\\prime}$, and $u v \\in E(G)$.\n- For every connected component $F$ of $G\\left[A^{\\prime}\\right]-N[Z]$ that contains a relevant $C_{6}$, for every $i \\in$ $\\{1,2\\}$, the set $N(F) \\cap A \\cap N(Z) \\cap V_{\\alpha}$ is $\\mathcal{T}$-poor.\n\nWe start by guessing an extremal relevant $C_{6}(C, x, y)$. Somewhat abusing the notation, let us denote its main remainder in $G\\left[A^{\\prime}\\right]$ by $\\mathrm{MR}_{C}$.\n\nWe check if $Z=V(C)$ satisfies the above properties. If this is the case, we are done, so assume otherwise.\n\nWe say that a component $D$ of $G\\left[\\mathrm{MR}_{C}\\right]$ is terrifying if it contains a relevant $C_{6}$ and additionally $N(D) \\cap A \\cap N(Z) \\cap V_{1}$ is $\\mathcal{T}$-rich or $N(D) \\cap A \\cap N(Z) \\cap V_{2}$ is $\\mathcal{T}$-rich. Observe that $Z=V(C)$ does not satisfy the desired properties if and only there exists a terrifying component. Note that it can happen only if c is not poor/poor.\n\nLet $D_{0}$ be a terrifying component. Guess $D_{0}$ and a relevant $C_{6}\\left(C^{\\prime}, x^{\\prime}, y^{\\prime}\\right)$ that is extremal in $G\\left[D_{0}\\right]$. Lemma 4.15 implies that $N\\left(D_{0}\\right) \\cap A \\cap S_{1}^{C}$ contains two vertices of $\\mathcal{T}^{\\alpha_{1}^{\\prime}}$ for some $\\alpha_{1}^{\\prime}>\\alpha_{1}$ or $N\\left(D_{0}\\right) \\cap A \\cap S_{2}^{C}$ contains two vertices of $\\mathcal{T}^{\\alpha_{2}^{\\prime}}$ for some $\\alpha_{2}^{\\prime}>\\alpha_{2}$; let $u$ be any of those two vertices. Then, Lemma 4.17 applies to the graph $G\\left[A^{\\prime} \\cup\\left(A \\cap\\left(S_{1}^{C} \\cup S_{2}^{C}\\right)\\right)\\right]$ : by the first point, $u \\notin N\\left(V\\left(C^{\\prime}\\right)\\right)$, the second point gives $v \\in D_{0} \\cap\\left(S_{1}^{C^{\\prime}} \\cup S_{2}^{C^{\\prime}}\\right)$ with $u v \\in E(G)$, and the third point implies that $D_{0}$ is the only terrifying component.\n\nDenote $Z:=V(C) \\cup V\\left(C^{\\prime}\\right) \\cup\\{u, v\\}$. Lemma 4.18 applies to $(C, x, y),\\left(C^{\\prime}, x^{\\prime}, y^{\\prime}\\right), u$, and $v$ in the graph $G\\left[A^{\\prime} \\cup(A \\cap N[Z])\\right]$ : every connected component $D$ of $G\\left[A^{\\prime}\\right]-N[Z]$ that contains a relevant $C_{6}$, the set $N(D) \\cap A \\cap N(Z)$ is contained in $N(V(C)) \\cup N\\left(V\\left(C^{\\prime}\\right)\\right)$ and both $N(D) \\cap A \\cap N(Z) \\cap V_{1}$ and $N(D) \\cap A \\cap N(Z) \\cap V_{2}$ are $\\mathcal{T}$-poor. Consequently, $Z$ satisfies the desired properties.\n\nFinding a neighborhood $Y$. Lemma 4.16, applied to $Z$ in the graph $G\\left[A^{\\prime} \\cup(A \\cap N[Z])\\right]$ asserts that the components of $G\\left[A^{\\prime}\\right]-N[Z]$ that contain a relevant $C_{6}$ have comparable neighborhoods in $A \\cap N[Z] \\cap V_{1}$ and comparable neighborhoods in $A \\cap N[Z] \\cap V_{2}$. For every $i \\in\\{1,2\\}$, guess a component $D_{i}^{\\circ}$ of $G\\left[A^{\\prime}\\right]-N[Z]$ that contains a relevant $C_{6}$ and with maximal $N\\left(D_{i}^{\\circ}\\right) \\cap A \\cap N[Z] \\cap V_{i}$; a valid guess is $D_{i}^{\\circ}=\\emptyset$ if no such component exists. By the properties of $Z$, we have that $N\\left(D_{i}^{\\circ}\\right) \\cap A \\cap N[Z] \\cap V_{i}$ is $\\mathcal{T}$-poor.\n\nLet $Y:=\\bigcup_{i \\in\\{1,2\\}} N\\left(D_{i}^{\\circ}\\right) \\cap A \\cap N[Z] \\cap V_{i}$. We have that $|Y \\cap \\mathcal{T}| \\leq 2 d$ and for every component $D$ of $G\\left[A^{\\prime}\\right]-N[Z]$, if $D$ contains a relevant $C_{6}$, then $N(D) \\cap A \\cap N[Z] \\subseteq Y$.\n\nLet $D_{\\text {poor }}$ be the union of vertex sets of all components $D$ of $G\\left[A^{\\prime}\\right]-N[Z]$ such that $|D|>1$ and $N(D) \\cap A \\cap N[Z] \\subseteq Y$. Note that every relevant $C_{6}$ that is contained in $G\\left[A^{\\prime}\\right]-N[Z]$ is in fact in $G\\left[D_{\\text {poor }}\\right]$.\n\nUsing cleaning. Let $\\mathcal{F}$ be the result of applying Lemma 4.12 to $G\\left[A^{\\prime} \\backslash\\left(Y \\cup D_{\\text {poor }}\\right)\\right]$ and $Z$. The following claim establishes the progress of the recursion.\n\nClaim 4.20. For every $X \\in \\mathcal{F}$, every connected component $D$ of $G\\left[A^{\\prime} \\backslash\\left(X \\cup Y \\cup Z \\cup D_{\\text {poor }}\\right)\\right]$ either does not contain a relevant $C_{6}$, or every relevant $C_{6}$ in $D$ has at least one neighbor in $(X \\cup Y \\cup Z) \\cap \\mathcal{T}$.\n\nProof. Let $\\mathcal{Z}=\\left\\{A_{i, Q} \\mid i \\in\\{1,2\\}, Q \\subseteq Z \\cap V_{i}\\right\\}$ be the neighborhood partition with respect to $Z$ in $G\\left[A^{\\prime} \\backslash D_{\\text {poor }}\\right]$. Fix $X \\in \\mathcal{F}$ and consider a connected component $D$ of $G\\left[A^{\\prime} \\backslash\\left(X \\cup Y \\cup Z \\cup D_{\\text {poor }}\\right)\\right]$.\n\nIf $D$ is anticomplete to $Z$, then $D$ does not contain a relevant $C_{6}$ as $D$ is not part of $D_{\\text {poor }}$. Lemma 4.9 ensures that $D$ is contained in the union of two sets of $\\mathcal{Z}$, denote them $A_{1, Q_{1}}$ and $A_{2, Q_{2}}$. If any of those sets is adjacent to a vertex of $Z \\cap \\mathcal{T}$, then every relevant $C_{6}$ in $D$ has a neighbor in $Z \\cap \\mathcal{T}$, as desired. Otherwise, both $A_{1, Q_{1}}$ and $A_{2, Q_{2}}$ are anticomplete to $x$ and $y$, and, in case $Z$ has the double $C_{6}$ structure, also to $u, x^{\\prime}$, and $y^{\\prime}$.\n\nIn particular, $D$ is disjoint with $S_{1}^{C} \\cup S_{2}^{C}$. Hence, either $D \\subseteq A^{\\prime} \\backslash\\left(\\mathrm{MR}_{C} \\cup S_{1}^{C} \\cup S_{2}^{C}\\right)$ or $D \\subseteq \\mathrm{MR}_{C}$. Consider now the first case.\n\nIf $D$ does not contain a relevant $C_{6}$, then we are done, so assume otherwise. Let $\\left(C^{\\prime \\prime}, x^{\\prime \\prime}, y^{\\prime \\prime}\\right)$ be a relevant $C_{6}$ in $D$. Observe that $\\mathrm{MR}_{C}$ is contained in the main remainder of $C^{\\prime \\prime}$ in $G\\left[A^{\\prime}\\right]$. Hence, as $(C, x, y)$ is extremal, these two main remainders are equal.\n\nDenote $C=c_{1}-c_{2}-\\ldots-c_{6}-c_{1}$ with $c_{1}=x$ and $c_{4}=y$. Observe that, unless $Q_{1}=\\left\\{c_{3}, c_{5}\\right\\}$ and $Q_{2}=\\left\\{c_{2}, c_{6}\\right\\}$, there exists an an edge of $C$ that is anticomplete to $C^{\\prime \\prime}$. This edge is contained in the main remainder of $C^{\\prime \\prime}$ in $G\\left[A^{\\prime}\\right]$, a contradiction to the fact that $(C, x, y)$ is extremal. In the other case, the fact that $(C, x, y)$ is extremal and $(C, x, y)$ and $\\left(C^{\\prime \\prime}, x^{\\prime \\prime}, y^{\\prime \\prime}\\right)$ have equal main remainders in $G\\left[A^{\\prime}\\right]$ implies that $\\left|A^{\\prime} \\cap N\\left[V\\left(C^{\\prime \\prime}\\right)\\right] \\cap \\mathcal{T}\\right| \\geq\\left|A^{\\prime} \\cap N[V(C)] \\cap \\mathcal{T}\\right|$. Observe that $x, y \\in N[V(C)] \\backslash$ $N\\left[V\\left(C^{\\prime \\prime}\\right)\\right]$. Hence, there are at least two vertices of $\\mathcal{T}$ in $A^{\\prime} \\cap \\mathcal{T} \\cap\\left(N\\left[V\\left(C^{\\prime}\\right)\\right] \\backslash N[V(C)]\\right)$. Since $D \\subseteq A_{1, Q_{1}} \\cup A_{2, Q_{2}} \\subseteq N(V(C))$, these two vertices of $\\mathcal{T}$ necessarily belong to $X \\cup Y \\cup Z$, as desired. This completes the case $D \\subseteq A^{\\prime} \\backslash\\left(\\mathrm{MR}_{C} \\cup S_{1}^{C} \\cup S_{2}^{C}\\right)$.\n\nWe are left with the remaining case $D \\subseteq \\mathrm{MR}_{C}$. If $Z$ is of single $C_{6}$ structure, then we are done, as $D \\cap D_{\\text {poor }}=\\emptyset$ and thus $D$ contains no relevant $C_{6}$. Assume then $Z$ is of double $C_{6}$ structure.\n\nAssume first that $D \\cap D_{0}=\\emptyset$. Recall that $u \\in Q_{1} \\cup Q_{2}$ as otherwise any relevant $C_{6}$ in $D$ has a neighbor in $Z \\cap \\mathcal{T}$ as desired. Hence, $D \\cap N[Z]=\\emptyset$. Then, as $D$ is disjoint with $D_{\\text {poor }}, D$ does not contain any relevant $C_{6}$.\n\nIn the second case, $D \\subseteq D_{0}$ as $D$ is disjoint with $S_{1}^{C} \\cup S_{2}^{C}$. Since $x^{\\prime}, y^{\\prime}, u \\notin Q_{1} \\cup Q_{2}, D \\subseteq$ $D_{0} \\cap N\\left(V\\left(C^{\\prime}\\right)\\right) \\backslash\\left(S_{1}^{C^{\\prime}} \\cup S_{2}^{C^{\\prime}}\\right)$ or $D$ is part of the main remainder of $C^{\\prime}$ in $D_{0}$. In the latter case, the properties of $Z$ ensure that $D$ is contained in $G\\left[A^{\\prime}\\right]-N[Z]$ and, as $D \\cap D_{\\text {poor }}=\\emptyset, D$ contains no relevant $C_{6}$.\n\nIn the former case, let $C^{\\prime}=c_{1}^{\\prime}-c_{2}^{\\prime}-\\ldots-c_{6}^{\\prime}-c_{1}^{\\prime}$ and assume there exists a relevant $C_{6}\\left(C^{\\prime \\prime}, x^{\\prime \\prime}, y^{\\prime \\prime}\\right)$ in $D$. Observe that the main remainder of $C^{\\prime}$ in $G\\left[D_{0}\\right]$ is contained in the main remainder of $C^{\\prime \\prime}$. Since $\\left(C^{\\prime}, x^{\\prime}, y^{\\prime}\\right)$ is extremal in $G\\left[D_{0}\\right]$, these main remainders are equal. Observe that unless $Q_{1} \\cap V\\left(C^{\\prime}\\right)=$ $\\left\\{c_{3}^{\\prime}, c_{5}^{\\prime}\\right\\}$ and $Q_{2} \\cap V\\left(C^{\\prime}\\right)=\\left\\{c_{2}^{\\prime}, c_{6}^{\\prime}\\right\\}$, there is an edge of $C^{\\prime}$ that is anticomplete to $C^{\\prime \\prime}$, a contradiction to the fact that the main remainders of $C^{\\prime}$ and $C^{\\prime \\prime}$ in $G\\left[D_{0}\\right]$ are equal. Otherwise, since $\\left(C^{\\prime}, x^{\\prime}, y^{\\prime}\\right)$ is extremal, there are at least two elements of $\\mathcal{T}$ in $D_{0} \\cap\\left(N\\left(V\\left(C^{\\prime \\prime}\\right)\\right) \\backslash N\\left(V\\left(C^{\\prime}\\right)\\right)\\right)$. Since $D \\subseteq N\\left(V\\left(C^{\\prime}\\right)\\right)$ (if $Q_{1} \\cap V\\left(C^{\\prime}\\right)=\\left\\{c_{3}^{\\prime}, c_{5}^{\\prime}\\right\\}$ and $Q_{2} \\cap V\\left(C^{\\prime}\\right)=\\left\\{c_{2}^{\\prime}, c_{6}^{\\prime}\\right\\}$ ), these two elements of $\\mathcal{T}$ necessarily are in $X \\cup Y \\cup Z$, as desired. This completes the case analysis and the proof of the claim.\n\nWrapping up. We guess $Z$ and $Y$ as described above, compute $D_{\\text {poor }}$ and invoke Lemma 4.12 to $Z$ in $G\\left[A^{\\prime} \\backslash\\left(Y \\cup D_{\\text {poor }}\\right)\\right]$, obtaining a family $\\mathcal{F}$. Claim 4.19 ensures that every connected component of $G\\left[D_{\\text {poor }}\\right]$ belongs to $\\mathcal{A}$ and, furthermore, if $A^{\\prime}$ is $\\mathcal{T}$-regular, then so is every connected component of $G\\left[D_{\\text {poor }}\\right]$. If this is the case, let $\\left(T_{D}, \\beta_{D}\\right)$ be the promised tree decomposition for a component $D$ of $G\\left[D_{\\text {poor }}\\right]$. Insert into $\\mathcal{C}\\left(A^{\\prime}\\right)$ all sets of $\\mathcal{C}(D)$ for every connected component $D$ of $G\\left[D_{\\text {poor }}\\right]$.\n\nFor every $X \\in \\mathcal{F}$, we proceed as follows. First, insert $X \\cup Y \\cup Z \\cup\\left(N\\left(A^{\\prime}\\right) \\cap A\\right)$ into $\\mathcal{C}\\left(A^{\\prime}\\right)$. Then, recurse on every connected component $D$ of $G\\left[A^{\\prime} \\backslash\\left(X \\cup Y \\cup Z \\cup D_{\\text {poor }}\\right)\\right]$ with the same parameters $\\left(\\alpha_{1}, \\alpha_{2}\\right)$, ActiveCls, and $\\gamma$ except for the value $\\gamma(\\mathrm{c})$ increased by one, obtaining a family $\\mathcal{C}^{\\prime}(D)$. For every set $B \\in \\mathcal{C}^{\\prime}(D)$ from the returned family, insert $X \\cup Y \\cup Z \\cup\\left(N\\left(A^{\\prime}\\right) \\cap A\\right) \\cup B$ into the set $\\mathcal{C}\\left(A^{\\prime}\\right)$. This completes the description of the algorithm.\n\nObserve that if $A^{\\prime}$ is $\\mathcal{T}$-regular, then for the set $X \\in \\mathcal{F}$ that satisfies the promise of Lemma 4.12 for $\\mathcal{T}$, we have\n\n$$\n\\left|\\left(X \\cup Y \\cup Z \\cup\\left(N\\left(A^{\\prime}\\right) \\cap A\\right)\\right) \\cap \\mathcal{T}\\right| \\leq 2^{3 \\cdot 14} d^{2}(d+1)+2 d+14+4 d<2^{43}(d+1)^{3}=d_{\\max }\n$$\n\nHence, for that set the premise of the recursion guarantee is satisfied, and we have the promised tree decomposition $\\left(T_{D}, \\beta_{D}\\right)$ of $G[D]$.\n\nConstruct the desired tree decomposition $(T, \\beta)$ as follows. Start with the root bag $(X \\cup Y \\cup Z \\cup$ $\\left.\\left(N\\left(A^{\\prime}\\right) \\cap A\\right)\\right)$. For every connected component $D$ of $G\\left[D_{\\text {poor }}\\right]$, attach $\\left(T_{D}, \\beta_{D}\\right)$ as a subtree with its root adjacent to the root bag of $(T, \\beta)$. For every connected component $D$ of $G\\left[A^{\\prime} \\backslash\\left(X \\cup Y \\cup Z \\cup D_{\\text {poor }}\\right)\\right]$, denote $\\beta_{D}^{\\prime}(t)=\\beta_{D}(t) \\cup X \\cup Y \\cup Z \\cup\\left(N\\left(A^{\\prime}\\right) \\cap A\\right)$ for $t \\in V\\left(T_{D}\\right)$ and attach $\\left(T_{D}, \\beta_{D}^{\\prime}\\right)$ as a subtree with its root adjacent to the root bag of $(T, \\beta)$. It is immediate that $(T, \\beta)$ is a tree decomposition of $G\\left[N\\left[A^{\\prime}\\right] \\cap A\\right]$; the bound on $|\\mathcal{T} \\cap \\beta(t)|$ for any $t \\in V(T)$ follows from (1).", "tables": {}, "images": {}}, {"section_id": 16, "text": "# 5 Proof of Theorem 1.1 \n\nIn this section we use Theorems 3.1 and 4.1 to prove Theorem 1.1. Fix an integer $d>0$.\nOn the very high level, the algorithm works as follows. We invoke Theorem 3.1 on the input graph $G$, obtaining the family $\\mathcal{F}$. Let $\\mathcal{T}$ be the sought solution and let $S$ be a $\\mathcal{T}$-avoiding minimal separator of $G$. Let $\\Psi=(K, \\mathcal{D}, L) \\in \\mathcal{F}$ be the element promised for $S$ by Theorem 3.1. Note that $S \\subseteq W(\\Psi):=K \\cup \\bigcup \\mathcal{D}$. We would like to first understand the components of $\\mathcal{D}$ and then use $W(\\Psi)$ as a container for $S$. Luckily, every $D \\in \\mathcal{D}$ is somewhat easier than the whole graph $G$. Let $\\mathcal{C}(\\Psi)$ be the family of all connected components of $G[L(D)]$ and all connected components of $G[D \\backslash L(D)]$; recall that they are modules of $G[D]$. Every connected component of $\\mathcal{C}(\\Psi)$ has clique number strictly smaller than $G$ (so we can recurse on them), while the quotient graph after contracting every component $\\mathcal{C}(\\Psi)$ in $G[D]$ is bipartite and thus handled by Theorem 4.1.\n\nUnfortunately, we do not know how to handle the aforementioned recursion into $\\mathcal{C}(\\Psi)$ using only the language of families of containers or carvers and we will need to do it using the language of \"partial solutions to $\\mathrm{CMSO}_{2}$ formulae\". To this end, we will use the handy notion of a threshold automata as in [13].\n\nThreshold automata. Let $\\Sigma$ be a finite alphabet. A $\\Sigma$-labelled forest is a rooted forest $F$ where every $v \\in V(F)$ as a label label $(v) \\in \\Sigma$.\n\nWe use the notation $\\{\\{\\cdot\\}\\}$ for defining multisets. For a multiset $X$ and an integer $\\tau \\in \\mathbb{N}$, let $X \\wedge \\tau$ be the multiset obtained from $X$ by the following operation: for every element $e$ whose multiplicity $k$ is larger than $2 \\tau$, we reduce its multiplicity to the unique integer in $\\{\\tau+1, \\ldots, 2 \\tau\\}$ with the same residue as $k$ modulo $\\tau$. For a set $Q$, let $\\operatorname{Multi}(Q, \\tau)$ be the family of all multisets that contain elements of $Q$, and each element is contained at most $2 \\tau$ times.\n\nDefinition 5.1 ([13]). A threshold automaton is a tuple $\\mathcal{A}=(Q, \\Sigma, \\tau, \\delta, C)$, where:\n\n- $Q$ is a finite set of states;\n- $\\Sigma$ is a finite alphabet;\n- $\\tau \\in \\mathbb{N}$ is a nonnegative integer called the threshold;\n- $\\delta: \\Sigma \\times \\operatorname{Multi}(Q, \\tau) \\rightarrow Q$ is the transition function; and\n- $C \\subseteq \\operatorname{Multi}(Q, \\tau)$ is the accepting condition.\n\nFor a $\\Sigma$-labelled forest $F$, the run of $\\mathcal{A}$ on $F$ is the unique labelling $\\xi: V(F) \\rightarrow Q$ satisfying the following property for each $x \\in V(F)$ :\n\n$$\n\\xi(x)=\\delta(\\operatorname{label}(x),\\{\\{\\xi(y): y \\text { is a child of } x\\}\\} \\wedge \\tau)\n$$\n\nWe say that $\\mathcal{A}$ accepts $F$ if\n\n$$\n\\{\\{\\xi(z): z \\text { is a root of } F\\}\\} \\wedge \\tau \\in C\n$$\n\nwhere $\\xi$ is the run of $\\mathcal{A}$ on $F$.\n\nRecall that for a $\\mathrm{CMSO}_{2}$ formula with one vertex set variable $\\phi$, the $(\\phi, \\mathrm{td} \\leq d)$-MWIS problem, given a vertex-weighted graph $G$, asks for a pair $(\\mathrm{Sol}, X)$ with $X \\subseteq \\mathrm{Sol} \\subseteq V(G)$ such that $G[\\mathrm{Sol}]$ is of treedepth at most $d, \\phi(X)$ is satisfied in $G[\\mathrm{Sol}]$, and the weight of $X$ is maximized.\n\nLet $(\\mathrm{Sol}, X)$ be such that $X \\subseteq \\mathrm{Sol} \\subseteq V(G)$ and $\\operatorname{td}(G[\\mathrm{Sol}]) \\leq d$ and let $\\mathcal{T}$ be a treedepth- $d$ structure containing Sol. Let label be a labeling of $V(\\mathcal{T})$ that labels $v \\in V(\\mathcal{T})$ with the following information: (1) its depth in $\\mathcal{T}$, (2) which of its ancestors in $\\mathcal{T}$ it is adjacent to, and (3) whether $v \\in X$ and/or $v \\in$ Sol. As discussed in [13], the check whether $\\phi(X)$ is satisfied in $G[\\mathrm{Sol}]$ can be done with a threshold automaton run on $(\\mathcal{T}$, label). More precisely, there exists a threshold automaton $\\mathcal{A}$ (depending only on $d$ and $\\phi$ ) such that $\\phi(X)$ is satisfied in $G[\\mathrm{Sol}]$ if and only if $\\mathcal{A}$ accepts $\\mathcal{T}$ with labeling label. Thus, instead of focusing on a $\\mathrm{CMSO}_{2}$ formula $\\phi$, we can fix a threshold automaton $\\mathcal{A}$ and look for a treedepth- $d$ structure $\\mathcal{T}$ and $X \\subseteq \\mathrm{Sol} \\subseteq \\mathcal{T}$ such that $\\mathcal{A}$ accepts $\\mathcal{T}$ with the aforementioned labeling and, subject to the above, the weight of $X$ is maximized. In what follows, the labeling label will be implicit and not mentioned.\n\nPartial solutions. A treedepth- $d$ structure $\\mathcal{T}$ is neat if for every non-root node $v$ with a parent $u, u$ is adjacent to at least one descendant of $v$ (possibly $v$ itself). A simple (cf. [13]) argument shows that every treedepth- $d$ structure can be turned into a neat one without increasing the depth of any vertex.\n\nLet $\\preceq_{1}$ be the following quasi-order on sets of vertices of a graph $G: X \\preceq_{1} Y$ if $|X|>|Y|$ or $|X|=|Y|$ and $X$ precedes $Y$ lexicographically. In [13], a quasi-order $\\preceq$ on treedepth- $d$ structures in $G$ was introduced: to compare two treedepth- $d$ structures $\\mathcal{T}_{1}$ and $\\mathcal{T}_{2}$, the following sequence of sets is compared with $\\preceq_{1}$ and the first differing one determines whether $\\mathcal{T}_{1} \\preceq \\mathcal{T}_{2}$ : first the set of all vertices, then the set of all depth- 1 vertices (i.e., roots), then the set of all depth- 2 vertices, $\\ldots$, the set of all depth- $d$ vertices. Although two distinct treedepth- $d$ structures $\\mathcal{T}_{1}, \\mathcal{T}_{2}$ can satisfy both $\\mathcal{T}_{1} \\preceq \\mathcal{T}_{2}$ and $\\mathcal{T}_{2} \\preceq \\mathcal{T}_{1}$, the quasi-order $\\preceq$ is a total order on the set of neat treedepth- $d$ structures [13].\n\nA partial solution in a graph $G$ is a tuple $(\\mathcal{T}, X, \\mathrm{Sol})$ where $\\mathcal{T}$ is a treedepth- $d$ structure in $G$ and $X \\subseteq \\mathrm{Sol} \\subseteq V(\\mathcal{T})$. As in [13], we extend $\\preceq$ to comparing partial solutions: $(\\mathcal{T}, X, \\mathrm{Sol}) \\preceq\\left(\\mathcal{T}^{\\prime}, X^{\\prime}, \\mathrm{Sol}^{\\prime}\\right)$ if:\n\n1. the weight of $X$ is larger than the weight of $X^{\\prime}$, or\n2. the weights of $X$ and $X^{\\prime}$ are equal, but $X \\preceq_{1} X^{\\prime}$;\n3. $X=X^{\\prime}$, but Sol $\\preceq_{1} \\mathrm{Sol}^{\\prime}$;\n4. $X=X^{\\prime}$ and Sol $=$ Sol $^{\\prime}$, but $\\mathcal{T} \\preceq \\mathcal{T}^{\\prime}$.\n\nWe will be looking for a $\\preceq$-minimal solution $(\\mathcal{T}, X, \\mathrm{Sol})$ to our $(\\phi, \\mathrm{td} \\leq d)$-MWIS problem on $G$. As shown in [13], $\\mathcal{T}$ is then maximal and neat.\n\nA partial solution $\\left(\\mathcal{T}^{\\prime}, X^{\\prime}, \\mathrm{Sol}^{\\prime}\\right)$ is an extension of a partial solution $(\\mathcal{T}, X, \\mathrm{Sol})$ if $\\mathcal{T}$ is an induced subgraph of $\\mathcal{T}^{\\prime}$, every root of $\\mathcal{T}$ is a root of $\\mathcal{T}^{\\prime}$, and $X^{\\prime} \\cap \\mathcal{T}=X$ and Sol $^{\\prime} \\cap \\mathcal{T}=$ Sol. An extension $\\left(\\mathcal{T}^{\\prime}, X^{\\prime}, \\mathrm{Sol}^{\\prime}\\right)$ of $(\\mathcal{T}, X, \\mathrm{Sol})$ is neat if for every non-root node $v \\in V\\left(\\mathcal{T}^{\\prime}\\right)$ if $v \\notin V(\\mathcal{T})$, then there is an edge between the parent of $v$ and some descendant of $v$ in $\\mathcal{T}^{\\prime}$.\n\nFor a fixed threshold automaton $\\mathcal{A}=(Q, \\Sigma, \\tau, \\delta, C)$, a multistate assignment of a partial solution $(\\mathcal{T}, X, \\mathrm{Sol})$ is a function $\\xi:\\{\\emptyset\\} \\cup V(\\mathcal{T}) \\rightarrow \\operatorname{Multi}(Q, \\tau)$. We say that an extension $\\left(\\mathcal{T}^{\\prime}, X^{\\prime}, \\mathrm{Sol}^{\\prime}\\right)$ of $(\\mathcal{T}, X$, Sol $)$ evaluates to $\\xi$ if for the run $\\xi^{\\prime}$ of $\\mathcal{A}$ on $\\left(\\mathcal{T}^{\\prime}, X^{\\prime}, \\mathrm{Sol}^{\\prime}\\right)$ (with the aforementioned natural labeling of $\\mathcal{T}^{\\prime}$ ) it holds that\n\n$$\n\\left\\{\\left\\{\\xi^{\\prime}(z) \\mid z \\text { is a root of } \\mathcal{T}^{\\prime} \\text { but not of } \\mathcal{T}\\right\\}\\right\\} \\wedge \\tau_{\\mathcal{A}}=\\xi(\\emptyset)\n$$\n\nand, for every $v \\in V(\\mathcal{T})$,\n\n$$\n\\left\\{\\left\\{\\xi^{\\prime}(z) \\mid z \\text { is a child of } v \\text { in } \\mathcal{T}^{\\prime} \\text { but not in } \\mathcal{T}\\right\\}\\right\\} \\wedge \\tau_{\\mathcal{A}}=\\xi(v)\n$$\n\nIntuitively, $\\xi$ contains all the information on how $\\mathcal{T}^{\\prime} \\backslash \\mathcal{T}$ contributes to the run of $\\mathcal{A}$ on $\\left(\\mathcal{T}^{\\prime}, X^{\\prime}, \\mathrm{Sol}^{\\prime}\\right)$. We will be computing set families $\\mathcal{F}$ as follows.\n\nDefinition 5.2. Let $d, \\tilde{d}, \\tilde{d}>0$ be integers and $\\mathcal{A}$ be a threshold automaton. For a graph $G$ and a set $D \\subseteq V(G)$, we say that a family $\\mathcal{F}$ of subsets of $D$ is a defect- $\\tilde{d}$ extension- $\\tilde{d}$ treedepth- $d$ container family\n\nif for every partial solution $(\\mathcal{T}, X$, Sol) in $G$ with $|V(\\mathcal{T})| \\leq \\tilde{d}$ and for every multistate assignment $\\xi$ of $(\\mathcal{T}, X$, Sol), if $\\left(\\mathcal{T}^{\\prime}, X^{\\prime}\\right.$, Sol $\\left.^{\\prime}\\right)$ is the $\\preceq$-minimal extension of $(\\mathcal{T}, X$, Sol) among extensions that satisfy (1) $V\\left(\\mathcal{T}^{\\prime}\\right) \\backslash V(\\mathcal{T}) \\subseteq D$ and (2) $\\left(\\mathcal{T}^{\\prime}, X^{\\prime}\\right.$, Sol $\\left.^{\\prime}\\right)$ evaluates to $\\xi$, then if $\\left(\\mathcal{T}^{\\prime}, X^{\\prime}\\right.$, Sol $\\left.^{\\prime}\\right)$ is actually a neat extension of $(\\mathcal{T}, X$, Sol), then there exists a tree decomposition $(\\mathcal{T}, \\beta)$ of $G[D]$ such that for every $t \\in V(T)$ there exists $A \\in \\mathcal{F}$ with $\\beta(t) \\subseteq A$ and $\\left|A \\cap \\mathcal{T}^{\\prime}\\right| \\leq \\tilde{d}$.\n\nFurthermore, the family $\\mathcal{F}$ is exact if additionally $\\beta(t)=A$ in the above.\nThe dynamic programming algorithm of [13, Section 3] can be expressed as the following algorithmic lemma that we will use as a subroutine.\nLemma 5.3 ([13]). Let $d, \\tilde{d}, \\tilde{d}>0$ be fixed integers and $\\mathcal{A}$ be a fixed threshold automaton. There exists a polynomial-time algorithm that takes on input a graph $G$, a set $D \\subseteq V(G)$, and a family $\\mathcal{F}$ that is a defect- $\\tilde{d}$ extension- $\\tilde{d}$ treedepth-d container family and outputs, for every partial solution $(\\mathcal{T}, X$, Sol) in $G$ with $|V(\\mathcal{T})| \\leq \\tilde{d}$ and for every multistate assignment $\\xi$ of $(\\mathcal{T}, X$, Sol), the $\\preceq$-minimal extension $\\left(\\mathcal{T}^{\\prime}, X^{\\prime}\\right.$, Sol $\\left.^{\\prime}\\right)$ of $(\\mathcal{T}, X$, Sol $)$ among extensions that evaluate to $\\xi$ and $V\\left(\\mathcal{T}^{\\prime}\\right) \\backslash V(\\mathcal{T}) \\subseteq D$, provided that this is a neat extension.\n\nThe family of Theorem 4.1 is stronger, and we capture it with the following definition.\nDefinition 5.4. Let $d, \\tilde{d}>0$ be integers. For a graph $G$, we say that a family $\\mathcal{F}$ of subsets of $V(G)$ is a defect- $\\tilde{d}$ treedepth-d container family if for every treedepth- $d$ structure $\\mathcal{T}$ in $G$ there exists a tree decomposition $(T, \\beta)$ of $G$ such that for every $t \\in V(T)$ there exists $A \\in \\mathcal{F}$ with $\\beta(t) \\subseteq A$ and $\\left|A \\cap \\mathcal{T}^{\\prime}\\right| \\leq \\tilde{d}$\n\nFurthermore, the family $\\mathcal{F}$ is exact if additionally $\\beta(t)=A$ in the above.\nIn both definitions of a container family we often omit \"treedepth- $d$ \" if the constant $d$ is clear from the context.\n\nNeatness is crucial for the following step.\nLemma 5.5. Let $d>0$ be fixed. Let $G$ be a graph. Let $F \\subseteq D \\subseteq V(G)$. Let $(\\mathcal{T}, X$, Sol $)$ be a partial solution in $G$ and let $\\left(\\mathcal{T}^{\\prime}, X^{\\prime}\\right.$, Sol $\\left.^{\\prime}\\right)$ be a treedepth-d structure in $G$ that is a neat extension of $\\mathcal{T}$ with $V\\left(\\mathcal{T}^{\\prime}\\right) \\backslash V(\\mathcal{T}) \\subseteq D$\n\nLet $\\mathcal{T}_{F}$ consist of $\\mathcal{T}$ and ancestors of all nodes of $\\mathcal{T}^{\\prime}$ in $D \\cap N(F)$. Let $\\mathcal{T}_{F}^{\\prime}$ constist of $\\mathcal{T}$ and ancestors of all nodes of $\\mathcal{T}^{\\prime}$ in $F \\cup(D \\cap N(F))$. Then, $\\left(\\mathcal{T}_{F}^{\\prime}, X^{\\prime} \\cap V\\left(\\mathcal{T}_{F}^{\\prime}\\right)\\right.$, Sol $\\left.\\left.\\mathcal{T} \\cap V\\left(\\mathcal{T}_{F}^{\\prime}\\right)\\right)$ is a neat extension of $\\left(\\mathcal{T}_{F}, X^{\\prime} \\cap V\\left(\\mathcal{T}_{F}\\right)\\right.$, Sol $\\left.\\left.\\mathcal{T} \\cap V\\left(\\mathcal{T}_{F}\\right)\\right)$, and $V\\left(\\mathcal{T}_{F}^{\\prime}\\right) \\backslash V\\left(\\mathcal{T}_{F}\\right) \\subseteq F$.\n\nFurthermore, if $\\mathcal{A}$ is a threshold automaton, $\\xi$ is the multistate assignment that $\\left(\\mathcal{T}^{\\prime}, X^{\\prime}\\right.$, Sol $\\left.^{\\prime}\\right)$ evaluates to in $(\\mathcal{T}, X$, Sol $)$ and $\\xi_{F}$ is the multistate assignment that $\\left(\\mathcal{T}_{F}^{\\prime}, X^{\\prime} \\cap V\\left(\\mathcal{T}_{F}^{\\prime}\\right)\\right.$, Sol $\\left.\\left.\\mathcal{T} \\cap V\\left(\\mathcal{T}_{F}^{\\prime}\\right)\\right)$ evaluates to in $\\left(\\mathcal{T}_{F}, X^{\\prime} \\cap V\\left(\\mathcal{T}_{F}\\right)\\right.$, Sol $\\left.\\left.\\mathcal{T} \\cap V\\left(\\mathcal{T}_{F}\\right)\\right)$, then if $\\left(\\mathcal{T}^{\\prime}, X^{\\prime}\\right.$, Sol $\\left.^{\\prime}\\right)$ is the $\\preceq$-minimum extension of $(\\mathcal{T}, X$, Sol $)$ among extensions that evaluate to $\\xi$ and satisfy $V\\left(\\mathcal{T}^{\\prime}\\right) \\backslash V(\\mathcal{T}) \\subseteq D$, then $\\left(\\mathcal{T}_{F}^{\\prime}, X^{\\prime} \\cap V\\left(\\mathcal{T}_{F}^{\\prime}\\right)\\right.$, Sol $\\left.\\left.\\mathcal{T} \\cap V\\left(\\mathcal{T}_{F}^{\\prime}\\right)\\right)\\right.$ is the $\\preceq$-minimum extension of $\\left(\\mathcal{T}_{F}, X^{\\prime} \\cap V\\left(\\mathcal{T}_{F}\\right)\\right.$, Sol $\\left.\\left.\\mathcal{T} \\cap V\\left(\\mathcal{T}_{F}\\right)\\right)$ among extensions that evaluate to $\\xi_{F}$ and satisfy $V\\left(\\mathcal{T}_{F}^{\\prime}\\right) \\backslash V\\left(\\mathcal{T}_{F}\\right) \\subseteq F$.\nProof. Let $v \\in V\\left(\\mathcal{T}^{\\prime}\\right)$ and $u \\in V\\left(\\mathcal{T}^{\\prime}\\right)$ be such that $u, v \\notin V(\\mathcal{T}), u, v \\notin N(F) \\cap D$, and $u$ is the parent of $v$ in $\\mathcal{T}^{\\prime}$. We claim if exactly one of $u, v$ is in $F$, then $u, v \\in V\\left(\\mathcal{T}_{F}\\right)$.\n\nSince $\\left(\\mathcal{T}^{\\prime}, X^{\\prime}\\right.$, Sol $\\left.^{\\prime}\\right)$ neatly extends $(\\mathcal{T}, X$, Sol $)$, there exists a path $P$ from $v$ to $u$ with internal vertices being the descendants of $v$ in $\\mathcal{T}^{\\prime}$ (so, in particular, $P$ is disjoint with $\\mathcal{T}$ ). If exactly one of $u, v$ is in $F$, then $P$ needs to contain an edge $x y$ with $x \\in F$ and $y \\notin F$. As $P$ is disjoint with $\\mathcal{T}, V(P) \\subseteq D$. Hence, $y \\in N(F) \\cap D$. Since $y$ is a descendant of $v$ in $\\mathcal{T}^{\\prime}$, we have $u, v \\in V\\left(\\mathcal{T}_{F}\\right)$, as desired.\n\nWe infer that if $v \\in V\\left(\\mathcal{T}_{F}^{\\prime}\\right) \\backslash V\\left(\\mathcal{T}_{F}\\right)$, then all descendants of $v$ in $\\mathcal{T}^{\\prime}$ are also in $V\\left(\\mathcal{T}_{F}^{\\prime}\\right) \\backslash V\\left(\\mathcal{T}_{F}\\right)$. Also, if additionally $v \\in F$, then all descencendants of $v$ in $\\mathcal{T}^{\\prime}$ are in $F$. Hence, $\\left(\\mathcal{T}_{F}^{\\prime}, X^{\\prime} \\cap V\\left(\\mathcal{T}_{F}^{\\prime}\\right)\\right.$, Sol $\\left.\\left.\\mathcal{T} \\cap\\right.\\right.$ $V\\left(\\mathcal{T}_{F}^{\\prime}\\right)$ ) is an extension of $\\left(\\mathcal{T}_{F}, X^{\\prime} \\cap V\\left(\\mathcal{T}_{F}\\right)\\right.$, Sol $\\left.\\left.\\mathcal{T} \\cap V\\left(\\mathcal{T}_{F}\\right)\\right)$ and $V\\left(\\mathcal{T}_{F}^{\\prime}\\right) \\backslash V\\left(\\mathcal{T}_{F}\\right) \\subseteq F$. Neatness is immediate from the definition.\n\nFor the last claim, assume that $\\left(\\mathcal{T}_{F}^{\\prime \\prime}, X^{\\prime \\prime}\\right.$, Sol $\\left.^{\\prime \\prime}\\right)$ is a $\\preceq$-smaller extension of $\\left(\\mathcal{T}_{F}, X^{\\prime} \\cap V\\left(\\mathcal{T}_{F}\\right)\\right.$, Sol $\\left.^{\\prime} \\cap\\right.$ $\\left.V\\left(\\mathcal{T}_{F}\\right)\\right)$ that evaluates to $\\xi_{F}$ and with $V\\left(\\mathcal{T}_{F}^{\\prime \\prime}\\right) \\backslash V\\left(\\mathcal{T}_{F}\\right) \\subseteq F$. Then, one easily observes that if we replace $\\mathcal{T}_{F}^{\\prime} \\backslash \\mathcal{T}_{F}$ with $\\mathcal{T}_{F}^{\\prime \\prime} \\backslash \\mathcal{T}_{F}$ and similarly for $X^{\\prime}$ and Sol' in $\\left(\\mathcal{T}^{\\prime}, X^{\\prime}\\right.$, Sol $\\left.^{\\prime}\\right)$ we obtain an extension of $(\\mathcal{T}, X$, Sol $)$ that evaluates to the same $\\xi$ but that is $\\preceq$-smaller, a contradiction.\n\nWe now prove a lemma that handles components $D$ as in the last case \" $D \\in \\mathcal{D}$ \" of Theorem 3.1, using Theorem 4.1 and recursion.\n\nLemma 5.6. Let $d, \\bar{d} \\geq 1$ be fixed integers.\nLet $G$ be a graph, $D \\subseteq V(G)$, and $D=L \\uplus R$ be a partition, let $\\mathcal{D}$ be the family of connected components of $G[L]$ and the connected components of $G[R]$. Assume that every $F \\in \\mathcal{D}$ is a module of $G[D]$ and let $H$ be the quotient graph of $G[D] / \\mathcal{D}$.\n\nFurthermore, assume we are given a defect-d $d_{1}$ exact decomposition family $\\mathcal{F}_{H}$ of $H$ and, for every $F \\in \\mathcal{D}$, we are given a defect- $d_{2}$ extension- $\\left(d^{2}+\\bar{d}\\right)$ decomposition family $\\mathcal{F}_{F}$ of $G\\left[D^{\\prime}\\right]$.\n\nThen, there exists a defect- $\\left((d+1) d_{1}+d_{2}\\right)$ extension- $\\bar{d}$ decomposition family $\\mathcal{F}$ of $D$ in $G$ of size at most $\\left(1+\\left|\\mathcal{F}_{H}\\right|\\right)^{d_{1}}+\\sum_{F \\in \\mathcal{D}}\\left|\\mathcal{F}_{F}\\right|$. Furthermore, it can be computed in time polynomial in the input and output size, given $G, D, L \\uplus R, \\mathcal{F}_{H}$, and $\\left(\\mathcal{F}_{F}\\right)_{F \\in \\mathcal{D}}$.\n\nMoreover, if all families $\\mathcal{F}_{F}$ for $F \\in \\mathcal{D}$ are exact, then $\\mathcal{F}$ is exact, too.\nProof. Fix $(\\mathcal{T}, X$, Sol $), \\xi$, and $\\left(\\mathcal{T}^{\\prime}, X^{\\prime}, \\mathrm{Sol}^{\\prime}\\right)$ as in the definition of a extension- $\\bar{d}$ decomposition family of $D$ in $G$. As in the definition, assume that $\\left(\\mathcal{T}^{\\prime}, X^{\\prime}, \\mathrm{Sol}^{\\prime}\\right)$ is a neat extension of $(\\mathcal{T}, X$, Sol $)$.\n\nObserve that $\\mathcal{D}$ is a partition of $D$. Let\n\n$$\n\\mathcal{D}_{\\mathcal{T}^{\\prime}}=\\left\\{F \\in \\mathcal{D} \\mid F \\cap \\mathcal{T}^{\\prime} \\neq \\emptyset\\right\\}\n$$\n\nAs $H\\left[\\mathcal{D}_{\\mathcal{T}^{\\prime}}\\right]$ is isomorphic to an induced subgraph of $\\mathcal{T}^{\\prime}$, it is of treedepth at most $d$. Consequently, by the promise of $\\mathcal{F}_{H}$, there exists a tree decomposition $\\left(T_{H}, \\beta_{H}\\right)$ of $H$ such that for every $t \\in V\\left(T_{H}\\right)$ we have $\\beta_{H}(t) \\in \\mathcal{F}_{H}$ and $\\left|\\beta_{H}(t) \\cap \\mathcal{D}_{H}\\right| \\leq d_{1}$.\n\nLet\n\n$$\n\\mathcal{D}_{T^{\\prime}}^{\\text {big }}=\\left\\{F \\in \\mathcal{D} \\mid\\left|F \\cap \\mathcal{T}^{\\prime}\\right|>d\\right\\} \\subseteq \\mathcal{D}_{\\mathcal{T}^{\\prime}}\n$$\n\nAs $\\mathcal{T}^{\\prime}$ cannot contain $K_{d+1, d+1}$, we have the following.\nClaim 5.7. For every $F \\in \\mathcal{D}_{\\mathcal{T}^{\\prime}}^{\\text {big }}, \\bigcup_{F^{\\prime} \\in N_{H}(F)} F^{\\prime}$ contains at most $d$ elements of $\\mathcal{T}$. In particular, $\\mathcal{D}_{T^{\\prime}}^{\\text {big }}$ is an independent set in $H$.\n\nObserve that $\\left(T_{H}, \\beta^{\\prime}\\right)$ where $\\beta^{\\prime}(t)=\\bigcup_{F \\in \\beta_{H}(t)} F$ is a tree decomposition of $G[D]$. However, $\\beta^{\\prime}(t)$ may contain unbounded number of elements of $\\mathcal{T}^{\\prime}$ if $\\beta_{H}(t)$ contains an element of $\\mathcal{D}_{\\mathcal{T}^{\\prime}}^{\\text {big }}$. We now modify $\\left(T_{H}, \\beta_{H}\\right)$ to isolate elements of $\\mathcal{D}_{\\mathcal{T}^{\\prime}}^{\\text {big }}$, so that we can use the families $\\mathcal{F}_{F}$ to handle them.\n\nAs a first step, for every $F \\in \\mathcal{D}_{T^{\\prime}}^{\\text {big }}$, we drag all nodes of $N_{H}(F)$ to be present in every bag where $F$ is present, too. More precisely, we define $\\beta_{H}^{1}: V\\left(T_{H}\\right) \\rightarrow 2^{V(H)}$ as\n\n$$\n\\beta_{H}^{1}(t):=\\beta_{H}(t) \\cup \\bigcup_{F \\in \\mathcal{D}_{\\mathcal{T}^{\\prime}}^{\\text {big }} \\cap \\beta_{H}(t)} N_{H}(F)\n$$\n\nTo see that $\\left(T_{H}, \\beta_{H}^{1}\\right)$ is a tree decomposition of $H$, note that for every $F \\in \\mathcal{D}_{T^{\\prime}}^{\\text {big }}$ and $F^{\\prime} \\in N_{H}(F)$, there exists a node $t$ with $F, F^{\\prime} \\in \\beta(t)$, and thus $\\left\\{t \\in V\\left(T_{H}\\right) \\mid F^{\\prime} \\in \\beta_{H}^{1}(t)\\right\\}$ is connected. Furthermore, as $\\bigcup_{F^{\\prime} \\in N_{H}(F)} F^{\\prime}$ contains at most $d$ elements of $\\mathcal{T}$ due to Claim 5.7 and every bag $\\beta_{H}(t)$ contains at most $d_{1}$ elements of $\\mathcal{D}_{\\mathcal{T}^{\\prime}}$, we have\n\n$$\n\\forall_{t \\in V\\left(T_{H}\\right)}\\left|\\bigcup_{F \\in \\beta_{H}^{1}(t) \\backslash \\mathcal{D}_{T^{\\prime}}^{\\text {big }}} F \\cap V\\left(\\mathcal{T}^{\\prime}\\right)\\right| \\leq(d+1) d_{1}\n$$\n\nAs a second step, for every $F \\in \\mathcal{D}_{\\mathcal{T}^{\\prime}}^{\\text {big }}$, we fix one node $t_{F}^{\\prime} \\in V\\left(T_{H}\\right)$ with $F \\in \\beta_{H}^{1}\\left(t_{F}^{\\prime}\\right)$ and add a new degree-1 node $t_{F}$ to $T_{H}$, adjacent to $t_{F}^{\\prime}$. Let $T_{H}^{2}$ be the resulting tree. For $t \\in V\\left(T_{H}^{2}\\right)$, define\n\n$$\n\\beta_{H}^{2}(t):= \\begin{cases}\\beta_{H}^{1}(t) \\backslash \\mathcal{D}_{\\mathcal{T}^{\\prime}}^{\\text {big }} & \\text { if } t \\in V\\left(T_{H}\\right) \\\\ \\beta_{H}^{1}\\left(t_{F}^{\\prime}\\right) & \\text { if } t=t_{F} \\text { for some } F \\in \\mathcal{D}_{\\mathcal{T}^{\\prime}}^{\\text {big }}\\end{cases}\n$$\n\nIt is immediate that $\\left(T_{H}^{2}, \\beta_{H}^{2}\\right)$ is a tree decomposition of $H$ and for every $t \\in V\\left(T_{H}^{2}\\right)$\n\n$$\n\\beta_{H}^{2}(t) \\cap \\mathcal{D}_{\\mathcal{T}^{\\prime}}^{\\mathrm{big}}=\\left\\{\\begin{array}{ll}\n\\emptyset & \\text { if } t \\in V\\left(T_{H}\\right) \\\\\n\\{F\\} & \\text { if } t=t_{F} \\text { for some } F \\in \\mathcal{D}_{\\mathcal{T}^{\\prime}}^{\\mathrm{big}}\n\\end{array}\\right.\n$$\n\nFurthermore, as every bag of $\\left(T_{H}^{2}, \\beta_{H}^{2}\\right)$ is a subset of some bag of $\\left(T_{H}, \\beta_{H}^{1}\\right)$, we have\n\n$$\n\\forall_{t \\in V\\left(T_{H}^{2}\\right)}\\left|\\bigcup_{F \\in \\beta_{H}^{1}(t) \\backslash \\mathcal{D}_{T^{\\prime}}^{\\mathrm{big}}} F \\cap V\\left(\\mathcal{T}^{\\prime}\\right)\\right| \\leq(d+1) d_{1}\n$$\n\nFix $F \\in \\mathcal{D}_{\\mathcal{T}^{\\prime}}^{\\text {big }}$. Let $\\mathcal{T}_{F}$ consist of $\\mathcal{T}$ and ancestors of all nodes of $\\mathcal{T}^{\\prime}$ in $D \\cap N(F)$; note that $\\left|V\\left(\\mathcal{T}_{F}\\right)\\right| \\leq d^{2}+\\bar{d}$ as $\\left|D \\cap N(F) \\cap V\\left(\\mathcal{T}^{\\prime}\\right)\\right| \\leq d$. Let $\\mathcal{T}_{F}^{\\prime}$ constist of $\\mathcal{T}$ and ancestors of all nodes of $\\mathcal{T}^{\\prime}$ in $F \\cup(D \\cap N(F))$. Lemma 5.5 asserts that $\\left(\\mathcal{T}_{F}^{\\prime}, X^{\\prime} \\cap V\\left(\\mathcal{T}_{F}^{\\prime}\\right), \\operatorname{Sol}^{\\prime} \\cap V\\left(\\mathcal{T}_{F}^{\\prime}\\right)\\right)$ is a neat extension of $\\left(\\mathcal{T}_{F}, X^{\\prime} \\cap V\\left(\\mathcal{T}_{F}\\right), \\operatorname{Sol}^{\\prime} \\cap V\\left(\\mathcal{T}_{F}\\right)\\right)$, and $V\\left(\\mathcal{T}_{F}^{\\prime}\\right) \\backslash V\\left(\\mathcal{T}_{F}\\right) \\subseteq F$.\n\nLet $\\xi_{F}$ be the multistate assignment such that $\\left(\\mathcal{T}_{F}^{\\prime}, X^{\\prime} \\cap V\\left(\\mathcal{T}_{F}^{\\prime}\\right), \\operatorname{Sol}^{\\prime} \\cap V\\left(\\mathcal{T}_{F}^{\\prime}\\right)\\right)$ as an extension of $\\left(\\mathcal{T}_{F}, X^{\\prime} \\cap V\\left(\\mathcal{T}_{F}\\right), \\operatorname{Sol}^{\\prime} \\cap V\\left(\\mathcal{T}_{F}\\right)\\right)$ evaluates to. Lemma 5.5 asserts also that $\\left(\\mathcal{T}_{F}^{\\prime}, X^{\\prime} \\cap V\\left(\\mathcal{T}_{F}^{\\prime}\\right), \\operatorname{Sol}^{\\prime} \\cap V\\left(\\mathcal{T}_{F}^{\\prime}\\right)\\right)$ is the $\\preceq$-minimum extension of $\\left(\\mathcal{T}_{F}, X^{\\prime} \\cap V\\left(\\mathcal{T}_{F}\\right), \\operatorname{Sol}^{\\prime} \\cap V\\left(\\mathcal{T}_{F}\\right)\\right)$ among extensions that evaluate fo $\\xi_{F}$ and satisfy $V\\left(\\mathcal{T}_{F}^{\\prime}\\right) \\backslash V\\left(\\mathcal{T}_{F}\\right) \\subseteq F$.\n\nTherefore, the promise for $\\mathcal{F}_{F}$ applies. That is, there exists a tree decomposition $\\left(T_{F}, \\beta_{F}\\right)$ for $\\left(\\mathcal{T}_{F}^{\\prime}, X^{\\prime} \\cap V\\left(\\mathcal{T}_{F}^{\\prime}\\right), \\operatorname{Sol}^{\\prime} \\cap V\\left(\\mathcal{T}_{F}^{\\prime}\\right)\\right)$ : for every $t \\in V\\left(T_{D}\\right)$ there exists $A \\in \\mathcal{F}_{F}$ such that (1) $\\beta_{F}(t) \\subseteq A$, and (2) $\\left|A \\cap \\mathcal{T}_{F}^{\\prime}\\right| \\leq d_{2}$. By the definition of $\\mathcal{T}_{F}^{\\prime}$, the last point also implies $\\left|A \\cap \\mathcal{T}^{\\prime}\\right| \\leq d_{2}$.\n\nWe now construct a tree decomposition $(T, \\beta)$ of $G[D]$ as follows. To construct $T$, start with $T_{H}^{2}$ and, for every $F \\in \\mathcal{D}_{\\mathcal{T}}^{\\text {big }}$, replace $t_{F}$ with $T_{F}$, i.e., remove $t_{F}$ and put $T_{F}$ instead, with its root adjacent to $t_{F}^{\\prime}$. Define $\\beta$ as follows:\n\n$$\n\\beta(t):= \\begin{cases}\\bigcup_{F \\in \\beta_{H}^{2}(t)} F & \\text { if } t \\in V\\left(T_{H}\\right) \\\\ \\bigcup_{F^{\\prime} \\in \\beta_{H}^{1}\\left(t_{F}^{\\prime}\\right)} F^{\\prime} & \\text { if } t \\in V\\left(T_{F}\\right) \\text { for some } F \\in \\mathcal{D}_{\\mathcal{T}}^{\\mathrm{big}}\\end{cases}\n$$\n\nA direct check shows that $(T, \\beta)$ is a tree decomposition of $G[D]$.\nWe output the family $\\mathcal{F}$ consisting of the following sets:\n\n- For every $A \\in \\mathcal{F}$ and $Z \\subseteq A$ that is independent in $H$ and is of size at most $d_{1}$, the set\n\n$$\n\\left(\\bigcup_{F \\in A \\backslash Z} F\\right) \\cup\\left(\\bigcup_{F \\in Z} \\bigcup_{F^{\\prime} \\in N_{H}(F)} F^{\\prime}\\right)\n$$\n\nNote that every bag $\\beta(t)$ for $t \\in V\\left(T_{H}\\right)$ is of the above form and there are at most $\\left(1+\\left|\\mathcal{F}_{H}\\right|\\right)^{d_{1}}$ such sets. Furthermore, by (2), every such set contains at most $(d+1) d_{1}$ elements of $\\mathcal{T}^{\\prime}$.\n\n- For every $F \\in \\mathcal{D}$ and $B \\in \\mathcal{F}_{F}$, the set\n\n$$\n\\left(\\bigcup_{F^{\\prime} \\in N_{H}(F)} F^{\\prime}\\right) \\cup B\n$$\n\nNote that every bag $\\beta(t)$ for $t \\in V\\left(T_{F}\\right)$ for some $F \\in \\mathcal{D}_{\\mathcal{T}}^{\\text {big }}$ is contained in a set of the above form (or exactly equal to a set of the above form if the families $\\mathcal{F}_{F}$ are exact), there are at most $\\sum_{F \\in \\mathcal{D}}\\left|\\mathcal{F}_{F}\\right|$ such sets, and every such set contains at most $d+d_{2}$ elements of $\\mathcal{T}^{\\prime}$.\nThis finishes the proof of the lemma.\n\nWe are now ready to state the technical statement that we will prove by induction on the clique number $k$.\n\nTheorem 5.8. For every fixed integers $d, \\bar{d}, k>0$ and a threshold automaton $\\mathcal{A}$, there exists a constant $\\bar{d}$ and an algorithm that takes on input a vertex-weighted $P_{1}$-free graph $G$ and a set $D \\subseteq V(G)$ with $\\omega(G[D]) \\leqq k$, runs in polynomial time and computes an family $\\mathcal{F}$ of subsets of $D$ that is a defect- $\\bar{d}$ extension- $\\bar{d}$ treedepth- $d$ container family for $D$.\n\nProof. Let $d, \\bar{d}, k>0$ be fixed. We will proceed by induction on $k$. In the base case, $k=1$, so $G[D]$ is edgeless and $\\mathcal{F}=\\{\\{v\\} \\mid v \\in D\\}$ satisfies the requiments with $\\bar{d}=1$. Assume then $k>1$.\n\nLet $d_{1}$ be the bound on $|K \\cap V(\\mathcal{T})|$ of Theorem 3.1 for the fixed $d, k$. Let $\\bar{d}^{\\prime}$ be the constant from the inductive assumption for treedepth $d$, clique number $k-1$, and extension $\\bar{d}+d d_{1}+d^{2}$.\n\nWe invoke Theorem 3.1 on $G[D]$, obtaining a family $\\mathcal{F}^{\\prime}$. For every $\\Psi:=(K, \\mathcal{D}, L) \\in \\mathcal{F}^{\\prime}$ and every $D^{\\prime} \\in \\mathcal{D}$ proceed as follows. Let $\\mathcal{C}\\left(D^{\\prime}\\right)$ be the family of connected components of either $G\\left[L\\left(D^{\\prime}\\right)\\right]$ or of $G\\left[D^{\\prime} \\backslash L\\left(D^{\\prime}\\right)\\right]$. For every $F \\in \\mathcal{C}\\left(D^{\\prime}\\right)$, recurse with the same treedepth $d$, clique number $k-1$, and extension $\\bar{d}+d d_{1}+d^{2}$, obtaining a defect- $\\bar{d}^{\\prime}$ extension- $\\left(\\bar{d}+d d_{1}+d^{2}\\right)$ treedepth- $d$ family $\\mathcal{F}_{F}$. Invoke Theorem 4.1 on the quotient graph $G[\\bigcup \\mathcal{D}] / \\bigcup_{D^{\\prime} \\in \\mathcal{D}} \\mathcal{C}\\left(D^{\\prime}\\right)$, obtaining a family $\\mathcal{F}^{\\text {kip }}$. Invoke Lemma 5.6 in $G, \\bigcup \\mathcal{D}$, partition $\\left(\\bigcup_{D^{\\prime} \\in \\mathcal{D}} L\\left(D^{\\prime}\\right)\\right) \\uplus\\left(\\bigcup_{D^{\\prime} \\in \\mathcal{D}} D^{\\prime} \\backslash L\\left(D^{\\prime}\\right)\\right)$, the family $\\mathcal{F}^{\\text {kip }}$ and families $\\left(\\mathcal{F}_{F}\\right)_{D^{\\prime} \\in \\mathcal{D}, F \\in \\mathcal{C}\\left(D^{\\prime}\\right)}$, obtaining a family $\\mathcal{F}^{\\prime \\prime}$. Note that $\\mathcal{F}^{\\prime \\prime}$ is a defect- $\\bar{d}^{\\prime \\prime}$ extension- $\\left(\\bar{d}+d d_{1}\\right)$ treedepth- $d$ container family for $\\bigcup \\mathcal{D}$ in $G$ for some constant $\\bar{d}^{\\prime \\prime}$.\n\nConstruct a family $\\mathcal{F}^{\\text {sep }}$ as follows. Iterate over all partial solutions $\\left(\\mathcal{T}_{\\Psi}, X_{\\Psi}, \\mathrm{Sol}_{\\Psi}\\right)$ in $G$ with $\\left|V\\left(\\mathcal{T}_{\\Psi}\\right)\\right| \\leq \\bar{d}+d d_{1}$ and their multistate assignments $\\xi_{\\Psi}$. Set $\\mathcal{F}_{\\Psi, \\mathcal{T}}=\\left\\{V\\left(\\mathcal{T}_{\\Psi}\\right) \\cup A \\mid A \\in \\mathcal{F}^{\\prime \\prime}\\right.$. For every choice of $\\left(\\mathcal{T}_{\\Psi}, X_{\\Psi}, \\mathrm{Sol}_{\\Psi}\\right)$ and $\\xi_{\\Psi}$, use $\\mathcal{F}_{\\Psi, \\mathcal{T}}$ and the algorithm of [13, Section 3] (Lemma 5.3) to compute in polynomial time the $\\preceq$-minimum extension $\\left(\\mathcal{T}_{\\Psi}^{\\prime}, X_{\\Psi}^{\\prime}, \\mathrm{Sol}_{\\Psi}^{\\prime}\\right)$ of $\\left(\\mathcal{T}_{\\Psi}, X_{\\Psi}, \\mathrm{Sol}_{\\Psi}\\right)$ among extensions that evaluate to $\\xi$ and satisfy $V\\left(\\mathcal{T}_{\\Psi}^{\\prime}\\right) \\backslash V\\left(\\mathcal{T}_{\\Psi}\\right) \\subseteq \\bigcup \\mathcal{D}$. Insert $K \\cup\\left(\\bigcup \\mathcal{D} \\backslash V\\left(\\mathcal{T}_{\\Psi}^{\\prime}\\right)\\right)$ into $\\mathcal{F}^{\\text {sep }}$.\n\nLet $(\\mathcal{T}, X$, Sol $)$ be a partial solution with $|V(\\mathcal{T})| \\leq \\bar{d}$, let $\\xi$ be a multistage assignment of $(\\mathcal{T}, X$, Sol $)$, and let $\\left(\\mathcal{T}^{\\prime}, X^{\\prime}, \\mathrm{Sol}^{\\prime}\\right)$ be the $\\preceq$-minimum extension of $(\\mathcal{T}, X$, Sol $)$ amongs ones that evaluate to $\\xi$ and satisfy $V\\left(\\mathcal{T}^{\\prime}\\right) \\backslash V(\\mathcal{T}) \\subseteq D$. Assume $\\left(\\mathcal{T}^{\\prime}, X^{\\prime}, \\mathrm{Sol}^{\\prime}\\right)$ is a neat extension of $(\\mathcal{T}, X$, Sol $)$.\n\nLet $\\mathcal{T}^{\\prime \\prime}$ be any maximal treedepth- $d$ structure that contains $V\\left(\\mathcal{T}^{\\prime}\\right) \\cap D$. Let $F^{\\prime \\prime}$ be any $\\mathcal{T}^{\\prime \\prime}$-aligned minimal chordal completion of $G[D]$. Let $S$ be a $\\mathcal{T}^{\\prime \\prime}$-avoiding minimal separator of $G[D]+F^{\\prime \\prime}$ with full components $A, B$. Let $\\Psi=(K, \\mathcal{D}, L) \\in \\mathcal{F}^{\\prime}$ be the tuple for $S, A, B$ promised by Theorem 3.1. Set $F:=\\bigcup \\mathcal{D}$ and use Lemma 5.5 to $G, D, F,(\\mathcal{T}, X$, Sol $)$ and $\\left(\\mathcal{T}^{\\prime}, X^{\\prime}, \\mathrm{Sol}^{\\prime}\\right)$. We infer that $\\mathcal{F}^{\\text {sep }}$ contains $K \\cup\\left(F \\backslash V\\left(\\mathcal{T}^{\\prime}\\right)\\right)$. As $K$ is guaranteed to contain $V\\left(\\mathcal{T}^{\\prime}\\right) \\cap S$, we have that $S \\subseteq K \\cup\\left(F \\backslash V\\left(\\mathcal{T}^{\\prime}\\right)\\right)$. That is, $\\mathcal{F}^{\\text {sep }}$ contains a set that on one hand contains $S$, and on the other hand contains at most $d_{1}+\\bar{d}^{\\prime \\prime}$ elements of $\\mathcal{T}^{\\prime \\prime}$.\n\nLet $c=c(k)$ be the constant from Corollary 2.13 for $t=7$ and $k$. We set $\\mathcal{F}$ to be the union of $\\{N[v] \\mid v \\in V(G)\\}$ and the set of all possible unions at most $c$ elements of $\\mathcal{F}^{\\text {sep }}$. Corollary 2.13 implies that for every maximal clique $\\Omega$ of $G[D]+F^{\\prime \\prime}$ there exists $A \\in \\mathcal{F}$ with $\\Omega \\subseteq A$ and $\\left|A \\cap V\\left(\\mathcal{T}^{\\prime}\\right)\\right| \\leq$ $c\\left(d_{1}+\\bar{d}^{\\prime \\prime}\\right)$. Hence, a clique tree $(T, \\beta)$ of $G[D]+F^{\\prime \\prime}$ satisfies the requirements of the theorem for $\\bar{d}=c\\left(d_{1}+\\bar{d}^{\\prime \\prime}\\right)$. This finishes the proof.\n\nTheorem 1.1 follows now from the combination of Theorem 5.8 for $\\bar{d}=0$ and $D=V(G)$ and the algorithm of [13, Section 3] (Lemma 5.3). Note that for the case $\\bar{d}$, any $\\preceq$-minimum extension $\\left(\\mathcal{T}^{\\prime}, X^{\\prime}, \\mathrm{Sol}^{\\prime}\\right)$ of $(\\emptyset, \\emptyset, \\emptyset)$ among extensions that evaluate to some fixed multistate assignment $\\xi$ satisfies that $\\mathcal{T}^{\\prime}$ is maximal and neat, as proven in [13].", "tables": {}, "images": {}}, {"section_id": 17, "text": "# 6 Conclusion \n\nOur work suggests some directions for future research. Of course the most ambitious goal is to show a polynomial-time algorithm for (tw $\\leq d, \\psi$ )-MWIS in $P_{t}$-free graphs, for all fixed $t$, with the first open case for $t=7$ (with no further assumptions on the graph).\n\nHowever, there are several intermediate goals that also seem interesting. For example, we think that the idea of considering graphs of bounded clique number is quite promising. Not only it allows us to use some strong structural tools like $\\chi$-boundedness or VC-dimension, but also to measure the progress of an algorithm by decreasing clique number (see also [12, 11]).\n\nProblem 6.1 ([12, Problem 9.2]). Show that for every fixed $t$ and $k$, MWIS is polynomial-time solvable in $P_{t}$-free graphs with clique number at most $k$.\n\nAs illustrated in Section 4, assuming additionally that a graph is bipartite might lead to an easier, but still interesting problem. Of course in this setting asking for an algorithm for MWIS makes little sense, but already the next case is far from trivial.\n\nProblem 6.2. Show that for every fixed $t$, given a vertex-weighted bipartite $P_{t}$-free graph, in polynomialtime we can find an induced forest of maximum possible weight.\n\nRecall that the polynomial-time algorithm for $t=7$ follows not only from our work, but also (via a very different approach) from the work of Lozin and Zamaraev [33] - their structural theorem about $P_{7}$-free bipartite graphs have bounded mim-width. However, this is no longer the case for $P-8$-free bipartite graphs, as shown by Brettell et al. [10].\n\nA different subclass of $P_{t}$-free graphs are $\\left(P_{t}, K_{1, k}\\right)$-free graphs (i.e., excluding additionally a star with $k$ leaves as an induced subgraph), studied by Lozin and Rautenbach [32], who show that Maximum Weight Independent Set is polynomial-time solvable in these graph classes. Does this result generalize to (tw $\\leq d, \\psi)$-MWIS?\n\nFinally, let us point out that Abrishami, Chudnovsky, Pilipczuk, Rz\u0105\u0328\u0307ewski, and Seymour [1] did not only provide an algorithm for (tw $\\leq d, \\psi$ )-MWIS in $P_{5}$-free graphs, but they actually considered a richer class of graphs. In particular, their algorithm works for $C_{>4}$-free graphs, i.e., graph with no induced cycles of length more than 4 (analogously we define $C_{>t}$-free graphs for any $t$ ). Similarly, the quasipolynomial-time algorithm for (tw $\\leq d, \\psi$ )-MWIS works for $C_{>t}$-free graphs, for any $t$. Note that $C_{>t}$-free graphs are a proper superclass of $P_{t}$-free graphs.\n\nWe believe that all polynomial-time results for $P_{t}$-free graphs, discussed in this paper, can be actually lifted to $C_{>t}$-free graphs.", "tables": {}, "images": {}}, {"section_id": 18, "text": "# References \n\n[1] Tara Abrishami, Maria Chudnovsky, Marcin Pilipczuk, Pawe\u0142 Rz\u0105\u0307ewski, and Paul D. Seymour. Induced subgraphs of bounded treewidth and the container method. SIAM J. Comput., 53(3):624647, 2024.\n[2] Benjamin Bergougnoux, \u00c9douard Bonnet, Nick Brettell, and O-joung Kwon. Close relatives of feedback vertex set without single-exponential algorithms parameterized by treewidth. In Yixin Cao and Marcin Pilipczuk, editors, 15th International Symposium on Parameterized and Exact Computation, IPEC 2020, December 14-18, 2020, Hong Kong, China (Virtual Conference), volume 180 of LIPIcs, pages 3:1-3:17. Schloss Dagstuhl - Leibniz-Zentrum f\u00fcr Informatik, 2020.\n[3] Benjamin Bergougnoux, Jan Dreier, and Lars Jaffke. A logic-based algorithmic meta-theorem for mim-width. In Nikhil Bansal and Viswanath Nagarajan, editors, Proceedings of the 2023 ACMSIAM Symposium on Discrete Algorithms, SODA 2023, Florence, Italy, January 22-25, 2023, pages 3282-3304. SIAM, 2023.\n[4] Marthe Bonamy, Nicolas Bousquet, Micha\u0142 Pilipczuk, Pawe\u0142 Rz\u0105\u0307ewski, St\u00e9phan Thomass\u00e9, and Bartosz Walczak. Degeneracy of $P_{t}$-free and $C_{>t}$-free graphs with no large complete bipartite subgraphs. J. Comb. Theory B, 152:353-378, 2022.\n\n[5] Flavia Bonomo, Maria Chudnovsky, Peter Maceli, Oliver Schaudt, Maya Stein, and Mingxian Zhong. Three-coloring and list three-coloring of graphs without induced paths on seven vertices. Comb., 38(4):779-801, 2018.\n[6] Flavia Bonomo-Braberman, Maria Chudnovsky, Jan Goedgebeur, Peter Maceli, Oliver Schaudt, Maya Stein, and Mingxian Zhong. Better 3-coloring algorithms: Excluding a triangle and a seven vertex path. Theor. Comput. Sci., 850:98-115, 2021.\n[7] Vincent Bouchitt\u00e9 and Ioan Todinca. Listing all potential maximal cliques of a graph. Theor. Comput. Sci., 276(1-2):17-32, 2002.\n[8] Vincent Bouchitt\u00e9 and Ioan Todinca. Treewidth and minimum fill-in: Grouping the minimal separators. SIAM J. Comput., 31(1):212-232, jan 2002.\n[9] Andreas Brandst\u00e4dt and Raffaele Mosca. Maximum Weight Independent Sets for ( $P_{7}$, triangle)free graphs in polynomial time. Discret. Appl. Math., 236:57-65, 2018.\n[10] Nick Brettell, Jake Horsfield, Andrea Munaro, Giacomo Paesani, and Dani\u00ebl Paulusma. Bounding the mim-width of hereditary graph classes. J. Graph Theory, 99(1):117-151, 2022.\n[11] Nick Brettell, Jake Horsfield, Andrea Munaro, and Dani\u00ebl Paulusma. List $k$-colouring $P_{t}$-free graphs: A mim-width perspective. Inf. Process. Lett., 173:106168, 2022.\n[12] Maria Chudnovsky, Jason King, Micha\u0142 Pilipczuk, Pawe\u0142 Rz\u0105\u017cewski, and Sophie Spirkl. Finding large $H$-colorable subgraphs in hereditary graph classes. SIAM J. Discret. Math., 35(4):2357-2386, 2021.\n[13] Maria Chudnovsky, Rose McCarty, Marcin Pilipczuk, Micha\u0142 Pilipczuk, and Pawe\u0142 Rz\u0105\u017cewski. Sparse induced subgraphs in $P_{6}$-free graphs. In David P. Woodruff, editor, Proceedings of the 2024 ACM-SIAM Symposium on Discrete Algorithms, SODA 2024, Alexandria, VA, USA, January 7-10, 2024, pages 5291-5299. SIAM, 2024.\n[14] Derek G. Corneil, Yehoshua Perl, and Lorna K. Stewart. A linear recognition algorithm for cographs. SIAM J. Comput., 14(4):926-934, 1985.\n[15] Bruno Courcelle, Johann A. Makowsky, and Udi Rotics. Linear time solvable optimization problems on graphs of bounded clique width. In Juraj Hromkovic and Ondrej S\u00fdkora, editors, GraphTheoretic Concepts in Computer Science, 24th International Workshop, WG '98, Smolenice Castle, Slovak Republic, June 18-20, 1998, Proceedings, volume 1517 of Lecture Notes in Computer Science, pages 1-16. Springer, 1998.\n[16] Cl\u00e9ment Dallard, Martin Milani\u010d, and Kenny Storgel. Treewidth versus clique number. II. treeindependence number. J. Comb. Theory B, 164:404-442, 2024.\n[17] Guo Li Ding, Paul Seymour, and Peter Winkler. Bounding the vertex cover number of a hypergraph. Combinatorica, 14(1):23-34, March 1994.\n[18] Jack Edmonds. Paths, trees, and flowers. Canadian Journal of Mathematics, 17:449-467, 1965.\n[19] Fedor V. Fomin, Ioan Todinca, and Yngve Villanger. Large induced subgraphs via triangulations and CMSO. SIAM J. Comput., 44(1):54-87, 2015.\n[20] Peter Gartland and Daniel Lokshtanov. Independent set on $P_{k}$-free graphs in quasi-polynomial time. In Sandy Irani, editor, 61st IEEE Annual Symposium on Foundations of Computer Science, FOCS 2020, Durham, NC, USA, November 16-19, 2020, pages 613-624. IEEE, 2020.\n\n[21] Peter Gartland, Daniel Lokshtanov, Tom\u00e1s Masa\u0159\u00edk, Marcin Pilipczuk, Micha\u0142 Pilipczuk, and Pawe\u0142 Rz\u0105\u017cewski. Maximum weight independent set in graphs with no long claws in quasipolynomial time. In Bojan Mohar, Igor Shinkar, and Ryan O'Donnell, editors, Proceedings of the 56th Annual ACM Symposium on Theory of Computing, STOC 2024, Vancouver, BC, Canada, June 24-28, 2024, pages 683-691. ACM, 2024.\n[22] Peter Gartland, Daniel Lokshtanov, Marcin Pilipczuk, Micha\u0142 Pilipczuk, and Pawe\u0142 Rz\u0105\u017cewski. Finding large induced sparse subgraphs in $C_{\\infty 1}$-free graphs in quasipolynomial time. In Samir Khuller and Virginia Vassilevska Williams, editors, STOC '21: 53rd Annual ACM SIGACT Symposium on Theory of Computing, Virtual Event, Italy, June 21-25, 2021, pages 330-341. ACM, 2021.\n[23] Andrzej Grzesik, Tereza Klimo\u0161ov\u00e1, Marcin Pilipczuk, and Micha\u0142 Pilipczuk. Polynomial-time algorithm for maximum weight independent set on $P_{0}$-free graphs. ACM Trans. Algorithms, 18(1):4:1-4:57, 2022.\n[24] Martin Gr\u00f6tschel, Laszlo Lov\u00e1sz, and Alexander Schrijver. Polynomial algorithms for perfect graphs. In C. Berge and V. Chv\u00e1tal, editors, Topics on Perfect Graphs, volume 88 of North-Holland Mathematics Studies, pages 325-356. North-Holland, 1984.\n[25] Andr\u00e1s Gy\u00e1rf\u00e1s. Problems from the world surrounding perfect graphs. Applicationes Mathematicae, 19(3-4):413-441, 1987.\n[26] Fr\u00e9d\u00e9ric Havet, Ross J. Kang, and Jean-S\u00e9bastien Sereni. Improper coloring of unit disk graphs. Networks, 54(3):150-164, 2009.\n[27] Bart M. P. Jansen, Daniel Lokshtanov, and Saket Saurabh. A near-optimal planarization algorithm. In Chandra Chekuri, editor, Proceedings of the Twenty-Fifth Annual ACM-SIAM Symposium on Discrete Algorithms, SODA 2014, Portland, Oregon, USA, January 5-7, 2014, pages 1802-1811. SIAM, 2014.\n[28] Richard M. Karp. Reducibility among combinatorial problems. In Raymond E. Miller, James W. Thatcher, and Jean D. Bohlinger, editors, Complexity of Computer Computations: Proceedings of a symposium on the Complexity of Computer Computations, held March 20-22, 1972, at the IBM Thomas J. Watson Research Center, Yorktown Heights, New York, and sponsored by the Office of Naval Research, Mathematics Program, IBM World Trade Corporation, and the IBM Research Mathematical Sciences Department, pages 85-103, Boston, MA, 1972. Springer US.\n[29] Ton Kloks, Ching-Hao Liu, and Sheung-Hung Poon. Feedback vertex set on chordal bipartite graphs. CoRR, abs/1104.3915, 2012.\n[30] Paloma T. Lima, Martin Milani\u010d, Peter Mursic, Karolina Okrasa, Pawel Rz\u0105\u017cewski, and Kenny \u0160torgel. Tree decompositions meet induced matchings: beyond max weight independent set. CoRR, abs/2402.15834, 2024.\n[31] Daniel Lokshtanov, Martin Vatshelle, and Yngve Villanger. Independent set in $P_{2}$-free graphs in polynomial time. In Chandra Chekuri, editor, Proceedings of the Twenty-Fifth Annual ACM-SIAM Symposium on Discrete Algorithms, SODA 2014, Portland, Oregon, USA, January 5-7, 2014, pages 570-581. SIAM, 2014.\n[32] Vadim V. Lozin and Dieter Rautenbach. Some results on graphs without long induced paths. Inf. Process. Lett., 88(4):167-171, 2003.\n[33] Vadim V. Lozin and Viktor Zamaraev. The structure and the number of $P_{7}$-free bipartite graphs. Eur. J. Comb., 65:143-153, 2017.\n\n[34] Pranabendu Misra, Venkatesh Raman, M. S. Ramanujan, and Saket Saurabh. Parameterized algorithms for even cycle transversal. In Martin Charles Golumbic, Michal Stern, Avivit Levy, and Gila Morgenstern, editors, Graph-Theoretic Concepts in Computer Science - 38th International Workshop, WG 2012, Jerusalem, Israel, June 26-28, 2012, Revised Seltcted Papers, volume 7551 of Lecture Notes in Computer Science, pages 172-183. Springer, 2012.\n[35] Giacomo Paesani, Dani\u00ebl Paulusma, and Pawe\u0142 Rz\u0105\u0328\u0307ewski. Feedback Vertex Set and Even Cycle Transversal for $H$-free graphs: Finding large block graphs. SIAM J. Discret. Math., 36(4):24532472, 2022.\n[36] Marcin Pilipczuk. A tight lower bound for Vertex Planarization on graphs of bounded treewidth. Discret. Appl. Math., 231:211-216, 2017.\n[37] Marcin Pilipczuk, Micha\u0142 Pilipczuk, and Pawe\u0142 Rz\u0105\u0307ewski. Quasi-polynomial-time algorithm for independent set in $P_{1}$-free graphs via shrinking the space of induced paths. In Hung Viet Le and Valerie King, editors, 4th Symposium on Simplicity in Algorithms, SOSA 2021, Virtual Conference, January 11-12, 2021, pages 204-209. SIAM, 2021.\n[38] Marcin Pilipczuk and Pawe\u0142 Rz\u0105\u0307ewski. A polynomial bound on the number of minimal separators and potential maximal cliques in $P_{0}$-free graphs of bounded clique number. CoRR, abs/2310.11573, 2023.\n[39] Vladimir N. Vapnik and Alexei Ya. Chervonenkis. On the uniform convergence of relative frequencies of events to their probabilities. Theory of Probability \\& Its Applications, 16(2):264-280, 1971.", "tables": {}, "images": {}}], "id": "2412.14836v3", "authors": ["Maria Chudnovsky", "Jadwiga Czy\u017cewska", "Kacper Kluk", "Marcin Pilipczuk", "Pawe\u0142 Rz\u0105\u017cewski"], "categories": ["cs.DS", "math.CO"], "abstract": "Many natural computational problems, including e.g. Max Weight Independent\nSet, Feedback Vertex Set, or Vertex Planarization, can be unified under an\numbrella of finding the largest sparse induced subgraph, that satisfies some\nproperty definable in CMSO$_2$ logic.\n  It is believed that each problem expressible with this formalism can be\nsolved in polynomial time in graphs that exclude a fixed path as an induced\nsubgraph.\n  This belief is supported by the existence of a quasipolynomial-time algorithm\nby Gartland, Lokshtanov, Pilipczuk, Pilipczuk, and Rz\\k{a}\\.zewski [STOC 2021],\nand a recent polynomial-time algorithm for $P_6$-free graphs by Chudnovsky,\nMcCarty, Pilipczuk, Pilipczuk, and Rz\\k{a}\\.zewski [SODA 2024].\n  In this work we extend polynomial-time tractability of all such problems to\n$P_7$-free graphs of bounded clique number.", "updated": "2025-04-22T08:54:36Z", "published": "2024-12-19T13:27:25Z"}